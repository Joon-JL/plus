<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN" "http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>    							
		<query id="common.legacyintf.insertInfContCnsdreq" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
		    	EXEC	dbo.SP_DELETE_TNC_INF_CONTRACT	:vo.key_id
		    	
				INSERT INTO TN_INF_CONT_CNSDREQ (
					TCOMP_CD,
					TCOMP_NM,
					KEY_ID,
					KEY_NM,
					REQ_TITLE,
					BIZ_CLSFCN,
					DEPTH_CLSFCN,
					CNCLSNPURPS_BIGCLSFCN,
					CNCLSNPURPS_MIDCLSFCN,
					BFHDCSTN_MTNMAN_ID,
					BFHDCSTN_MTNMAN_NM,
					BFHDCSTN_MTNMAN_JIKGUP_NM,
					BFHDCSTN_MTN_DEPT_NM,
					BFHDCSTN_APBTMAN_ID,
					BFHDCSTN_APBTMAN_NM,
					BFHDCSTN_APBTMAN_JIKGUP_NM,
					BFHDCSTN_APBT_DEPT_NM,
					BFHDCSTN_APBTDAY,
					BFHDCSTN_APBT_MTHD,
					RE_DEMNDDAY,
					REQMAN_ID,
					REQMAN_NM,
					REQMAN_JIKGUP_NM,
					REQ_DEPT_NM,
					REQ_DT,
					CNTRT_OPPNT_CD,
					CNTRT_OPPNT_NM,
					POSTALCODE,
					CITYN,
					NATION,
					STAPR,					
					VENDOR_TYPE,
					TNC_APP_LINK,
					CTC_LINK,
					OTC_Link,
					TNC_SUMMARY_LINK,
					SYS_NM,
					IF_DT,
					ECMS_RESULT_FLAG,
					CNTRT_TRGT,
					TNC_SOURCE,
					CNTRTPERIOD_STARTDAY,
					CNTRTPERIOD_ENDDAY
				) VALUES (
					:vo.tcomp_cd,
					:vo.tcomp_nm,
					:vo.key_id,
					:vo.key_nm,
					:vo.req_title,
					:vo.biz_clsfcn,
					:vo.depth_clsfcn,
					:vo.cnclsnpurps_bigclsfcn,
					:vo.cnclsnpurps_midclsfcn,
					:vo.bfhdcstn_mtnman_id,
					:vo.bfhdcstn_mtnman_nm,
					:vo.bfhdcstn_mtnman_jikgup_nm,
					:vo.bfhdcstn_mtn_dept_nm,
					:vo.bfhdcstn_apbtman_id,
					:vo.bfhdcstn_apbtman_nm,
					:vo.bfhdcstn_apbtman_jikgup_nm,
					:vo.bfhdcstn_apbt_dept_nm,
					:vo.bfhdcstn_apbtday,
					:vo.bfhdcstn_apbt_mthd,
					:vo.re_demndday,
					:vo.reqman_id,
					:vo.reqman_nm,
					:vo.reqman_jikgup_nm,
					:vo.req_dept_nm,
					:vo.req_dt,
					:vo.cntrt_oppnt_cd,
					:vo.cntrt_oppnt_nm,
					:vo.postalcode,
					:vo.cityn,
					:vo.nation,
					:vo.stapr,					
					:vo.vendor_type,
					:vo.tnc_app_link,
					:vo.ctc_link,
					:vo.otc_link,
					:vo.tnc_summary_link,
					:vo.sys_nm,
					:vo.if_dt,
					:vo.ecms_result_flag,
					:vo.cntrt_trgt,
					:vo.tnc_source,
					:vo.cntrtperiod_startday,
					:vo.cntrtperiod_endday					
		    	)
		    ]]>
		  </statement>
		</query>
		
		<query id="common.legacyintf.insertInfFileAttach" isCamelCase="false">
		  <statement>
		    <![CDATA[
				INSERT INTO TN_INF_FILE_ATTACH (
					TCOMP_CD,
					TCOMP_NM,
					KEY_ID,
					KEY_NM,
					FILE_ID,
					FILE_SRT,
					FILE_SZ,
					SYS_CD,
					FILE_BIGCLSFCN,
					FILE_MIDCLSFCN,
					FILE_SMLCLSFCN,
					ORG_FILE_NM,
					FILE_PATH,					
					FILE_INFO,
					DEL_YN,
					REG_ID,
					REG_DT,
					SYS_NM,
					IF_DT,
					ECMS_RESULT_FLAG					
				) VALUES (
					:vo.tcomp_cd,
					:vo.tcomp_nm,
					:vo.key_id,
					:vo.key_nm,
					:vo.file_id,
					:vo.file_srt,
					:vo.file_sz,
					:vo.sys_cd,
					:vo.file_bigclsfcn,
					:vo.file_midclsfcn,
					:vo.file_smlclsfcn,
					:vo.org_file_nm,
					:vo.file_path,					
					:vo.file_info,
					:vo.del_yn,
					:vo.reg_id,
					GETDATE(),
					:vo.sys_nm,
					:vo.if_dt,
					:vo.ecms_result_flag
		    	)
		    ]]>
		  </statement>
		</query>
		
		<query id="common.legacyintf.getTncMatchInfo" isCamelCase="false">
		  <statement>
		 	<![CDATA[
		 		SELECT 
		 			A.TCOMP_CD, 
		 			A.KEY_ID,
		 			B.CNTRT_ID,
		 			B.COMP_CD, 
		 			B.CNTRT_NO,
		 			B.CNTRT_NM,  
		 			B.CONT_DRAFT 
				FROM TN_INF_CONTTNC_MATCH A,TN_CLM_CONTRACT_MASTER B
				WHERE A.CNTRT_ID=B.CNTRT_ID
				AND A.CNTRT_ID=:vo.cntrt_id				
			]]>
			</statement>
		</query>
		
		<query id="common.legacyintf.getRequiredItemInfo" isCamelCase="false">
		  <statement>
		  <![CDATA[
		    SELECT
		    	CASE 
				WHEN A.DIS_YN='N'
				THEN ''
				WHEN A.DIS_YN='Y' AND B.DIS_YN='N'
				THEN 'N'
				ELSE 'Y'
				END
				AS ITEM_YN
				  FROM TB_COM_REQU_ITEM A
				  LEFT OUTER JOIN TN_CLM_REQU_ITEM B ON A.ITEM_CD = B.ITEM_CD
				                        AND B.CNTRT_ID = :vo.cntrt_id
										AND B.COMP_CD = :vo.comp_cd
			WHERE A.COMP_CD = :vo.comp_cd
			ORDER BY A.ITEM_CD
			]]>
			</statement>
		</query>
		
		
		<query id="common.legacyintf.countRequiredItemInfo" isCamelCase="false">
			<statement>
			<![CDATA[
			SELECT
				CHECK_LIST_YN
			FROM TN_CLM_CONTRACT_MASTER
			WHERE CNTRT_ID = :vo.cntrt_id
			]]>
			</statement>
		</query>
		
		<query id="common.legacyintf.countRequiredItemInfoForPost" isCamelCase="false">
			<statement>
			<![CDATA[
			SELECT
				CHECK_LIST_YN
			FROM TN_CLM_CONTRACT_MASTER
			WHERE CNTRT_ID = (SELECT MAX(TA.PARENT_CNTRT_ID) 
	           					FROM TN_CLM_RELATION_CONTRACT TA 
	           					WHERE TA.CNTRT_ID = :vo.cntrt_id AND REL_DEFN = 'Master' )			
			]]>
			</statement>
		</query>
		
		<query id="common.legacyintf.getRequiredItemInfoForPost" isCamelCase="false">
		  <statement>
		  <![CDATA[
		    SELECT
		    	CASE 
				WHEN A.DIS_YN='N'
				THEN ''
				WHEN A.DIS_YN='Y' AND B.DIS_YN='N'
				THEN 'N'
				ELSE 'Y'
				END
				AS ITEM_YN
				  FROM TB_COM_REQU_ITEM A
				  LEFT OUTER JOIN TN_CLM_REQU_ITEM B ON A.ITEM_CD = B.ITEM_CD
				                        AND B.CNTRT_ID = (SELECT MAX(TA.PARENT_CNTRT_ID) 
				                        					FROM TN_CLM_RELATION_CONTRACT TA 
				                        					WHERE TA.CNTRT_ID = :vo.cntrt_id AND REL_DEFN = 'Master' )
										AND B.COMP_CD = :vo.comp_cd
			WHERE A.COMP_CD = :vo.comp_cd
			ORDER BY A.ITEM_CD
			]]>
			</statement>
		</query>
									
		<query id="common.legacyintf.insertInfCntTncMatch" isCamelCase="false">
			<statement>
			<![CDATA[
				INSERT INTO TN_INF_CONTRACT_INFO (
					TCOMP_CD,
					KEY_ID,
					CNTRT_ID,
					CNTRT_NO,
					CNTRT_NM,
					ITEM_CD1,
					ITEM_CD2,
					ITEM_CD3,
					ITEM_CD4,
					ITEM_CD5,
					ITEM_CD6,
					ITEM_CD7,
					ITEM_CD8,
					ITEM_CD9,
					ITEM_CD10,
					ITEM_CD11,
					ITEM_CD12,
					ITEM_CD13,
					ITEM_CD14,
					ITEM_CD15,
					CONT_DRAFT,
					SYS_NM,
					ECMS_RESULT_FLAG,
					REG_ID,
					REG_DT
				)VALUES (
					:vo.tcomp_cd,  
					:vo.key_id,
					:vo.cntrt_id,
					:vo.cntrt_no,
					:vo.cntrt_nm,
					:vo.item_cd1,
					:vo.item_cd2,
					:vo.item_cd3,
					:vo.item_cd4,
					:vo.item_cd5,
					:vo.item_cd6,
					:vo.item_cd7,
					:vo.item_cd8,
					:vo.item_cd9,
					:vo.item_cd10,
					:vo.item_cd11,
					:vo.item_cd12,
					:vo.item_cd13,
					:vo.item_cd14,
					:vo.item_cd15,
					:vo.cont_draft,
					:vo.sys_nm,
					:vo.ecms_result_flag,
					:vo.reg_id,
					GETDATE()
				)
			]]>
			</statement>		
		</query>
		
		<query id="common.legacyintf.listInfContractInfo" isCamelCase="false">
		  <statement>
		 	<![CDATA[
		 		SELECT 
		 			TCOMP_CD, 
		 			KEY_ID, 
		 			CNTRT_ID,
		 			CNTRT_NO, 
		 			CNTRT_NM,
		 			ITEM_CD1,
		 			ITEM_CD2,
		 			ITEM_CD3,
		 			ITEM_CD4,
		 			ITEM_CD5,
		 			ITEM_CD6,
		 			ITEM_CD7,
		 			ITEM_CD8,
		 			ITEM_CD9,
		 			ITEM_CD10,
		 			ITEM_CD11,
		 			ITEM_CD12,
		 			ITEM_CD13,
		 			ITEM_CD14,
		 			ITEM_CD15,
		 			CONT_DRAFT
				FROM TN_INF_CONTRACT_INFO
				WHERE SYS_NM = :vo.sys_nm			
				AND ECMS_RESULT_FLAG ='N'	
			]]>
			</statement>
		</query>	
		
		
		<query id="common.legacyintf.updateSendinfo" isCamelCase="false">
			<statement>
		 	<![CDATA[
		 		UPDATE TN_INF_CONTRACT_INFO 
		 		SET	ECMS_DT = GETDATE(), ECMS_RESULT = :vo.ecms_result, ECMS_RESULT_FLAG = :vo.ecms_result_flag
		 		WHERE TCOMP_CD = :vo.tcomp_cd
		 		AND KEY_ID = :vo.key_id
		 	]]>
		</statement>
		</query>
		
								
		<query id="common.legacyintf.getPostConYnByComp" isCamelCase="false">
			<statement>
		 	<![CDATA[
		 		SELECT USEMAN_MNG_ITM4 FROM TB_COM_CD 
		 		WHERE GRP_CD='COMP2'
		 		AND CD=:vo.comp_cd
		 	]]>
		</statement>
		</query>
		
		<query id="common.legacyintf.updateAttachFailInfo" isCamelCase="false">
			<statement>
		 	<![CDATA[
		 		UPDATE TN_INF_FILE_ATTACH 
		 		SET	ECMS_DT = GETDATE(), ECMS_RESULT = :vo.ecms_result, ECMS_RESULT_FLAG = :vo.ecms_result_flag
		 		WHERE FILE_ID = :vo.file_id	 		
		 		AND FILE_SRT = :vo.file_srt
		 	]]>
		</statement>
		</query>
		
		
		<query id="common.legacyintf.listMigTNCContractBatch" isCamelCase="false">
			<statement>
		 	<![CDATA[
		 		SELECT A.CNTRT_ID
		 		FROM TN_CLM_RELATION_CONTRACT A
		 		WHERE A.CNTRT_ID IN (SELECT CNTRT_ID 
		 							FROM TN_CLM_CONTRACT_MASTER 
		 							WHERE SYS_NM='TNC' AND COMP_CD = :vo.comp_cd 
									AND CNTRT_STATUS='C02401'
									AND PRCS_DEPTH='C02502'
									AND DEPTH_STATUS='C02631')
				AND EXISTS(SELECT REF_KEY FROM TN_COM_ATTACH WHERE REF_KEY=A.CNTRT_ID)  
		 	]]>
		</statement>
		</query>
		
		<query id="common.legacyintf.updateMigTNCContractStatus" isCamelCase="false">
			<statement>
		 	<![CDATA[
		 		UPDATE TN_CLM_CONTRACT_MASTER SET CNTRT_STATUS=:vo.cntrt_status , PRCS_DEPTH=:vo.prcs_depth , DEPTH_STATUS=:vo.depth_status
				WHERE CNTRT_ID=:vo.cntrt_id
				
				UPDATE TN_CLM_CONT_CNSDREQ SET PRGRS_STATUS=:vo.prgrs_status
				WHERE CNSDREQ_ID=(
				SELECT CNSDREQ_ID FROM TN_CLM_CONTRACT_CNSD WHERE CNTRT_ID=:vo.cntrt_id)
				
		 	]]>
		</statement>
		</query>
		
																      
    </queries>
</queryservice>
