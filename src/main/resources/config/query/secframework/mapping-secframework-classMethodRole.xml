<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
	<queries>
		<!-- 페이징 리스트 조회 -->
		<query id="secfw.classmethodrole.listPage" isCamelCase="false">
			<statement>
            <![CDATA[
            	SELECT *
                  FROM(
                    SELECT ROWNUM RM
                          ,COUNT(1) OVER() TOTAL_CNT
                          ,A.*
                      FROM (
                    		SELECT SYS_CD 
                    			  ,CLASS_NM 
                    		  	  ,METHOD_NM
                    		  	  ,CHECK_YN
                    		  	  ,SYS_CD || ':' || CLASS_NM || ':' || METHOD_NM AS DELETE_KEY
        				  	  FROM TB_SHRI_CLASS_METHOD
        				  	 WHERE SYS_CD = :vo.sys_cd 
        				  	 	#if($vo.class_srch_word.length() > 0)
        				  	 AND CLASS_NM LIKE '%' || :vo.class_srch_word || '%'
        				  	 	#end
        				  	 	#if($vo.method_srch_word.length() > 0)
        				  	 AND METHOD_NM LIKE '%' || :vo.method_srch_word || '%'
        				  	 	#end
        				  	 	#if(!$vo.srch_type.equals("ALL"))
        					 AND CHECK_YN = :vo.srch_type
        					 	#end
                           ORDER BY CLASS_NM, METHOD_NM ) A
				    ) B
				WHERE B.RM BETWEEN :vo.start_index and :vo.end_index
				 	 
            ]]>
			</statement>
		</query>
		
		<!-- TB_SHRI_CLASS_METHOD 테이블 row 삭제 -->
		<query id="secfw.classmethodrole.delete" isCamelCase="false">
			<statement>
            <![CDATA[
            DELETE 
              FROM TB_SHRI_CLASS_METHOD
              WHERE SYS_CD = :vo.sys_cd
              AND CLASS_NM = :vo.class_nm
              AND METHOD_NM = :vo.method_nm
            ]]>
			</statement>
		</query>
		
		<!-- TB_SHRI_CLASS_METHOD_ROLE 테이블 row 삭제(메소드 전체)  -->
		<query id="secfw.classmethodrole.deleteRole" isCamelCase="false">
			<statement>
            <![CDATA[
            DELETE 
              FROM TB_SHRI_CLASS_METHOD_ROLE
              WHERE SYS_CD = :vo.sys_cd
              AND CLASS_NM = :vo.class_nm
              AND METHOD_NM = :vo.method_nm
            ]]>
			</statement>
		</query>
		
		<!-- TB_SHRI_CLASS_METHOD_ROLE 테이블 row 삭제(role_cd기준)  -->
		<query id="secfw.classmethodrole.deleteRole2" isCamelCase="false">
			<statement>
            <![CDATA[
            DELETE 
              FROM TB_SHRI_CLASS_METHOD_ROLE
              WHERE SYS_CD = :vo.sys_cd
              AND CLASS_NM = :vo.class_nm
              AND METHOD_NM = :vo.method_nm
              AND ROLE_CD = :vo.role_cd
            ]]>
			</statement>
		</query>
		
		<!-- TB_SHRI_CLASS_METHOD detail  -->
		<query id="secfw.classmethodrole.detail" isCamelCase="false">
			<statement>
            <![CDATA[
            SELECT *
              FROM TB_SHRI_CLASS_METHOD
              WHERE SYS_CD = :vo.sys_cd
              AND CLASS_NM = :vo.class_nm
              AND METHOD_NM = :vo.method_nm
            ]]>
			</statement>
		</query>

		
		<!-- TB_SHRI_CLASS_METHOD_ROLE 테이블 메소드별 role 검색  -->
		<query id="secfw.classmethodrole.listRole" isCamelCase="false">
			<statement>
            <![CDATA[
            SELECT ROLE_CD
              FROM TB_SHRI_CLASS_METHOD_ROLE
              WHERE SYS_CD = :vo.sys_cd
              AND CLASS_NM = :vo.class_nm
              AND METHOD_NM = :vo.method_nm
              ORDER BY ROLE_CD
            ]]>
			</statement>
		</query>
		
		<!-- TB_SHRI_CLASS_METHOD_ROLE 테이블 메소드별 role 검색  -->
		<query id="secfw.classmethodrole.listNotRole" isCamelCase="false">
			<statement>
            <![CDATA[
            SELECT ROLE_CD
              FROM TB_COM_ROLE
             WHERE ROLE_CD NOT IN(SELECT ROLE_CD
              					  FROM TB_SHRI_CLASS_METHOD_ROLE
              					  WHERE SYS_CD = :vo.sys_cd
              					  AND CLASS_NM = :vo.class_nm
              					  AND METHOD_NM = :vo.method_nm
              					  )
             	AND SYS_CD = :vo.sys_cd
             ORDER BY ROLE_CD
            ]]>
			</statement>
		</query>		

		<!-- TB_SHRI_CLASS_METHOD 테이블 삽입-->
		<query id="secfw.classmethodrole.insert" isCamelCase="false">
			<statement>
            <![CDATA[
            INSERT INTO TB_SHRI_CLASS_METHOD 
                      ( SYS_CD
					   ,CLASS_NM
            	       ,METHOD_NM
            	       ,CHECK_YN
            	       ,REG_ID
            	       ,REG_NM
            	       ,REG_JIKGUP_NM
            	       ,REG_DEPT_NM
            	       ,REG_DT
            	       ,MOD_ID
            	       ,MOD_NM
            	       ,MOD_JIKGUP_NM
            	       ,MOD_DEPT_NM
            	   	   ,MOD_DT )
           		VALUES( :vo.sys_cd
           		       ,:vo.class_nm
           		       ,:vo.method_nm
           		       ,:vo.check_yn
           		       ,:vo.reg_id
           		       ,:vo.reg_nm
           		       ,:vo.reg_jikgup_nm
           		       ,:vo.reg_dept_nm
           		       ,sysdate
           		       ,:vo.mod_id
           		       ,:vo.mod_nm
           		       ,:vo.mod_jikgup_nm
           		       ,:vo.mod_dept_nm
           		       ,sysdate )
            ]]>
			</statement>
		</query>
		
		<!-- TB_SHRI_CLASS_METHOD 테이블 수정-->
		<query id="secfw.classmethodrole.modify" isCamelCase="false">
			<statement>
            <![CDATA[
            UPDATE TB_SHRI_CLASS_METHOD
               SET CHECK_YN = :vo.check_yn
            	   ,MOD_ID = :vo.mod_id
                   ,MOD_NM = :vo.mod_nm
            	   ,MOD_JIKGUP_NM = :vo.mod_jikgup_nm
            	   ,MOD_DEPT_NM = :vo.mod_dept_nm
            	   ,MOD_DT = sysdate
       	     WHERE  SYS_CD = :vo.sys_cd
               		AND CLASS_NM = :vo.class_nm
               		AND METHOD_NM = :vo.method_nm 
            ]]>
			</statement>
		</query>
		
		<!-- TB_SHRI_CLASS_METHOD_ROLE 테이블 삽입 및 수정  -->
		<query id="secfw.classmethodrole.insertRole" isCamelCase="false">
			<statement>
            <![CDATA[
            MERGE INTO TB_SHRI_CLASS_METHOD_ROLE A
            USING
            ON( A.SYS_CD = :vo.sys_cd
               AND A.CLASS_NM = :vo.class_nm
               AND A.METHOD_NM = :vo.method_nm
               AND A.ROLE_CD = :vo.role_cd
              )
            WHEN MATCHED THEN
           		UPDATE SET
            	   MOD_ID = :vo.mod_id
                   ,MOD_NM = :vo.mod_nm
            	   ,MOD_JIKGUP_NM = :vo.mod_jikgup_nm
            	   ,MOD_DEPT_NM = :vo.mod_dept_nm
            	   ,MOD_DT = sysdate
            WHEN NOT MATCHED THEN
            	INSERT( SYS_CD
            	       ,CLASS_NM
            	       ,METHOD_NM
            	       ,ROLE_CD
            	       ,REG_ID
            	       ,REG_NM
            	       ,REG_JIKGUP_NM
            	       ,REG_DEPT_NM
            	       ,REG_DT
            	       ,MOD_ID
            	       ,MOD_NM
            	       ,MOD_JIKGUP_NM
            	       ,MOD_DEPT_NM
            	   	   ,MOD_DT )
           		VALUES( :vo.sys_cd
           		       ,:vo.class_nm
           		       ,:vo.method_nm
           		       ,:vo.role_cd
           		       ,:vo.reg_id
           		       ,:vo.reg_nm
           		       ,:vo.reg_jikgup_nm
           		       ,:vo.reg_dept_nm
           		       ,sysdate
           		       ,:vo.mod_id
           		       ,:vo.mod_nm
           		       ,:vo.mod_jikgup_nm
           		       ,:vo.mod_dept_nm
           		       ,sysdate )
            ]]>
			</statement>
		</query>
        
        <!-- 메소드 권한 리스트 -->
        <query id="shri.method.listRole" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT  B.ROLE_CD
                       ,A.CHECK_YN
                  FROM  TB_SHRI_CLASS_METHOD A
                       ,TB_SHRI_CLASS_METHOD_ROLE B
                 WHERE  A.SYS_CD = B.SYS_CD(+)
                   AND  A.CLASS_NM = B.CLASS_NM(+)
                   AND  A.METHOD_NM = B.METHOD_NM(+)
                   AND  A.CLASS_NM = :vo.class_nm
                   AND  A.METHOD_NM = :vo.method_nm
            ]]>
            </statement>
        </query>
	</queries>
</queryservice>