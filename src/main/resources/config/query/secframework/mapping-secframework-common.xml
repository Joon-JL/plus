<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
	<queries>
		<query id="secframework.common.">
			<statement>
			<![CDATA[
                SELECT    M.MENU_NO,
                        M.MENU_NM,
                        M.MENU_DESC,
                        M.COMMAND_NO,
                        M.PMENU_NO,
                        M.SIBLING_ORDER,
                        M.MENU_ICON,
                        M.IMG_ON,
                        M.IMG_OFF,
                        M.USE_YN,
                        M.LINK_YN,
                        C.COMMAND_NM,
                        C.COMMAND_URL
                        FROM    MENU        M,
                                COMMAND        C,
                                MENU_ROLES    R
                WHERE    M.COMMAND_NO    = C.COMMAND_NO
					AND	M.PMENU_NO		= :pMenuNo
				#if ($useYn)
					AND	M.USE_YN		= :useYn
				#end
				#if ($linkYn)				
					AND	M.LINK_YN		= :linkYn
				#end
					AND	M.MENU_NO		= R.MENU_NO
					AND	R.AUTHORITY		= :authority
				ORDER	BY	M.SIBLING_ORDER
			]]>
			</statement>
		</query>
					
		<!-- Top Menu List -->
		<query id="secframework.common.listTopMenu" isCamelCase="false">
			<statement>
			<![CDATA[
                SELECT *
                  FROM ( SELECT rownum RN, t.*, COUNT(1) over() TOTAL_CNT
                           FROM (
                                -- Business Logic 
									SELECT
										LEVEL AS LEV ,A.MENU_ID ,A.MENU_NM ,A.MENU_NM_ENG
										,A.UP_MENU_ID ,A.MENU_LEVEL ,A.COMMENTS ,A.MENU_URL
									FROM TB_COM_MENU A
									WHERE SYS_CD = :sys_cd
									AND A.USE_YN = 'Y'
									and A.menu_level <=2
									START WITH A.UP_MENU_ID in (SELECT UP_MENU_ID FROM TB_COM_MENU WHERE SYS_CD = :sys_cd AND USE_YN = 'Y' AND menu_level = 1  AND UP_MENU_ID <> '*')
									CONNECT BY PRIOR A.MENU_ID = A.UP_MENU_ID  
									ORDER BY MENU_ORDER||SUBSTR(MENU_ID,1,2), MENU_ID                 
                                -- Business Logic
                                ) t
                    ORDER BY rn 
					)
			]]>
			</statement>
		</query>
	</queries>
</queryservice>
