<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>

        <!-- 로그인 이력 등록 -->
        <query id="secfw.log.insertLoginLog">
            <statement>
            <![CDATA[
            INSERT INTO TB_COM_LOGIN_STAT
                 (SYS_CD
                  ,USER_ID
                  ,USER_NM
                  ,DEPT_NM
                  ,YEAR
                  ,MONTH
                  ,DAY
                  ,HOUR
                  ,LOGIN_DT
                  ,LOGOUT_DT
                  ,IP_ADDRESS
                  ,BROWSER_TYPE
                  ,EMP_NO
                  ,USER_NM_ENG
                  ,SINGLE_ID
                  ,SINGLE_EPID
                  ,COMP_CD
                  ,COMP_NM
                  ,COMP_NM_ENG
                  ,BUSINESS_CD
                  ,BUSINESS_NM
                  ,BUSINESS_NM_ENG
                  ,DIVISION_CD
                  ,DIVISION_NM
                  ,DEPT_CD
                  ,IN_DEPT_CD
                  ,JIKGUP_CD
                  ,JIKGUP_NM
                  ,JIKGUP_NM_ENG
                  ,JIKMU_CD
                  ,JIKMU_NM
                  ,REGION_CD
                  ,REGION_NM
                  ,REGION_NM_ENG
                  ,EMAIL
                  ,OFFICE_TEL_NO
                  ,HOME_TEL_NO
                  ,MOBILE_NO
                  ,STATUS
                  ,EMPLOYEE_TYPE
                  ,SESSION_ID
                  )
                SELECT
                  :vo.sys_cd
                  ,:vo.user_id
                  ,:vo.user_nm
                  ,:vo.dept_nm
                  ,:vo.year
                  ,:vo.month
                  ,:vo.day
                  ,:vo.hour
                  ,CONVERT(DATETIME, LEFT( :vo.login_dt ,8)+' '+
                  	SUBSTRING( :vo.login_dt ,9,2)+':'+
                  	SUBSTRING( :vo.login_dt ,11,2)+':'+
                  	RIGHT( :vo.login_dt ,2) , 20) 
                  ,:vo.logout_dt
                  ,:vo.ip_address
                  ,:vo.browser_type
                  ,EMP_NO
                  ,USER_NM_ENG
                  ,SINGLE_ID
                  ,SINGLE_EPID
                  ,COMP_CD
                  ,COMP_NM
                  ,COMP_NM_ENG
                  ,BUSINESS_CD
                  ,BUSINESS_NM
                  ,BUSINESS_NM_ENG
                  ,DIVISION_CD
                  ,DIVISION_NM
                  ,DEPT_CD
                  ,IN_DEPT_CD
                  ,JIKGUP_CD
                  ,JIKGUP_NM
                  ,JIKGUP_NM_ENG
                  ,JIKMU_CD
                  ,JIKMU_NM
                  ,REGION_CD
                  ,REGION_NM
                  ,REGION_NM_ENG
                  ,EMAIL
                  ,OFFICE_TEL_NO
                  ,HOME_TEL_NO
                  ,MOBILE_NO
                  ,STATUS
                  ,EMPLOYEE_TYPE
                  ,:vo.session_id
                FROM TB_COM_USER
               WHERE USER_ID = :vo.user_id
            ]]>
            </statement>
        </query>

        <!-- 로그아웃 이력 등록 -->
        <query id="secfw.log.updateLogoutLog">
            <statement>
            <![CDATA[
                UPDATE
                TB_COM_LOGIN_STAT SET LOGOUT_DT=GETDATE()
                WHERE 1=1
                AND SESSION_ID = :vo.session_id
                AND USER_ID    = :vo.user_id
            ]]>
            </statement>
        </query>

        <!-- 메뉴사용현황 이력 등록 -->
        <query id="secfw.log.insertPageUseLog">
            <statement>
            <![CDATA[
            INSERT INTO TB_COM_MENU_STAT
                 (SYS_CD
                  ,MENU_ID
                  ,MENU_NM
                  ,MENU_NM_ENG
                  ,UP_MENU_ID
                  ,MENU_LEVEL
                  ,MENU_ORDER
                  ,COMMENTS
                  ,MENU_URL
                  ,MENU_TYPE
                  ,DEVELOPER_NM
                  ,USER_ID
                  ,USER_NM
                  ,DEPT_NM
                  ,YEAR
                  ,MONTH
                  ,DAY
                  ,HOUR
                  ,CONTACT_DT
                  ,EMP_NO
                  ,USER_NM_ENG
                  ,SINGLE_ID
                  ,SINGLE_EPID
                  ,COMP_CD
                  ,COMP_NM
                  ,COMP_NM_ENG
                  ,BUSINESS_CD
                  ,BUSINESS_NM
                  ,BUSINESS_NM_ENG
                  ,DIVISION_CD
                  ,DIVISION_NM
                  ,DEPT_CD
                  ,IN_DEPT_CD
                  ,JIKGUP_CD
                  ,JIKGUP_NM
                  ,JIKGUP_NM_ENG
                  ,JIKMU_CD
                  ,JIKMU_NM
                  ,REGION_CD
                  ,REGION_NM
                  ,REGION_NM_ENG
                  ,EMAIL
                  ,OFFICE_TEL_NO
                  ,HOME_TEL_NO
                  ,MOBILE_NO
                  ,STATUS
                  ,EMPLOYEE_TYPE)
           SELECT A.SYS_CD
                 ,A.MENU_ID
                 ,A.MENU_NM
                 ,A.MENU_NM_ENG
                 ,A.UP_MENU_ID
                 ,A.MENU_LEVEL
                 ,A.MENU_ORDER
                 ,A.COMMENTS
                 ,A.MENU_URL
                 ,A.MENU_TYPE
                 ,A.DEVELOPER_NM
                 ,A.USER_ID
                 ,A.USER_NM
                 ,A.DEPT_NM
                 ,A.YEAR
                 ,A.MONTH
                 ,A.DAY
                 ,A.HOUR
                 ,GETDATE()
                 , B.EMP_NO
                 ,B.USER_NM_ENG
                 ,B.SINGLE_ID
                 ,B.SINGLE_EPID
                 ,B.COMP_CD
                 ,B.COMP_NM
                 ,B.COMP_NM_ENG
                 ,B.BUSINESS_CD
                 ,B.BUSINESS_NM
                 ,B.BUSINESS_NM_ENG
                 ,B.DIVISION_CD
                 ,B.DIVISION_NM
                 ,B.DEPT_CD
                 ,B.IN_DEPT_CD
                 ,B.JIKGUP_CD
                 ,B.JIKGUP_NM
                 ,B.JIKGUP_NM_ENG
                 ,B.JIKMU_CD
                 ,B.JIKMU_NM
                 ,B.REGION_CD
                 ,B.REGION_NM
                 ,B.REGION_NM_ENG
                 ,B.EMAIL
                 ,B.OFFICE_TEL_NO
                 ,B.HOME_TEL_NO
                 ,B.MOBILE_NO
                 ,B.STATUS
                 ,B.EMPLOYEE_TYPE
            FROM (SELECT SYS_CD
                        ,MENU_ID
                        ,MENU_NM
                        ,MENU_NM_ENG
                        ,UP_MENU_ID
                        ,MENU_LEVEL
                        ,MENU_ORDER
                        ,COMMENTS
                        ,MENU_URL
                        ,MENU_TYPE
                        ,DEVELOPER_NM
                        ,CAST(:user_id AS VARCHAR(50)) AS USER_ID
                        ,CAST(:user_nm AS VARCHAR(50)) AS USER_NM
                        ,CAST(:dept_nm AS VARCHAR(50)) AS DEPT_NM
                        ,CAST(YEAR(GETDATE()) AS VARCHAR(4)) AS YEAR
                        ,RIGHT('0'+CAST(MONTH(GETDATE() ) AS VARCHAR(2)) ,2) /*MM*/ AS MONTH
                        ,RIGHT('0'+CAST(DAY(GETDATE() ) AS VARCHAR(2)) ,2) /*DD*/ AS DAY
                        ,RIGHT('0'+CAST(DATEPART(hh,GETDATE() ) AS VARCHAR(2)) ,2) /*HH24*/ AS HOUR
                   FROM TB_COM_MENU A
                  WHERE A.SYS_CD = :sys_cd
                    AND MENU_ID  = :menu_id
                 ) A,
                 (SELECT USER_ID, EMP_NO
                         ,USER_NM_ENG
                         ,SINGLE_ID
                         ,SINGLE_EPID
                         ,COMP_CD
                         ,COMP_NM
                         ,COMP_NM_ENG
                         ,BUSINESS_CD
                         ,BUSINESS_NM
                         ,BUSINESS_NM_ENG
                         ,DIVISION_CD
                         ,DIVISION_NM
                         ,DEPT_CD
                         ,IN_DEPT_CD
                         ,JIKGUP_CD
                         ,JIKGUP_NM
                         ,JIKGUP_NM_ENG
                         ,JIKMU_CD
                         ,JIKMU_NM
                         ,REGION_CD
                         ,REGION_NM
                         ,REGION_NM_ENG
                         ,EMAIL
                         ,OFFICE_TEL_NO
                         ,HOME_TEL_NO
                         ,MOBILE_NO
                         ,STATUS
                         ,EMPLOYEE_TYPE
                     FROM TB_COM_USER
                    WHERE USER_ID = :user_id
                   ) B
                  WHERE A.USER_ID = B.USER_ID
            ]]>
            </statement>
        </query>

        <!-- 첨부파일 다운로드 이력 등록 -->
        <query id="secfw.log.insertFileDownLog">
            <statement>
            <![CDATA[
             INSERT INTO TB_COM_FILE_STAT
                 (SYS_CD
                  ,FILE_PATH
                  ,FILE_NM
                  ,USER_ID
                  ,USER_NM
                  ,DEPT_NM
                  ,YEAR
                  ,MONTH
                  ,DAY
                  ,HOUR
                  ,CONTACT_DT
                  ,EMP_NO
                  ,USER_NM_ENG
                  ,SINGLE_ID
                  ,SINGLE_EPID
                  ,COMP_CD
                  ,COMP_NM
                  ,COMP_NM_ENG
                  ,BUSINESS_CD
                  ,BUSINESS_NM
                  ,BUSINESS_NM_ENG
                  ,DIVISION_CD
                  ,DIVISION_NM
                  ,DEPT_CD
                  ,IN_DEPT_CD
                  ,JIKGUP_CD
                  ,JIKGUP_NM
                  ,JIKGUP_NM_ENG
                  ,JIKMU_CD
                  ,JIKMU_NM
                  ,REGION_CD
                  ,REGION_NM
                  ,REGION_NM_ENG
                  ,EMAIL
                  ,OFFICE_TEL_NO
                  ,HOME_TEL_NO
                  ,MOBILE_NO
                  ,STATUS
                  ,EMPLOYEE_TYPE
                  )
                 SELECT
                   :vo.sys_cd
                  ,:vo.file_path
                  ,:vo.file_nm
                  ,:vo.user_id
                  ,:vo.user_nm
                  ,:vo.dept_nm
                  ,CAST(YEAR(GETDATE()) AS VARCHAR(4))   /*YYYY*/
                  ,RIGHT('0'+CAST(MONTH(GETDATE() ) AS VARCHAR(2)) ,2) /*MM*/
                  ,RIGHT('0'+CAST(DAY(GETDATE() ) AS VARCHAR(2)) ,2) /*DD*/
                  ,RIGHT('0'+CAST(DATEPART(hh,GETDATE() ) AS VARCHAR(2)) ,2) /*HH24*/
                  ,GETDATE()
                  ,EMP_NO
                  ,USER_NM_ENG
                  ,SINGLE_ID
                  ,SINGLE_EPID
                  ,COMP_CD
                  ,COMP_NM
                  ,COMP_NM_ENG
                  ,BUSINESS_CD
                  ,BUSINESS_NM
                  ,BUSINESS_NM_ENG
                  ,DIVISION_CD
                  ,DIVISION_NM
                  ,DEPT_CD
                  ,IN_DEPT_CD
                  ,JIKGUP_CD
                  ,JIKGUP_NM
                  ,JIKGUP_NM_ENG
                  ,JIKMU_CD
                  ,JIKMU_NM
                  ,REGION_CD
                  ,REGION_NM
                  ,REGION_NM_ENG
                  ,EMAIL
                  ,OFFICE_TEL_NO
                  ,HOME_TEL_NO
                  ,MOBILE_NO
                  ,STATUS
                  ,EMPLOYEE_TYPE
               FROM TB_COM_USER
              WHERE USER_ID = :vo.user_id
            ]]>
            </statement>
        </query>

        <!-- 로그인 현황 조회 -->
        <query id="secfw.log.listLoginLog" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT *
                  FROM (
                        SELECT ROW_NUMBER() OVER (ORDER BY LOGIN_DT DESC) RN
                             , T.*
                             , COUNT(1) OVER() TOTAL_CNT
                         FROM (
                               SELECT SYS_CD
                                    , USER_ID
                                    , USER_NM
                                    , DEPT_NM
                                    , YEAR
                                    , MONTH
                                    , DAY
                                    , HOUR
                                    , CONVERT(CHAR(19), LOGIN_DT, 20) AS LOGIN_DT /*YYYY-MM-DD HH24:MI:SS*/
                                    , LOGOUT_DT
                                    , IP_ADDRESS
                                    , BROWSER_TYPE
                                    , EMP_NO
                                    , USER_NM_ENG
                                    , SINGLE_ID
                                    , SINGLE_EPID
                                    , COMP_CD
                                    , COMP_NM
                                    , COMP_NM_ENG
                                    , BUSINESS_CD
                                    , BUSINESS_NM
                                    , BUSINESS_NM_ENG
                                    , DIVISION_CD
                                    , DIVISION_NM
                                    , DEPT_CD
                                    , IN_DEPT_CD
                                    , JIKGUP_CD
                                    , JIKGUP_NM
                                    , JIKGUP_NM_ENG
                                    , JIKMU_CD
                                    , JIKMU_NM
                                    , REGION_CD
                                    , REGION_NM
                                    , REGION_NM_ENG
                                    , EMAIL
                                    , OFFICE_TEL_NO
                                    , HOME_TEL_NO
                                    , MOBILE_NO
                                    , STATUS
                                    , EMPLOYEE_TYPE
                                 FROM TB_COM_LOGIN_STAT
                                WHERE SYS_CD = :vo.sys_cd
                                  AND (COMP_CD IN (SELECT CD
                                                    FROM TB_COM_CD
                                                   WHERE SYS_CD = :vo.sys_cd
                                                     AND GRP_CD = 'COMP2'
                                                     AND USE_YN = 'Y') OR COMP_CD='C10')
                                  					 AND LOGIN_DT BETWEEN CONVERT(DATETIME, :vo.start_datetime) /*YYYY-MM-DD HH24:MI*/
                                  					 AND CONVERT(DATETIME, :vo.end_datetime ) /*YYYY-MM-DD HH24:MI*/
                                  					 AND USER_ID NOT IN (SELECT USER_ID
                                                        FROM TB_COM_ROLE_USER
                                                       WHERE ROLE_CD = 'RA00')
                #if($vo.search_name && !$vo.search_nm.equals(""))
                    #if ($vo.search_combo && $vo.search_combo.equals("comp_nm"))
                                  AND COMP_NM LIKE '%' + :vo.search_name + '%'
                    #end
                    #if($vo.search_combo && $vo.search_combo.equals("user_nm"))
                                  AND USER_NM LIKE '%' + :vo.search_name + '%'
                    #end
                #end
                              ) T
                       ) TA
                 WHERE RN BETWEEN :vo.start_index AND :vo.end_index
                 ORDER BY RN
            ]]>
            </statement>
        </query>

        <!-- 로그인 현황 엑셀다운로드 - 사용자별 로그인 현황 (페이징처리 X) -->
        <query id="secfw.log.listLoginLogNoPage" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT SYS_CD
                     , USER_ID
                     , USER_NM
                     , DEPT_NM
                     , YEAR
                     , MONTH
                     , DAY
                     , HOUR
                     , CONVERT(CHAR(19), LOGIN_DT, 20) AS LOGIN_DT /*YYYY-MM-DD HH24:MI:SS*/
                     , CONVERT(CHAR(19), LOGOUT_DT, 20) AS LOGOUT_DT /*YYYY-MM-DD HH24:MI:SS*/
                     , IP_ADDRESS
                     , BROWSER_TYPE
                     , SESSION_ID
                     , EMP_NO
                     , USER_NM_ENG
                     , SINGLE_ID
                     , SINGLE_EPID
                     , COMP_CD
                     , COMP_NM
                     , COMP_NM_ENG
                     , BUSINESS_CD
                     , BUSINESS_NM
                     , BUSINESS_NM_ENG
                     , DIVISION_CD
                     , DIVISION_NM
                     , DEPT_CD
                     , IN_DEPT_CD
                     , JIKGUP_CD
                     , JIKGUP_NM
                     , JIKGUP_NM_ENG
                     , JIKMU_CD
                     , JIKMU_NM
                     , REGION_CD
                     , REGION_NM
                     , REGION_NM_ENG
                     , EMAIL
                     , OFFICE_TEL_NO
                     , HOME_TEL_NO
                     , MOBILE_NO
                     , STATUS
                     , EMPLOYEE_TYPE
                  FROM TB_COM_LOGIN_STAT
                 WHERE SYS_CD = :vo.sys_cd
                   AND (COMP_CD IN (SELECT CD
                                     FROM TB_COM_CD
                                    WHERE SYS_CD = :vo.sys_cd
                                      AND GRP_CD = 'COMP2'
                                      AND USE_YN = 'Y') OR COMP_CD='C10')
                   AND LOGIN_DT BETWEEN TO_DATE(:vo.start_datetime, 'YYYY-MM-DD HH24:MI') AND TO_DATE(:vo.end_datetime, 'YYYY-MM-DD HH24:MI')
                   AND USER_ID NOT IN (SELECT USER_ID
                                         FROM TB_COM_ROLE_USER
                                        WHERE ROLE_CD = 'RA00')
        #if($vo.search_name && !$vo.search_nm.equals(""))
            #if($vo.search_combo && $vo.search_combo.equals("user_nm"))
                   AND USER_NM LIKE '%' + :vo.search_name + '%'
            #end
            #if($vo.search_combo && $vo.search_combo.equals("comp_nm"))
                   AND COMP_NM LIKE '%' + :vo.search_name + '%'
            #end
        #end
                 ORDER BY LOGIN_DT DESC
            ]]>
            </statement>
        </query>

        <!-- 로그인 현황 엑셀다운로드 - 회사별 로그인 현황 -->
        <query id="secfw.log.listLoginLogComp" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT CASE
                            WHEN  A.COMP_CD IS NULL THEN B.COMP_CD
                            WHEN  B.COMP_CD IS NULL THEN A.COMP_CD
                            ELSE  A.COMP_CD
                       END COMP_CD
                     , CASE
                            WHEN  A.COMP_NM IS NULL THEN B.COMP_NM
                            WHEN  B.COMP_NM IS NULL THEN A.COMP_NM
                            ELSE  A.COMP_NM
                       END COMP_NM
                     , ISNULL(A.USER_CNT, 0) TODAY_USER_CNT
                     , ISNULL(A.LOGIN_CNT, 0) TODAY_LOGIN_CNT
                     , ISNULL(B.USER_CNT, 0) SRCH_USER_CNT
                     , ISNULL(B.LOGIN_CNT, 0) SRCH_LOGIN_CNT
                  FROM (
                        SELECT ISNULL(COMP_CD, '') COMP_CD
                             , ISNULL(COMP_NM, '') COMP_NM
                             , COUNT(LOGIN_CNT) USER_CNT
                             , SUM(LOGIN_CNT) LOGIN_CNT
                          FROM (
                                SELECT COMP_CD
                                     , COMP_NM
                                     , COUNT(USER_ID) LOGIN_CNT
                                  FROM TB_COM_LOGIN_STAT
                                 WHERE SYS_CD = :vo.sys_cd
                                   AND COMP_CD IN (SELECT CD
                                                     FROM TB_COM_CD
                                                    WHERE SYS_CD = :vo.sys_cd
                                                      AND GRP_CD = 'COMP2'
                                                      AND USE_YN = 'Y')
                    #if($vo.search_name && !$vo.search_nm.equals(""))
                        #if($vo.search_combo && $vo.search_combo.equals("user_nm"))
                                   AND USER_NM LIKE '%' + :vo.search_name + '%'
                        #end
                        #if($vo.search_combo && $vo.search_combo.equals("comp_nm"))
                                   AND COMP_NM LIKE '%' + :vo.search_name + '%'
                        #end
                    #end
                                   AND USER_ID NOT IN (SELECT USER_ID
                                                         FROM TB_COM_ROLE_USER
                                                        WHERE ROLE_CD = 'RA00')
                                   AND LOGIN_DT BETWEEN TO_DATE(TO_CHAR(GETDATE()-1, 'YYYY-MM-DD') + ' 18:00', 'YYYY-MM-DD HH24:MI') AND TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD') + ' 18:00', 'YYYY-MM-DD HH24:MI')
                                 GROUP BY COMP_CD, COMP_NM, USER_ID
                               ) T1
                         GROUP BY COMP_CD, COMP_NM
                         ORDER BY COMP_NM
                       ) A
                       FULL OUTER JOIN
                       (
                        SELECT ISNULL(COMP_CD, '') COMP_CD
                             , ISNULL(COMP_NM, '') COMP_NM
                             , COUNT(LOGIN_CNT) USER_CNT
                             , SUM(LOGIN_CNT) LOGIN_CNT
                          FROM (
                                SELECT COMP_CD
                                     , COMP_NM
                                     , COUNT(USER_ID) LOGIN_CNT
                                  FROM TB_COM_LOGIN_STAT
                                 WHERE SYS_CD = :vo.sys_cd
                                   AND COMP_CD IN (SELECT CD
                                                     FROM TB_COM_CD
                                                    WHERE SYS_CD = :vo.sys_cd
                                                      AND GRP_CD = 'COMP2'
                                                      AND USE_YN = 'Y')
                    #if($vo.search_name && !$vo.search_nm.equals(""))
                        #if($vo.search_combo && $vo.search_combo.equals("comp_nm"))
                                   AND COMP_NM LIKE '%' + :vo.search_name + '%'
                        #end
                        #if($vo.search_combo && $vo.search_combo.equals("user_nm"))
                                   AND USER_NM LIKE '%' + :vo.search_name + '%'
                        #end
                    #end
                                   AND LOGIN_DT BETWEEN TO_DATE(:vo.start_datetime, 'YYYY-MM-DD HH24:MI') AND TO_DATE(:vo.end_datetime, 'YYYY-MM-DD HH24:MI')
                                   AND USER_ID NOT IN (SELECT USER_ID
                                                         FROM TB_COM_ROLE_USER
                                                        WHERE ROLE_CD = 'RA00')
                                 GROUP BY COMP_CD, COMP_NM, USER_ID
                               ) T1
                         GROUP BY COMP_CD, COMP_NM
                         ORDER BY COMP_NM
                       ) B
                    ON A.COMP_CD = B.COMP_CD
            ]]>
            </statement>
        </query>

        <!-- 로그인 현황 조회(엑셀다운로드 시 - 사용하지 않는 듯) -->
        <query id="secfw.log.excelDownLoginLog" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT *
                  FROM (
                        SELECT ROWNUM RN
                             , T.*
                             , COUNT(1) OVER() TOTAL_CNT
                          FROM (
                                SELECT SYS_CD
                                     , USER_ID
                                     , USER_NM
                                     , DEPT_NM
                                     , YEAR
                                     , MONTH
                                     , DAY
                                     , HOUR
                                     , TO_CHAR(LOGIN_DT, 'YYYY-MM-DD HH24:MI:SS') AS LOGIN_DT
                                     , TO_CHAR(LOGOUT_DT, 'YYYY-MM-DD HH24:MI:SS') AS LOGOUT_DT
                                     , IP_ADDRESS
                                     , BROWSER_TYPE
                                     , EMP_NO
                                     , USER_NM_ENG
                                     , SINGLE_ID
                                     , SINGLE_EPID
                                     , COMP_CD
                                     , COMP_NM
                                     , COMP_NM_ENG
                                     , BUSINESS_CD
                                     , BUSINESS_NM
                                     , BUSINESS_NM_ENG
                                     , DIVISION_CD
                                     , DIVISION_NM
                                     , DEPT_CD
                                     , IN_DEPT_CD
                                     , JIKGUP_CD
                                     , JIKGUP_NM
                                     , JIKGUP_NM_ENG
                                     , JIKMU_CD
                                     , JIKMU_NM
                                     , REGION_CD
                                     , REGION_NM
                                     , REGION_NM_ENG
                                     , EMAIL
                                     , OFFICE_TEL_NO
                                     , HOME_TEL_NO
                                     , MOBILE_NO
                                     , STATUS
                                     , EMPLOYEE_TYPE
                                 FROM TB_COM_LOGIN_STAT
                                 WHERE SYS_CD = :vo.sys_cd
                                  AND COMP_CD IN (SELECT CD
                                                    FROM TB_COM_CD
                                                   WHERE SYS_CD = :vo.sys_cd
                                                     AND GRP_CD = 'COMP2'
                                                     AND USE_YN = 'Y')
                                  AND (TO_CHAR(LOGIN_DT,'YYYY-MM-DD') BETWEEN :vo.start_date AND :vo.end_date)
                                  AND USER_ID NOT IN (SELECT USER_ID
                                                        FROM TB_COM_ROLE_USER
                                                       WHERE ROLE_CD = 'RA00')
                                 #if ($vo.search_combo.equals("user_nm"))
                                    AND USER_NM LIKE '%' + :vo.search_name + '%'
                                 #else
                                    AND COMP_NM LIKE '%' + :vo.search_name + '%'
                                 #end
                                 ORDER BY LOGIN_DT DESC
                               ) T
                         ORDER BY RN
                       )
            ]]>
            </statement>
        </query>

        <!-- 부서별 로그인 현황 조회(엑셀다운로드 시 - 사용하지 않는 듯) -->
        <query id="secfw.log.excelDownLoginDeptLog" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT LPAD(' ', 4*(LEVEL-1)) + REGION_NM AS REGION_NM, REGION_BIGCATE, REGION_MIDCATE, D7, D6, D5, D4, D3, D2, D1, D0, REGION_TOT
                  FROM (
                        SELECT REGION_NM, REGION_BIGCATE, REGION_MIDCATE, D7, D6, D5, D4, D3, D2, D1, D0
                              ,UP_REGION_CD, REGION_CD, REGION_CD_DEPTH, REGION_CD_ORDER
                              ,SUM(D7+D6+D5+D4+D3+D2+D1+D0) OVER(PARTITION BY REGION_BIGCATE, REGION_MIDCATE) AS REGION_TOT
                          FROM (
                                SELECT B.REGION_NM, B.REGION_BIGCATE, B.REGION_MIDCATE, ISNULL(A.D7, 0) AS D7, ISNULL(A.D6, 0) AS D6, ISNULL(A.D5, 0) AS D5, ISNULL(A.D4, 0) AS D4, ISNULL(A.D3, 0) AS D3, ISNULL(A.D2, 0) AS D2, ISNULL(A.D1, 0) AS D1, ISNULL(A.D0, 0) AS D0
                                      ,B.UP_REGION_CD, B.REGION_CD, B.REGION_CD_DEPTH, B.REGION_CD_ORDER
                                 FROM
                                (
                                    SELECT BIG_NM AS REGION_BIGCATE, ISNULL(MID_NM, '*') AS REGION_MIDCATE
                                              , SUM(CASE WHEN YEAR+MONTH+DAY = TO_CHAR(TO_DATE(:vo.end_date, 'YYYYMMDD')-7, 'YYYYMMDD') THEN 1 ELSE 0 END) AS "D7"
                                              , SUM(CASE WHEN YEAR+MONTH+DAY = TO_CHAR(TO_DATE(:vo.end_date, 'YYYYMMDD')-6, 'YYYYMMDD') THEN 1 ELSE 0 END) AS "D6"
                                              , SUM(CASE WHEN YEAR+MONTH+DAY = TO_CHAR(TO_DATE(:vo.end_date, 'YYYYMMDD')-5, 'YYYYMMDD') THEN 1 ELSE 0 END) AS "D5"
                                              , SUM(CASE WHEN YEAR+MONTH+DAY = TO_CHAR(TO_DATE(:vo.end_date, 'YYYYMMDD')-4, 'YYYYMMDD') THEN 1 ELSE 0 END) AS "D4"
                                              , SUM(CASE WHEN YEAR+MONTH+DAY = TO_CHAR(TO_DATE(:vo.end_date, 'YYYYMMDD')-3, 'YYYYMMDD') THEN 1 ELSE 0 END) AS "D3"
                                              , SUM(CASE WHEN YEAR+MONTH+DAY = TO_CHAR(TO_DATE(:vo.end_date, 'YYYYMMDD')-2, 'YYYYMMDD') THEN 1 ELSE 0 END) AS "D2"
                                              , SUM(CASE WHEN YEAR+MONTH+DAY = TO_CHAR(TO_DATE(:vo.end_date, 'YYYYMMDD')-1, 'YYYYMMDD') THEN 1 ELSE 0 END) AS "D1"
                                              , SUM(CASE WHEN YEAR+MONTH+DAY = TO_CHAR(TO_DATE(:vo.end_date, 'YYYYMMDD')-0, 'YYYYMMDD') THEN 1 ELSE 0 END) AS "D0"
                                      FROM
                                    (
                                    SELECT A.YEAR, A.MONTH, A.DAY, A.LOGIN_DT, A.USER_NM, B.REGION_BIGCATE, B.REGION_MIDCATE, B.ROLE_CD,
                                           CASE
                                             WHEN B.REGION_BIGCATE = 'top' OR B.ROLE_CD LIKE 'RA%' THEN 'Compliance Team (Headquarters)'
                                             ELSE C.REGION_NM
                                           END AS BIG_NM
                                           ,CASE
                                             WHEN B.REGION_BIGCATE = 'TOP' OR B.ROLE_CD LIKE 'RA%' THEN '*'
                                             ELSE D.REGION_NM
                                           END AS MID_NM
                                     FROM TB_COM_LOGIN_STAT A,
                                          TB_COM_USER_REGION B,
                                          TB_COM_REGION C,
                                          TB_COM_REGION D
                                    WHERE TO_CHAR(A.LOGIN_DT, 'YYYYMMDD') BETWEEN TO_CHAR(TO_DATE(:vo.end_date, 'YYYYMMDD') - 7, 'YYYYMMDD') AND TO_CHAR(TO_DATE(:vo.end_date, 'YYYYMMDD'), 'YYYYMMDD')
                                   -- AND DECODE(A.COMP_CD, NULL, 'C10', A.COMP_CD) NOT IN ('C60')
                                      AND COALESCE(A.COMP_CD, :comp_cd) NOT IN ('C60')
                                      AND A.USER_ID = B.USER_ID
                                      AND B.REGION_BIGCATE = C.REGION_CD(+)
                                      AND B.REGION_MIDCATE = D.REGION_CD(+)
                                     ORDER BY A.YEAR, A.MONTH, A.DAY, BIG_NM, MID_NM, A.USER_NM
                                    )
                                    GROUP BY BIG_NM, ISNULL(MID_NM, '*')
                                    ORDER BY BIG_NM, ISNULL(MID_NM, '*')
                                ) A,
                                (
                                SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN
                                        CASE
                                         WHEN A.REGION_CD = 'TOP' THEN 'Compliance팀(본사)'
                                         WHEN A.REGION_CD_DEPTH = 1 THEN C.REGION_NM
                                         ELSE B.REGION_NM
                                        END
                                       ELSE
                                        CASE
                                         WHEN A.REGION_CD = 'TOP' THEN 'Compliance Team (Headquarters)'
                                         WHEN A.REGION_CD_DEPTH = 1 THEN C.REGION_NM
                                         ELSE B.REGION_NM
                                        END
                                       END AS REGION_BIGCATE
                                       , CASE
                                         WHEN A.REGION_CD_DEPTH IN (0,1) THEN '*'
                                         ELSE C.REGION_NM
                                       END AS REGION_MIDCATE
                                      ,CASE WHEN :vo.session_user_locale = 'ko' THEN
                                        CASE
                                         WHEN A.REGION_CD = 'TOP' THEN 'Compliance팀(본사)'
                                         ELSE C.REGION_NM
                                        END
                                       WHEN :vo.session_user_locale = 'fr' THEN
                                        CASE
                                         WHEN A.REGION_CD = 'TOP' THEN 'Equipe Compliance (HQ)'
                                         ELSE C.REGION_NM
                                        END
                                       WHEN :vo.session_user_locale = 'de' THEN
                                        CASE
                                         WHEN A.REGION_CD = 'TOP' THEN 'Compliance Team (Headquarters)'
                                         ELSE C.REGION_NM
                                        END
                                       ELSE
                                        CASE
                                         WHEN A.REGION_CD = 'TOP' THEN 'Compliance Team (Headquarters)'
                                         ELSE C.REGION_NM
                                        END
                                       END AS REGION_NM
                                        , A.UP_REGION_CD, A.REGION_CD, A.REGION_CD_DEPTH, A.REGION_CD_ORDER
                                  FROM (
                                      SELECT UP_REGION_CD, REGION_CD, REGION_CD_DEPTH, REGION_CD_ORDER--, DECODE(REGION_CD, 'TOP', 'Compliance팀(본사)', REGION_NM) AS REGION_NM
                                        FROM (SELECT *
                                                          FROM TB_COM_REGION
                                                         WHERE DEL_YN = 'N')
                                        START WITH REGION_CD = 'TOP'
                                        CONNECT BY PRIOR REGION_CD = UP_REGION_CD
                                        ) A,
                                        TB_COM_REGION B,
                                        TB_COM_REGION C
                                WHERE A.UP_REGION_CD = B.REGION_CD(+)
                                  AND A.REGION_CD = C.REGION_CD(+)
                                ) B
                            WHERE B.REGION_BIGCATE = A.REGION_BIGCATE(+)
                             AND B.REGION_MIDCATE = A.REGION_MIDCATE(+)
                         )
                    )
                  START WITH REGION_CD = 'TOP'
                  CONNECT BY PRIOR REGION_CD = UP_REGION_CD
                  ORDER SIBLINGS BY REGION_CD_ORDER
            ]]>
            </statement>
        </query>

        <!-- 시스템사용(메뉴) 현황 조회 -->
        <query id="secfw.log.listMenuUseLog" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT *
                  FROM (
                        SELECT ROW_NUMBER() OVER (ORDER BY CONTACT_DT DESC) RN
                             , T.*
                             , COUNT(1) OVER() TOTAL_CNT
                         FROM (
                               SELECT SYS_CD
                                    , MENU_ID
                                    , MENU_NM
                                    , MENU_NM_ENG
                                    , UP_MENU_ID
                                    , MENU_LEVEL
                                    , MENU_ORDER
                                    , COMMENTS
                                    , MENU_URL
                                    , MENU_TYPE
                                    , DEVELOPER_NM
                                    , USER_ID
                                    , USER_NM
                                    , DEPT_NM
                                    , YEAR
                                    , MONTH
                                    , DAY
                                    , HOUR
                                    , CONVERT(CHAR(19), CONTACT_DT, 20) AS CONTACT_DT /*YYYY-MM-DD HH24:MI:SS*/
                                    , EMP_NO
                                    , USER_NM_ENG
                                    , SINGLE_ID
                                    , SINGLE_EPID
                                    , COMP_CD
                                    , COMP_NM
                                    , COMP_NM_ENG
                                    , BUSINESS_CD
                                    , BUSINESS_NM
                                    , BUSINESS_NM_ENG
                                    , DIVISION_CD
                                    , DIVISION_NM
                                    , DEPT_CD
                                    , IN_DEPT_CD
                                    , JIKGUP_CD
                                    , JIKGUP_NM
                                    , JIKGUP_NM_ENG
                                    , JIKMU_CD
                                    , JIKMU_NM
                                    , REGION_CD
                                    , REGION_NM
                                    , REGION_NM_ENG
                                    , EMAIL
                                    , OFFICE_TEL_NO
                                    , HOME_TEL_NO
                                    , MOBILE_NO
                                    , STATUS
                                    , EMPLOYEE_TYPE
                                 FROM TB_COM_MENU_STAT
                                WHERE SYS_CD = :vo.sys_cd
                                  AND (COMP_CD IN (SELECT CD
                                                    FROM TB_COM_CD
                                                   WHERE SYS_CD = :vo.sys_cd
                                                     AND GRP_CD = 'COMP2'
                                                     AND USE_YN = 'Y') OR COMP_CD='C10')
                                  AND CONTACT_DT BETWEEN CONVERT(DATETIME, :vo.start_datetime) /*YYYY-MM-DD HH24:MI*/
                                  AND CONVERT(DATETIME, :vo.end_datetime) /*YYYY-MM-DD HH24:MI*/
                                  AND MENU_ID != 'SECFW_ADMIN'
                                  AND MENU_ID NOT IN (SELECT MENU_ID FROM [dbo].[SECFW.LOG.LISTMENULOGNOPAGE]( :vo.sys_cd ))
                                  AND USER_ID NOT IN (SELECT USER_ID
                                                        FROM TB_COM_ROLE_USER
                                                       WHERE ROLE_CD = 'RA00')
                    #if($vo.search_name && !$vo.search_nm.equals(""))
                        #if($vo.search_combo && $vo.search_combo.equals("menu_nm"))
                                  AND MENU_NM LIKE '%' + :vo.search_name + '%'
                        #end
                        #if($vo.search_combo && $vo.search_combo.equals("comp_nm"))
                                  AND COMP_NM LIKE '%' + :vo.search_name + '%'
                        #end
                        #if($vo.search_combo && $vo.search_combo.equals("user_nm"))
                                  AND USER_NM LIKE '%' + :vo.search_name + '%'
                        #end
                    #end
                              ) T
                       ) TA
                 WHERE RN BETWEEN :vo.start_index AND :vo.end_index
                 ORDER BY RN
            ]]>
            </statement>
        </query>

        <!-- 시스템사용(메뉴) 현황 엑셀다운로드 - 사용자별 메뉴 접속 (페이징처리 X) -->
        <query id="secfw.log.listMenuLogNoPage" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT SYS_CD
                     , MENU_ID
                     , MENU_NM
                     , MENU_NM_ENG
                     , UP_MENU_ID
                     , MENU_LEVEL
                     , MENU_ORDER
                     , COMMENTS
                     , MENU_URL
                     , MENU_TYPE
                     , DEVELOPER_NM
                     , USER_ID
                     , USER_NM
                     , DEPT_NM
                     , YEAR
                     , MONTH
                     , DAY
                     , HOUR
                     , EMP_NO
                     , USER_NM_ENG
                     , SINGLE_ID
                     , SINGLE_EPID
                     , COMP_CD
                     , COMP_NM
                     , COMP_NM_ENG
                     , BUSINESS_CD
                     , BUSINESS_NM
                     , BUSINESS_NM_ENG
                     , DIVISION_CD
                     , DIVISION_NM
                     , DEPT_CD
                     , IN_DEPT_CD
                     , JIKGUP_CD
                     , JIKGUP_NM
                     , JIKGUP_NM_ENG
                     , JIKMU_CD
                     , JIKMU_NM
                     , REGION_CD
                     , REGION_NM
                     , REGION_NM_ENG
                     , EMAIL
                     , OFFICE_TEL_NO
                     , HOME_TEL_NO
                     , MOBILE_NO
                     , STATUS
                     , EMPLOYEE_TYPE
                     , CONVERT(CHAR(19), CONTACT_DT, 20) AS CONTACT_DT /*YYYY-MM-DD HH24:MI:SS*/
                  FROM TB_COM_MENU_STAT
                 WHERE SYS_CD = :vo.sys_cd
                   AND (COMP_CD IN (SELECT CD
                                     FROM TB_COM_CD
                                    WHERE SYS_CD = :vo.sys_cd
                                      AND GRP_CD = 'COMP2'
                                      AND USE_YN = 'Y') OR COMP_CD='C10')
                   AND CONTACT_DT BETWEEN CONVERT(DATETIME, :vo.start_datetime) /*YYYY-MM-DD HH24:MI*/
                   AND CONVERT(DATETIME, :vo.end_datetime) /*YYYY-MM-DD HH24:MI*/
                   
                   AND MENU_ID != 'SECFW_ADMIN'
                   AND MENU_ID NOT IN (
                   						SELECT MENU_ID FROM [dbo].[SECFW.LOG.LISTMENULOGNOPAGE]( :vo.sys_cd )		
                   						)
                   AND USER_ID NOT IN (SELECT USER_ID
                                         FROM TB_COM_ROLE_USER
                                        WHERE ROLE_CD = 'RA00')
            #if($vo.search_name && !$vo.search_nm.equals(""))
                #if($vo.search_combo && $vo.search_combo.equals("menu_nm"))
                   AND MENU_NM LIKE '%' + :vo.search_name + '%'
                #end
                #if($vo.search_combo && $vo.search_combo.equals("comp_nm"))
                   AND COMP_NM LIKE '%' + :vo.search_name + '%'
                #end
                #if($vo.search_combo && $vo.search_combo.equals("user_nm"))
                   AND USER_NM LIKE '%' + :vo.search_name + '%'
                #end
            #end
                 ORDER BY CONTACT_DT DESC
            ]]>
            </statement>
        </query>

        <!-- 시스템사용(메뉴) 현황 엑셀다운로드 - 메뉴별 접속 현황 (접속자수/접속횟수) -->
        <query id="secfw.log.listMenuLogContact" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT T2.MENU_ID
                     , T2.MENU_NM
                     , CASE
                            WHEN T2.LVL = 1 THEN CAST('-' AS VARCHAR(10))
                            ELSE CAST(ISNULL(T1.TODAY_USER_CNT,0) AS VARCHAR(10))
                       END TODAY_USER_CNT
                     , CASE
                            WHEN T2.LVL = 1 THEN CAST('-' AS VARCHAR(10))
                            ELSE CAST(ISNULL(T1.TODAY_CONTACT_CNT,0) AS VARCHAR(10))
                       END TODAY_CONTACT_CNT
                     , CASE
                            WHEN T2.LVL = 1 THEN CAST('-' AS VARCHAR(10))
                            ELSE CAST(ISNULL(T1.SRCH_USER_CNT,0) AS VARCHAR(10))
                       END SRCH_USER_CNT
                     , CASE
                            WHEN T2.LVL = 1 THEN CAST('-' AS VARCHAR(10))
                            ELSE CAST(ISNULL(T1.SRCH_CONTACT_CNT,0) AS VARCHAR(10))
                       END SRCH_CONTACT_CNT
                   --, DECODE(T2.LVL, 1, '-', ISNULL(T1.TODAY_USER_CNT,0)) TODAY_USER_CNT
                   --, DECODE(T2.LVL, 1, '-', ISNULL(T1.TODAY_CONTACT_CNT,0)) TODAY_CONTACT_CNT
                   --, DECODE(T2.LVL, 1, '-', ISNULL(T1.SRCH_USER_CNT,0)) SRCH_USER_CNT
                   --, DECODE(T2.LVL, 1, '-', ISNULL(T1.SRCH_CONTACT_CNT,0)) SRCH_CONTACT_CNT
                  FROM (
                        SELECT CASE
                                    WHEN  A.MENU_ID IS NULL THEN B.MENU_ID
                                    WHEN  B.MENU_ID IS NULL THEN A.MENU_ID
                                    ELSE  A.MENU_ID
                               END MENU_ID
                             , A.USER_CNT TODAY_USER_CNT
                             , A.CONTACT_CNT TODAY_CONTACT_CNT
                             , B.USER_CNT SRCH_USER_CNT
                             , B.CONTACT_CNT SRCH_CONTACT_CNT
                          FROM (
                                SELECT MENU_ID
                                     , COUNT(CONTACT_CNT) USER_CNT
                                     , SUM(CONTACT_CNT) CONTACT_CNT
                                  FROM (
                                        SELECT MENU_ID
                                             , COUNT(USER_ID) CONTACT_CNT
                                          FROM TB_COM_MENU_STAT
                                         WHERE SYS_CD  = :vo.sys_cd
                                           AND COMP_CD IN (SELECT CD
                                                             FROM TB_COM_CD
                                                            WHERE SYS_CD = :vo.sys_cd
                                                              AND GRP_CD = 'COMP2'
                                                              AND USE_YN = 'Y')
                                           AND CONTACT_DT BETWEEN CONVERT(DATETIME, :vo.start_datetime) /*YYYY-MM-DD HH24:MI*/
                                           AND CONVERT(DATETIME, :vo.end_datetime) /*YYYY-MM-DD HH24:MI*/
                                        -- AND CONTACT_DT BETWEEN TO_DATE(TO_CHAR(SYSDATE-1, 'YYYY-MM-DD') + ' 18:00', 'YYYY-MM-DD HH24:MI') AND TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM-DD') + ' 18:00', 'YYYY-MM-DD HH24:MI')
                                           AND USER_ID NOT IN (SELECT USER_ID
                                                                 FROM TB_COM_ROLE_USER
                                                                WHERE ROLE_CD = 'RA00')
                        #if($vo.search_name && !$vo.search_nm.equals(""))
                            #if($vo.search_combo && $vo.search_combo.equals("menu_nm"))
                                           AND MENU_NM LIKE '%' + :vo.search_name + '%'
                            #end
                            #if($vo.search_combo && $vo.search_combo.equals("comp_nm"))
                                           AND COMP_NM LIKE '%' + :vo.search_name + '%'
                            #end
                            #if($vo.search_combo && $vo.search_combo.equals("user_nm"))
                                           AND USER_NM LIKE '%' + :vo.search_name + '%'
                            #end
                        #end
                                         GROUP BY MENU_ID, USER_ID
                                       )
                                 GROUP BY MENU_ID
                               ) A
                               FULL OUTER JOIN
                               (
                                SELECT MENU_ID
                                     , COUNT(CONTACT_CNT) USER_CNT
                                     , SUM(CONTACT_CNT) CONTACT_CNT
                                  FROM (
                                        SELECT MENU_ID
                                             , COUNT(USER_ID) CONTACT_CNT
                                          FROM TB_COM_MENU_STAT
                                         WHERE SYS_CD = :vo.sys_cd
                                           AND COMP_CD IN (SELECT CD
                                                             FROM TB_COM_CD
                                                            WHERE SYS_CD = :vo.sys_cd
                                                              AND GRP_CD = 'COMP2'
                                                              AND USE_YN = 'Y')
                                           AND CONTACT_DT BETWEEN TO_DATE(:vo.start_datetime, 'YYYY-MM-DD HH24:MI') AND TO_DATE(:vo.end_datetime, 'YYYY-MM-DD HH24:MI')
                                           AND USER_ID NOT IN (SELECT USER_ID
                                                                 FROM TB_COM_ROLE_USER
                                                                WHERE ROLE_CD = 'RA00')
                        #if($vo.search_name && !$vo.search_nm.equals(""))
                            #if($vo.search_combo && $vo.search_combo.equals("menu_nm"))
                                           AND MENU_NM LIKE '%' + :vo.search_name + '%'
                            #end
                            #if($vo.search_combo && $vo.search_combo.equals("comp_nm"))
                                           AND COMP_NM LIKE '%' + :vo.search_name + '%'
                            #end
                            #if($vo.search_combo && $vo.search_combo.equals("user_nm"))
                                           AND USER_NM LIKE '%' + :vo.search_name + '%'
                            #end
                        #end
                                         GROUP BY MENU_ID, USER_ID
                                       )
                                 GROUP BY MENU_ID
                               ) B
                            ON A.MENU_ID = B.MENU_ID
                       ) T1
                     , (
                        SELECT MENU_ID
                             , LPAD('  ', (LEVEL-1) * 2, '  ') + MENU_NM MENU_NM
                             , LEVEL LVL
                          FROM TB_COM_MENU
                         WHERE SYS_CD     = :vo.sys_cd
                           AND USE_YN     = 'Y'
                           AND DISPLAY_YN = 'Y'
                           AND MENU_ID <> 'SECFW_ADMIN'
                           AND MENU_ID NOT IN (SELECT MENU_ID
                                                 FROM TB_COM_MENU
                                                WHERE SYS_CD     = :vo.sys_cd
                                                  AND USE_YN     = 'Y'
                                                  AND DISPLAY_YN = 'Y'
                                                START WITH UP_MENU_ID  = 'SECFW_ADMIN'
                                              CONNECT BY PRIOR MENU_ID = UP_MENU_ID)
                         START WITH UP_MENU_ID  = 'root'
                       CONNECT BY PRIOR MENU_ID = UP_MENU_ID
                         ORDER SIBLINGS BY TO_NUMBER(MENU_ORDER)
                       ) T2
                 WHERE T1.MENU_ID(+) = T2.MENU_ID
            ]]>
            </statement>
        </query>

        <!-- 시스템사용(메뉴) 현황(엑셀다운로드 시 - 사용하지 않는 듯) -->
        <query id="secfw.log.excelDownMenuUseLog" isCamelCase="false">
            <statement>
            <![CDATA[
                 SELECT SYS_CD
                      , MENU_ID
                      , MENU_NM
                      , MENU_NM_ENG
                      , UP_MENU_ID
                      , MENU_LEVEL
                      , MENU_ORDER
                      , COMMENTS
                      , MENU_URL
                      , MENU_TYPE
                      , DEVELOPER_NM
                      , USER_ID
                      , USER_NM
                      , DEPT_NM
                      , YEAR
                      , MONTH
                      , DAY
                      , HOUR
                      , CONVERT(CHAR(19), CONTACT_DT, 20) /*YYYY-MM-DD HH24:MI:SS*/ AS CONTACT_DT
                      , USER_NM + '(' + JIKGUP_NM + ')' + '/' + DEPT_NM + '/' + COMP_NM AS USER_INFO
                      , EMP_NO
                      , USER_NM_ENG
                      , SINGLE_ID
                      , SINGLE_EPID
                      , COMP_CD
                      , COMP_NM
                      , COMP_NM_ENG
                      , BUSINESS_CD
                      , BUSINESS_NM
                      , BUSINESS_NM_ENG
                      , DIVISION_CD
                      , DIVISION_NM
                      , DEPT_CD
                      , IN_DEPT_CD
                      , JIKGUP_CD
                      , JIKGUP_NM
                      , JIKGUP_NM_ENG
                      , JIKMU_CD
                      , JIKMU_NM
                      , REGION_CD
                      , REGION_NM
                      , REGION_NM_ENG
                      , EMAIL
                      , OFFICE_TEL_NO
                      , HOME_TEL_NO
                      , MOBILE_NO
                      , STATUS
                      , EMPLOYEE_TYPE
                  FROM TB_COM_MENU_STAT
                 WHERE SYS_CD = :vo.sys_cd
                   AND COMP_CD IN (SELECT CD
                                     FROM TB_COM_CD
                                    WHERE SYS_CD = :vo.sys_cd
                                      AND GRP_CD = 'COMP2'
                                      AND USE_YN = 'Y')
                   AND (CONVERT(CHAR(10), CONTACT_DT, 23) BETWEEN :vo.start_date AND :vo.end_date) /*YYYY-MM-DD*/
                   AND MENU_ID != 'SECFW_ADMIN'
                   AND MENU_ID NOT IN (SELECT MENU_ID FROM [dbo].[SECFW.LOG.LISTMENULOGNOPAGE]( :vo.sys_cd ))
                   AND USER_ID NOT IN (SELECT USER_ID
                                         FROM TB_COM_ROLE_USER
                                        WHERE ROLE_CD = 'RA00')
                #if ($vo.search_combo.equals("user_nm"))
                     AND USER_NM LIKE '%' + :vo.search_name + '%'
                #elseif ($vo.search_combo.equals("comp_nm"))
                     AND COMP_NM LIKE '%' + :vo.search_name + '%'
                #elseif ($vo.search_combo.equals("menu_nm"))
                     AND MENU_NM LIKE '%' + :vo.search_name + '%'
                #end
            ]]>
            </statement>
        </query>

        <!-- 파일다운로드 현황 조회 -->
        <query id="secfw.log.listFileLog" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT *
                  FROM (
                        SELECT ROW_NUMBER() OVER (ORDER BY CONTACT_DT DESC) RN
                             , T.*
                             , COUNT(1) OVER() TOTAL_CNT
                          FROM (
                                SELECT SYS_CD
                                     , FILE_PATH
                                     , FILE_NM
                                     , USER_ID
                                     , USER_NM
                                     , DEPT_NM
                                     , YEAR
                                     , MONTH
                                     , DAY
                                     , HOUR
                                     , CONVERT(CHAR(19), CONTACT_DT, 20) /*YYYY-MM-DD HH24:MI:SS*/ AS CONTACT_DT
                                     , EMP_NO
                                     , USER_NM_ENG
                                     , SINGLE_ID
                                     , SINGLE_EPID
                                     , COMP_CD
                                     , COMP_NM
                                     , COMP_NM_ENG
                                     , BUSINESS_CD
                                     , BUSINESS_NM
                                     , BUSINESS_NM_ENG
                                     , DIVISION_CD
                                     , DIVISION_NM
                                     , DEPT_CD
                                     , IN_DEPT_CD
                                     , JIKGUP_CD
                                     , JIKGUP_NM
                                     , JIKGUP_NM_ENG
                                     , JIKMU_CD
                                     , JIKMU_NM
                                     , REGION_CD
                                     , REGION_NM
                                     , REGION_NM_ENG
                                     , EMAIL
                                     , OFFICE_TEL_NO
                                     , HOME_TEL_NO
                                     , MOBILE_NO
                                     , STATUS
                                     , EMPLOYEE_TYPE
                                  FROM TB_COM_FILE_STAT
                                 WHERE SYS_CD = :vo.sys_cd
                                   AND CONTACT_DT BETWEEN CONVERT(DATETIME, :vo.start_datetime) /*YYYY-MM-DD HH24:MI*/ AND CONVERT(DATETIME, :vo.end_datetime) /*YYYY-MM-DD HH24:MI*/
                                   AND (COMP_CD IN (SELECT CD
                                                     FROM TB_COM_CD
                                                    WHERE SYS_CD = :vo.sys_cd
                                                      AND GRP_CD = 'COMP2'
                                                      AND USE_YN = 'Y') OR COMP_CD='C10')
                                   AND USER_ID NOT IN (SELECT USER_ID
                                                         FROM TB_COM_ROLE_USER
                                                        WHERE ROLE_CD = 'RA00')
                    #if($vo.search_name && !$vo.search_nm.equals(""))
                        #if($vo.search_combo && $vo.search_combo.equals("file_nm"))
                                   AND FILE_NM LIKE '%' + :vo.search_name + '%'
                        #end
                        #if($vo.search_combo && $vo.search_combo.equals("comp_nm"))
                                   AND COMP_NM LIKE '%' + :vo.search_name + '%'
                        #end
                        #if($vo.search_combo && $vo.search_combo.equals("user_nm"))
                                   AND USER_NM LIKE '%' + :vo.search_name + '%'
                        #end
                    #end
                               ) T
                       ) TA
                 WHERE RN BETWEEN :vo.start_index AND :vo.end_index
                 ORDER BY RN
            ]]>
            </statement>
        </query>

        <!--  파일다운로드 현황 엑셀다운로드(페이징처리 X) -->
        <query id="secfw.log.listFileLogNoPage" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT SYS_CD
                     , FILE_PATH
                     , FILE_NM
                     , USER_ID
                     , USER_NM
                     , DEPT_NM
                     , YEAR
                     , MONTH
                     , DAY
                     , HOUR
                     , EMP_NO
                     , USER_NM_ENG
                     , SINGLE_ID
                     , SINGLE_EPID
                     , COMP_CD
                     , COMP_NM
                     , COMP_NM_ENG
                     , BUSINESS_CD
                     , BUSINESS_NM
                     , BUSINESS_NM_ENG
                     , DIVISION_CD
                     , DIVISION_NM
                     , DEPT_CD
                     , IN_DEPT_CD
                     , JIKGUP_CD
                     , JIKGUP_NM
                     , JIKGUP_NM_ENG
                     , JIKMU_CD
                     , JIKMU_NM
                     , REGION_CD
                     , REGION_NM
                     , REGION_NM_ENG
                     , EMAIL
                     , OFFICE_TEL_NO
                     , HOME_TEL_NO
                     , MOBILE_NO
                     , STATUS
                     , EMPLOYEE_TYPE
                     , CONTACT_DT
                  FROM TB_COM_FILE_STAT
                 WHERE SYS_CD = :vo.sys_cd
                   AND CONTACT_DT BETWEEN TO_DATE(:vo.start_datetime, 'YYYY-MM-DD HH24:MI') AND TO_DATE(:vo.end_datetime, 'YYYY-MM-DD HH24:MI')
                   AND (COMP_CD IN (SELECT CD
                                     FROM TB_COM_CD
                                    WHERE SYS_CD = :vo.sys_cd
                                      AND GRP_CD = 'COMP2'
                                      AND USE_YN = 'Y') OR COMP_CD='C10')
                   AND USER_ID NOT IN (SELECT USER_ID
                                         FROM TB_COM_ROLE_USER
                                        WHERE ROLE_CD = 'RA00')
            #if($vo.search_name && !$vo.search_nm.equals(""))
                #if($vo.search_combo && $vo.search_combo.equals("file_nm"))
                   AND FILE_NM LIKE '%' + :vo.search_name + '%'
                #end
                #if($vo.search_combo && $vo.search_combo.equals("comp_nm"))
                   AND COMP_NM LIKE '%' + :vo.search_name + '%'
                #end
                #if($vo.search_combo && $vo.search_combo.equals("user_nm"))
                   AND USER_NM LIKE '%' + :vo.search_name + '%'
                #end
            #end
                 ORDER BY CONTACT_DT DESC
            ]]>
            </statement>
        </query>

        <!-- 파일다운로드 현황(엑셀다운로드 시 - 사용하지 않는 듯) -->
        <query id="secfw.log.excelDownFileDownLoadLog" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT *
                  FROM (
                        SELECT ROWNUM RN
                             , T.*
                             , COUNT(1) OVER() TOTAL_CNT
                          FROM (
                                SELECT SYS_CD
                                     , FILE_PATH
                                     , FILE_NM
                                     , USER_ID
                                     , USER_NM
                                     , DEPT_NM
                                     , YEAR
                                     , MONTH
                                     , DAY
                                     , HOUR
                                     , TO_CHAR(CONTACT_DT, 'YYYY-MM-DD HH24:MI:SS') AS CONTACT_DT
                                     , USER_NM + '(' + JIKGUP_NM + ')' + '/' + DEPT_NM + '/' + COMP_NM AS USER_INFO
                                     , EMP_NO
                                     , USER_NM_ENG
                                     , SINGLE_ID
                                     , SINGLE_EPID
                                     , COMP_CD
                                     , COMP_NM
                                     , COMP_NM_ENG
                                     , BUSINESS_CD
                                     , BUSINESS_NM
                                     , BUSINESS_NM_ENG
                                     , DIVISION_CD
                                     , DIVISION_NM
                                     , DEPT_CD
                                     , IN_DEPT_CD
                                     , JIKGUP_CD
                                     , JIKGUP_NM
                                     , JIKGUP_NM_ENG
                                     , JIKMU_CD
                                     , JIKMU_NM
                                     , REGION_CD
                                     , REGION_NM
                                     , REGION_NM_ENG
                                     , EMAIL
                                     , OFFICE_TEL_NO
                                     , HOME_TEL_NO
                                     , MOBILE_NO
                                     , STATUS
                                     , EMPLOYEE_TYPE
                                  FROM TB_COM_FILE_STAT
                                 WHERE SYS_CD = :vo.sys_cd
                                   AND COMP_CD IN (SELECT CD
                                                     FROM TB_COM_CD
                                                    WHERE SYS_CD = :vo.sys_cd
                                                      AND GRP_CD = 'COMP2'
                                                      AND USE_YN = 'Y')
                                   AND USER_ID NOT IN (SELECT USER_ID
                                                         FROM TB_COM_ROLE_USER
                                                        WHERE ROLE_CD = 'RA00')
                                   AND (TO_CHAR(CONTACT_DT,'YYYY-MM-DD') BETWEEN :vo.start_date AND :vo.end_date)
                            #if ($vo.search_combo.equals("user_nm"))
                                   AND USER_NM LIKE '%' + :vo.search_name + '%'
                            #elseif ($vo.search_combo.equals("comp_nm"))
                                   AND COMP_NM LIKE '%' + :vo.search_name + '%'
                            #elseif ($vo.search_combo.equals("file_nm"))
                                   AND FILE_NM LIKE '%' + :vo.search_name + '%'
                            #end
                                 ORDER BY CONTACT_DT DESC
                               ) T
                         ORDER BY RN
                       )
            ]]>
            </statement>
        </query>

        <!-- CHART 로그인현황(기간별) -->
        <query id="secfw.log.listLoginLogDayChart" isCamelCase="false">
            <statement>
            <![CDATA[
            SELECT ROWNUM AS RN, LOGIN_DATE, LOGIN_CNT, MAX(LOGIN_CNT) OVER() AS MAX_CNT, MIN(LOGIN_CNT) OVER() AS MIN_CNT
              FROM (
                   SELECT TO_CHAR(TO_DATE(B.DAYS), 'YYYY-MM-DD') AS LOGIN_DATE, SUM(DECODE(A.USER_ID, NULL, 0, 1)) AS LOGIN_CNT
                          FROM TB_COM_LOGIN_STAT A,
                               (SELECT TO_CHAR(SYSDATE - (ROWNUM-1), 'YYYYMMDD') AS DAYS
                                  FROM TB_COM_COPY_T
                                 WHERE ROWNUM <= :vo.range_date
                               ) B
                         WHERE A.SYS_CD(+) = :vo.sys_cd
                           AND B.DAYS = A.YEAR(+)+A.MONTH(+)+A.DAY(+)
                           AND TO_CHAR(A.LOGIN_DT(+), 'YYYYMMDD') BETWEEN TO_CHAR(SYSDATE-(:vo.range_date - 1), 'YYYYMMDD') AND TO_CHAR(SYSDATE, 'YYYYMMDD')
                        -- AND DECODE(A.COMP_CD, NULL, 'C10', A.COMP_CD) NOT IN ('C60')
                           AND COALESCE(A.COMP_CD, :comp_cd) NOT IN ('C60')
                         GROUP BY B.DAYS
                         ORDER BY B.DAYS
             )
            ORDER BY RN
            ]]>
            </statement>
        </query>

        <!-- CHART 로그인현황(기간별) -->
        <query id="secfw.log.recentUserInfo" isCamelCase="false">
            <statement>
            <![CDATA[
            SELECT SYS_CD
                 , USER_ID
                 , USER_NM
                 , DEPT_NM
                 , JIKGUP_CD
                 , JIKGUP_NM
                 , COMP_CD
                 , COMP_NM
                 /*, TO_CHAR(LOGIN_DT, 'YYYY-MM-DD HH24:MI:SS') AS LOGIN_DT */
                 , CONVERT(CHAR(19),LOGIN_DT, 20) AS LOGIN_DT
                 , LOGOUT_DT
                 , IP_ADDRESS
              FROM (
                    SELECT TOP 1 SA.*
                      FROM TB_COM_LOGIN_STAT SA
                     WHERE SYS_CD  = :sys_cd
                       AND USER_ID = :user_id
                       AND COALESCE(COMP_CD, :comp_cd) NOT IN ('C60')
                     ORDER BY LOGIN_DT DESC
                   ) T
            
            ]]>
            </statement>
        </query>

        <!-- 해당테이블의 컬럼명, COMMENT 가져오기 -->
        <query id="secfw.log.column.info" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT  A.COLUMN_NAME
                       ,B.COMMENTS
                  FROM  USER_TAB_COLUMNS A
                       ,USER_COL_COMMENTS B
                 WHERE  A.TABLE_NAME = B.TABLE_NAME
                   AND  A.COLUMN_NAME = B.COLUMN_NAME
                   AND  A.TABLE_NAME = :vo.table_nm
                 ORDER  BY COLUMN_ID
            ]]>
            </statement>
        </query>

        <!-- 로그인현황 엑셀다운로드 - 부서별 로그인현황 (법무LITE에서 사용안함 - 회사별 로그인현황으로 변경) -->
        <query id="secfw.log.listLoginLogDept" isCamelCase="false">
            <statement>
            <![CDATA[
                SELECT  CASE
                            WHEN  A.BUSINESS_CD IS NULL THEN B.BUSINESS_CD
                            WHEN  B.BUSINESS_CD IS NULL THEN A.BUSINESS_CD
                            ELSE  A.BUSINESS_CD
                        END BUSINESS_CD
                       ,CASE
                            WHEN  A.BUSINESS_NM IS NULL THEN B.BUSINESS_NM
                            WHEN  B.BUSINESS_NM IS NULL THEN A.BUSINESS_NM
                            ELSE  A.BUSINESS_NM
                        END BUSINESS_NM
                       ,ISNULL(A.USER_CNT, 0) TODAY_USER_CNT
                       ,ISNULL(A.LOGIN_CNT, 0) TODAY_LOGIN_CNT
                       ,ISNULL(B.USER_CNT, 0) SRCH_USER_CNT
                       ,ISNULL(B.LOGIN_CNT, 0) SRCH_LOGIN_CNT
                  FROM  ( SELECT  ISNULL(BUSINESS_CD, '') BUSINESS_CD
                                 ,CASE WHEN :vo.session_user_locale = 'ko' THEN
                                        ISNULL(DECODE(BUSINESS_CD,'DIGI', '생활가전', 'TELE', '무선사업부', BUSINESS_NM), '기타')
                                  ELSE
                                        ISNULL(DECODE(BUSINESS_CD,'DIGI', 'Home Appliance', 'TELE', 'Mobile Communications Business', BUSINESS_NM), 'Others')
                                  END BUSINESS_NM
                                 ,COUNT(LOGIN_CNT) USER_CNT
                                 ,SUM(LOGIN_CNT) LOGIN_CNT
                            FROM  (
                                    SELECT  BUSINESS_CD
                                           ,BUSINESS_NM
                                           ,COUNT(USER_ID) LOGIN_CNT
                                      FROM  TB_COM_LOGIN_STAT
                                     WHERE  SYS_CD = :vo.sys_cd
                                    -- AND  COMP_CD = 'C10'
                                     #if($vo.search_name && !$vo.search_nm.equals(""))
                                         #if($vo.search_combo && $vo.search_combo.equals("user_nm"))
                                       AND  USER_NM LIKE '%' + :vo.search_name + '%'
                                         #end
                                         #if($vo.search_combo && $vo.search_combo.equals("dept_nm"))
                                       AND  DEPT_NM LIKE '%' + :vo.search_name + '%'
                                         #end
                                     #end
                                       AND  USER_ID NOT IN ( SELECT  USER_ID
                                                               FROM  TB_COM_ROLE_USER
                                                              WHERE  ROLE_CD = 'RA00')
                                       AND  LOGIN_DT BETWEEN TO_DATE(TO_CHAR(SYSDATE-1, 'yyyy-MM-dd') + ' 18:00', 'yyyy-MM-dd hh24:mi') AND
                                                             TO_DATE(TO_CHAR(SYSDATE, 'yyyy-MM-dd') + ' 18:00', 'yyyy-MM-dd hh24:mi')
                                    GROUP BY BUSINESS_CD, BUSINESS_NM, USER_ID) T1
                           GROUP  BY BUSINESS_CD, BUSINESS_NM
                           ORDER  BY BUSINESS_NM ) A
                 FULL OUTER JOIN
                        ( SELECT  ISNULL(BUSINESS_CD, '') BUSINESS_CD
                                 ,CASE WHEN :vo.session_user_locale = 'ko' THEN
                                        ISNULL(DECODE(BUSINESS_CD,'DIGI', '생활가전', 'TELE', '무선사업부', BUSINESS_NM), '기타')
                                  ELSE
                                        ISNULL(DECODE(BUSINESS_CD,'DIGI', 'Home Appliance', 'TELE', 'Mobile Communications Business', BUSINESS_NM), 'Others')
                                  END BUSINESS_NM
                                 ,COUNT(LOGIN_CNT) USER_CNT
                                 ,SUM(LOGIN_CNT) LOGIN_CNT
                            FROM  (
                                    SELECT  BUSINESS_CD
                                           ,BUSINESS_NM
                                           ,COUNT(USER_ID) LOGIN_CNT
                                      FROM  TB_COM_LOGIN_STAT
                                     WHERE  SYS_CD = :vo.sys_cd
                                    -- AND  COMP_CD = 'C10'
                                     #if($vo.search_name && !$vo.search_nm.equals(""))
                                         #if($vo.search_combo && $vo.search_combo.equals("dept_nm"))
                                       AND  DEPT_NM LIKE '%' + :vo.search_name + '%'
                                         #end
                                         #if($vo.search_combo && $vo.search_combo.equals("user_nm"))
                                       AND  USER_NM LIKE '%' + :vo.search_name + '%'
                                         #end
                                     #end
                                       AND  LOGIN_DT BETWEEN TO_DATE(:vo.start_datetime, 'yyyy-MM-dd hh24:mi') AND TO_DATE(:vo.end_datetime, 'yyyy-MM-dd hh24:mi')
                                       AND  USER_ID NOT IN ( SELECT  USER_ID
                                                               FROM  TB_COM_ROLE_USER
                                                              WHERE  ROLE_CD = 'RA00')
                                    GROUP BY BUSINESS_CD, BUSINESS_NM, USER_ID) T1
                           GROUP  BY BUSINESS_CD, BUSINESS_NM
                           ORDER  BY BUSINESS_NM ) B
                 ON  A.BUSINESS_CD = B.BUSINESS_CD
            ]]>
            </statement>
        </query>

    </queries>
</queryservice>
