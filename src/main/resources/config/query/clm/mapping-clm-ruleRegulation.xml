<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
    
	    <!-- 프로세스&규정지침서 목록조회: 2011.09.06 : 신남원 -->
		<query id="clm.rule.listRegulation" isCamelCase="false">
		  <statement>
		    <![CDATA[
			    SELECT RULE_NO
				     , UP_RULE_NO
				     , RULE_DEPTH
				     , RULE_SRT
				     , DN_RULE_EXIST_YN
				     , RULE_TITLE
				     , ISNULL(RULE_TITLE_EN,RULE_TITLE) RULE_TITLE_EN
				     , RULE_CONT
				     , RULE_CONT_EN
				     , REG_DT
				     , REG_ID
				     , REG_NM
				     , MOD_DT
				     , MOD_ID
				     , MOD_NM
				     , DEL_YN
				     , DEL_DT
				     , DEL_ID
				     , DEL_NM
				     , COUNT(*) OVER(PARTITION BY UP_RULE_NO) CNT
				  -- , ROW_NUMBER() OVER(PARTITION BY UP_RULE_NO) UP_RULE_NO_RN
				     , ROW_NUMBER() OVER(ORDER BY UP_RULE_NO) UP_RULE_NO_RN
				  FROM TN_CLM_PRCS_RULE
				 WHERE  DEL_YN = 'N'
				#if(!$vo.session_auth_comp_cd.equals(""))
					AND COMP_CD IN ($vo.session_auth_comp_cd)
				#end
				 	AND	UP_RULE_NO IN (
							SELECT 	UP_RULE_NO 
							FROM 	TN_CLM_PRCS_RULE
							WHERE 	DEL_YN = 'N'
							#if(!$vo.session_auth_comp_cd.equals(""))
								AND COMP_CD IN ($vo.session_auth_comp_cd)
							#end
							GROUP BY UP_RULE_NO HAVING COUNT(UP_RULE_NO) > 1 )
					
				 ORDER BY UP_RULE_NO ASC, RULE_DEPTH ASC, RULE_SRT ASC
		    ]]>
		  </statement>
		</query>
		
    </queries>
</queryservice>		