<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
	   <queries>
<query id="clm.share.ListContractAttention" isCamelCase="false">
  <statement>
    <![CDATA[
 SELECT *
		FROM(
			SELECT rownum RN,t.*, COUNT(1) over() TOTAL_CNT
        		  FROM(
	               	   SELECT z.MTBAT_NO
	                         ,z.TYPE_GBN 
	                         ,CASE WHEN z.TYPE_MIDCLSFCN IS NOT NULL THEN z.TYPE_GBN_NM + ' ▶ ' + z.TYPE_BIGCLSFCN_NM + ' ▶ '  + z.TYPE_MIDCLSFCN_NM
			                  ELSE z.TYPE_GBN_NM + ' ▶ ' + z.TYPE_BIGCLSFCN_NM
			                  END TYPE_GBN_NM
		                      ,z.TYPE_BIGCLSFCN 
		                      ,z.TYPE_MIDCLSFCN 
		                      ,z.TITLE 
		                      ,z.CONT 
		                      ,z.RDCNT 
		                      ,z.REG_DT 
		                      ,z.REG_ID 
		                      ,z.REG_NM 
		                      ,z.MOD_DT 
		                      ,z.MOD_ID 
		                      ,z.MOD_NM 
		                      ,z.DEL_YN 
		                      ,z.DEL_DT 
		                      ,z.DEL_ID 
		                      ,z.DEL_NM
	           			from(
							 		    SELECT A.MTBAT_NO AS MTBAT_NO
							           		  ,A.TYPE_GBN AS TYPE_GBN
				                			  ,CASE WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM
			              							WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_FRA
			              							WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_DEU
			              					  	    ELSE B.CD_NM_ENG
			              					   END AS TYPE_GBN_NM
							           		  ,A.TYPE_BIGCLSFCN AS TYPE_BIGCLSFCN
				                  			  ,CASE WHEN :vo.session_user_locale = 'ko' THEN C.CD_NM
			              							WHEN :vo.session_user_locale = 'fr' THEN C.CD_NM_FRA
			              							WHEN :vo.session_user_locale = 'de' THEN C.CD_NM_DEU
			              					  	    ELSE C.CD_NM_ENG
			              					   END AS TYPE_BIGCLSFCN_NM
							            	  ,A.TYPE_MIDCLSFCN AS TYPE_MIDCLSFCN
				                  			  ,CASE WHEN :vo.session_user_locale = 'ko' THEN D.CD_NM
			              							WHEN :vo.session_user_locale = 'fr' THEN D.CD_NM_FRA
			              							WHEN :vo.session_user_locale = 'de' THEN D.CD_NM_DEU
			              					  	    ELSE D.CD_NM_ENG
			              					   END AS TYPE_MIDCLSFCN_NM
							            	  ,A.TITLE AS TITLE
							            	  ,A.CONT  AS CONT
							            	  ,A.RDCNT AS RDCNT
							            	  ,TO_CHAR(A.REG_DT, 'YYYYMMDD') AS REG_DT
							            	  ,A.REG_ID AS REG_ID
							            	  ,A.REG_NM AS REG_NM
							            	  ,A.MOD_DT AS MOD_DT
							            	  ,A.MOD_ID AS MOD_ID
							            	  ,A.MOD_NM AS MOD_NM
							           		  ,A.DEL_YN AS DEL_YN
							            	  ,A.DEL_DT AS DEL_DT
							            	  ,A.DEL_ID AS DEL_ID
							            	  ,A.DEL_NM AS DEL_NM
							         	 FROM TN_CLM_CONTRACT_MTBAT A
						                     ,TN_COM_CONTRACTTYPE_CD B
						                     ,TN_COM_CONTRACTTYPE_CD C 
						                     ,TN_COM_CONTRACTTYPE_CD D
             							WHERE A.TYPE_GBN = B.TYPE_CD
					                    AND A.TYPE_BIGCLSFCN = C.TYPE_CD
					                    AND A.TYPE_MIDCLSFCN = D.TYPE_CD(+)
					                    AND A.DEL_YN   = 'N'
							         #if (!$vo.srch_bigclsfcn.equals(""))
											AND	A.TYPE_GBN = :vo.srch_bigclsfcn
									 #end
									 #if (!$vo.srch_midclsfcn.equals(""))
											AND	A.TYPE_BIGCLSFCN = :vo.srch_midclsfcn
									 #end
									 #if (!$vo.srch_smlclsfcn.equals(""))
											AND	A.TYPE_MIDCLSFCN = :vo.srch_smlclsfcn
									 #end
								         ORDER BY A.MTBAT_NO DESC
					          				) Z
										 ) t
									)
		  							  WHERE RN between :vo.start_index and :vo.end_index
    ]]>
  </statement>
</query>


<query id="clm.share.InsertContractAttention" isCamelCase="false">
  <statement>
    <![CDATA[
    INSERT INTO TN_CLM_CONTRACT_MTBAT (
           MTBAT_NO
               , TYPE_GBN
               , TYPE_BIGCLSFCN
               , TYPE_MIDCLSFCN
               , TITLE
               , CONT
               , RDCNT
               , REG_DT
               , REG_ID
               , REG_NM
               , DEL_YN
        ) VALUES (
           :vo.mtbat_no
          ,:vo.type_gbn
          ,:vo.type_bigclsfcn
          ,:vo.type_midclsfcn
          ,:vo.title
          ,:vo.cont
          ,0
          ,sysdate
          ,:vo.reg_id
          ,:vo.reg_nm
          ,'N'
        )
    ]]>
  </statement>
</query>


<query id="clm.share.ModifyContractAttention" isCamelCase="false">
  <statement>
    <![CDATA[
         UPDATE TN_CLM_CONTRACT_MTBAT
          SET   TYPE_GBN = :vo.type_gbn
               ,TYPE_BIGCLSFCN = :vo.type_bigclsfcn
               ,TYPE_MIDCLSFCN = :vo.type_midclsfcn
               ,TITLE = :vo.title  
               ,CONT = :vo.cont
			   , MOD_DT  = SYSDATE  
               , MOD_ID = :vo.mod_id
               , MOD_NM = :vo.mod_nm
          WHERE	MTBAT_NO    = :vo.mtbat_no
          AND		DEL_YN   = 'N'	  
    ]]>
  </statement>
</query>

<query id="clm.share.detailContractAttention" isCamelCase="false">
  <statement>
    <![CDATA[ 
		        SELECT MTBAT_NO
		              ,TYPE_GBN
		              ,TYPE_BIGCLSFCN
		              ,TYPE_MIDCLSFCN
		              ,TITLE 
		              ,CASE WHEN TYPE_MIDCLSFCN IS NOT NULL THEN TYPE_GBN_NM + ' ▶ ' + TYPE_BICCLSFC_NM + ' ▶ '  + TYPE_MIDCLSFCN_NM
		                    ELSE TYPE_GBN_NM + ' ▶ ' + TYPE_BICCLSFC_NM
	             	   END TYPE_GBN_NM
                ,TYPE_BICCLSFC_NM, TYPE_MIDCLSFCN_NM, CONT, RDCNT, REG_ID, REG_NM, MOD_DT, MOD_ID, MOD_NM, DEL_YN,DEL_DT,REG_DT        
         		 FROM(    
        			  SELECT   A.MTBAT_NO AS MTBAT_NO
			            	  ,A.TYPE_GBN AS TYPE_GBN
			            	  ,A.TYPE_BIGCLSFCN AS TYPE_BIGCLSFCN
                  			  ,A.TYPE_MIDCLSFCN AS TYPE_MIDCLSFCN
                  			  ,A.TITLE    AS TITLE
                 			  ,CASE WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_DEU
			              			ELSE B.CD_NM_ENG
			              	   END AS TYPE_GBN_NM
                 			  ,CASE WHEN :vo.session_user_locale = 'ko' THEN C.CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN C.CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN C.CD_NM_DEU
			              			ELSE C.CD_NM_ENG
			              	   END AS TYPE_BICCLSFC_NM 
                 			  ,CASE WHEN :vo.session_user_locale = 'ko' THEN D.CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN D.CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN D.CD_NM_DEU
			              			ELSE D.CD_NM_ENG
			              	   END AS TYPE_MIDCLSFCN_NM
					          ,A.CONT     AS CONT
					          ,A.RDCNT    AS RDCNT
					          ,TO_CHAR(A.REG_DT, 'YYYY-MM-DD') AS REG_DT
					          ,A.REG_ID AS REG_ID
					          ,A.REG_NM AS REG_NM
					          ,A.MOD_DT AS MOD_DT
					          ,A.MOD_ID AS MOD_ID
					          ,A.MOD_NM AS MOD_NM
					          ,A.DEL_YN AS DEL_YN
					          ,A.DEL_DT AS DEL_DT
					          ,A.DEL_ID AS DEL_ID
					          ,A.DEL_NM AS DEL_NM
		        FROM 	TN_CLM_CONTRACT_MTBAT A  
                 ,TN_COM_CONTRACTTYPE_CD B
                 ,TN_COM_CONTRACTTYPE_CD C 
                 ,TN_COM_CONTRACTTYPE_CD D
		     	WHERE  	A.TYPE_GBN = B.TYPE_CD
                       	AND 	A.TYPE_BIGCLSFCN = C.TYPE_CD
                       	AND 	A.TYPE_MIDCLSFCN = D.TYPE_CD(+)
		     	       	AND 	MTBAT_NO = :vo.mtbat_no
		  	 )
			    
    ]]>
  </statement>
</query>   


<query id="clm.share.DeleteContractAttention" isCamelCase="false">
  <statement>
    <![CDATA[
     	       UPDATE TN_CLM_CONTRACT_MTBAT
		       SET       DEL_YN  = 'Y'
				        ,DEL_DT  = SYSDATE
				        ,DEL_ID  = :vo.del_id
				        ,DEL_NM  = :vo.del_nm
			   WHERE	MTBAT_NO = :vo.mtbat_no
			   AND		DEL_YN   = 'N'	         
    ]]>
  </statement>
	</query>
	
	<!-- ContractAttention RDCNT Increase -->
		<query id="clm.share.ContractAttention.increseRdcnt" isCamelCase="false">
            <statement>
            <![CDATA[
                UPDATE  TN_CLM_CONTRACT_MTBAT
                   SET  RDCNT = RDCNT + 1
                 WHERE	1=1
				   AND	MTBAT_NO    = :vo.mtbat_no
				   AND	DEL_YN   = 'N'
            ]]>
            </statement>
        </query>
        
        <!-- ContractAttention MAX Sequence -->
		<query id="clm.share.makeSeqLibrary" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT	ISNULL(MAX(MTBAT_NO)+1,1) NEXT_MTBAT_NO
				  FROM	TN_CLM_CONTRACT_MTBAT
				 
		
			]]>
			</statement>
		</query>
			<!-- 표준 조항 권한 체크 정보  -->
		<query id="clm.share.authContractAttention" isCamelCase="false">
		  	<statement>
			    <![CDATA[
					SELECT	MTBAT_NO, TYPE_GBN, TYPE_BIGCLSFCN, TYPE_MIDCLSFCN, TITLE, CONT, RDCNT
						  , TO_CHAR(REG_DT, 'YYYYMMDD') AS REG_DT, REG_ID, REG_NM
					FROM 	TN_CLM_CONTRACT_MTBAT
					WHERE   MTBAT_NO = :vo.mtbat_no
			    ]]>
		  	</statement>
		</query>
		
		
		
	</queries>
</queryservice>	