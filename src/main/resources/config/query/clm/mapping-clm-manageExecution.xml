<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
    	<!-- 계약  목록 -->
		<query id="clm.manage.listContract" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT ROW_NUMBER() OVER (ORDER BY A.CNSDREQ_ID) AS RN
				,A.CNSDREQ_ID
				,A.CNTRT_ID
				,A.CNSDMAN_NM
				,A.CNSDMAN_ID
				,dbo.CLM_REQ_RESPMANS_M(A.CNSDREQ_ID, 'en') AS CNSDMANS /* add reviewers */
				,B.CNTRT_NO
				,B.CNTRT_NM
				,B.CNTRT_OPPNT_CD
				,B.CNTRT_STATUS
				,B.CNTRT_RESPMAN_ID
				,B.CNTRT_RESPMAN_NM
				,B.PRCS_DEPTH
				,B.DEPTH_STATUS
				,X.REQMAN_ID
				,X.REQMAN_NM
				,X.MN_CNSD_DEPT
				,X.MN_RESPMAN_APNT_YN
				,X.VC_CNSD_DEPT
				,X.VC_CNSD_DEMND_DT
				,X.VC_CNSD_DEMND_CONT
				,X.VC_RESPMAN_APNT_YN
				,X.DMSTFRGN_GBN
				,X.DRAFT_DEMND_YN
				,X.PLNDBN_REQ_YN
				,X.LAST_CNSD_YN
				,X.PREV_CNSDREQ_ID
				,X.REQ_TITLE
				,X.REQ_DEPT
				,X.REQ_DEPT_NM
				/* ,TO_CHAR(X.REQ_DT,'YYYY-MM-DD') REQ_DT */
				,CONVERT(VARCHAR, X.REQ_DT, 23) AS REQ_DT
				,CONVERT(DATE, X.RE_DEMNDDAY, 120) AS RE_DEMNDDAY
				,X.LASTBN_CHGE_YN
				,X.REBFR_APPRVL_YN
				,X.RE_DT
				,X.PUB_YN
				,X.REQ_OPERDIV
				,X.REQ_UP_DEPT
				,X.REQMAN_JIKGUP_NM
				,X.ACPT_DT
				,X.PLNDBN_CHGE_CONT
				,X.CNSD_HOLD_CAUSE
				,X.FST_REQ_DEPT
				,X.FST_REQ_UP_DEPT
				,X.REQ_INTNL_DEPT_CD
				,X.CNSD_DEMND_CONT
				,COUNT(A.CNSDREQ_ID) OVER (PARTITION BY A.CNSDREQ_ID ORDER BY A.CNTRT_ID) TOTAL_CNT
				/* SUNGWOO ADDED 2014-09-30 ATTACHMENT BRANCH*/
				,B.CNTRT_INFO_GBN
				, ISNULL(SUBSTRING( TNC_SUMMARY_LINK, charindex('tcdoc=', TNC_SUMMARY_LINK)+6, len(TNC_SUMMARY_LINK)), '') AS TNC_NO 
			FROM TN_CLM_CONT_CNSDREQ X
				,TN_CLM_CONTRACT_CNSD A
				,TN_CLM_CONTRACT_MASTER B
				WHERE	X.CNSDREQ_ID = A.CNSDREQ_ID
				   AND	A.CNTRT_ID = B.CNTRT_ID
				   AND	A.CNSDREQ_ID = :vo.cnsdreq_id
				   AND	B.DEL_YN = 'N'
				   AND  X.DEL_YN = 'N'
				
			]]>
			</statement>
		</query>
		<query id="clm.manage.count.responseManId" isCamelCase="false" comment="법무 재검토 발신 ">
            <statement>
            <![CDATA[			       
			    SELECT count(DISTINCT RESPMAN_ID) CNT
			    FROM  TN_CLM_CONT_CNSDREQ_RESPMAN
			    WHERE CNSDREQ_ID = :vo.cnsdreq_id	
			    AND  RESPMAN_ID = :vo.session_user_id	   
            ]]>
            </statement>
        </query>
		<query id="clm.manage.listContract2" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT	ROW_NUMBER() OVER(ORDER BY A.CNSDREQ_ID) AS RN
						, A.CNSDREQ_ID, A.CNTRT_ID
						, B.CNTRT_NM, A.COMP_CD
                		, B.CNTRT_OPPNT_CD, B.CNTRT_STATUS, B.CNTRT_RESPMAN_ID
						, B.CNTRT_RESPMAN_NM, B.PRCS_DEPTH, B.DEPTH_STATUS
						, X.REQMAN_ID, X.REQMAN_NM, X.MN_CNSD_DEPT, X.MN_RESPMAN_APNT_YN
						, X.VC_CNSD_DEPT, X.VC_CNSD_DEMND_DT, X.VC_CNSD_DEMND_CONT
						, X.VC_RESPMAN_APNT_YN, X.DMSTFRGN_GBN, X.DRAFT_DEMND_YN
						, X.PLNDBN_REQ_YN, X.LAST_CNSD_YN, X.PREV_CNSDREQ_ID
						, X.REQ_TITLE, X.REQ_DEPT, X.REQ_DEPT_NM
						/* , TO_CHAR(X.REQ_DT,'YYYY-MM-DD') REQ_DT */
						, CONVERT(VARCHAR,X.REQ_DT,23) AS REQ_DT
						/* , TO_CHAR(TO_DATE(X.RE_DEMNDDAY,'YYYYMMDD'),'YYYY-MM-DD') RE_DEMNDDAY */
						, CONVERT(DATE,X.RE_DEMNDDAY,120) AS RE_DEMNDDAY 
						, X.LASTBN_CHGE_YN, X.REBFR_APPRVL_YN
						, X.RE_DT, X.PUB_YN, X.REQ_OPERDIV, X.REQ_UP_DEPT
						, X.REQMAN_JIKGUP_NM, X.ACPT_DT, X.PLNDBN_CHGE_CONT
						, X.CNSD_HOLD_CAUSE, X.FST_REQ_DEPT, X.FST_REQ_UP_DEPT
						, X.REQ_INTNL_DEPT_CD, X.CNSD_DEMND_CONT						
						, COUNT(A.CNSDREQ_ID) OVER(PARTITION BY A.CNSDREQ_ID ORDER BY A.CNTRT_ID) TOTAL_CNT
				  FROM	TN_CLM_CONT_CNSDREQ X, TN_CLM_CONTRACT_CNSD A, TN_CLM_CONTRACT_MASTER B
				 WHERE	X.CNSDREQ_ID = A.CNSDREQ_ID
				   AND	A.CNTRT_ID = B.CNTRT_ID
				   AND	A.CNSDREQ_ID = (SELECT MAX(CNSDREQ_ID) 
				                          FROM TN_CLM_CONTRACT_CNSD 
				                         WHERE CNTRT_ID = :vo.cntrt_id)
				   AND	B.DEL_YN = 'N'
				   AND  X.DEL_YN = 'N'
				
			]]>
			</statement>
		</query>
		
		<!-- 계약 상세정보 -->
		<query id="clm.manage.detailContract" isCamelCase="false">
			<statement>
			<![CDATA[
			SELECT ROW_NUMBER() OVER(ORDER BY A.CNTRT_ID) AS RN
			     , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  	WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  	WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  	ELSE CD_NM_ENG
			               END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.BIZ_CLSFCN ) AS BIZ_CLSFCN_NM
				 , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  	WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  	WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  	ELSE CD_NM_ENG
			               END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.DEPTH_CLSFCN ) AS DEPTH_CLSFCN_NM
			     , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  	WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  	WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  	ELSE CD_NM_ENG
			               END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNCLSNPURPS_BIGCLSFCN ) AS CNCLSNPURPS_BIGCLSFCN_NM
			     , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  	WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  	WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  	ELSE CD_NM_ENG
			               END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNCLSNPURPS_MIDCLSFCN ) AS CNCLSNPURPS_MIDCLSFCN_NM
			     , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  	WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  	WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  	ELSE CD_NM_ENG
			               END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNCLSNPURPS_MIDCLSFCN_ETC ) AS CNCLSNPURPS_MIDCLSFCN_ETC_NM
			     , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  	WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  	WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  	ELSE CD_NM_ENG
			               END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNTRT_TRGT ) AS CNTRT_TRGT_NM				      
			     , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
					            WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
					            WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
					            ELSE CD_NM_ENG
					          END CD_NM FROM TB_COM_CD WHERE CD = A.PAYMENT_GBN ) AS PAYMENT_GBN_NM 
			     , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			     				WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			     				WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			     				ELSE CD_NM_ENG END FROM TB_COM_CD WHERE CD = A.BFHDCSTN_APBT_MTHD) AS BFHDCSTN_APBT_MTHD_NM 
			     , A.CNTRT_OPPNT_CD AS CUSTOMER_CD 	
     			 , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              ELSE CD_NM_ENG
			          END CD_NM FROM TB_COM_CD WHERE CD = A.CNTRT_OPPNT_TYPE ) AS GUBN_CD
     			 , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              ELSE CD_NM_ENG
			          END CD_NM FROM TB_COM_CD WHERE CD = A.CNTRT_OPPNT_TYPE ) AS BUSINESS_TYPE     
     			 , A.CNTRT_OPPNT_NM AS CUSTOMER_NM1  
     			 , A.CNTRT_OPPNT_RPRSNTMAN
     			 , A.CNTRT_OPPNT_RESPMAN
     			 , A.CNTRT_OPPNT_TELNO
     			 , A.CNTRT_OPPNT_EMAIL
			     , A.CNTRT_ID
			     , A.CNTRT_NM
			     , A.REGION_GBN
			     , A.BIZ_CLSFCN
			     , A.DEPTH_CLSFCN
			     , A.CNCLSNPURPS_BIGCLSFCN
			     , A.CNCLSNPURPS_MIDCLSFCN
			     , A.CNCLSNPURPS_MIDCLSFCN_ETC
			     , A.CNTRT_TRGT
			     , A.CNTRT_TRGT_DET
			     , A.PSHDBKGRND_PURPS
			     , A.PAYMENT_GBN
			     , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              ELSE CD_NM_ENG
			          END CD_NM FROM TB_COM_CD WHERE CD = A.PAYMENT_GBN) AS PAYMENT_GBN_NM
			     , A.ANTCPTNEFCT
    		     , CASE WHEN A.CNTRTPERIOD_STARTDAY = '' 
			 				THEN '' 
			 				ELSE CONVERT(VARCHAR, CONVERT(DATE, A.CNTRTPERIOD_STARTDAY, 120))
						END AS CNTRTPERIOD_STARTDAY 
				 , CASE WHEN A.CNTRTPERIOD_ENDDAY = '' 
			 				THEN '' 
			 				ELSE CONVERT(VARCHAR, CONVERT(DATE, A.CNTRTPERIOD_ENDDAY,120))
						END AS CNTRTPERIOD_ENDDAY 
			     , A.SECRET_KEEPPERIOD
			     ,RTRIM(REPLACE(CONVERT(VARCHAR,CONVERT(MONEY,ISNULL(A.CNTRT_UNTPRC,'0')),1),'.00','')) AS CNTRT_UNTPRC
			     ,RTRIM(REPLACE(CONVERT(VARCHAR,CONVERT(MONEY,ISNULL(A.CNTRT_AMT,'0')),1),'.00','')) AS CNTRT_AMT
			     , A.CRRNCY_UNIT
			     , A.PAYMENT_COND
			     , A.AUTO_RNEW_YN
			     /* , TO_CHAR(TO_DATE(A.EXPRT_NOTIDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS EXPRT_NOTIDAY */
			     , CONVERT(DATE,A.EXPRT_NOTIDAY,120) AS EXPRT_NOTIDAY
			     , A.OBLGT_LMT
			     , A.SPCL_COND
			     /* , TO_CHAR(TO_DATE(A.CNCLSN_PLNDDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNCLSN_PLNDDAY */ 
			     , CONVERT(DATE,A.CNCLSN_PLNDDAY,120) AS CNCLSN_PLNDDAY
			     , A.CNTRT_RESPMAN_ID
			     , A.CNTRT_RESPMAN_NM
			     , A.CNTRT_OPPNT_CD
			     , A.SIGN_PLNDMAN_ID
			     , A.SIGN_PLNDMAN_NM
			     , A.SIGN_PLNDMAN_JIKGUP_NM
			     , A.SIGN_PLND_DEPT_NM
			     , A.SEAL_MTHD
			     , A.CNTRT_CNCLSN_YN
			     , A.SIGNMAN_ID
			     , A.SIGNMAN_NM
			     , A.OPPNT_SIGNMAN_NM
			     , A.OPPNT_SIGNMAN_JIKGUP
			     , A.OPPNT_SIGNMAN_DEPT
			     , A.OPPNT_SIGNDAY
			     , A.CNTRT_CNCLSNDAY
			     , A.CPY_REGDAY
			     , A.CNTRT_NO
			     , A.LOAC
			     , A.DSPT_RESOLT_MTHD
			     , A.DSPT_RESOLT_MTHD_DET
			     , A.ORG_ACPT_DLAY_CAUSE
			     , A.ORG_ACPTDAY
			     , A.ORG_TKOVMAN_ID
			     , A.ORG_TKOVMAN_NM
				 , A.ORG_HDOVMAN_ID
				 , A.ORG_HDOVMAN_NM
				 , A.ORG_STRG_POS
				 , A.PRCS_DEPTH
				 , A.DEPTH_STATUS
				 , A.CNTRT_STATUS
				 , A.REG_DT
				 , A.REG_ID
				 , A.REG_NM
				 , A.MOD_DT
				 , A.MOD_ID
				 , A.MOD_NM
				 , A.DEL_YN
				 , A.DEL_DT
				 , A.DEL_ID
				 , A.DEL_NM
				 , A.LOAC_ETC
				 , A.CNTRT_CHGE_DEMNDDAY
				 , A.CNTRT_CHGE_DEMNDMAN_ID
				 , A.CNTRT_CHGE_DEMNDMAN_NM
				 , A.CNTRT_CHGE_DEMND_CAUSE
				/*  , TO_CHAR(TO_DATE(A.CNTRT_CHGE_PLNDDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNTRT_CHGE_PLNDDAY */
				 , CONVERT(DATE,A.CNTRT_CHGE_PLNDDAY,120) AS CNTRT_CHGE_PLNDDAY 
				 , A.CNTRT_CHGE_CONF_YN
				 /* , TO_CHAR(TO_DATE(A.CNTRT_CHGE_CONFDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNTRT_CHGE_CONFDAY */
				 , CONVERT(DATE,A.CNTRT_CHGE_CONFDAY,120) AS CNTRT_CHGE_CONFDAY
				 , A.CNTRT_CHGE_CONFMAN_ID
			     , A.CNTRT_CHGE_CONFMAN_NM
				 , A.BFHDCSTN_MTNMAN_ID
				 , A.BFHDCSTN_MTNMAN_NM
				 , A.BFHDCSTN_MTNMAN_JIKGUP_NM
				 , A.BFHDCSTN_MTN_DEPT_NM
				 , A.BFHDCSTN_MTNMAN_EMAIL
				 , A.BFHDCSTN_APBT_MTHD
				 , A.BFHDCSTN_APBTMAN_ID
				 , A.BFHDCSTN_APBTMAN_NM
				 , A.BFHDCSTN_APBTMAN_JIKGUP_NM
				 , A.BFHDCSTN_APBT_DEPT_NM
				 , A.BFHDCSTN_APBTDAY
				 , A.SEAL_RQSTDAY
				 , A.SEAL_RQSTMAN_ID
				 , A.SEAL_RQSTMAN_NM
				 , A.SEAL_FFMTMAN_ID
				 , A.SEAL_FFMTMAN_NM
				 , A.SEAL_FFMTDAY
				 , A.REG_OPERDIV
				 , A.ETC_MAIN_CONT
				 , A.IF_SYS_CD
				 , C.AGREE_SEQNO
				 , C.AGREEMAN_ID
				 , C.AGREEMAN_NM
				 , C.AGREEMAN_JIKGUP_NM
				 , C.AGREEMAN_DEPT_NM
				 /* , TO_CHAR(TO_DATE(C.AGREEDAY, 'yyyyMMdd'), 'YYYY-MM-DD') AS AGREEDAY */            
				 , CONVERT(DATE,C.AGREEDAY,120) AS AGREEDAY 
         		 , CASE WHEN :vo.session_user_locale = 'ko' THEN
         		 		CASE C.AGREE_YN WHEN 'Y' THEN '합의'
         		                   WHEN 'N' THEN '미합의'
         		                            ELSE ''
         		    	END
         		   WHEN :vo.session_user_locale = 'fr' THEN
         		 		CASE C.AGREE_YN WHEN 'Y' THEN 'Accord'
         		                   WHEN 'N' THEN 'L‘opération a échoué'
         		                            ELSE ''
         		    	END
         		   WHEN :vo.session_user_locale = 'de' THEN
         		 		CASE C.AGREE_YN WHEN 'Y' THEN 'Vereinbarung'
         		                   WHEN 'N' THEN 'Fehlgeschlagen'
         		                            ELSE ''
         		    	END
         		   ELSE
         		   		CASE C.AGREE_YN WHEN 'Y' THEN 'Agreement'
         		                   WHEN 'N' THEN 'Failed'
         		                            ELSE ''
         		    	END	AS AGREE_YN			  
         		 , C.AGREE_CAUSE
			  FROM TN_CLM_CONTRACT_MASTER A 
			    LEFT OUTER JOIN (
			        SELECT *
			          FROM TN_CLM_CNCLSN_AGREE
			         WHERE CNTRT_ID = :vo.cntrt_id
			           AND AGREE_SEQNO = (
			                              SELECT MAX(AGREE_SEQNO)
			                                FROM TN_CLM_CNCLSN_AGREE
			                               WHERE CNTRT_ID = :vo.cntrt_id
			                                 AND DEL_YN = 'N'
			                             )
			           AND DEL_YN = 'N'     
			       )  C ON A.CNTRT_ID = C.CNTRT_ID 
		     WHERE 1=1 
			   AND A.CNTRT_ID = :vo.cntrt_id
			]]>
			</statement>
		</query>
		
    	<!-- 이행정보 목록 -->
    	<!-- 
    		계약관리_계약_마스터(TN_CLM_CONTRACT_MASTER) : 진행상태(DEPTH_STATUS) - 정보성 정보
   		    	일정확인 : 계약관리_이행정보(TN_CLM_CONT_EXECINFO) 에서 이행예정일이 현재일보다 작거나 같은 이행 Row중에서 이행상태가 완료(C03104)가 아닌 것이 존재할 경우
   		    	진행중      : 계약관리_이행정보(TN_CLM_CONT_EXECINFO) 에서 이행예정일이 현재일보다 작거나 같은 이행 Row가 모두 이행상태가 완료(C03104)일 경우
   		    	완료           : 계약관리_이행정보(TN_CLM_CONT_EXECINFO) 에서 모든 이행 Row의 이행상태가 완료(C03104)일 경우
    	 -->
		<query id="clm.manage.listExecution" isCamelCase="false">
  			<statement>
		    <![CDATA[
				SELECT *
		          FROM ( 
		          		 SELECT	ROW_NUMBER() OVER(ORDER BY t.EXEC_SEQNO ASC) RN
		          		      , t.*
		          		      , COUNT(1) over() TOTAL_CNT
		          		      , ROW_NUMBER() OVER (PARTITION BY t.EXEC_GBN ORDER BY  t.EXEC_SEQNO ASC) RNO
						   FROM	(
									SELECT	  /* DECODE(X.EXEC_UP_NO, '0', X.EXEC_SEQNO, X.EXEC_UP_NO) AS T_NO */
									         CASE X.EXEC_UP_NO
									           WHEN '0' THEN X.EXEC_SEQNO
									         ELSE
									           X.EXEC_UP_NO
									         END AS T_NO
										    ,X.CNTRT_ID
											,X.EXEC_SEQNO
											,X.EXEC_ITM
											/* ,TO_CHAR(TO_DATE(X.EXEC_PLNDDAY, 'YYYYMMDD'),'YYYY-MM-DD') EXEC_PLNDDAY */
											,CONVERT(VARCHAR, CONVERT(DATE, X.EXEC_PLNDDAY), 23) AS EXEC_PLNDDAY
											/* ,TRIM(TO_CHAR(X.EXEC_AMT, '999,999,999,999,999')) EXEC_AMT */
											,RTRIM(REPLACE(CONVERT(VARCHAR,CONVERT(MONEY,ISNULL(X.EXEC_AMT,'0')),1),'.00','')) AS EXEC_AMT											
											/* ,TRIM(TO_CHAR(X.EXEC_AMT, '999999999999999')) EXEC_AMT2 */
											,RTRIM(LTRIM(CONVERT(VARCHAR, X.EXEC_AMT))) AS EXEC_AMT2
											,X.EXEC_CONT
											/* ,TO_CHAR(TO_DATE(X.EXEC_CMPLTDAY, 'YYYYMMDD'),'YYYY-MM-DD') EXEC_CMPLTDAY */
											,CONVERT(VARCHAR, CONVERT(DATE, CASE X.EXEC_CMPLTDAY WHEN '' THEN X.EXEC_PLNDDAY ELSE X.EXEC_PLNDDAY END), 23) AS EXEC_CMPLTDAY
											,X.NOTE
											,X.EXEC_GBN
											,(SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
											              WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
											              WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
											              ELSE CD_NM_ENG
											      	END CD_NM 
											    FROM TB_COM_CD 
											   WHERE SYS_CD = :vo.sys_cd 
											     AND GRP_CD = 'C055' 
											     AND CD = X.EXEC_GBN) AS EXEC_GBN_NM
											,X.EXEC_STATUS
											,(SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN A.CD_NM
											              WHEN :vo.session_user_locale = 'fr' THEN A.CD_NM_FRA
											              WHEN :vo.session_user_locale = 'de' THEN A.CD_NM_DEU
											              ELSE A.CD_NM_ENG
											      	END CD_NM 
					                            FROM TB_COM_CD A 
					                           WHERE A.SYS_CD = :vo.sys_cd 
					                             AND A.GRP_CD = 'C031' 
					                             AND A.CD = X.EXEC_STATUS) AS EXEC_STATUSNM
											/* ,TO_CHAR(X.REG_DT, 'YYYY-MM-DD') AS REG_DT */
											,CONVERT(VARCHAR, X.REG_DT, 23) AS REG_DT
											,X.REG_ID
											,X.REG_NM
											/* ,TO_CHAR(X.MOD_DT, 'YYYY-MM-DD') AS MOD_DT */
											,CONVERT(VARCHAR, X.MOD_DT, 23) AS MOD_DT
											,X.MOD_ID
											,X.MOD_NM
											,X.DEL_YN
											,X.DEL_DT
											,X.DEL_ID
											,X.DEL_NM
											,X.EXEC_UP_NO
											,X.EXEC_SRT
											,A.PAYMENT_GBN
									  FROM	TN_CLM_CONTRACT_MASTER A
									  LEFT OUTER JOIN (SELECT * 
									                     FROM TN_CLM_CONT_EXECINFO
									                   WHERE DEL_YN = 'N' ) X ON A.CNTRT_ID = X.CNTRT_ID 
									 WHERE	A.CNTRT_ID = :vo.cntrt_id 
									   AND  A.DEL_YN = 'N'									   
								  --ORDER BY	X.EXEC_PLNDDAY
								  
								          
								) t
						) Y
						
						ORDER BY /* DECODE(Y.EXEC_UP_NO,  '0', Y.EXEC_SEQNO, Y.EXEC_UP_NO) */
								           CASE Y.EXEC_UP_NO
								            WHEN '0' THEN Y.EXEC_SEQNO
								          ELSE
								            Y.EXEC_UP_NO
								          END
								  , Y.EXEC_SRT
		    ]]>
			</statement>
		</query>
		
		
		<!-- 이행정보등록 -->
		<query id="clm.manage.insertExecution" isCamelCase="false">
			<statement>
			<![CDATA[
				INSERT INTO TN_CLM_CONT_EXECINFO  
							(
					         CNTRT_ID
							,EXEC_SEQNO
							,EXEC_CONT
							,EXEC_PLNDDAY
							,EXEC_STATUS
							,EXEC_GBN
							,EXEC_ITM
							,EXEC_AMT
							,EXEC_CMPLTDAY
							,NOTE
							,REG_DT
							,REG_ID
							,REG_NM
							,DEL_YN
					        ) VALUES (
					           :vo.cntrt_id
					          ,( SELECT	ISNULL(MAX(EXEC_SEQNO)+1,1) FROM TN_CLM_CONT_EXECINFO )
					          ,:vo.exec_cont
					          ,:vo.exec_plndday
					          ,:vo.exec_status
					          ,:vo.exec_gbn
					          ,:vo.exec_itm
					          ,:vo.exec_amt
					          ,:vo.exec_cmpltday
					          ,:vo.note
					          ,GETDATE()
					          ,:vo.session_user_id
					          ,:vo.session_user_nm
					          ,'N'
					        )
			]]>
			</statement>
		</query>
		
	<!--  이행정보등록
		<query id="clm.manage.insertExecution" isCamelCase="false"  주석 입니다.>
			<statement>
			<![CDATA[
				INSERT INTO TN_CLM_CONT_EXECINFO  
							(
					         CNTRT_ID
							,EXEC_SEQNO
							,EXEC_CONT
							,EXEC_PLNDDAY
							,EXEC_STATUS
							,EXEC_GBN
							,EXEC_ITM
							,EXEC_AMT
							,EXEC_CMPLTDAY
							,NOTE
							,REG_DT
							,REG_ID
							,REG_NM
							,DEL_YN
					        ) VALUES (
					           :vo.cntrt_id
					          ,( SELECT	ISNULL(MAX(EXEC_SEQNO)+1,1) FROM TN_CLM_CONT_EXECINFO )
					          ,:vo.exec_cont
					          ,:vo.exec_plndday
					          ,:vo.exec_status
					          ,:vo.exec_gbn
					          ,:vo.exec_itm
					          ,:vo.exec_amt
					          ,:vo.exec_cmpltday
					          ,:vo.note
					          ,SYSDATE
					          ,:vo.session_user_id
					          ,:vo.session_user_nm
					          ,'N'
					        )
			]]>
			</statement>
		</query>
		 -->
<!-- 		이행정보 저장 시 상태코드 변경 
		<query id="clm.manage.modifyMstStatus" isCamelCase="false">
			<statement>
			<![CDATA[
				UPDATE	TN_CLM_CONTRACT_MASTER
					   SET	CNTRT_STATUS   = 'C02402'
					   		, PRCS_DEPTH   = 'C02504'
					   		, DEPTH_STATUS = 'C02662'
							, MOD_DT  = SYSDATE
							, MOD_ID  = :vo.session_user_id
							, MOD_NM  = :vo.session_user_nm
					WHERE	CNTRT_ID	= :vo.cntrt_id
					  AND	DEL_YN		= 'N'
			]]>
			</statement>
		</query>
		이행정보 저장 시 상태코드 변경
		<query id="clm.manage.modifyCnsdreqStatus" isCamelCase="false">
			<statement>
			<![CDATA[
				UPDATE	TN_CLM_CONT_CNSDREQ
					   SET	PRGRS_STATUS   = 'C04219'
							, MOD_DT  = SYSDATE
							, MOD_ID  = :vo.session_user_id
							, MOD_NM  = :vo.session_user_nm
					WHERE	CNSDREQ_ID	= :vo.cnsdreq_id
					  AND	DEL_YN		= 'N'
			]]>
			</statement>
		</query> -->

		<!-- 이행정보수정 -->
		<query id="clm.manage.modifyExecution" isCamelCase="false">
			<statement>
			<![CDATA[
				UPDATE	TN_CLM_CONT_EXECINFO
					   SET	EXEC_STATUS	   = :vo.exec_status
					   		,EXEC_CONT     = :vo.exec_cont
							,EXEC_PLNDDAY  = :vo.exec_plndday
							,EXEC_GBN      = :vo.exec_gbn
							,EXEC_ITM      = :vo.exec_itm
							,EXEC_AMT      = :vo.exec_amt
							,EXEC_CMPLTDAY = :vo.exec_cmpltday
							,NOTE          = :vo.note
							,MOD_DT        = GETDATE()
							,MOD_ID        = :vo.session_user_id
							,MOD_NM        = :vo.session_user_nm
					WHERE	CNTRT_ID	   = :vo.cntrt_id
					  AND	EXEC_SEQNO	   = :vo.exec_seqno
					  AND	DEL_YN		   = 'N'
			]]>
			</statement>
		</query>
		<!-- 이행정보상태정보수정 -->
		<query id="clm.manage.modifyExecutionStatus" isCamelCase="false">
			<statement>
			<![CDATA[
				UPDATE	TN_CLM_CONT_EXECINFO
					   SET	EXEC_STATUS	= :vo.exec_status	
					   	#if ($vo.getExec_plndday().equals('Y'))			        	 
			         	#else				      
			            	,EXEC_PLNDDAY= :vo.exec_plndday	
				        #end					       	      
					        ,EXEC_AMT = :vo.exec_amt
					        ,EXEC_CONT = :vo.exec_cont
					        ,EXEC_CMPLTDAY = :vo.exec_cmpltday
					        ,NOTE = :vo.note
							,MOD_DT  = GETDATE()
							,MOD_ID  = :vo.session_user_id
							,MOD_NM  = :vo.session_user_nm
					WHERE	CNTRT_ID	= :vo.cntrt_id
					  AND	EXEC_SEQNO	= :vo.exec_seqno
					  AND	DEL_YN		= 'N'
			]]>
			</statement>
		</query>
		
				<!-- 이행정보상태정보수정 -->
		<query id="clm.manage.maxExecSeqno" isCamelCase="false">
			<statement>
			<![CDATA[
					SELECT /* TO_CHAR(MAX(EXEC_SEQNO)) AS MAX_EXEC_NUM */
					       CONVERT(VARCHAR, MAX(EXEC_SEQNO)) AS MAX_EXEC_NUM
					  FROM TN_CLM_CONT_EXECINFO 
					 WHERE CNTRT_ID	= :vo.cntrt_id

			]]>
			</statement>
		</query>
		
		
				<!-- 이행정보상태정보수정 -->
		<query id="clm.manage.addExecution" isCamelCase="false">
			<statement>
			<![CDATA[
				INSERT
				  INTO TN_CLM_CONT_EXECINFO ( CNTRT_ID , EXEC_SEQNO , EXEC_CONT , EXEC_PLNDDAY , EXEC_STATUS , EXEC_GBN , EXEC_ITM , EXEC_AMT , EXEC_CMPLTDAY , NOTE , REG_DT , REG_ID , REG_NM , DEL_YN , EXEC_UP_NO , EXEC_SRT )
				  		SELECT 
				  			   CNTRT_ID ,
						       (SELECT MAX(EXEC_SEQNO)+1 FROM TN_CLM_CONT_EXECINFO WHERE CNTRT_ID = :vo.cntrt_id),
						       EXEC_CONT ,
						       EXEC_PLNDDAY ,
						       :vo.exec_status ,
						       EXEC_GBN ,
						       CASE 
						         WHEN :vo.session_user_locale = 'ko' THEN 
						         	'변경) ' + REPLACE(EXEC_ITM, '변경) ','')
						         WHEN :vo.session_user_locale = 'fr' THEN 
						         	'Modifier) ' + REPLACE(EXEC_ITM, 'Modifier) ','')
						         WHEN :vo.session_user_locale = 'de' THEN 
						         	'Ändern) ' + REPLACE(EXEC_ITM, 'Ändern) ','')
						       ELSE 
						       		'Change) ' + REPLACE(EXEC_ITM, 'Change) ','')
						       END
						       ,
						       EXEC_AMT ,
						       '',
						       ' ' ,
					           GETDATE(),
					           :vo.session_user_id,
					           :vo.session_user_nm,
						       'N',
						       /* DECODE(EXEC_UP_NO, '0', :vo.exec_seqno, EXEC_UP_NO), */
						       CASE EXEC_UP_NO
						         WHEN '0' THEN :vo.exec_seqno
						       ELSE
						         EXEC_UP_NO
						       END,
						       -- (SELECT ISNULL(MAX(EXEC_SRT)+1,1) FROM TN_CLM_CONT_EXECINFO WHERE EXEC_UP_NO = :vo.exec_seqno)
						       (SELECT ISNULL(MAX(EXEC_SRT)+1,1) 
						          FROM TN_CLM_CONT_EXECINFO 
						         WHERE EXEC_UP_NO = /* DECODE(EXEC_UP_NO, '0', :vo.exec_seqno, EXEC_UP_NO)) */
						                            CASE EXEC_UP_NO
						                              WHEN '0' THEN :vo.exec_seqno
						                            ELSE
						                              EXEC_UP_NO
						                            END )
						  FROM TN_CLM_CONT_EXECINFO
						 WHERE EXEC_SEQNO = :vo.exec_seqno
						 	   AND CNTRT_ID = :vo.cntrt_id 
						 GROUP BY CNTRT_ID ,
						       EXEC_CONT ,
						       EXEC_PLNDDAY ,
						       EXEC_STATUS ,
						       EXEC_GBN ,
						       EXEC_ITM ,
						       EXEC_AMT ,
						       EXEC_UP_NO,
						       EXEC_CMPLTDAY ,
						       NOTE
			]]>
			</statement>
		</query>
		

		<!-- 이행정보삭제 -->
		<query id="clm.manage.deleteExecution" isCamelCase="false">
			<statement>
			<![CDATA[
				UPDATE	TN_CLM_CONT_EXECINFO
				   SET   DEL_YN  = 'Y'
				        ,DEL_DT  = GETDATE()
				        ,DEL_ID  = :vo.session_user_id
				        ,DEL_NM  = :vo.session_user_nm
				 WHERE	CNTRT_ID	= :vo.cntrt_id
				   AND	EXEC_SEQNO	= :vo.exec_seqno
				   AND	DEL_YN		= 'N'
			]]>
			</statement>
		</query>
		
		<!-- 검토이력 정보 -->
		<query id="clm.manage.listContractReview" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT  CNSDREQ_ID, nm
				        , CR_FLAN_NM
				        , CR_FLAG, TITLE
				        , MAN_ID, MAN_NM
				        , DEPT
				        , DEPT_NM
				        , JIKGUP_NM
				        , CONVERT(CHAR(10), REG_DT, 23) AS REG_DT /*YYYY-MM-DD*/
				        , ISNULL(CONT,' ') CONT
				        , ISNULL(APBT_CONT, ' ') APBT_CONT
				        , ISNULL(CHGE_CONT, '') CHGE_CONT
				        , CNSD_DEPT
				        , RM
				        , PLNDBN_REQ_YN
				        , LASTBN_CHGE_YN_NM
				        , PLNDBN_CHGE_CONT
				  FROM  (
				          SELECT * FROM (
				          SELECT  CNSD_LEVEL RM
				          		  , A.CNSDREQ_ID
				                  , CASE WHEN :vo.session_user_locale = 'ko' THEN
				                  		'[' + CAST(CNSD_LEVEL AS NVARCHAR) + '차 의뢰' + DBO.DECODE3(PLNDBN_REQ_YN, 'Y', '-최종본]', ']')
				                  	ELSE
				                  		CASE WHEN CNSD_LEVEL = '1' THEN '[' + CAST(CNSD_LEVEL AS NVARCHAR) + 'st Request' + DBO.DECODE3(PLNDBN_REQ_YN, 'Y', '-Fianl Version]', ']') 
				                  		 	  WHEN CNSD_LEVEL = '2' THEN '[' + CAST(CNSD_LEVEL AS NVARCHAR) + 'nd Request' + DBO.DECODE3(PLNDBN_REQ_YN, 'Y', '-Fianl Version]', ']')
				                  		 	  WHEN CNSD_LEVEL = '3' THEN '[' + CAST(CNSD_LEVEL AS NVARCHAR) + 'rd Request' + DBO.DECODE3(PLNDBN_REQ_YN, 'Y', '-Fianl Version]', ']')
				                  		 	  ELSE '[' + CAST(CNSD_LEVEL AS NVARCHAR) + 'th Request' + DBO.DECODE3(PLNDBN_REQ_YN, 'Y', '-Fianl Version]', ']')
				                  		 END
				                  	END AS CR_FLAN_NM
				                  , 'CONSULT' CR_FLAG
				                  , REQ_TITLE TITLE
				                  , REQMAN_ID MAN_ID
				                  , REQMAN_NM MAN_NM
				                  , REQ_DEPT DEPT
				                  , REQ_DEPT_NM DEPT_NM
				                  , REQMAN_JIKGUP_NM JIKGUP_NM
				                  , ACPT_DT REG_DT
				                  , CNSD_DEMND_CONT CONT
				                  , '' APBT_CONT
				                  , PLNDBN_CHGE_CONT CHGE_CONT
				                  , '' CNSD_DEPT
				                  , PLNDBN_REQ_YN
				            	  , (CASE WHEN LASTBN_CHGE_YN = 'Y' THEN 'YES' ELSE 'NO' END) AS LASTBN_CHGE_YN_NM
				            	  , PLNDBN_CHGE_CONT
				            	  , REQMAN_NM+'/'+REQMAN_JIKGUP_NM+'/'+REQ_DEPT_NM as nm
				            FROM  TN_CLM_CONT_CNSDREQ A,
				            	(SELECT CNSDREQ_ID FROM DBO.[COM.GET_LINK_CNSDREQ_ID]( :vo.cnsdreq_id )) B
				          WHERE A.PRGRS_STATUS IN ( SELECT CD 
				                                      FROM TB_COM_CD 
				                                     WHERE SYS_CD = 'LAS' 
				                                       AND GRP_CD = 'C042' )
				            AND A.DEL_YN = 'N'
				            AND A.CNSDREQ_ID = B.CNSDREQ_ID
				) TA
				UNION ALL (
				          SELECT  C.CNSD_LEVEL RM
				          		  , C.CNSDREQ_ID
								  , CASE WHEN :vo.session_user_locale = 'ko' THEN 
								  		'[' + CAST(C.CNSD_LEVEL AS NVARCHAR) + '차 회신' + DBO.DECODE3(PLNDBN_REQ_YN, 'Y', '-최종본]', ']')
								  	ELSE
								  		CASE WHEN C.CNSD_LEVEL = '1' THEN '[' + CAST(C.CNSD_LEVEL AS NVARCHAR) + 'st Reply' + DBO.DECODE3(PLNDBN_REQ_YN, 'Y', '-Final Version]', ']') 
								  			 WHEN C.CNSD_LEVEL = '2' THEN '[' + CAST(C.CNSD_LEVEL AS NVARCHAR) + 'nd Reply' + DBO.DECODE3(PLNDBN_REQ_YN, 'Y', '-Final Version]', ']')
								  			 WHEN C.CNSD_LEVEL = '3' THEN '[' + CAST(C.CNSD_LEVEL AS NVARCHAR) + 'rd Reply' + DBO.DECODE3(PLNDBN_REQ_YN, 'Y', '-Final Version]', ']')
								  			 ELSE '[' + CAST(C.CNSD_LEVEL AS NVARCHAR) + 'th Reply' + DBO.DECODE3(PLNDBN_REQ_YN, 'Y', '-Final Version]', ']')
								  		END
								  	END AS CR_FLAN_NM
				                  , 'REPLY' CR_FLAG
				                  , B.CNTRT_NM
				                  , CASE WHEN A.CNSDMAN_ID IS NULL THEN A.APBTMAN_ID ELSE A.CNSDMAN_ID END MAN_ID
				                  , CASE WHEN A.CNSDMAN_ID IS NULL THEN A.APBTMAN_NM ELSE A.CNSDMAN_NM END MAN_NM
				                  , C.MN_CNSD_DEPT DEPT
							      , D.CD_ABBR_NM
				                  , E.JIKGUP_NM JIKGUP_NM
				                  , ISNULL(A.APBT_DT, A.CNSD_DT) REG_DT
				                  , A.CNSD_OPNN CONT
				                  ,	A.APBT_OPNN APBT_CONT
				                  , '' CHGE_CONT
				                  , C.MN_CNSD_DEPT CNSD_DEPT
				                  , C.PLNDBN_REQ_YN
				            	  , '' AS LASTBN_CHGE_YN_NM
				            	  , '' AS PLNDBN_CHGE_CONT
				            	  , DBO.DECODE3(E.comp_cd,'C10',E.user_nm, (CASE WHEN A.CNSDMAN_ID IS NULL THEN A.APBTMAN_NM ELSE A.CNSDMAN_NM END)+'/'+ E.JIKGUP_NM+'/'+ D.CD_ABBR_NM )as nm
				            FROM  TN_CLM_CONTRACT_CNSD A JOIN
				            TN_CLM_CONTRACT_MASTER B ON A.CNTRT_ID = B.CNTRT_ID
				            JOIN
				            TN_CLM_CONT_CNSDREQ C ON A.CNSDREQ_ID = C.CNSDREQ_ID
				            JOIN
				            TB_COM_CD D ON C.COMP_CD = D.CD
				            LEFT OUTER JOIN
				            TB_COM_USER E ON USER_ID = (CASE WHEN A.CNSDMAN_ID IS NULL THEN A.APBTMAN_ID ELSE A.CNSDMAN_ID END) 
				          WHERE A.CNTRT_ID = :vo.cntrt_id
				            AND  A.CNSD_STATUS = 'C04305'
				            AND  D.SYS_CD ='LAS'
		                    AND  D.grp_cd = 'COMP2' 
				        )) TB
			  ORDER BY  RM, CR_FLAG
			]]>
			</statement>
		</query>
		
		<!-- 승인이력 정보 -->
		<!-- Joon 2015-1-7, 2015-2-4 -->
		<query id="clm.manage.listContractApprove" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT  C.MIS_ID, A.CNSDREQ_ID,
						M.CNTRT_ID
			            , B.TITLE
			            , 'en' ACTIVITY_NM
			            , C.USER_NAME			            
						, 
						CASE 
							WHEN C.APPROVED IS NULL THEN ''
							WHEN C.APPROVED = '' THEN ''
							WHEN ISDATE(C.APPROVED) = 1 THEN C.APPROVED
						ELSE 
							CONVERT(VARCHAR(10), (CONVERT(DATE, SUBSTRING(C.APPROVED, 1, 8), 120)))	
						END AS APPROVED			            
			            , C.DEPT_NAME
			            , C.DUTY
			            , C.GROUP_NAME
						,(
							SELECT MAX(A.CREATE_DATE) FROM (
									SELECT								
											CASE
												WHEN C.APPROVED IS NULL THEN ''
												WHEN C.APPROVED = '' THEN ''
												WHEN ISDATE(C.APPROVED) = 1 THEN APPROVED
												WHEN ISDATE(C.APPROVED) = 0 THEN CONVERT(VARCHAR(10), (CONVERT(DATE, SUBSTRING(APPROVED, 1, 8), 120)))		
											ELSE
												''
											END
											AS CREATE_DATE
									FROM TB_COM_ROUTE_WSVO
									WHERE MIS_ID = B.MIS_ID
									AND MODULE_ID = B.MODULE_ID
									AND ACTIVITY >= 0
									AND ARRIVED != ''
							) A
						) AS CREATE_DATE
			            , CONVERT(INT, C.SEQUENCE) SEQUENCE
						, C.ACTIVITY
						, CASE 
						    WHEN :vo.session_user_locale = 'fr' THEN D.CD_NM_FRA
						    WHEN :vo.session_user_locale = 'de' THEN D.CD_NM_DEU
						  ELSE D.CD_NM_ENG
						  END AS CD_NM
						, D.CD
			            /*, LEAD(A.CNTRT_ID) OVER(ORDER BY A.CNTRT_ID) LEAD_CNTRT_ID
			            , LAG(A.CNTRT_ID) OVER(ORDER BY A.CNTRT_ID) LAG_CNTRT_ID*/
			            , CAST(COUNT(B.MIS_ID) OVER(PARTITION BY B.MIS_ID) AS NUMERIC) CNTRT_ID_CNT
			            , ((COUNT(B.MIS_ID) OVER(PARTITION BY B.MIS_ID)) + 1)*2 CNTRT_ID_CNT_NUM
			            , B.MIS_ID
			            , CAST( (SELECT COUNT(*) 
			                       FROM TB_COM_ATTACHMENT_WSVO 
			                      WHERE MIS_ID = B.MIS_ID 
			                        AND MODULE_ID = B.MODULE_ID) AS NUMERIC) AS FILE_CNT
						,CASE 
							WHEN :vo.session_user_locale = 'fr' THEN 
								CASE B.STATUS
								    WHEN '1' THEN 'Approbation en cours de traitement'
								    WHEN '2' THEN 'Complété'
								    WHEN '3' THEN 'Refuser'
								    WHEN '4' THEN 'Annuler'
								    WHEN '5' THEN 'Prise de décision'
								    WHEN '6' THEN 'Approuvé à l‘issue de la finalisation'
								ELSE ' ' 
								END
							WHEN :vo.session_user_locale = 'de' THEN 
								CASE B.STATUS
								    WHEN '1' THEN 'Genehmigung in Bearbeitung'
								    WHEN '2' THEN 'Abgeschlossen'
								    WHEN '3' THEN 'Ablehnen'
								    WHEN '4' THEN 'Abbrechen'
								    WHEN '5' THEN 'Entscheidungsfindung'
								    WHEN '6' THEN 'Genehmigt nach Abschluss'
								ELSE ' ' 
								END
							ELSE
								CASE B.STATUS
									WHEN '1' THEN 'Approval in Process'
								    WHEN '2' THEN 'Completed'
								    WHEN '3' THEN 'Reject'
								    WHEN '4' THEN 'Cancel'
								    WHEN '5' THEN 'Decide Arbitrarily'
								    WHEN '6' THEN 'Approved after Completion'
								ELSE ' '
								END
							END STATUS
			            ,CASE 
							WHEN C.APPROVED <> '' AND C.ACTIVITY = 0 THEN 'Draft'		/* 결재내역 중 ACTIVITY가 0인경우 DRAFT*/
							WHEN C.APPROVED <> '' AND C.ACTIVITY > 0 AND C.ARRIVED <> '' THEN /* 결재내역 중 Draft 가 아니면서 결재 날짜가 찍힌경우 해당 시점 완료 내역 표기 */
								CASE B.STATUS 
									WHEN '1' THEN  'Approved'
									WHEN '2' THEN  'Approved' 
									WHEN '3' THEN  'Rejected'
								END 
							WHEN C.APPROVED = '' AND C.ACTIVITY > 0 THEN /* mySingle로 부터 결재여부가 없는경우 상태조회 */ 
								CASE 
								WHEN :vo.session_user_locale = 'fr' THEN 
									CASE B.STATUS
									    WHEN '1' THEN 'Approbation en cours de traitement'
									    WHEN '2' THEN 'Complété'
									    WHEN '3' THEN 'Refuser'
									    WHEN '4' THEN 'Annuler'
									    WHEN '5' THEN 'Prise de décision'
									    WHEN '6' THEN 'Approuvé à l‘issue de la finalisation'
									ELSE ' ' 
									END
								WHEN :vo.session_user_locale = 'de' THEN 
									CASE B.STATUS
									    WHEN '1' THEN 'Genehmigung in Bearbeitung'
									    WHEN '2' THEN 'Abgeschlossen'
									    WHEN '3' THEN 'Ablehnen'
									    WHEN '4' THEN 'Abbrechen'
									    WHEN '5' THEN 'Entscheidungsfindung'
									    WHEN '6' THEN 'Genehmigt nach Abschluss'
									ELSE ' ' 
									END
								ELSE
									CASE B.STATUS
										WHEN '1' THEN 'Approval in Process'
									    WHEN '2' THEN 'Completed'
									    WHEN '3' THEN 'Reject'
									    WHEN '4' THEN 'Cancel'
									    WHEN '5' THEN 'Decide Arbitrarily'
									    WHEN '6' THEN 'Approved after Completion'
									ELSE ' '
									END
								END
							ELSE '' 
							END AS PRG_STATUS
						, B.APPRVL_CLSFCN
						, C.OPINION
				FROM TN_CLM_CONTRACT_MASTER M
				INNER JOIN TN_CLM_CONTRACT_CNSD A	/* Sungwoo added for searching to other request history */
					ON A.CNTRT_ID = M.CNTRT_ID
				INNER JOIN TB_COM_START_PROCESS_WSVO B
					ON B.REF_KEY = A.CNSDREQ_ID
				INNER JOIN TB_COM_ROUTE_WSVO C
					ON C.MIS_ID = B.MIS_ID
					AND C.MODULE_ID = B.MODULE_ID
				INNER JOIN TB_COM_CD D
					ON D.CD=C.ACTIVITY
			     WHERE  M.CNTRT_ID = :vo.cntrt_id
			       AND  B.APPRVL_CLSFCN IN ( SELECT CD 
			                                   FROM TB_COM_CD 
			                                  WHERE SYS_CD = 'LAS' 
			                                    AND GRP_CD = 'C030' )
			       AND  D.GRP_CD = 'SECFW_APPROVAL_ACTIVITY'
			       AND  D.SYS_CD = 'LAS'
			       AND  B.STATUS NOT IN ('0','E')
			       AND  B.APPRVL_CLSFCN IN ('C03002','C03003', 'C03004')
			       
			  
			  UNION 
			  
				SELECT  C.MIS_ID, '' CNSDREQ_ID,
						M.CNTRT_ID
			            , B.TITLE
			            , 'en' ACTIVITY_NM
			            , C.USER_NAME			            
						, 
						CASE 
							WHEN C.APPROVED IS NULL THEN ''
							WHEN C.APPROVED = '' THEN ''
							WHEN ISDATE(C.APPROVED) = 1 THEN C.APPROVED
						ELSE 
							CONVERT(VARCHAR(10), (CONVERT(DATE, SUBSTRING(C.APPROVED, 1, 8), 120)))	
						END AS APPROVED			            
			            , C.DEPT_NAME
			            , C.DUTY
			            , C.GROUP_NAME
						,(
							SELECT MAX(A.CREATE_DATE) FROM (
									SELECT								
											CASE
												WHEN C.APPROVED IS NULL THEN ''
												WHEN C.APPROVED = '' THEN ''
												WHEN ISDATE(C.APPROVED) = 1 THEN APPROVED
												WHEN ISDATE(C.APPROVED) = 0 THEN CONVERT(VARCHAR(10), (CONVERT(DATE, SUBSTRING(APPROVED, 1, 8), 120)))		
											ELSE
												''
											END
											AS CREATE_DATE
									FROM TB_COM_ROUTE_WSVO
									WHERE MIS_ID = B.MIS_ID
									AND MODULE_ID = B.MODULE_ID
									AND ACTIVITY >= 0
									AND ARRIVED != ''
							) A
						) AS CREATE_DATE
			            , CONVERT(INT, C.SEQUENCE) SEQUENCE
						, C.ACTIVITY
						, CASE 
						    WHEN :vo.session_user_locale = 'fr' THEN D.CD_NM_FRA
						    WHEN :vo.session_user_locale = 'de' THEN D.CD_NM_DEU
						  ELSE D.CD_NM_ENG
						  END AS CD_NM
						, D.CD
			            , CAST(COUNT(B.MIS_ID) OVER(PARTITION BY B.MIS_ID) AS NUMERIC) CNTRT_ID_CNT
			            , ((COUNT(B.MIS_ID) OVER(PARTITION BY B.MIS_ID)) + 1)*2 CNTRT_ID_CNT_NUM
			            , B.MIS_ID
			            , CAST( (SELECT COUNT(*) 
			                       FROM TB_COM_ATTACHMENT_WSVO 
			                      WHERE MIS_ID = B.MIS_ID 
			                        AND MODULE_ID = B.MODULE_ID) AS NUMERIC) AS FILE_CNT
						,CASE 
							WHEN :vo.session_user_locale = 'fr' THEN 
								CASE B.STATUS
								    WHEN '1' THEN 'Approbation en cours de traitement'
								    WHEN '2' THEN 'Complété'
								    WHEN '3' THEN 'Refuser'
								    WHEN '4' THEN 'Annuler'
								    WHEN '5' THEN 'Prise de décision'
								    WHEN '6' THEN 'Approuvé à l‘issue de la finalisation'
								ELSE ' ' 
								END
							WHEN :vo.session_user_locale = 'de' THEN 
								CASE B.STATUS
								    WHEN '1' THEN 'Genehmigung in Bearbeitung'
								    WHEN '2' THEN 'Abgeschlossen'
								    WHEN '3' THEN 'Ablehnen'
								    WHEN '4' THEN 'Abbrechen'
								    WHEN '5' THEN 'Entscheidungsfindung'
								    WHEN '6' THEN 'Genehmigt nach Abschluss'
								ELSE ' ' 
								END
							ELSE
								CASE B.STATUS
									WHEN '1' THEN 'Approval in Process'
								    WHEN '2' THEN 'Completed'
								    WHEN '3' THEN 'Reject'
								    WHEN '4' THEN 'Cancel'
								    WHEN '5' THEN 'Decide Arbitrarily'
								    WHEN '6' THEN 'Approved after Completion'
								ELSE ' '
								END
							END STATUS
			            ,CASE 
							WHEN C.APPROVED <> '' AND C.ACTIVITY = 0 THEN 'Draft'		/* 결재내역 중 ACTIVITY가 0인경우 DRAFT*/
							WHEN C.APPROVED <> '' AND C.ACTIVITY > 0 AND C.ARRIVED <> '' THEN /* 결재내역 중 Draft 가 아니면서 결재 날짜가 찍힌경우 해당 시점 완료 내역 표기 */
								CASE B.STATUS 
									WHEN '1' THEN  'Approved'
									WHEN '2' THEN  'Approved' 
									WHEN '3' THEN  'Rejected'
								END 
							WHEN C.APPROVED = '' AND C.ACTIVITY > 0 THEN /* mySingle로 부터 결재여부가 없는경우 상태조회 */ 
								CASE 
								WHEN :vo.session_user_locale = 'fr' THEN 
									CASE B.STATUS
									    WHEN '1' THEN 'Approbation en cours de traitement'
									    WHEN '2' THEN 'Complété'
									    WHEN '3' THEN 'Refuser'
									    WHEN '4' THEN 'Annuler'
									    WHEN '5' THEN 'Prise de décision'
									    WHEN '6' THEN 'Approuvé à l‘issue de la finalisation'
									ELSE ' ' 
									END
								WHEN :vo.session_user_locale = 'de' THEN 
									CASE B.STATUS
									    WHEN '1' THEN 'Genehmigung in Bearbeitung'
									    WHEN '2' THEN 'Abgeschlossen'
									    WHEN '3' THEN 'Ablehnen'
									    WHEN '4' THEN 'Abbrechen'
									    WHEN '5' THEN 'Entscheidungsfindung'
									    WHEN '6' THEN 'Genehmigt nach Abschluss'
									ELSE ' ' 
									END
								ELSE
									CASE B.STATUS
										WHEN '1' THEN 'Approval in Process'
									    WHEN '2' THEN 'Completed'
									    WHEN '3' THEN 'Reject'
									    WHEN '4' THEN 'Cancel'
									    WHEN '5' THEN 'Decide Arbitrarily'
									    WHEN '6' THEN 'Approved after Completion'
									ELSE ' '
									END
								END
							ELSE '' 
							END AS PRG_STATUS
						, B.APPRVL_CLSFCN
						, C.OPINION
				FROM TN_CLM_CONTRACT_MASTER M
				INNER JOIN TB_COM_START_PROCESS_WSVO B
					ON B.REF_KEY = M.CNTRT_ID
				INNER JOIN TB_COM_ROUTE_WSVO C
					ON C.MIS_ID = B.MIS_ID
					AND C.MODULE_ID = B.MODULE_ID
				INNER JOIN TB_COM_CD D
					ON D.CD=C.ACTIVITY
			     WHERE  M.CNTRT_ID = :vo.cntrt_id
			       AND  B.APPRVL_CLSFCN IN ( SELECT CD 
			                                   FROM TB_COM_CD 
			                                  WHERE SYS_CD = 'LAS' 
			                                    AND GRP_CD = 'C030' )
			       AND  D.GRP_CD = 'SECFW_APPROVAL_ACTIVITY'
			       AND  D.SYS_CD = 'LAS'
			       AND  B.STATUS NOT IN ('0','E')
			       AND  B.APPRVL_CLSFCN IN ('C03002','C03003', 'C03004')
			       
			  ORDER BY  C.MIS_ID, SEQUENCE ASC
			]]>
			</statement>
		</query>
		
		<!-- 체결이력 정보 -->
		<query id="clm.manage.listContractSign" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT  A.CNTRT_ID
				        ,A.CNTRT_NM
				        /*, DECODE(ISNULL(A.CNTRT_CNCLSN_YN,'N'),'N','No','Yes') CNTRT_CNCLSN_YN */
				        , CASE ISNULL(A.CNTRT_CNCLSN_YN, 'N')
	                        WHEN 'N' THEN 'NO'
	                      ELSE 'Yes'
	                      END AS CNTRT_CNCLSN_YN
				        /*, TO_CHAR(TO_DATE(A.CNTRT_CNCLSNDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') CNTRT_CNCLSNDAY */
				        , CONVERT(DATE, A.CNTRT_CNCLSNDAY, 120) AS CNTRT_CNCLSNDAY
				        , A.SIGN_PLNDMAN_ID, A.SIGN_PLNDMAN_NM, A.SIGN_PLND_DEPT_NM, A.SIGN_PLNDMAN_JIKGUP_NM
				        , A.SEAL_MTHD
				        , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
							           WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
							           WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
							           ELSE CD_NM_ENG
							     END CD_NM 
			          		FROM TB_COM_CD WHERE SYS_CD='LAS' AND GRP_CD='C021' AND CD=A.SEAL_MTHD) SEAL_MTHD_NM
				        /*, TO_CHAR(TO_DATE(A.SEAL_RQSTDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') SEAL_RQSTDAY */
				        , CONVERT(DATE, A.SEAL_RQSTDAY, 120) AS SEAL_RQSTDAY
				        , A.SEAL_RQSTMAN_ID
				        , A.SEAL_RQSTMAN_NM
				        , A.SEAL_RQST_DEPT_NM
				        , A.SEAL_RQSTMAN_JIKGUP_NM
				        /* , TO_CHAR(TO_DATE(A.SEAL_FFMTDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') SEAL_FFMTDAY */
				        , CONVERT(DATE, A.SEAL_FFMTDAY, 120) AS SEAL_FFMTDAY
				        , A.SEAL_FFMTMAN_ID
				        , A.SEAL_FFMTMAN_NM
				        , A.SEAL_FFMT_DEPT_NM
				        , A.SEAL_FFMTMAN_JIKGUP_NM
				        , A.SIGNMAN_ID, A.SIGNMAN_NM, A.SIGN_DEPT_NM, A.SIGNMAN_JIKGUP_NM
				        /* , TO_CHAR(TO_DATE(A.SIGNDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') SIGNDAY */
				        , CONVERT(DATE, A.SIGNDAY, 120) AS SIGNDAY
				        , A.OPPNT_SIGNMAN_NM
				        , A.OPPNT_SIGNMAN_JIKGUP
				        , A.OPPNT_SIGNMAN_DEPT
				        /* , TO_CHAR(TO_DATE(A.OPPNT_SIGNDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') OPPNT_SIGNDAY */
				        , CONVERT(DATE, A.OPPNT_SIGNDAY, 120) AS OPPNT_SIGNDAY
				        , A.CPY_REGMAN_ID
				        , A.CPY_REGMAN_NM
				        , A.CPY_REGMAN_JIKGUP_NM
				        , A.CPY_REG_DEPT_NM
				        /* , TO_CHAR(TO_DATE(A.CPY_REGDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') CPY_REGDAY */
				        , CONVERT(DATE, A.CPY_REGDAY, 120) AS CPY_REGDAY
				        , A.ORG_ACPT_DLAY_CAUSE
				        /* , TO_CHAR(TO_DATE(A.ORG_ACPTDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') ORG_ACPTDAY */
				        , CONVERT(DATE, A.ORG_ACPTDAY, 120) AS ORG_ACPTDAY
				        , A.ORG_TKOVMAN_ID
				        , A.ORG_TKOVMAN_NM
				        , A.ORG_TKOV_DEPT_NM
				        , A.ORG_TKOVMAN_JIKGUP_NM
				        , A.ORG_HDOVMAN_ID
				        , A.ORG_HDOVMAN_NM
				        , A.ORG_HDOV_DEPT_NM
				        , A.ORG_HDOVMAN_JIKGUP_NM
				        , A.ORG_STRG_POS
				        /*, TO_CHAR(TO_DATE(B.CHGEBFR_CNCLSN_PLNDDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') CHGEBFR_CNCLSN_PLNDDAY */
				        , CONVERT(DATE, B.CHGEBFR_CNCLSN_PLNDDAY, 120) AS CHGEBFR_CNCLSN_PLNDDAY
				        /*, TO_CHAR(TO_DATE(B.CHGEAFT_CNCLSN_PLNDDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') CHGEAFT_CNCLSN_PLNDDAY, B.DLAY_CAUSE*/
				        , CONVERT(DATE, B.CHGEAFT_CNCLSN_PLNDDAY, 120) AS CHGEAFT_CNCLSN_PLNDDAY
				  FROM  TN_CLM_CONTRACT_MASTER A, 
				        ( SELECT  CNTRT_ID, DLAY_SEQNO, CHGEBFR_CNCLSN_PLNDDAY, CHGEAFT_CNCLSN_PLNDDAY, DLAY_CAUSE
				            FROM  ( SELECT  TOP 1 
				                            CNTRT_ID,
				                            DLAY_SEQNO,
				                            CHGEBFR_CNCLSN_PLNDDAY,
				                            CHGEAFT_CNCLSN_PLNDDAY,
				                            DLAY_CAUSE
				                      FROM  TN_CLM_CONTRACT_CNCLSNDLAY 
				                     WHERE  CNTRT_ID = :vo.cntrt_id
				                       AND  DEL_YN = 'N'
				                  ORDER BY DLAY_SEQNO DESC
				                  ) X
				        ) B
				 WHERE  A.CNTRT_ID = B.CNTRT_ID
				  
			]]>
			</statement>
		</query>
		
		<!-- 사전검토이력 정보 -->
		<query id="clm.manage.listContractInfo" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT  A.CNTRT_ID
		        		, A.BFHDCSTN_MTNMAN_ID
						, A.BFHDCSTN_MTNMAN_NM
						, A.BFHDCSTN_MTNMAN_JIKGUP_NM
						, A.BFHDCSTN_MTN_DEPT_NM
						, A.BFHDCSTN_MTNMAN_EMAIL
						, (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
									   WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
									   WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
									   ELSE CD_NM_ENG END FROM TB_COM_CD WHERE CD = A.BFHDCSTN_APBT_MTHD) AS BFHDCSTN_APBT_MTHD_NM 
						, A.BFHDCSTN_APBTMAN_ID
						, A.BFHDCSTN_APBTMAN_NM
						, A.BFHDCSTN_APBTMAN_JIKGUP_NM
						, A.BFHDCSTN_APBT_DEPT_NM
						/* , TO_CHAR(TO_DATE(A.BFHDCSTN_APBTDAY, 'YYYYMMDD'), 'YYYY-MM-DD') BFHDCSTN_APBTDAY */
						, CONVERT(DATE, A.BFHDCSTN_APBTDAY, 120) AS BFHDCSTN_APBTDAY
				  FROM  TN_CLM_CONTRACT_MASTER A
				 WHERE  CNTRT_ID = :vo.cntrt_id
				   AND  DEL_YN = 'N'
			]]>
			</statement>
		</query>
		<!-- 승인자 정보 -->
		<query id="clm.manage.listContractApproveMan" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT  A.CNSDREQ_ID
						, A.CNTRT_ID
			            , B.TITLE
			            , 'en' ACTIVITY_NM
			            , C.USER_NAME
			            , C.USER_ID
			            , C.APPROVED
			            , C.DEPT_NAME
			            , C.DUTY
			            , C.GROUP_NAME
			            /* , TO_CHAR(TO_DATE(B.CREATE_DATE, 'YYYY-MM-DD HH24:MI:SS'), 'YYYY-MM-DD') CREATE_DATE */
			            , CONVERT(DATE, SUBSTRING(B.CREATE_DATE,1,8), 120) AS CREATE_DATE
			            , C.SEQUENCE
						, C.ACTIVITY
						, CASE WHEN :vo.session_user_locale = 'ko' THEN D.CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN D.CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN D.CD_NM_DEU
			              	  ELSE D.CD_NM_ENG
			             END CD_NM			            
			            , LEAD(A.CNTRT_ID) OVER(ORDER BY A.CNTRT_ID) LEAD_CNTRT_ID
			            , LAG(A.CNTRT_ID) OVER(ORDER BY A.CNTRT_ID) LAG_CNTRT_ID
			            , COUNT(A.CNTRT_ID) OVER(PARTITION BY A.CNTRT_ID) CNTRT_ID_CNT
			      FROM  TN_CLM_CONTRACT_CNSD A, TB_COM_START_PROCESS_WSVO B, TB_COM_ROUTE_WSVO C, TB_COM_CD D
			     WHERE  A.CNSDREQ_ID = :vo.cnsdreq_id
			       AND  A.CNTRT_ID = :vo.cntrt_id
			       AND  A.CNSDREQ_ID = B.REF_KEY	/* A.CNTRT_ID = B.REF_KEY 에서 변경처리 신성우 */
			       AND  B.MIS_ID = C.MIS_ID
			       AND  B.MODULE_ID = C.MODULE_ID
			       AND  B.APPRVL_CLSFCN IN ( SELECT CD FROM TB_COM_CD WHERE SYS_CD = 'LAS' AND GRP_CD = 'C030' )
			       AND	B.APPRVL_CLSFCN = 'C03003'
			       AND	C.ACTIVITY = '1'
			       AND  D.GRP_CD = 'SECFW_APPROVAL_ACTIVITY'
			       AND  D.CD=C.ACTIVITY
			  ORDER BY  CREATE_DATE DESC,  convert(int, SEQUENCE)
			]]>
			</statement>
		</query>	
		
		<query id="clm.execution.modifyContractStatus" isCamelCase="false">
			<statement>
			<![CDATA[
			UPDATE TN_CLM_CONTRACT_MASTER
			   SET PRCS_DEPTH = 'C02505'
			     , DEPTH_STATUS = 'C02681'
			     , MOD_DT 	   = GETDATE()
			     , MOD_ID	   = :vo.session_user_id
			     , MOD_NM      = :vo.session_user_nm
			WHERE CNTRT_ID     = :vo.cntrt_id
			]]>
			</statement>
		</query>	
		
		<query id="clm.execution.execUpNo" isCamelCase="false">
			<statement>
			<![CDATA[
			SELECT EXEC_UP_NO
			  FROM TN_CLM_CONT_EXECINFO
			 WHERE CNTRT_ID = :vo.cntrt_id
			   AND EXEC_SEQNO = :vo.exec_seqno
			]]>
			</statement>
		</query>
		
		<query id="clm.manage.modifyExecutionStatus2" isCamelCase="false">
			<statement>
			<![CDATA[
				UPDATE	TN_CLM_CONT_EXECINFO
					   SET	EXEC_STATUS	= :vo.exec_status
					WHERE	CNTRT_ID	= :vo.cntrt_id
					  AND	EXEC_SEQNO	= :vo.exec_up_no
					  AND	DEL_YN		= 'N'
			]]>
			</statement>
		</query>	

	</queries>
</queryservice>