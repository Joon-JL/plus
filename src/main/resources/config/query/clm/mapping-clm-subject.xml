<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
    	<!-- 목록 -->
        <query id="clm.admin.listSubject" isCamelCase="false">
            <statement>
            <![CDATA[
            SELECT *
              FROM(   SELECT ROW_NUMBER() OVER (ORDER BY TYPE_CD ASC) RN, 
              			t.*, CAST(COUNT(1) over() AS NUMERIC) TOTAL_CNT
		                FROM ( SELECT	 B.TYPE_CD
		                				,CASE WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM
			              					  WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_FRA
			              					  WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_DEU
			              					  ELSE B.CD_NM_ENG
			              			     END CD_NM
		                        		,A.TYPE_CD DIMENSION_CD
										,CASE WHEN :vo.session_user_locale = 'ko' THEN A.CD_NM
			              					  WHEN :vo.session_user_locale = 'fr' THEN A.CD_NM_FRA
			              					  WHEN :vo.session_user_locale = 'de' THEN A.CD_NM_DEU
			              					  ELSE A.CD_NM_ENG
			              			     END DIMENSION_NM
										,CASE WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM
			              					  WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_FRA
			              					  WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_DEU
			              					  ELSE B.CD_NM_ENG
			              			     END DIMENSION_NM_ENG
										,CASE WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM_ABBR
			              					  WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_ABBR_FRA
			              					  WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_ABBR_DEU
			              					  ELSE B.CD_NM_ABBR_ENG
			              			     END CD_NM_ABBR
										,CASE WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM
			              					  WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_FRA
			              					  WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_DEU
			              					  ELSE B.CD_NM_ENG
			              			     END CD_NM_ENG
										,CASE WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM_ABBR
			              					  WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_ABBR_FRA
			              					  WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_ABBR_DEU
			              					  ELSE B.CD_NM_ABBR_ENG
			              			     END CD_NM_ABBR_ENG
										,B.PRNT_SRT
										,B.CD_EXPL
										,B.USE_YN
										,CONVERT(CHAR(10), B.REG_DT, 23) AS REG_DT /*YYYY-MM-DD*/
										,B.REG_ID
										,B.REG_NM
										,B.REG_DEPT_NM
										,CONVERT(CHAR(10), B.MOD_DT, 23) AS MOD_DT /*YYYY-MM-DD*/
										,B.MOD_ID
										,B.MOD_NM
										,B.MOD_DEPT_NM
								  FROM  TN_COM_CONTRACTTYPE_CD A LEFT OUTER JOIN
										TN_COM_CONTRACTTYPE_CD B 
								  ON A.TYPE_CD = B.UP_TYPE_CD 			
								 WHERE  A.UP_TYPE_CD = 'TOP'
								   AND  A.USE_YN = 'Y'
								   AND  B.USE_YN = 'Y'
								   
								#if (!$vo.srch_dimension.equals(""))
								   AND  B.UP_TYPE_CD = :vo.srch_dimension
								#end
		            		) t
            ) TA
            WHERE RN between :vo.start_index and :vo.end_index
            ORDER BY RN
            ]]>
            </statement>
        </query>
        
        <!-- 상세 -->
        <query id="clm.admin.detailSubject" isCamelCase="false">
            <statement>
            <![CDATA[
                       SELECT	 B.TYPE_CD
               				,CASE WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM
			              		  WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_FRA
			              		  WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_DEU
			              		  ELSE B.CD_NM_ENG
			              	 END CD_NM
                       		,A.TYPE_CD DIMENSION_CD
							,A.CD_NM DIMENSION_NM
							,CASE WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM_ABBR
			              		  WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_ABBR_FRA
			              		  WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_ABBR_DEU
			              		  ELSE B.CD_NM_ABBR_ENG
			              	 END CD_NM_ABBR
							,CASE WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM
			              		  WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_FRA
			              		  WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_DEU
			              		  ELSE B.CD_NM_ENG
			              	 END CD_NM_ENG
							,CASE WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM_ABBR
			              		  WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_ABBR_FRA
			              		  WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_ABBR_DEU
			              		  ELSE B.CD_NM_ABBR_ENG
			              	 END CD_NM_ABBR_ENG
							,B.PRNT_SRT
							,B.CD_EXPL
							,B.USE_YN
							,CONVERT(CHAR(10), B.REG_DT, 23) AS REG_DT /*YYYY-MM-DD*/
							,B.REG_ID
							,B.REG_NM
							,B.REG_DEPT_NM
							,CONVERT(CHAR(10), B.MOD_DT, 23) AS MOD_DT /*YYYY-MM-DD*/
							,B.MOD_ID
							,B.MOD_NM
							,B.MOD_DEPT_NM
					  FROM  TN_COM_CONTRACTTYPE_CD A LEFT OUTER JOIN
							TN_COM_CONTRACTTYPE_CD B
					  ON A.TYPE_CD = B.UP_TYPE_CD
					 WHERE  A.UP_TYPE_CD = 'TOP'
					   AND  A.USE_YN = 'Y'
					   AND  B.USE_YN = 'Y'
					   AND  B.TYPE_CD = :vo.type_cd
            ]]>
            </statement>
        </query>
        
        <!-- 등록 -->
		<query id="clm.admin.insertSubject" isCamelCase="false">
			<statement>
			<![CDATA[
				INSERT INTO TN_COM_CONTRACTTYPE_CD  
							(
								 TYPE_CD
								,UP_TYPE_CD
								,CD_NM
								,CD_NM_ABBR
								,CD_NM_ENG
								,CD_NM_ABBR_ENG
								,PRNT_SRT
								,CD_EXPL
								,USE_YN
								,REG_DT
								,REG_ID
								,REG_NM
								,REG_DEPT_NM
					        ) VALUES (
					           :vo.type_cd
					          ,:vo.dimension_cd
					          ,:vo.cd_nm
					          ,:vo.cd_nm_abbr
					          ,:vo.cd_nm_eng
					          ,:vo.cd_nm_abbr_eng
					          ,0
					          ,:vo.cd_expl
					          ,'Y'
					          ,GETDATE()
					          ,:vo.reg_id
					          ,:vo.reg_nm
					          ,:vo.reg_dept_nm
					        )
			]]>
			</statement>
		</query>
		
		<!-- 수정 -->
		<query id="clm.admin.modifySubject" isCamelCase="false">
			<statement>
			<![CDATA[
				UPDATE	TN_COM_CONTRACTTYPE_CD
				   SET	 TYPE_CD = :vo.type_cd
						,CD_NM = :vo.cd_nm
						,CD_NM_ABBR = :vo.cd_nm_abbr
						,CD_NM_ENG = :vo.cd_nm_eng
						,CD_NM_ABBR_ENG = :vo.cd_nm_abbr_eng
						,PRNT_SRT = 0
						,CD_EXPL = :vo.cd_expl
						,MOD_DT = GETDATE()
						,MOD_ID = :vo.mod_id
						,MOD_NM = :vo.mod_nm
						,MOD_DEPT_NM = :vo.mod_dept_nm
				WHERE TYPE_CD = :vo.type_cd
				  AND USE_YN = 'Y'
			]]>
			</statement>
		</query>        
		
		<!-- 삭제 -->
		<query id="clm.admin.deleteSubject" isCamelCase="false">
			<statement>
			<![CDATA[
				UPDATE	TN_COM_CONTRACTTYPE_CD
				   SET   USE_YN  = 'N'
				        ,MOD_DT  = GETDATE()
						,MOD_ID = :vo.mod_id
						,MOD_NM = :vo.mod_nm
						,MOD_DEPT_NM = :vo.mod_dept_nm
				WHERE TYPE_CD = :vo.type_cd
				  AND USE_YN = 'Y'
			]]>
			</statement>
		</query>
		
		<!-- Item 삭제 -->
		<query id="clm.admin.deleteSubjectItem" isCamelCase="false">
			<statement>
			<![CDATA[
				DELETE TN_COM_CONTRACTTYPE_CD
				 WHERE UP_TYPE_CD = :vo.type_cd
				   AND USE_YN = 'Y'
			]]>
			</statement>
		</query>
		
		<!-- SubjectCd 채번생성 -->
		<query id="clm.admin.makeSubjectCd" isCamelCase="false">
			<statement>
			<![CDATA[
			SELECT :vo.dimension_cd + ISNULL(RIGHT('0'+CAST((CAST(RIGHT((
											SELECT  MAX(TYPE_CD)
											  FROM  TN_COM_CONTRACTTYPE_CD
											 WHERE  UP_TYPE_CD = :vo.dimension_cd
											   AND  RIGHT(TYPE_CD, 2) <> '99'
									   ), 2) AS numeric)+1) AS NVARCHAR(2)),2),'01')  nextSubjectCd
			  
			]]>
			</statement>
		</query>
    </queries>
</queryservice>