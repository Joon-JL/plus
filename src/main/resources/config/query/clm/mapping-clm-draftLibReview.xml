<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>

        <!-- LibReview 목록 -->
        <query id="clm.draft.listLibReview1" isCamelCase="false">
            <statement>
            <![CDATA[
            SELECT  A.LEVEL LEVEL, A.TYPE_CD TYPE_CD, A.UP_TYPE_CD UP_TYPE_CD
			        , A.CD_NM CD_NM, A.CD_NM_ABBR CD_NM_ABBR, A.LEAD_UP_TYPE_CD LEAD_UP_TYPE_CD, A.LAG_UP_TYPE_CD LAG_UP_TYPE_CD
			        , B.CONTRACT_TYPE_CD CONTRACT_TYPE_CD, B.CONTRACT_TYPE_ID CONTRACT_TYPE_ID
			        , B.CONTRACT_TYPE_CNT CONTRACT_TYPE_CNT
			  FROM  (
			          SELECT  LEVEL, TYPE_CD, UP_TYPE_CD
			          		  , CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			 WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			 WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			 ELSE CD_NM_ENG
			              		END AS CD_NM
               				  ,	CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM_ABBR
               				  		 WHEN :vo.session_user_locale = 'fr' THEN CD_NM_ABBR_FRA
               				  		 WHEN :vo.session_user_locale = 'de' THEN CD_NM_ABBR_DEU 
               				  		 ELSE CD_NM_ABBR_ENG
               				  	END AS CD_NM_ABBR
			          		  , LEAD(UP_TYPE_CD) OVER(ORDER BY TYPE_CD) LEAD_UP_TYPE_CD
			          		  , LAG(UP_TYPE_CD) OVER(ORDER BY TYPE_CD) LAG_UP_TYPE_CD
			            FROM  TN_COM_CONTRACTTYPE_CD
			           WHERE  LEVEL <= '3'
			             AND  USE_YN = 'Y'
			      START WITH UP_TYPE_CD = 'TOP'
			CONNECT BY PRIOR TYPE_CD = UP_TYPE_CD
			ORDER SIBLINGS BY TYPE_CD  
			        ) A,
			        (
						SELECT 'T01' CONTRACT_TYPE_CD, 'BIZ_CLSFCN' CONTRACT_TYPE_ID,  SUM(X.CONTRACT_TYPE_CNT) CONTRACT_TYPE_CNT     
						  FROM (
						          SELECT  DISTINCT  BIZ_CLSFCN CONTRACT_TYPE_CD, 'BIZ_CLSFCN' CONTRACT_TYPE_ID
						              , COUNT(BIZ_CLSFCN) OVER (PARTITION BY BIZ_CLSFCN) CONTRACT_TYPE_CNT
						            FROM  TN_CLM_CONTRACT_LIBRARY
						          WHERE  DEL_YN = 'N'      
						        ) X
						UNION ALL
						SELECT 'T02' CONTRACT_TYPE_CD , 'DEPTH_CLSFCN' CONTRACT_TYPE_ID ,  SUM(X.CONTRACT_TYPE_CNT) CONTRACT_TYPE_CNT     
						  FROM (
						          SELECT  DISTINCT DEPTH_CLSFCN CONTRACT_TYPE_CD, 'DEPTH_CLSFCN' CONTRACT_TYPE_ID
						                  , COUNT(DEPTH_CLSFCN) OVER (PARTITION BY DEPTH_CLSFCN) CONTRACT_TYPE_CNT
						            FROM  TN_CLM_CONTRACT_LIBRARY
						           WHERE  DEL_YN = 'N'      
						        ) X
						UNION ALL                        
						SELECT 'T03' CONTRACT_TYPE_CD, 'CNCLSNPURPS_BIGCLSFCN' CONTRACT_TYPE_ID,  SUM(X.CONTRACT_TYPE_CNT) CONTRACT_TYPE_CNT     
						  FROM (
						          SELECT  DISTINCT CNCLSNPURPS_BIGCLSFCN CONTRACT_TYPE_CD, 'CNCLSNPURPS_BIGCLSFCN' CONTRACT_TYPE_ID
						                  , COUNT(CNCLSNPURPS_BIGCLSFCN) OVER (PARTITION BY CNCLSNPURPS_BIGCLSFCN) CONTRACT_TYPE_CNT
						            FROM  TN_CLM_CONTRACT_LIBRARY
						           WHERE  DEL_YN = 'N'       
						        ) X
						UNION ALL    
						SELECT  DISTINCT BIZ_CLSFCN CONTRACT_TYPE_CD, 'BIZ_CLSFCN' CONTRACT_TYPE_ID
						    , COUNT(BIZ_CLSFCN) OVER (PARTITION BY BIZ_CLSFCN) CONTRACT_TYPE_CNT
						  FROM  TN_CLM_CONTRACT_LIBRARY
						 WHERE  DEL_YN = 'N'
						UNION ALL
						SELECT  DISTINCT DEPTH_CLSFCN CONTRACT_TYPE_CD, 'DEPTH_CLSFCN' CONTRACT_TYPE_ID
						        , COUNT(DEPTH_CLSFCN) OVER (PARTITION BY DEPTH_CLSFCN) CONTRACT_TYPE_CNT
						  FROM  TN_CLM_CONTRACT_LIBRARY
						 WHERE  DEL_YN = 'N'            
						UNION ALL  
						SELECT  DISTINCT CNCLSNPURPS_BIGCLSFCN CONTRACT_TYPE_CD, 'CNCLSNPURPS_BIGCLSFCN' CONTRACT_TYPE_ID
						        , COUNT(CNCLSNPURPS_BIGCLSFCN) OVER (PARTITION BY CNCLSNPURPS_BIGCLSFCN) CONTRACT_TYPE_CNT
						  FROM  TN_CLM_CONTRACT_LIBRARY
						 WHERE  DEL_YN = 'N'            
						UNION ALL  
						SELECT  DISTINCT CNCLSNPURPS_MIDCLSFCN CONTRACT_TYPE_CD, 'CNCLSNPURPS_MIDCLSFCN' CONTRACT_TYPE_ID
						        , COUNT(CNCLSNPURPS_MIDCLSFCN) OVER (PARTITION BY CNCLSNPURPS_MIDCLSFCN) CONTRACT_TYPE_CNT
						  FROM  TN_CLM_CONTRACT_LIBRARY  
						 WHERE  DEL_YN = 'N'   
			        ) B
			 WHERE A.TYPE_CD = B.CONTRACT_TYPE_CD(+)
			 ORDER BY TYPE_CD
            ]]>
            </statement>
        </query>    	
    	
    	<!-- LibReview 목록 -->
        <query id="clm.draft.listLibReview" isCamelCase="false">
            <statement>
            <![CDATA[
            SELECT	RN, LIB_NO, LIB_GBN, LIB_GBNNM, REGION_GBN, BIZ_CLSFCN, BIZ_CLSFCNNM, DEPTH_CLSFCN, DEPTH_CLSFCNNM
            		, CNCLSNPURPS_BIGCLSFCN, CNCLSNPURPS_BIGCLSFCNNM, CNCLSNPURPS_MIDCLSFCN, CNCLSNPURPS_MIDCLSFCNNM, TITLE
            		, CONT, RDCNT, TO_CHAR(REG_DT, 'YYYY-MM-DD') AS REG_DT, REG_ID, REG_NM
            		, TO_CHAR(MOD_DT, 'YYYY-MM-DD') AS MOD_DT, MOD_ID, MOD_NM, DEL_YN, DEL_DT, DEL_ID, DEL_NM, TOTAL_CNT
            		, CASE WHEN CNCLSNPURPS_MIDCLSFCN IS NOT NULL THEN CNCLSNPURPS_BIGCLSFCNNM + ' ▶ ' + CNCLSNPURPS_MIDCLSFCNNM
                      ELSE CNCLSNPURPS_BIGCLSFCNNM
                      END CNCLSNPURPS_PATH
              FROM ( SELECT rownum RN, t.*, COUNT(1) over() TOTAL_CNT
                     FROM (
                        SELECT	A.LIB_NO
						        ,A.LIB_GBN
						        ,( SELECT CD_NM FROM TB_COM_CD WHERE SYS_CD = 'CLM' AND GRP_CD = 'C035' AND CD = A.LIB_GBN AND USE_YN = 'Y' ) LIB_GBNNM
						        ,A.REGION_GBN
						        ,A.BIZ_CLSFCN
						        ,( SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              					   WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              					   WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              					   ELSE CD_NM_ENG
			              		          END CD_NM
						             FROM TN_COM_CONTRACTTYPE_CD 
						            WHERE UP_TYPE_CD = 'T01' 
						              AND TYPE_CD = A.BIZ_CLSFCN ) AS BIZ_CLSFCNNM
						        ,A.DEPTH_CLSFCN
						        ,( SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              					   WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              					   WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              					   ELSE CD_NM_ENG
			              		          END CD_NM
						             FROM TN_COM_CONTRACTTYPE_CD 
						            WHERE UP_TYPE_CD = 'T02' 
						              AND TYPE_CD = A.DEPTH_CLSFCN ) AS DEPTH_CLSFCNNM
						        ,A.CNCLSNPURPS_BIGCLSFCN
						        ,( SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              					   WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              					   WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              					   ELSE CD_NM_ENG
			              		          END CD_NM
						             FROM TN_COM_CONTRACTTYPE_CD 
						            WHERE UP_TYPE_CD = 'T03' 
						              AND TYPE_CD = A.CNCLSNPURPS_BIGCLSFCN ) AS CNCLSNPURPS_BIGCLSFCNNM
						        ,A.CNCLSNPURPS_MIDCLSFCN
						        ,( SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              					   WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              					   WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              					   ELSE CD_NM_ENG
			              		          END CD_NM
						             FROM TN_COM_CONTRACTTYPE_CD 
						            WHERE LEVEL = '2' 
						              AND TYPE_CD = A.CNCLSNPURPS_MIDCLSFCN 
						       START WITH UP_TYPE_CD = 'T03' 
						       CONNECT BY PRIOR TYPE_CD = UP_TYPE_CD ) AS CNCLSNPURPS_MIDCLSFCNNM
						        ,A.TITLE
						        ,A.CONT
						        ,A.RDCNT
						        ,TO_CHAR(A.REG_DT, 'YYYY-MM-DD') AS REG_DT
						        ,A.REG_ID
						        ,A.REG_NM
						        ,TO_CHAR(A.MOD_DT, 'YYYY-MM-DD') AS MOD_DT
						        ,A.MOD_ID
						        ,A.MOD_NM
						        ,A.DEL_YN
						        ,A.DEL_DT
						        ,A.DEL_ID
						        ,A.DEL_NM
                         FROM TN_CLM_CONTRACT_LIBRARY A
                         WHERE	A.DEL_YN = 'N'
                         #if (!$vo.lib_gbn.equals(""))
                           AND	A.LIB_GBN = :vo.lib_gbn
                         #end
                         #if (!$vo.region_gbn.equals(""))
                           AND	A.REGION_GBN = :vo.region_gbn
                         #end
                         #if (!$vo.srch_biz_clsfcn.equals(""))
                         	#if (!$vo.srch_biz_clsfcn.equals("T01"))
                           AND	A.BIZ_CLSFCN = :vo.srch_biz_clsfcn
                         	#else
                           AND	A.BIZ_CLSFCN LIKE :vo.srch_biz_clsfcn + '%'
                         	#end
                         #end
                         #if (!$vo.srch_depth_clsfcn.equals(""))
                         	#if (!$vo.srch_depth_clsfcn.equals("T02"))
							AND	A.DEPTH_CLSFCN = :vo.srch_depth_clsfcn
							#else
							AND	A.DEPTH_CLSFCN LIKE :vo.srch_depth_clsfcn + '%'
							#end
                         #end
                         #if (!$vo.srch_cnclsnpurps_bigclsfcn.equals(""))
                         	#if (!$vo.srch_cnclsnpurps_bigclsfcn.equals("T03"))
							AND	A.CNCLSNPURPS_BIGCLSFCN = :vo.srch_cnclsnpurps_bigclsfcn
							#else
							AND	A.CNCLSNPURPS_BIGCLSFCN LIKE :vo.srch_cnclsnpurps_bigclsfcn + '%'
							#end
                         #end
                         #if (!$vo.srch_cnclsnpurps_midclsfcn.equals(""))
							AND	A.CNCLSNPURPS_MIDCLSFCN = :vo.srch_cnclsnpurps_midclsfcn
                         #end
                         ORDER BY A.LIB_NO DESC
                         ) t
            		ORDER BY RN 
            		)
            WHERE RN between :vo.start_index and :vo.end_index
            ]]>
            </statement>
        </query>
        
        <!-- Library 상세 -->
        <query id="clm.draft.getLibReview" isCamelCase="false">
            <statement>
            <![CDATA[
		SELECT	LIB_NO, LIB_GBN, LIB_GBNNM, REGION_GBN, BIZ_CLSFCN, BIZ_CLSFCNNM, DEPTH_CLSFCN, DEPTH_CLSFCNNM
				, CNCLSNPURPS_BIGCLSFCN, CNCLSNPURPS_BIGCLSFCNNM, CNCLSNPURPS_MIDCLSFCN, CNCLSNPURPS_MIDCLSFCNNM
				, TITLE, CONT, RDCNT, REG_DT, REG_ID, REG_NM, MOD_DT, MOD_ID, MOD_NM, DEL_YN, DEL_DT, DEL_ID, DEL_NM
				, CASE WHEN CNCLSNPURPS_MIDCLSFCN IS NOT NULL THEN CNCLSNPURPS_BIGCLSFCNNM + ' ▶ ' + CNCLSNPURPS_MIDCLSFCNNM
				       ELSE CNCLSNPURPS_BIGCLSFCNNM
				       END CNCLSNPURPS_PATH
		  FROM (
                SELECT	A.LIB_NO
                        ,A.LIB_GBN
                        ,( SELECT CD_NM FROM TB_COM_CD WHERE SYS_CD = 'CLM' AND GRP_CD = 'C035' AND CD = A.LIB_GBN AND USE_YN = 'Y' ) LIB_GBNNM
                        ,A.REGION_GBN
                        ,A.BIZ_CLSFCN
                        ,( SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			   WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			   WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			   ELSE CD_NM_ENG
			              		  END CD_NM
                             FROM TN_COM_CONTRACTTYPE_CD 
                            WHERE UP_TYPE_CD = 'T01' 
                              AND TYPE_CD = A.BIZ_CLSFCN 
                              AND USE_YN = 'Y') AS BIZ_CLSFCNNM
                        ,A.DEPTH_CLSFCN
                        ,( SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			   WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			   WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			   ELSE CD_NM_ENG
			              		  END CD_NM
                             FROM TN_COM_CONTRACTTYPE_CD 
                            WHERE UP_TYPE_CD = 'T02' 
                              AND TYPE_CD = A.DEPTH_CLSFCN AND USE_YN = 'Y') AS DEPTH_CLSFCNNM
                        ,A.CNCLSNPURPS_BIGCLSFCN
                        ,( SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			   WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			   WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			   ELSE CD_NM_ENG
			              		  END CD_NM
                             FROM TN_COM_CONTRACTTYPE_CD 
                            WHERE UP_TYPE_CD = 'T03' 
                              AND TYPE_CD = A.CNCLSNPURPS_BIGCLSFCN 
                              AND USE_YN = 'Y') AS CNCLSNPURPS_BIGCLSFCNNM
                        ,A.CNCLSNPURPS_MIDCLSFCN
                        ,( SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			   WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			   WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			   ELSE CD_NM_ENG
			              		  END CD_NM
                             FROM TN_COM_CONTRACTTYPE_CD 
                            WHERE LEVEL = '2' 
                              AND TYPE_CD = A.CNCLSNPURPS_MIDCLSFCN 
                              AND USE_YN = 'Y' 
                       START WITH UP_TYPE_CD = 'T03' 
                       CONNECT BY PRIOR TYPE_CD = UP_TYPE_CD ) AS CNCLSNPURPS_MIDCLSFCNNM
                        ,A.TITLE
                        ,A.CONT
                        ,A.RDCNT
                        ,TO_CHAR(A.REG_DT, 'YYYY-MM-DD') AS REG_DT
                        ,A.REG_ID
                        ,A.REG_NM
                        ,TO_CHAR(A.MOD_DT, 'YYYY-MM-DD') AS MOD_DT
                        ,A.MOD_ID
                        ,A.MOD_NM
                        ,A.DEL_YN
                        ,A.DEL_DT
                        ,A.DEL_ID
                        ,A.DEL_NM
                  FROM	TN_CLM_CONTRACT_LIBRARY A
                 WHERE	A.LIB_NO  = :vo.lib_no
				           AND	A.DEL_YN  = 'N'
              )
 
            ]]>
            </statement>
        </query>
        
		<!-- Library RDCNT Increase -->
		<query id="clm.draft.increseRdcnt" isCamelCase="false">
            <statement>
            <![CDATA[
                UPDATE  TN_CLM_CONTRACT_LIBRARY
                   SET  RDCNT = RDCNT + 1
                 WHERE	LIB_NO = :vo.lib_no
				   AND	DEL_YN = 'N'
            ]]>
            </statement>
        </query>
        
        <!-- Library RDCNT Increase -->
		<query id="clm.manage.listType" isCamelCase="false">
            <statement>
            <![CDATA[
	          SELECT * FROM DBO.[CLM.MANAGE.LISTTYPE]( :vo.session_user_locale )
			  ORDER  BY TYPE_CD 
            ]]>
            </statement>
        </query>
        
        

    </queries>
</queryservice>