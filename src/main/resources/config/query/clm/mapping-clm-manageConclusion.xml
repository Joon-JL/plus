<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
	<queries>
    	<query id="clm.manage.detailConclusion" isCamelCase="false"  comment="계약목록 ">
		  <statement>
		  <![CDATA[
		  SELECT ROW_NUMBER() OVER(ORDER BY A.CNSDREQ_ID) AS RN
			   , A.CNSDREQ_ID
			   , B.CNTRT_ID
			   , B.CNTRT_UNTPRC_EXPL
			   , A.PRGRS_STATUS
			   , B.DEPTH_STATUS
		    FROM TN_CLM_CONT_CNSDREQ A
		       , TN_CLM_CONTRACT_CNSD C
		       , TN_CLM_CONTRACT_MASTER B
		   WHERE A.CNSDREQ_ID = :vo.cnsdreq_id
		     AND A.DEL_YN = 'N'
		     AND A.CNSDREQ_ID = C.CNSDREQ_ID
		     AND B.CNTRT_ID = C.CNTRT_ID
		     AND B.DEL_YN = 'N'
	    ORDER BY B.CNTRT_ID ASC
		    ]]>
		  </statement>
		</query>
		
		<query id="clm.manage.detailOnlyConclusion" isCamelCase="false"  comment="계약목록 ">
		  <statement>
		  <![CDATA[

		  SELECT /* ROWNUM AS RN */
		         ROW_NUMBER() OVER(ORDER BY A.CNSDREQ_ID) AS RN
			   , A.CNSDREQ_ID
			   , B.CNTRT_ID
			   , B.CNTRT_UNTPRC_EXPL
			   , A.PRGRS_STATUS
			   , B.DEPTH_STATUS
		    FROM TN_CLM_CONT_CNSDREQ A
		       , TN_CLM_CONTRACT_CNSD C
		       , TN_CLM_CONTRACT_MASTER B
		   WHERE A.CNSDREQ_ID = :vo.cnsdreq_id
		     AND A.DEL_YN = 'N'
		     AND A.CNSDREQ_ID = C.CNSDREQ_ID
		     AND B.CNTRT_ID = C.CNTRT_ID
		     AND B.DEL_YN = 'N'
		     AND B.PRCS_DEPTH = 'C02503'
		     /**계약건 Drop 인건 도 다 모여주게 수정 함 **/
		    /** AND B.CNTRT_STATUS NOT IN ('C02406') **/ 
	    ORDER BY B.CNTRT_ID ASC
		    ]]>
		  </statement>
		</query>
		    
    	<query id="clm.manage.listConclusionContract" isCamelCase="false" comment="체결품의계약목록">
		  	<statement>
		    <![CDATA[
	    	SELECT ROW_NUMBER() OVER(ORDER BY A.CNTRT_ID) AS RM
	    	     , B.CNTRT_ID
	    	     , B.CNTRT_STATUS
	    	     , B.PRCS_DEPTH
	    	     , B.DEPTH_STATUS
			  FROM TN_CLM_CONT_CNSDREQ A
			     , TN_CLM_CONTRACT_CNSD C
			     , TN_CLM_CONTRACT_MASTER B
			 WHERE A.CNSDREQ_ID = :vo.cnsdreq_id
			   AND A.DEL_YN = 'N'
			   AND A.CNSDREQ_ID = C.CNSDREQ_ID
			   AND B.CNTRT_ID = C.CNTRT_ID
			   AND B.DEL_YN = 'N'
 	      ORDER BY B.CNTRT_ID ASC
		    ]]>
		  	</statement>
		</query>
	
		<query id="clm.manage.detailConclusionContractMaster" isCamelCase="false" comment="마스터테이블정보 가져오기">
		  <statement>
		  <![CDATA[
		  SELECT ROW_NUMBER() OVER(ORDER BY A.CNTRT_ID) AS RN
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.BIZ_CLSFCN ) AS BIZ_CLSFCN_NM
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.DEPTH_CLSFCN ) AS DEPTH_CLSFCN_NM
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNCLSNPURPS_BIGCLSFCN ) AS CNCLSNPURPS_BIGCLSFCN_NM
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNCLSNPURPS_MIDCLSFCN ) AS CNCLSNPURPS_MIDCLSFCN_NM
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNCLSNPURPS_MIDCLSFCN_ETC ) AS CNCLSNPURPS_MIDCLSFCN_ETC_NM
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNTRT_TRGT ) AS CNTRT_TRGT_NM				      
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TB_COM_CD WHERE CD = A.PAYMENT_GBN ) AS PAYMENT_GBN_NM 
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM 
			   				  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			   				  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			   ELSE CD_NM_ENG END FROM TB_COM_CD WHERE CD = A.BFHDCSTN_APBT_MTHD) AS BFHDCSTN_APBT_MTHD_NM 
			   , A.CNTRT_OPPNT_CD
			   , A.CNTRT_OPPNT_TELNO						
  			   , A.CNTRT_OPPNT_EMAIL
  			   , A.CNTRT_OPPNT_RPRSNTMAN				
  			   , A.CNTRT_INFO_GBN							
  			   , A.CNTRT_OPPNT_TYPE
  			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.CNTRT_OPPNT_TYPE)  AS CNTRT_OPPNT_TYPE_NM
  			   , A.CNTRT_OPPNT_NM
			   , A.CNTRT_OPPNT_RPRSNTMAN AS CNTRT_OPPNT_CEO
			   , A.CNTRT_OPPNT_RESPMAN
			   , A.CNTRT_ID
			   , A.CNTRT_NM
			   , A.REGION_GBN
			   , A.BIZ_CLSFCN
			   , A.DEPTH_CLSFCN
			   , A.CNCLSNPURPS_BIGCLSFCN
			   , A.CNCLSNPURPS_MIDCLSFCN
			   , A.CNCLSNPURPS_MIDCLSFCN_ETC
			   , A.CNTRT_TRGT
			   , A.CNTRT_TRGT_DET
			   , A.PSHDBKGRND_PURPS
			   , A.PAYMENT_GBN
			   , A.ANTCPTNEFCT
				/* Sungwoo replaced 2014-09-18 */
				,CASE 
					WHEN ISDATE(A.CNTRTPERIOD_STARTDAY) = 1
						THEN CONVERT(VARCHAR, CONVERT(DATETIME, A.CNTRTPERIOD_STARTDAY, 23), 23)
					ELSE ''
				END AS CNTRTPERIOD_STARTDAY
				,CASE 
					WHEN ISDATE(A.CNTRTPERIOD_ENDDAY) = 1
						THEN CONVERT(VARCHAR, CONVERT(DATETIME, A.CNTRTPERIOD_ENDDAY, 23), 23)
					ELSE ''
				END AS CNTRTPERIOD_ENDDAY
			   , A.SECRET_KEEPPERIOD
			   ,RTRIM(REPLACE(CONVERT(VARCHAR,CONVERT(MONEY,ISNULL(A.CNTRT_UNTPRC,'0')),1),'.00','')) AS CNTRT_UNTPRC			   
			   , A.CNTRT_UNTPRC_EXPL
			   ,RTRIM(REPLACE(CONVERT(VARCHAR,CONVERT(MONEY,ISNULL(A.CNTRT_AMT,'0')),1),'.00','')) AS CNTRT_AMT
			   , A.CRRNCY_UNIT
			   , A.PAYMENT_COND
			   , A.ETC_MAIN_CONT
			   , A.IF_SYS_CD
			   , A.AUTO_RNEW_YN
			   , CONVERT(DATE,A.EXPRT_NOTIDAY,120) AS EXPRT_NOTIDAY
			   , A.OBLGT_LMT
			   , A.SPCL_COND
			   , CONVERT(DATE,A.CNCLSN_PLNDDAY,120) AS CNCLSN_PLNDDAY
			   , A.CNTRT_RESPMAN_ID
			   , A.CNTRT_RESPMAN_NM
			   , A.CNTRT_RESP_DEPT_NM
			   , A.CNTRT_RESPMAN_JIKGUP_NM
			   , A.CNTRT_OPPNT_CD
			   , A.SIGN_PLNDMAN_ID
			   , A.SIGN_PLNDMAN_NM
			   , A.SIGN_PLNDMAN_JIKGUP_NM
			   , A.SIGN_PLND_DEPT_NM
			   , A.SEAL_MTHD
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.SEAL_MTHD) SEAL_MTHD_NM
			   , COALESCE(A.CNTRT_CNCLSN_YN, 'N') AS CNTRT_CNCLSN_YN
			   , A.SIGNMAN_ID
			   , A.SIGNMAN_NM
			   , A.SIGN_DEPT_NM
			   , A.SIGNMAN_JIKGUP_NM
			   , CASE WHEN A.SIGNDAY = ''
               		THEN ''
               		ELSE CONVERT(VARCHAR, CONVERT(DATE, A.SIGNDAY), 23)
               		END AS SIGNDAY
			   , A.OPPNT_SIGNMAN_NM
			   , A.OPPNT_SIGNMAN_JIKGUP
			   , A.OPPNT_SIGNMAN_DEPT
			   ,CASE WHEN A.OPPNT_SIGNDAY = ''
               		THEN ''
               		ELSE CONVERT(VARCHAR, CONVERT(DATE, A.OPPNT_SIGNDAY), 23)
               		END AS OPPNT_SIGNDAY
			   , CONVERT(DATE,A.CNTRT_CNCLSNDAY,120) AS CNTRT_CNCLSNDAY
			   , CONVERT(DATE,A.CPY_REGDAY,120) AS CPY_REGDAY
			   , CASE COAlESCE(A.CPY_REGDAY,'N') WHEN 'N' THEN ''
                                                          ELSE 
                                                          		CASE WHEN :vo.session_user_locale = 'ko' THEN
                                                          			'체결본등록완료'
                                                          		WHEN :vo.session_user_locale = 'fr' THEN
                                                          			'Finalisation de l‘enregistrement du contrat conclu'
                                                          		WHEN :vo.session_user_locale = 'de' THEN
                                                          			'Fertigstellung der Registrierung des abgeschlossenen Vertrags'
                                                          		ELSE
                                                          			'Completion of Concluded Contract Registration'
                                                          		END
			        END                         AS CPY_REGYN
			   , A.CNTRT_NO
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.LOAC) AS LOAC
			   , ISNULL(A.LOAC_ETC, ' ') AS LOAC_ETC
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.DSPT_RESOLT_MTHD) AS DSPT_RESOLT_MTHD
			   , ISNULL(A.DSPT_RESOLT_MTHD_DET, ' ') AS DSPT_RESOLT_MTHD_DET
			   , A.ORG_ACPT_DLAY_CAUSE
			   , CONVERT(DATE,A.ORG_ACPTDAY,120) AS ORG_ACPTDAY
			   , A.ORG_TKOVMAN_ID
			   , A.ORG_TKOVMAN_NM
			   , A.ORG_TKOVMAN_JIKGUP_NM
			   , A.ORG_TKOV_DEPT_NM
			   , A.ORG_HDOVMAN_ID
			   , A.ORG_HDOVMAN_NM
			   , A.ORG_HDOVMAN_JIKGUP_NM
			   , A.ORG_HDOV_DEPT_NM
			   , A.ORG_STRG_POS
			   , A.PRCS_DEPTH
			   , A.DEPTH_STATUS
			   , A.CNTRT_STATUS
			   , A.REG_DT
			   , A.REG_ID
			   , A.REG_NM
			   , A.MOD_DT
			   , A.MOD_ID
			   , A.MOD_NM
			   , A.DEL_YN
			   , A.DEL_DT
			   , A.DEL_ID
			   , A.DEL_NM
			   , A.CNTRT_CHGE_DEMNDDAY
			   , A.CNTRT_CHGE_DEMNDMAN_ID
			   , A.CNTRT_CHGE_DEMNDMAN_NM
			   , A.CNTRT_CHGE_DEMND_CAUSE
			   , CONVERT(DATE,A.CNTRT_CHGE_PLNDDAY,120) AS CNTRT_CHGE_PLNDDAY
			   , A.CNTRT_CHGE_CONF_YN
			   , CONVERT(DATE,A.CNTRT_CHGE_CONFDAY,120) AS CNTRT_CHGE_CONFDAY
			   , A.CNTRT_CHGE_CONFMAN_ID
			   , A.CNTRT_CHGE_CONFMAN_NM
			   , A.BFHDCSTN_MTNMAN_ID
			   , A.BFHDCSTN_MTNMAN_NM
			   , A.BFHDCSTN_MTNMAN_JIKGUP_NM
			   , A.BFHDCSTN_MTN_DEPT_NM
			   , A.BFHDCSTN_MTNMAN_EMAIL
			   , A.BFHDCSTN_APBT_MTHD
			   , A.BFHDCSTN_APBTMAN_ID
			   , A.BFHDCSTN_APBTMAN_NM
			   , A.BFHDCSTN_APBTMAN_JIKGUP_NM
			   , A.BFHDCSTN_APBT_DEPT_NM
			   , A.BFHDCSTN_APBTDAY
			   , A.SEAL_RQSTDAY
			   , A.SEAL_RQSTMAN_ID
			   , A.SEAL_RQSTMAN_NM
			   , A.SEAL_FFMTMAN_ID
			   , A.SEAL_FFMTMAN_NM
			   , A.SEAL_FFMTMAN_JIKGUP_NM
			   , A.SEAL_FFMT_DEPT_NM
			   , A.SEAL_FFMTDAY
			   , A.REG_OPERDIV
			   , A.CPY_REGMAN_ID
			   , A.CPY_REGMAN_NM
			   , A.CPY_REGMAN_JIKGUP_NM
			   , A.CPY_REG_DEPT_NM
			   , CONVERT(DATE,C.AGREEDAY,120) AS AGREEDAY
         	   , CASE 
         	   		WHEN :vo.session_user_locale = 'fr' THEN
         	   			CASE C.AGREE_YN
         	   			  WHEN 'Y' THEN 'Accord'
         	   			  WHEN 'N' THEN 'L‘opération a échoué'
         	   			ELSE
         	   			  ' '
         	   			END 
         	   		WHEN :vo.session_user_locale = 'de' THEN
         	   			CASE C.AGREE_YN
         	   			  WHEN 'Y' THEN 'Vereinbarung'
         	   			  WHEN 'N' THEN 'Fehlgeschlagen'
         	   			ELSE
         	   			  ' '
         	   			END 
         	   		ELSE
         	   			CASE C.AGREE_YN
         	   			  WHEN 'Y' THEN 'Agreement'
         	   			  WHEN 'N' THEN 'Failed'
         	   			ELSE
         	   			  ' '
         	   			END
         	   		END AS AGREE_YN
         	   , ISNULL(C.AGREE_CAUSE,'') AS AGREE_CAUSE
         	   , A.SYS_NM
         	   , B.CNSD_STATUS
         	   /* ECMS 추가  S */
               , A.CONT_DRAFT
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.CONT_DRAFT)  AS CONT_DRAFT_NM
               , A.TOP_30_CUS
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.TOP_30_CUS)  AS TOP_30_CUS_NM
               , A.RELATED_PRODUCTS
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.RELATED_PRODUCTS)  AS RELATED_PRODUCTS_NM
			    , ISNULL(SUBSTRING( TNC_SUMMARY_LINK, charindex('tcdoc=', TNC_SUMMARY_LINK)+6, len(TNC_SUMMARY_LINK)), '') AS TNC_NO  , A.CLOSE_YN
			   /* ECMS 추가  E */
	 	    FROM TN_CLM_CONTRACT_MASTER A 
			LEFT OUTER JOIN  (
			        SELECT *
			          FROM TN_CLM_CNCLSN_AGREE
			         WHERE CNTRT_ID = :vo.cntrt_id
			           AND AGREE_SEQNO = (
			                              SELECT MAX(AGREE_SEQNO)
			                                FROM TN_CLM_CNCLSN_AGREE
			                               WHERE CNTRT_ID = :vo.cntrt_id
			                                 AND DEL_YN = 'N'
			                             )
			           AND DEL_YN = 'N'     
			       )  C ON A.CNTRT_ID = C.CNTRT_ID
			 , TN_CLM_CONTRACT_CNSD B 
		     WHERE A.CNTRT_ID = :vo.cntrt_id
		     AND B.CNTRT_ID = :vo.cntrt_id
		  ]]>
		  </statement>
		</query>
		
		<query id="clm.manage.modifyConclusion" isCamelCase="false" comment="계약마스터수정">
		  	<statement>
		    <![CDATA[
		    #if($vo.getDepth_status().equals('C02642')) 	
		    UPDATE TN_CLM_CONTRACT_MASTER
		   	   SET ORG_HDOVMAN_ID		= :vo.org_hdovman_id
				 , ORG_HDOVMAN_NM		= :vo.org_hdovman_nm
				 , ORG_HDOV_DEPT_NM     = :vo.org_hdov_dept_nm
				 , ORG_HDOVMAN_JIKGUP_NM= :vo.org_hdovman_jikgup_nm
				 , ORG_TKOVMAN_ID		= :vo.session_user_id	
				 , ORG_TKOVMAN_NM		= :vo.session_user_nm
				 , ORG_TKOV_DEPT_NM	    = :vo.session_dept_nm
				 , ORG_TKOVMAN_JIKGUP_NM= :vo.session_jikgup_nm
				 , ORG_STRG_POS			= :vo.org_strg_pos
				 , ORG_ACPTDAY			= :vo.org_acptday
				 , ORG_ACPT_DLAY_CAUSE  = :vo.org_acpt_dlay_cause
				 , PRCS_DEPTH			= 'C02504'		
		   	     , DEPTH_STATUS			= 'C02662'
		   	     , MOD_DT				= GETDATE()
		   	     , MOD_ID	 			= :vo.session_user_id
		       	 , MOD_NM    			= :vo.session_user_nm
		     WHERE CNTRT_ID	 			= :vo.cntrt_id
		    #else
		    UPDATE TN_CLM_CONTRACT_MASTER
		   	   SET CPY_REGMAN_ID 		= :vo.session_user_id
		   	     , CPY_REGMAN_NM		= :vo.session_user_nm
		   	     , CPY_REGMAN_JIKGUP_NM = :vo.session_jikgup_nm
		   	     , CPY_REG_DEPT_NM 		= :vo.session_dept_nm
		   	     , CPY_REGDAY			= /* TO_CHAR(SYSDATE, 'yyyyMMdd') */ REPLACE(CONVERT(VARCHAR, GETDATE(), 23), '-','')
				#if($vo.getSeal_mthd().equals('C02101'))
		   		 , SEAL_FFMTMAN_ID		= :vo.seal_ffmtman_id
		   		 , SEAL_FFMTMAN_NM		= :vo.seal_ffmtman_nm
		   		 , SEAL_FFMTMAN_JIKGUP_NM = :vo.seal_ffmtman_jikgup_nm
		   		 , SEAL_FFMT_DEPT_NM	= :vo.seal_ffmt_dept_nm
		   		 , SEAL_FFMTDAY			= :vo.seal_ffmtday 
		   	     #end
		   		 #if($vo.getSeal_mthd().equals('C02102'))
		   		 , SIGNMAN_ID			= :vo.signman_id
		   	     , SIGNMAN_NM			= :vo.signman_nm
		   	     , SIGNMAN_JIKGUP_NM	= :vo.signman_jikgup_nm
		   	     , SIGN_DEPT_NM		    = :vo.sign_dept_nm
		   	     , SIGNDAY				= :vo.signday
		   	     #end
		   	     #if($vo.getCntrt_cnclsn_yn().equals('Y'))
		   	     , CNTRT_CNCLSNDAY		= :vo.cntrt_cnclsnday
		   		 , EXPRT_NOTIDAY		= :vo.exprt_notiday
		   	     , OPPNT_SIGNMAN_NM		= :vo.oppnt_signman_nm
		   	     , OPPNT_SIGNMAN_DEPT	= :vo.oppnt_signman_dept
		   	     , OPPNT_SIGNMAN_JIKGUP = :vo.oppnt_signman_jikgup
		   	     , OPPNT_SIGNDAY		= :vo.oppnt_signday
		   	      /*  
		   	      #if(!$vo.getWork_type().equals('temp'))
		   	     , CNTRT_NO				= (
												SELECT 
												  CASE 
														WHEN CNT1 = 0 	THEN AUTO_CNTRD_NM + '0001'
													  ELSE AUTO_CNTRD_NM + /* LPAD(TO_CHAR((SUBSTRING(MAX1,length(MAX1)-3,4))+1), 4, '0') */
													                       dbo.Function_lpad(CONVERT(VARCHAR, (SUBSTRING(MAX1,LEN(MAX1)-3,4))+1), 4, '0')
													END AS AUTO_CNTRD_NM
												FROM     
												(    
													SELECT
														(SELECT COUNT(CNTRT_ID) 
														   FROM TN_CLM_CONTRACT_MASTER A  
														  WHERE CHARINDEX(TA.AUTO_CNTRD_NM,CNTRT_NO) > 0) AS CNT1,
												    (SELECT MAX(CNTRT_NO) 
												       FROM TN_CLM_CONTRACT_MASTER A  
												      WHERE CHARINDEX(TA.AUTO_CNTRD_NM,CNTRT_NO) > 0) AS MAX1,
												    AUTO_CNTRD_NM
													FROM 
													(
														SELECT 
															C.CNTRT_ID
															, A.cd_abbr_nm + SUBSTRING(ISNULL(:vo.cntrt_cnclsnday,'00000000'),3,ISNULL(LEN(:vo.cntrt_cnclsnday),8))+ '_' AS AUTO_CNTRD_NM
												    FROM 
															TB_COM_CD A
															, TN_CLM_CONTRACT_MASTER C
														WHERE 
															C.CNTRT_ID = :vo.cntrt_id
															 AND A.CD  = C.COMP_CD
															 AND A.SYS_CD ='LAS'
      														 AND A.grp_cd = 'COMP2'
													) TA
												) X
	          								)
		   	     
		   	       #end			
		   	       */  
		   	     #end
		   	     , CNTRT_CNCLSN_YN		= :vo.cntrt_cnclsn_yn
		   	     #if(!$vo.getWork_type().equals('temp'))		 
			     , CNTRT_STATUS			= 'C02402'
		   	     , PRCS_DEPTH			= 'C02503'		
		   	     , DEPTH_STATUS			= 'C02642'
		   	     #end
		   	     , MOD_DT				= GETDATE()
		   	     , MOD_ID	 			= :vo.session_user_id
		       	 , MOD_NM    			= :vo.session_user_nm
		     WHERE CNTRT_ID	 			= :vo.cntrt_id
		    #end
		      ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.selectCntrtNo" isCamelCase="false" comment="계약관리번호조회">
			<statement>
		  	<![CDATA[
				SELECT 
 					CASE WHEN CNT1 = 0 	THEN AUTO_CNTRD_NM + '01'
						WHEN LEN(MAX1)=21 AND SUBSTRING(MAX1,20,1)='0' THEN AUTO_CNTRD_NM + '0' + CONVERT(VARCHAR, SUBSTRING(MAX1,21,1)+1)
              			WHEN LEN(MAX1)=22 AND SUBSTRING(MAX1,21,1)='0' THEN AUTO_CNTRD_NM + '0' + CONVERT(VARCHAR, SUBSTRING(MAX1,22,1)+1)
              			WHEN LEN(MAX1)=21 THEN AUTO_CNTRD_NM + CONVERT(VARCHAR, SUBSTRING(MAX1,20,2)+1)
						ELSE AUTO_CNTRD_NM + CONVERT(VARCHAR, SUBSTRING(MAX1,21,2)+1)
					END AS AUTO_CNTRD_NM
				  FROM     
				  (     
				  SELECT (SELECT COUNT(CNTRT_ID)  
							  FROM TN_CLM_CONTRACT_MASTER A  WHERE CHARINDEX(TA.AUTO_CNTRD_NM,CNTRT_NO)>0
						    ) AS CNT1,
				        (SELECT MAX(CNTRT_NO)  
							  FROM TN_CLM_CONTRACT_MASTER A  WHERE CHARINDEX(TA.AUTO_CNTRD_NM,CNTRT_NO)>0
						    ) AS MAX1, 
				        AUTO_CNTRD_NM
					  FROM (
							SELECT C.CNTRT_ID
							     , A.USEMAN_MNG_ITM1 
							       + SUBSTRING(C.CNTRT_OPPNT_CD,1,2) 
							       + '_' 
							       +D.CDCRTN_VAL 
							       +E.CDCRTN_VAL
							       +F.CDCRTN_VAL
							       +'_'
							       +SUBSTRING(ISNULL(C.CNTRT_CNCLSNDAY,'00000000'),3, ISNULL(LEN(C.CNTRT_CNCLSNDAY),8))
							       +'_' AS AUTO_CNTRD_NM
							  FROM TB_COM_CD A
							     , TN_CLM_CONTRACT_MASTER C
							     , TN_COM_CONTRACTTYPE_CD D
							     , TN_COM_CONTRACTTYPE_CD E
							     , TN_COM_CONTRACTTYPE_CD F 
						     WHERE C.CNTRT_ID = :cntrt_id  
							   AND A.CD  = C.COMP_CD
							   AND C.BIZ_CLSFCN = D.TYPE_CD 
							   AND D.CDCRTN_VAL IS NOT NULL
							   AND C.DEPTH_CLSFCN = E.TYPE_CD 
							   AND E.CDCRTN_VAL IS NOT NULL
							   AND C.CNCLSNPURPS_MIDCLSFCN = F.TYPE_CD 
							   AND F.CDCRTN_VAL IS NOT NULL
							   AND A.SYS_CD ='LAS'
							   AND A.GRP_CD = 'COMP2'
							 ) TA
				    ) X
		  	]]>
		  	</statement>
		</query>
		
		
		<query id="clm.manage.listConclusionDelay" isCamelCase="false" comment="체결지연정보조회(히스토리관리용-현재사용안함2011.11.16수정)">
			<statement>
		  	<![CDATA[
		  	SELECT A.*
		  	     , COUNT(1) OVER() TOT_CNT
		  	     /* , TO_CHAR(SYSDATE, 'YYYYMMDD') AS TODAY */
		  	     , CONVERT(VARCHAR,SYSDATETIME(),112) AS TODAY  
			  FROM (
			        SELECT ROW_NUMBER() OVER(ORDER BY CNTRT_ID) AS RN
			             , CNTRT_ID
			          	 , DLAY_SEQNO		
			             /* , TO_CHAR(TO_DATE(CHGEBFR_CNCLSN_PLNDDAY,'yyyy-MM-dd'),'YYYY-MM-DD') CHGEBFR_CNCLSN_PLNDDAY */
			              , CONVERT(DATE,CHGEBFR_CNCLSN_PLNDDAY,120) AS CHGEBFR_CNCLSN_PLNDDAY
			             /* , TO_CHAR(TO_DATE(CHGEAFT_CNCLSN_PLNDDAY,'yyyy-MM-dd'),'YYYY-MM-DD') CHGEAFT_CNCLSN_PLNDDAY */
			             , CONVERT(DATE,CHGEAFT_CNCLSN_PLNDDAY,120) AS CHGEAFT_CNCLSN_PLNDDAY
			             , DLAY_CAUSE
			             , REG_DT 
			             , REG_ID
			             , REG_NM
			             , DEL_YN
			             , DEL_DT
			             , DEL_ID
			             , DEL_NM
			          FROM TN_CLM_CONTRACT_CNCLSNDLAY
			         WHERE CNTRT_ID = :vo.cntrt_id
			           AND DEL_YN = 'N'
			       ) A 
		  ORDER BY A.DLAY_SEQNO   
		    ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.insertConclusionDelay" isCamelCase="false" comment="체결지연정보입력및수정(히스토리관리용-현재사용안함2011.11.16수정)">
			<statement>
		    <![CDATA[
		     #if($vo.work_flag.equals("I"))
		  	INSERT INTO TN_CLM_CONTRACT_CNCLSNDLAY( 
		  			    CNTRT_ID
              		  , DLAY_SEQNO		
              		  , CHGEBFR_CNCLSN_PLNDDAY
              		  , CHGEAFT_CNCLSN_PLNDDAY
              		  , DLAY_CAUSE	
              		  , REG_DT 
              		  , REG_ID
              		  , REG_NM
              		  , DEL_YN
              		  , DEL_DT
              		  , DEL_ID
              		  , DEL_NM
            ) VALUES (  :vo.cntrt_id
                      , (
                         SELECT ISNULL(MAX(DLAY_SEQNO),0) + 1
                           FROM TN_CLM_CONTRACT_CNCLSNDLAY
                          WHERE CNTRT_ID = :vo.cntrt_id
                        ) 	
              		  , :vo.chgebfr_cnclsn_plndday
              		  , :vo.chgeaft_cnclsn_plndday
              		  , :vo.dlay_cause	
              		  , GETDATE() 
              		  , :vo.reg_id
              		  , :vo.reg_nm
              		  , :vo.del_yn
              		  , ''
              		  , ''
              		  , ''
              	     )
           #else
           UPDATE TN_CLM_CONTRACT_CNCLSNDLAY 
		  	   SET CHGEBFR_CNCLSN_PLNDDAY = :vo.chgebfr_cnclsn_plndday
                 , CHGEAFT_CNCLSN_PLNDDAY = :vo.chgeaft_cnclsn_plndday
           	     , DLAY_CAUSE				= :vo.dlay_cause	
                 , DEL_YN					= :vo.del_yn
                 #if($vo.del_yn.equals("Y")) 
                 , DEL_DT					= GETDATE()
                 , DEL_ID					= :vo.del_id
                 , DEL_NM					= :vo.del_nm
                 #end
             WHERE CNTRT_ID					= :vo.cntrt_id
               AND DLAY_SEQNO				= :vo.dlay_seqno
          #end
		    ]]>
			</statement>
		</query>
		
		<query id="clm.manage.listConclusionDelayForMain" isCamelCase="false" comment="체결지연정보조회(현재사용 히스토리관리안함-2011.11.16 추가)">
			<statement>
		  	<![CDATA[
		  	SELECT CNTRT_ID
			  	 , DLAY_SEQNO		
			     /* , TO_CHAR(TO_DATE(CHGEBFR_CNCLSN_PLNDDAY,'yyyy-MM-dd'),'YYYY-MM-DD') CHGEBFR_CNCLSN_PLNDDAY */
			     , CONVERT(VARCHAR, CONVERT(DATE, CHGEBFR_CNCLSN_PLNDDAY), 23) AS CHGEBFR_CNCLSN_PLNDDAY
			     /* , TO_CHAR(TO_DATE(CHGEAFT_CNCLSN_PLNDDAY,'yyyy-MM-dd'),'YYYY-MM-DD') CHGEAFT_CNCLSN_PLNDDAY */
			     , CONVERT(VARCHAR, CONVERT(DATE, CHGEAFT_CNCLSN_PLNDDAY), 23) AS CHGEAFT_CNCLSN_PLNDDAY
			     , DLAY_CAUSE
		      FROM TN_CLM_CONTRACT_CNCLSNDLAY
	         WHERE CNTRT_ID = :vo.cntrt_id
	           AND DEL_YN = 'N'
	           AND DLAY_SEQNO = (
	           					 SELECT MAX(DLAY_SEQNO)
	           					   FROM	TN_CLM_CONTRACT_CNCLSNDLAY
	           					  WHERE CNTRT_ID = :vo.cntrt_id
	           						AND DEL_YN = 'N'
	           					)	   
		    ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.insertConclusionDelayForMain" isCamelCase="false" comment="체결지연정보 입력 및 수정(히스토리관리안함-2011.11.16 추가)">
			<statement>
		    <![CDATA[
		     #if($vo.work_flag.equals("I"))
		  	INSERT INTO TN_CLM_CONTRACT_CNCLSNDLAY( 
		  			    CNTRT_ID
              		  , DLAY_SEQNO		
              		  , CHGEBFR_CNCLSN_PLNDDAY
              		  , CHGEAFT_CNCLSN_PLNDDAY
              		  , DLAY_CAUSE	
              		  , REG_DT 
              		  , REG_ID
              		  , REG_NM
              		  , DEL_YN
              		  , DEL_DT
              		  , DEL_ID
              		  , DEL_NM
            ) VALUES (  :vo.cntrt_id
                      , (
                         SELECT ISNULL(MAX(DLAY_SEQNO),0) + 1
                           FROM TN_CLM_CONTRACT_CNCLSNDLAY
                          WHERE CNTRT_ID = :vo.cntrt_id
                        ) 	
              		  , :vo.chgebfr_cnclsn_plndday
              		  , :vo.chgeaft_cnclsn_plndday
              		  , :vo.dlay_cause	
              		  , GETDATE() 
              		  , :vo.reg_id
              		  , :vo.reg_nm
              		  , 'N'
              		  , ''
              		  , ''
              		  , ''
              	     )
           #else
           UPDATE TN_CLM_CONTRACT_CNCLSNDLAY 
		  	   SET CHGEBFR_CNCLSN_PLNDDAY = :vo.chgebfr_cnclsn_plndday
                 , CHGEAFT_CNCLSN_PLNDDAY = :vo.chgeaft_cnclsn_plndday
           	     , DLAY_CAUSE				= :vo.dlay_cause	
             WHERE CNTRT_ID					= :vo.cntrt_id
               AND DLAY_SEQNO				= :vo.dlay_seqno
          #end
		    ]]>
			</statement>
		</query>
		
		
		
		<query id="clm.manage.modifyConclusionReqStatus" isCamelCase="false" comment="계약의뢰단계수정">
		  	<statement>
		    <![CDATA[
		    UPDATE TN_CLM_CONT_CNSDREQ
		   	   SET PRGRS_STATUS			= :vo.prgrs_status		
		   	     , MOD_DT				= GETDATE()
		   	     , MOD_ID	 			= :vo.session_user_id
		       	 , MOD_NM    			= :vo.session_user_nm
		     WHERE CNSDREQ_ID	 		= :vo.cnsdreq_id
		      ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.listConclusionMinStatus" isCamelCase="false" comment="계약의뢰단계수정">
		  	<statement>
		    <![CDATA[
		    SELECT  A.CNSDREQ_ID
		          , A.CNTRT_ID
		          , C.CNTRT_STATUS
		          , C.PRCS_DEPTH
		          , C.DEPTH_STATUS
			      , COUNT(A.CNSDREQ_ID) OVER(PARTITION BY A.CNSDREQ_ID) CNTRT_CNT
			      , COUNT(C.DEPTH_STATUS) OVER(PARTITION BY C.DEPTH_STATUS) DEPTH_STATUS_CNT
			      , MIN(C.DEPTH_STATUS) OVER(PARTITION BY C.PRCS_DEPTH) DEPTH_STATUS_MIN
			  FROM  TN_CLM_CONTRACT_CNSD A
			      , TN_CLM_CONT_CNSDREQ B
			      , TN_CLM_CONTRACT_MASTER C
			 WHERE  A.CNSDREQ_ID = B.CNSDREQ_ID
			   AND  A.CNTRT_ID = C.CNTRT_ID
			   AND  B.DEL_YN = 'N'
			   AND  C.DEL_YN = 'N'
			   AND  A.CNSDREQ_ID = :vo.cnsdreq_id
			   AND  C.DEPTH_STATUS NOT IN ('C02603')
		      ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.listConclusionMaster" isCamelCase="false" comment="계약마스터조회">
		  	<statement>
		    <![CDATA[
		    SELECT * FROM TN_CLM_CONTRACT_MASTER WHERE CNTRT_ID = :cntrt_id
		      ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.listAgree" isCamelCase="false" comment="체결후등록 합의 이력 내역 추가">
			<statement>
		  	<![CDATA[
		  	SELECT   CNTRT_ID
			        ,AGREE_SEQNO
			        ,AGREEMAN_ID
			        ,AGREEMAN_NM
			        ,AGREEMAN_JIKGUP_NM
			        ,AGREEMAN_DEPT_NM
			        ,AGREE_YN
			        ,AGREEDAY
			        /* ,TO_CHAR(REG_DT,'YYYY-MM-DD') REG_DT */
			        , CONVERT(CHAR(10), REG_DT, 23) AS REG_DT			        
			        ,REG_ID
			        ,REG_NM
			        ,DEL_YN
			        ,DEL_DT
			        ,DEL_ID
			        ,DEL_NM
			        ,AGREE_CAUSE
			  FROM TN_CLM_CNCLSN_AGREE
			 WHERE CNTRT_ID = :vo.cntrt_id
			 ORDER BY REG_DT DESC   
		    ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.cancelConclusion" isCamelCase="false" comment="체결미확인에서 작성중으로 프로세스 복원">
		  	<statement>
		    <![CDATA[
		     BEGIN
		     
		     UPDATE TN_CLM_CONTRACT_MASTER SET
		     		CNTRT_STATUS = 'C02401'
		     	   ,PRCS_DEPTH = 'C02502'
		   	       ,DEPTH_STATUS = /* DECODE(A.DEPTH_STATUS, 'C02647', 'C02647', 'C02621') */
		   	                       CASE A.DEPTH_STATUS
		   	                         WHEN 'C02647' THEN 'C02647'
		   	                       ELSE
		   	                         'C02621'
		   	                       END
		   	       , MOD_DT = GETDATE()
		   	       , MOD_ID = :vo.session_user_id
		   	 FROM TN_CLM_CONTRACT_MASTER A
		   	 WHERE  A.CNTRT_ID IN (SELECT SA.CNTRT_ID FROM TN_CLM_CONTRACT_CNSD SA, TN_CLM_CONTRACT_MASTER SB
		   	 						WHERE SA.CNSDREQ_ID = :vo.cnsdreq_id AND SA.CNTRT_ID = SB.CNTRT_ID AND 
		   	 							SB.DEL_YN = 'N' AND SB.DEPTH_STATUS NOT IN ('C02603') ) ;

		   	 UPDATE TN_CLM_CONT_CNSDREQ
		   	    SET PRGRS_STATUS = 'C04211'
		   	 WHERE CNSDREQ_ID = :vo.cnsdreq_id ;
		   	 
		   	 UPDATE TB_COM_START_PROCESS_WSVO
		   	    SET POST_PROCESS_FLAG = 'B'
		   	  WHERE REF_KEY = :vo.cnsdreq_id
		   	    AND STATUS = '2'
		   	    AND APPRVL_CLSFCN = 'C03002' ;
		   	 
		   	 							
		   	END;
		    ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.deferConclusion.insert" isCamelCase="false">
			<statement>
		    <![CDATA[		    	
		    	INSERT INTO TN_CLM_CONT_CNSDREQ_HOLD 
		    			(
		    			CNSDREQ_ID
						, HOLD_SEQNO
						, HOLD_STARTDAY
						, HOLD_CAUSE
						, REG_DT
						, REG_ID
						, REG_NM		    	
		    	) VALUES (
		    			:vo.cnsdreq_id
						, :vo.hold_seqno
						, GETDATE()
						, :vo.hold_cause
						, GETDATE()
						, :vo.reg_id
						, :vo.reg_nm
		    	)
		    ]]>
		  	</statement>
		 </query>
		 
		 <query id="clm.manage.deferCancelConclusion.insert" isCamelCase="false">
			<statement>
		    <![CDATA[		    	
		    	INSERT INTO TN_CLM_CONT_CNSDREQ_HOLD 
		    			(
		    			CNSDREQ_ID
						, HOLD_SEQNO
						, HOLD_ENDDAY
						, HOLD_CAUSE
						, REG_DT
						, REG_ID
						, REG_NM		    	
		    	) VALUES (
		    			:vo.cnsdreq_id
						, :vo.hold_seqno
						, GETDATE()
						, :vo.hold_cause
						, GETDATE()
						, :vo.reg_id
						, :vo.reg_nm
		    	)
		    ]]>
		  	</statement>
		 </query>
		 
		 		 <query id="clm.manage.detailConclusionContractMaster.new" isCamelCase="false" comment="마스터테이블정보 가져오기">
          <statement>
          <![CDATA[

          SELECT /* ROWNUM AS RN */
                 ROW_NUMBER() OVER(ORDER BY A.CNTRT_ID) AS RN
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.BIZ_CLSFCN ) AS BIZ_CLSFCN_NM
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.DEPTH_CLSFCN ) AS DEPTH_CLSFCN_NM
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNCLSNPURPS_BIGCLSFCN ) AS CNCLSNPURPS_BIGCLSFCN_NM
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNCLSNPURPS_MIDCLSFCN ) AS CNCLSNPURPS_MIDCLSFCN_NM
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNCLSNPURPS_MIDCLSFCN_ETC ) AS CNCLSNPURPS_MIDCLSFCN_ETC_NM
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNTRT_TRGT ) AS CNTRT_TRGT_NM                    
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.PAYMENT_GBN ) AS PAYMENT_GBN_NM 
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.BFHDCSTN_APBT_MTHD) AS BFHDCSTN_APBT_MTHD_NM 
               , A.CNTRT_OPPNT_CD
               , A.CNTRT_OPPNT_TELNO                        
               , A.CNTRT_OPPNT_EMAIL
               , A.CNTRT_OPPNT_RPRSNTMAN                
               , A.CNTRT_INFO_GBN                           
               , A.CNTRT_OPPNT_TYPE
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.CNTRT_OPPNT_TYPE)  AS CNTRT_OPPNT_TYPE_NM
               , A.CNTRT_OPPNT_NM
               , A.CNTRT_OPPNT_RPRSNTMAN AS CNTRT_OPPNT_CEO
               , A.CNTRT_OPPNT_RESPMAN
               , A.CNTRT_ID
               , A.CNTRT_NM
               , A.REGION_GBN
               , A.BIZ_CLSFCN
               , A.DEPTH_CLSFCN
               , A.CNCLSNPURPS_BIGCLSFCN
               , A.CNCLSNPURPS_MIDCLSFCN
               , A.CNCLSNPURPS_MIDCLSFCN_ETC
               , A.CNTRT_TRGT
               , A.CNTRT_TRGT_DET
               , A.PSHDBKGRND_PURPS
               , A.PAYMENT_GBN
               , A.ANTCPTNEFCT
               , CASE WHEN A.CNTRTPERIOD_STARTDAY = '' 
			 				THEN '' 
			 				ELSE CONVERT(VARCHAR, CONVERT(DATE, A.CNTRTPERIOD_STARTDAY, 23))
					   END AS CNTRTPERIOD_STARTDAY 
				 , CASE WHEN A.CNTRTPERIOD_ENDDAY = '' 
			 				THEN '' 
			 				ELSE CONVERT(VARCHAR, CONVERT(DATE, A.CNTRTPERIOD_ENDDAY, 23))
					   END AS CNTRTPERIOD_ENDDAY 
               , A.SECRET_KEEPPERIOD
               /* , TRIM(TO_CHAR(A.CNTRT_UNTPRC, '999,999,999,999,999')) AS CNTRT_UNTPRC */
               , RTRIM(REPLACE( CONVERT( VARCHAR, CONVERT( MONEY, ISNULL(A.CNTRT_UNTPRC,'0')  ), 1 ), '.00', '' )) AS CNTRT_UNTPRC
               , A.CNTRT_UNTPRC_EXPL
               /* , TRIM(TO_CHAR(A.CNTRT_AMT, '999,999,999,999,999')) AS CNTRT_AMT */
               , RTRIM(REPLACE( CONVERT( VARCHAR, CONVERT( MONEY, ISNULL(A.CNTRT_AMT,'0')  ), 1 ), '.00', '' )) AS CNTRT_AMT
               , A.CRRNCY_UNIT
               , A.PAYMENT_COND
               , A.ETC_MAIN_CONT
               , A.IF_SYS_CD
               , A.AUTO_RNEW_YN
               , CASE WHEN A.EXPRT_NOTIDAY = ''
               		THEN ''
               		ELSE CONVERT(VARCHAR, CONVERT(DATE, A.EXPRT_NOTIDAY), 23)
               		END AS EXPRT_NOTIDAY 
               , A.OBLGT_LMT
               , A.SPCL_COND
               /* , TO_CHAR(TO_DATE(A.CNCLSN_PLNDDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNCLSN_PLNDDAY */
               , CONVERT(VARCHAR, CONVERT(DATE, A.CNCLSN_PLNDDAY), 23) AS CNCLSN_PLNDDAY
               , A.CNTRT_RESPMAN_ID
               , A.CNTRT_RESPMAN_NM
               , A.CNTRT_RESP_DEPT_NM
               , A.CNTRT_RESPMAN_JIKGUP_NM
               , A.CNTRT_OPPNT_CD
               , A.SIGN_PLNDMAN_ID
               , A.SIGN_PLNDMAN_NM
               , A.SIGN_PLNDMAN_JIKGUP_NM
               , A.SIGN_PLND_DEPT_NM
               , A.SEAL_MTHD
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.SEAL_MTHD) SEAL_MTHD_NM
               , COALESCE(A.CNTRT_CNCLSN_YN, 'N') AS CNTRT_CNCLSN_YN
               , A.SIGNMAN_ID
               , A.SIGNMAN_NM
               , A.SIGN_DEPT_NM
               , A.SIGNMAN_JIKGUP_NM
               ,CASE WHEN A.SIGNDAY = ''
               		THEN ''
               		ELSE CONVERT(VARCHAR, CONVERT(DATE, A.SIGNDAY), 23)
               		END AS SIGNDAY
               , A.OPPNT_SIGNMAN_NM
               , A.OPPNT_SIGNMAN_JIKGUP
               , A.OPPNT_SIGNMAN_DEPT
               ,CASE WHEN A.OPPNT_SIGNDAY = ''
               		THEN ''
               		ELSE CONVERT(VARCHAR, CONVERT(DATE, A.OPPNT_SIGNDAY), 23)
               		END AS OPPNT_SIGNDAY
               /* , TO_CHAR(TO_DATE(A.CNTRT_CNCLSNDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNTRT_CNCLSNDAY */
               , CONVERT(VARCHAR, CONVERT(DATE, A.CNTRT_CNCLSNDAY), 23) AS CNTRT_CNCLSNDAY 
               /* , TO_CHAR(TO_DATE(A.CPY_REGDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD')  AS CPY_REGDAY */
               , CONVERT(VARCHAR, CONVERT(DATE, A.CPY_REGDAY), 23) AS CPY_REGDAY
               , CASE COAlESCE(A.CPY_REGDAY,'N') WHEN 'N' THEN ''
                                                          ELSE 
                                                          		CASE WHEN :vo.session_user_locale = 'ko' THEN
                                                          			'체결본등록완료'
                                                          		WHEN :vo.session_user_locale = 'fr' THEN
                                                          			'Finalisation de l‘enregistrement du contrat conclu'
                                                          		WHEN :vo.session_user_locale = 'de' THEN
                                                          			'Fertigstellung der Registrierung des abgeschlossenen Vertrags'
                                                          		ELSE
                                                          			'Completion of Concluded Contract Registration'
                                                          		END
                    END                         AS CPY_REGYN
               , A.CNTRT_NO
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.LOAC) AS LOAC
               , ISNULL(A.LOAC_ETC, ' ') AS LOAC_ETC
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.DSPT_RESOLT_MTHD) AS DSPT_RESOLT_MTHD
               , ISNULL(A.DSPT_RESOLT_MTHD_DET, ' ') AS DSPT_RESOLT_MTHD_DET
               , A.ORG_ACPT_DLAY_CAUSE
               /* , TO_CHAR(TO_DATE(A.ORG_ACPTDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS ORG_ACPTDAY */
               , CONVERT(VARCHAR, CONVERT(DATE, A.ORG_ACPTDAY), 23) AS ORG_ACPTDAY
               , A.ORG_TKOVMAN_ID
               , A.ORG_TKOVMAN_NM
               , A.ORG_TKOVMAN_JIKGUP_NM
               , A.ORG_TKOV_DEPT_NM
               , A.ORG_HDOVMAN_ID
               , A.ORG_HDOVMAN_NM
               , A.ORG_HDOVMAN_JIKGUP_NM
               , A.ORG_HDOV_DEPT_NM
               , A.ORG_STRG_POS
               , A.PRCS_DEPTH
               , A.DEPTH_STATUS
               , A.CNTRT_STATUS
               , A.REG_DT
               , A.REG_ID
               , A.REG_NM
               , A.MOD_DT
               , A.MOD_ID
               , A.MOD_NM
               , A.DEL_YN
               , A.DEL_DT
               , A.DEL_ID
               , A.DEL_NM
               , A.CNTRT_CHGE_DEMNDDAY
               , A.CNTRT_CHGE_DEMNDMAN_ID
               , A.CNTRT_CHGE_DEMNDMAN_NM
               , A.CNTRT_CHGE_DEMND_CAUSE
               /* , TO_CHAR(TO_DATE(A.CNTRT_CHGE_PLNDDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNTRT_CHGE_PLNDDAY */
               , CONVERT(VARCHAR, CONVERT(DATE, A.CNTRT_CHGE_PLNDDAY), 23) AS CNTRT_CHGE_PLNDDAY
               , A.CNTRT_CHGE_CONF_YN
               /* , TO_CHAR(TO_DATE(A.CNTRT_CHGE_CONFDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNTRT_CHGE_CONFDAY */
               , CONVERT(VARCHAR, CONVERT(DATE, A.CNTRT_CHGE_CONFDAY), 23) AS CNTRT_CHGE_CONFDAY
               , A.CNTRT_CHGE_CONFMAN_ID
               , A.CNTRT_CHGE_CONFMAN_NM
               , A.BFHDCSTN_MTNMAN_ID
               , A.BFHDCSTN_MTNMAN_NM
               , A.BFHDCSTN_MTNMAN_JIKGUP_NM
               , A.BFHDCSTN_MTN_DEPT_NM
               , A.BFHDCSTN_MTNMAN_EMAIL
               , A.BFHDCSTN_APBT_MTHD
               , A.BFHDCSTN_APBTMAN_ID
               , A.BFHDCSTN_APBTMAN_NM
               , A.BFHDCSTN_APBTMAN_JIKGUP_NM
               , A.BFHDCSTN_APBT_DEPT_NM
               /* , TO_CHAR(TO_DATE(A.BFHDCSTN_APBTDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS BFHDCSTN_APBTDAY */
               , CONVERT(VARCHAR, CONVERT(DATE, A.BFHDCSTN_APBTDAY), 23) AS BFHDCSTN_APBTDAY
               , A.SEAL_RQSTDAY
               , A.SEAL_RQSTMAN_ID
               , A.SEAL_RQSTMAN_NM
               , A.SEAL_FFMTMAN_ID
               , A.SEAL_FFMTMAN_NM
               , A.SEAL_FFMTMAN_JIKGUP_NM
               , A.SEAL_FFMT_DEPT_NM
               , A.SEAL_FFMTDAY
               , A.REG_OPERDIV
               , A.CPY_REGMAN_ID
               , A.CPY_REGMAN_NM
               , A.CPY_REGMAN_JIKGUP_NM
               , A.CPY_REG_DEPT_NM
               /* ECMS 추가  S */
               , A.CONT_DRAFT
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.CONT_DRAFT)  AS CONT_DRAFT_NM
               , A.TOP_30_CUS
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.TOP_30_CUS)  AS TOP_30_CUS_NM
               , A.RELATED_PRODUCTS
               , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              			WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              			WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              			ELSE CD_NM_ENG
			              		END CD_NM FROM TB_COM_CD WHERE CD = A.RELATED_PRODUCTS)  AS RELATED_PRODUCTS_NM
			   /* ECMS 추가  E */
               /* , TO_CHAR(TO_DATE(C.AGREEDAY,'YYYY-MM-DD'), 'YYYY-MM-DD') AS AGREEDAY */
               , CONVERT(VARCHAR, CONVERT(DATE, C.AGREEDAY), 23) AS AGREEDAY
               , CASE WHEN :vo.session_user_locale = 'ko' THEN 
               	 	/* DECODE(C.AGREE_YN, 'Y', '합의', 'N', '미합의', ' ') */
               	 	CASE C.AGREE_YN
               		  WHEN 'Y' THEN '합의'
               		  WHEN 'N' THEN '미합의'
               		ELSE
               		  ' '
               		END
               	  WHEN :vo.session_user_locale = 'fr' THEN 
               	 	/* DECODE(C.AGREE_YN, 'Y', 'Accord', 'N', 'L‘opération a échoué', ' ') */
               	 	CASE C.AGREE_YN
               		  WHEN 'Y' THEN 'Accord'
               		  WHEN 'N' THEN 'L‘opération a échoué'
               		ELSE
               		  ' '
               		END
               	  WHEN :vo.session_user_locale = 'de' THEN 
               	 	/* DECODE(C.AGREE_YN, 'Y', 'Vereinbarung', 'N', 'Fehlgeschlagen', ' ') */
               	 	CASE C.AGREE_YN
               		  WHEN 'Y' THEN 'Vereinbarung'
               		  WHEN 'N' THEN 'Fehlgeschlagen'
               		ELSE
               		  ' '
               		END
               	 ELSE
               	 	/* DECODE(C.AGREE_YN, 'Y', 'Agreement', 'N', 'Failed', ' ') */
               		CASE C.AGREE_YN
               		  WHEN 'Y' THEN 'Agreement'
               		  WHEN 'N' THEN 'Failed'
               		ELSE
               		  ' '
               		END 
               	 END AS AGREE_YN
               , ISNULL(C.AGREE_CAUSE,'') AS AGREE_CAUSE
               , E.REQ_TITLE
               , E.REQMAN_ID
               , E.REQMAN_NM
               , E.REQMAN_JIKGUP_NM
               , E.REQ_DEPT_NM
               , dbo.CLM_REQ_RESPMANS_M(E.CNSDREQ_ID,:vo.session_user_locale) AS CNSDMANS
               , CASE WHEN :vo.session_user_locale = 'ko' THEN 
               		/* DECODE(A.CNCLSNPURPS_BIGCLSFCN, 'T0302', '', DECODE(E.MN_CNSD_DEPT,'A00000001', '국내법무','A00000002','해외법무')) */
               	 	CASE A.CNCLSNPURPS_BIGCLSFCN
               		  WHEN 'T0302' THEN ''
               		ELSE 
                      CASE E.MN_CNSD_DEPT
                        WHEN 'A00000001' THEN '국내법무'
                      ELSE
                        '해외법무'
                      END
               		END
               	 ELSE
               	 	/* DECODE(A.CNCLSNPURPS_BIGCLSFCN, 'T0302', '', DECODE(E.MN_CNSD_DEPT,'A00000001', 'Corporate Legal Team','A00000002','Global Legal Affairs Team')) */
               		CASE A.CNCLSNPURPS_BIGCLSFCN
               		  WHEN 'T0302' THEN ''
               		ELSE 
                      CASE E.MN_CNSD_DEPT
                        WHEN 'A00000001' THEN 'Corporate Legal Team'
                      ELSE
                        'Global Legal Affairs Team'
                      END
               		END
               	 END AS MN_CNSD_DEPT_NM
 			, ISNULL(SUBSTRING( TNC_SUMMARY_LINK, charindex('tcdoc=', TNC_SUMMARY_LINK)+6, len(TNC_SUMMARY_LINK)), '') AS TNC_NO               	 
            FROM TN_CLM_CONTRACT_MASTER A 
            LEFT OUTER JOIN (
                    SELECT *
                      FROM TN_CLM_CNCLSN_AGREE
                     WHERE CNTRT_ID = :vo.cntrt_id
                       AND AGREE_SEQNO = (
                                          SELECT MAX(AGREE_SEQNO)
                                            FROM TN_CLM_CNCLSN_AGREE
                                           WHERE CNTRT_ID = :vo.cntrt_id
                                             AND DEL_YN = 'N'
                                         )
                       AND DEL_YN = 'N'     
                 )  C ON A.CNTRT_ID = C.CNTRT_ID 
               , TN_CLM_CONTRACT_CNSD D
               , TN_CLM_CONT_CNSDREQ E 
             WHERE A.CNTRT_ID = D.CNTRT_ID
               AND D.CNSDREQ_ID = E.CNSDREQ_ID
               AND A.CNTRT_ID = :vo.cntrt_id
               AND D.CNSDREQ_ID = :vo.cnsdreq_id
          ]]>
          </statement>
        </query>
		
    </queries>
</queryservice>