<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
    	<!-- 2011.10.13 합의요청메일정보-->
		<query id="clm.manage.listAgreeRequestSendMailInfo" isCamelCase="false">
            <statement>
            <![CDATA[
            SELECT DISTINCT MAX(D.AGREEMAN_ID)    		AS AGREEMAN_ID
 			          	  , MAX(A.REQ_TITLE)   		   	AS REQ_TITLE
			              , MAX(E.USER_NAME)          	AS APPROVE_NM
			              , MAX(E.DEPT_NM)			    AS DEPT_NM
			              , MAX(E.DUTY)					AS DUTY
			              , MAX(E.CREATE_DATE)        	AS APPROVE_DT    
			 	      FROM TN_CLM_CONT_CNSDREQ A
				         , TN_CLM_CONTRACT_CNSD B
				         , TN_CLM_CONTRACT_MASTER C
				         , TN_CLM_CNCLSN_AGREE D
	                     ,(
			                SELECT B.USER_NAME				   	AS USER_NAME
			                     , B.DEPT_NAME				   	AS DEPT_NM
			                     , B.DUTY						AS DUTY
			                     , TO_CHAR(TO_DATE(SUBSTRING(A.CREATE_DATE, 0, 8),'yyyyMMdd'), 'YYYY-MM-DD') AS CREATE_DATE
			                  FROM TB_COM_START_PROCESS_WSVO A
			                     , TB_COM_ROUTE_WSVO B
			                 WHERE A.MODULE_ID = B.MODULE_ID
			                   AND A.MIS_ID  = B.MIS_ID
			                   AND A.APPRVL_CLSFCN = 'C03002'
			                   AND A.REF_KEY = :vo.cnsdreq_id
			                   AND B.ACTIVITY = 0
			               ) E	  
			          WHERE A.CNSDREQ_ID 	= B.CNSDREQ_ID
			            AND B.CNTRT_ID 		= C.CNTRT_ID
			            AND C.CNTRT_ID 		= D.CNTRT_ID
			            AND A.CNSDREQ_ID 	= :vo.cnsdreq_id
			            AND A.DEL_YN 		  = 'N'
			            AND C.DEL_YN 		  = 'N'
			            AND C.CNTRT_STATUS <> 'C02406'
			            AND D.DEL_YN       = 'N'
			       GROUP BY D.CNTRT_ID
            ]]>
            </statement>
        </query>
        
        <!-- 2011.10.13 계약담당자-->
		<query id="clm.manage.listContractConculusionSendMailInfo" isCamelCase="false">
            <statement>
            <![CDATA[
            SELECT CNTRT_RESPMAN_ID
     			 , CNTRT_NM
			  FROM TN_CLM_CONTRACT_MASTER 
			 WHERE DEL_YN 		= 'N'
			   AND CNTRT_STATUS <> 'C02406'
			   AND CNTRT_ID = :vo.cntrt_id
            ]]>
            </statement>
        </query>
        
		<!-- [계약검토]메일 정보  -->
		<query id="clm.manage.listCnsdreqMailInfo" isCamelCase="false">
			<statement>
			<![CDATA[
			SELECT  dbo.LAS_CONT_CNSDREQ_RESPMAN_F_M(:vo.cnsdreq_id,',', :vo.session_user_locale ) AS CNSDMAN_NM
					/* [영문화]함수 이관 필요 2013-04-15
					<![CDATA[
					SELECT  LAS_CONT_CNSDREQ_RESPMAN_FULL(:vo.cnsdreq_id,',') AS CNSDMAN_NM
					*/
			       /* ,TO_CHAR(A.REQ_DT, 'YYYY-MM-DD') AS REQ_DT */
			       , CONVERT(VARCHAR, A.REQ_DT, 23) AS REQ_DT
			       /* ,TO_CHAR(SYSDATE, 'YYYY-MM-DD') AS MAIL_SEND_DATE */
			       , CONVERT(VARCHAR, GETDATE(),23) AS MAIL_SEND_DATE
			       ,CASE WHEN :vo.session_user_locale = 'ko' THEN
			       		'(' + A.RN + '차)' 
					ELSE
			       		CASE WHEN A.RN = '1' THEN '(' + A.RN + 'st)'
							 WHEN A.RN = '2' THEN '(' + A.RN + 'nd)'
							 WHEN A.RN = '3' THEN '(' + A.RN + 'rd)'
						ELSE '(' + A.RN + 'th)'
						END
			       	END AS CNSD_CNT
			       ,A.REQ_TITLE
			       ,A.REQMAN_NM
				   , C.CNTRT_NO
				   , C.PRCS_DEPTH
				   , (SELECT 
				   		CASE WHEN :vo.session_user_locale= 'ko' THEN CD_NM
				   			 WHEN :vo.session_user_locale= 'fr' THEN CD_NM_FRA
				   			 WHEN :vo.session_user_locale= 'de' THEN CD_NM_DEU
				   		ELSE CD_NM_ENG
				   		END CD_NM
					  FROM TB_COM_CD WHERE CD = C.PRCS_DEPTH ) AS PRCS_DEPTH_NM
				   , C.DEPTH_STATUS
				   , (SELECT 
				   		CASE WHEN :vo.session_user_locale= 'ko' THEN CD_NM
				   			 WHEN :vo.session_user_locale= 'fr' THEN CD_NM_FRA
				   			 WHEN :vo.session_user_locale= 'de' THEN CD_NM_DEU
				   		ELSE CD_NM_ENG
				   		END CD_NM
				   	  FROM TB_COM_CD WHERE CD = C.DEPTH_STATUS ) AS DEPTH_STATUS_NM
				   , C.COMP_CD
				   , C.CNTRT_NM		/* 2014-03-17 신성우 추가 결재시 이메일발송용 조회 */
			  FROM  (SELECT CAST(SB.LEVEL AS NVARCHAR) RN,
			                SA.CNSDREQ_ID, 
			                REQ_DT,
			                REQ_TITLE,
			                REQMAN_NM
			           FROM TN_CLM_CONT_CNSDREQ  SA,
					   (SELECT * FROM DBO.[COM.GET_LINK_CNSDREQ_ID]( :vo.cnsdreq_id )) SB
					   WHERE DEL_YN = 'N'
			           AND SA.CNSDREQ_ID = SB.CNSDREQ_ID 
			          ) A
			       ,TN_CLM_CONTRACT_CNSD B, TN_CLM_CONTRACT_MASTER C
			 WHERE  A.CNSDREQ_ID = B.CNSDREQ_ID
			 AND    B.CNTRT_ID   = C.CNTRT_ID
			 AND    A.CNSDREQ_ID = :vo.cnsdreq_id
			 AND    B.CNTRT_ID   = :vo.cntrt_id
			 ORDER BY  A.CNSDREQ_ID
			]]>
			</statement>
		</query>
		
		<!-- [계약검토] 담당자 지정메일 정보  -->
		<query id="clm.manage.listCnsdreqRespmanMailInfo" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT  dbo.LAS_CONT_CNSDREQ_RESPMAN_F_M(:vo.cnsdreq_id,',', :vo.session_user_locale ) AS CNSDMAN_NM
				/* [영문화]함수 이관 필요 2013-04-15
				SELECT  LAS_CONT_CNSDREQ_RESPMAN_FULL(:vo.cnsdreq_id,',') AS CNSDMAN_NM
				*/
					   ,TO_CHAR(A.REQ_DT, 'YYYY-MM-DD') AS REQ_DT
					   , '' AS MAIL_SEND_DATE
				  FROM  TN_CLM_CONT_CNSDREQ A
				 WHERE  A.CNSDREQ_ID = :vo.cnsdreq_id
			]]>
			</statement>
		</query>
		
		
		<query id="clm.manage.listConsiderationDeliveryMailInfo" isCamelCase="false" comment="법무 검토의뢰 검토의견 작성 완료 발신 ">
            <statement>
            <![CDATA[
            SELECT RESPMAN_ID
			  FROM TN_CLM_CONT_CNSDREQ_RESPMAN
			 WHERE CNSDREQ_ID = :vo.cnsdreq_id
			   AND RESP_DEPT <> :vo.blngt_orgnz
            ]]>
            </statement>
        </query>
        
		<query id="clm.manage.listConsiderationApplyMailInfo" isCamelCase="false" comment="법무 검토요청 발신 ">
            <statement>
            <![CDATA[
			SELECT A.USER_ID AS RESPMAN_ID
			FROM  TB_COM_USER A
				 ,TB_COM_ROLE_USER B
			WHERE A.BLNGT_ORGNZ = 'A00000003'
			  AND A.USER_ID = B.USER_ID
				AND B.ROLE_CD = 'RA01'
            ]]>
            </statement>
        </query>

		<query id="clm.manage.listConsiderationReplyMailInfoByFinalReviewer" isCamelCase="false" comment="법무 검토회신 발신(Final) ">
            <statement>
            <![CDATA[
			    /* Legal Admin 내역만 조회 */
			    SELECT DISTINCT A.USER_ID AS REQMAN_ID, 'RA01' AS ROLE_CD, A.EMAIL
			    FROM TB_COM_USER A
			    INNER JOIN TB_COM_ROLE_USER B
			     ON A.USER_ID = B.USER_ID
			    LEFT OUTER JOIN TB_COM_LEGAL_ADMIN L /* LEGAL ADMIN 수신리스트에 있어야 하는경우 추가 */
			     ON L.COMP_CD = A.COMP_CD
			     AND L.USE_YN = 'Y'
			    WHERE  A.COMP_CD  = :vo.comp_cd
			    AND  A.BLNGT_ORGNZ  = 'A00000001'
			    AND  B.ROLE_CD   in ('RA01','RD01','RM00') /* legal admin에게 매일 발송 */
			    AND  A.EMAIL_RCV_YN = 'Y' /* 2014-02-17 Kevin. 메일수신 여부 조건 추가*/
            ]]>
            </statement>
        </query>

		<query id="clm.manage.listConsiderationReplyMailInfoByRerequester" isCamelCase="false" comment="법무 재검토 발신 ">
            <statement>
            <![CDATA[			       
			    SELECT DISTINCT RESPMAN_ID AS REQMAN_ID
			    FROM  TN_CLM_CONT_CNSDREQ_RESPMAN
			    WHERE CNSDREQ_ID = :vo.cnsdreq_id			   
            ]]>
            </statement>
        </query>
        
        <query id="clm.manage.listConsiderationRespManMailInfo" isCamelCase="false" comment="법무 검토회신 발신 ">
            <statement>
            <![CDATA[
			SELECT DISTINCT USER_ID
			FROM (
				SELECT	REQMAN_ID AS USER_ID
				FROM	TN_CLM_CONT_CNSDREQ
				WHERE	CNSDREQ_ID = :vo.cnsdreq_id
			
				UNION ALL	/* SUNGWOO ADDED CCed USER 2014-07-30 */
				
				SELECT	TRGTMAN_ID AS USER_ID
				FROM	TN_CLM_CONT_CNSDREQ R
				INNER JOIN TN_CLM_CONTRACT_CNSD C
				ON R.CNSDREQ_ID = C.CNSDREQ_ID
				INNER JOIN TN_CLM_CONTRACT_AUTHREQ Q
				ON C.CNTRT_ID = Q.CNTRT_ID
				WHERE	R.CNSDREQ_ID = :vo.cnsdreq_id
				
				UNION ALL
							
				SELECT	RESPMAN_ID AS USER_ID
				FROM 	TN_CLM_CONT_CNSDREQ_RESPMAN
				WHERE	CNSDREQ_ID = :vo.cnsdreq_id
				
			) AA
            ]]>
            </statement>
        </query>
		<!-- 2011.10.26 종료관리 변경확인 메일정보-->
		<query id="clm.manage.listCompletionNotifyMailInfo" isCamelCase="false">
            <statement>
            <![CDATA[
			SELECT	C.CNTRT_ID
					, C.CNTRT_NM
					, C.CNTRT_RESPMAN_ID
					, C.CNTRT_RESPMAN_NM
					, C.CNTRT_CHGE_CONF_YN
            		, C.CNTRT_CHGE_CONFDAY
            		, C.CNTRT_CHGE_CONFMAN_ID
            		, C.CNTRT_CHGE_CONFMAN_NM
            		, C.CNTRT_CHGE_CONF_DEPT_NM
            		, C.CNTRT_CHGE_CONFMAN_JIKGUP_NM
            		, C.CNTRT_CHGE_CONF_CONT
            		, B.REQMAN_ID
            		, B.REQMAN_NM
			  FROM TN_CLM_CONTRACT_CNSD A
			     , TN_CLM_CONT_CNSDREQ B
			     , TN_CLM_CONTRACT_MASTER C
			 WHERE A.CNSDREQ_ID 	= B.CNSDREQ_ID
			   AND A.CNTRT_ID 		= C.CNTRT_ID
			   AND B.DEL_YN 		= 'N'
			   AND C.DEL_YN 		= 'N'
			   AND A.CNSDREQ_ID 	= :vo.cnsdreq_id
			   AND A.CNTRT_ID		= :vo.cntrt_id
			   AND C.CNTRT_STATUS 	<> 'C02406'
            ]]>
            </statement>
        </query>
        
        <!-- 2012.1.10 종료관리 변경상신시  준법지원확인요청메일내용 -->
		<query id="clm.manage.detailCompleteStatusInformMail" isCamelCase="false">
            <statement>
            <![CDATA[
				SELECT	C.CNTRT_ID
						, C.CNTRT_NM
						, C.CNTRT_RESPMAN_ID
						, (SELECT X.USER_NM + '/' + X.JIKGUP_NM + '/' + X.DEPT_NM FROM TB_COM_USER X WHERE X.USER_ID = C.CNTRT_RESPMAN_ID) AS RESPMAN_INFO
	            		, B.REQMAN_ID
	            		, (SELECT X.USER_NM + '/' + X.JIKGUP_NM + '/' + X.DEPT_NM FROM TB_COM_USER X WHERE X.USER_ID = B.REQMAN_ID) AS REQMAN_INFO
						/* , TO_CHAR(SYSDATE,'YYYY-MM-DD') AS APP_DAY */
						, CONVERT(VARCHAR, GETDATE(), 23) AS APP_DAY
						, C.REG_OPERDIV AS BLNGT_ORGNZ_ID
						, B.REQ_TITLE
						, C.CNTRT_NO
						, C.PRCS_DEPTH
						, (SELECT  
							CASE WHEN :vo.session_user_locale= 'ko' THEN CD_NM
				   			     WHEN :vo.session_user_locale= 'fr' THEN CD_NM_FRA
				   			     WHEN :vo.session_user_locale= 'de' THEN CD_NM_DEU
				   			ELSE CD_NM_ENG
				   			END CD_NM
						   FROM TB_COM_CD WHERE CD = C.PRCS_DEPTH ) AS PRCS_DEPTH_NM
						, C.DEPTH_STATUS
						, (SELECT
							CASE WHEN :vo.session_user_locale= 'ko' THEN CD_NM
				   			     WHEN :vo.session_user_locale= 'fr' THEN CD_NM_FRA
				   			     WHEN :vo.session_user_locale= 'de' THEN CD_NM_DEU 
				   			ELSE CD_NM_ENG
				   			END CD_NM
						   FROM TB_COM_CD WHERE CD = C.DEPTH_STATUS ) AS DEPTH_STATUS_NM
						, C.COMP_CD
						, C.CNTRT_STATUS /* SUNGWOO ADDED 2014-06-30 */
				  FROM TN_CLM_CONTRACT_CNSD A
				     , TN_CLM_CONT_CNSDREQ B
				     , TN_CLM_CONTRACT_MASTER C
				 WHERE A.CNSDREQ_ID 	= B.CNSDREQ_ID
				   AND A.CNTRT_ID 		= C.CNTRT_ID
				   AND A.CNSDREQ_ID 	= :vo.cnsdreq_id
				   AND A.CNTRT_ID		= :vo.cntrt_id
            ]]>
            </statement>
        </query>
        
        <!-- Sungwoo 2014-07-30 Replacement Change target from Legal Admin to Requester, Reviewer, CC user-->
		<query id="clm.manage.RequesterNReviewerList" isCamelCase="false">
            <statement>
            <![CDATA[
				SELECT DISTINCT USER_ID
				FROM (
					SELECT	REQMAN_ID AS USER_ID
					FROM	TN_CLM_CONT_CNSDREQ
					WHERE	CNSDREQ_ID = :vo.cnsdreq_id
				
					UNION ALL	/* SUNGWOO ADDED CCed USER 2014-07-30 */
					
					SELECT	TRGTMAN_ID AS USER_ID
					FROM	TN_CLM_CONT_CNSDREQ R
					INNER JOIN TN_CLM_CONTRACT_CNSD C
					ON R.CNSDREQ_ID = C.CNSDREQ_ID
					INNER JOIN TN_CLM_CONTRACT_AUTHREQ Q
					ON C.CNTRT_ID = Q.CNTRT_ID
					WHERE	R.CNSDREQ_ID = :vo.cnsdreq_id
					
					UNION ALL
								
					SELECT	RESPMAN_ID AS USER_ID
					FROM 	TN_CLM_CONT_CNSDREQ_RESPMAN
					WHERE	CNSDREQ_ID = :vo.cnsdreq_id
					
				) AA
            ]]>
            </statement>
        </query>
        
        <query id="clm.manage.LegalAdminList" isCamelCase="false" comment="Selected Legal Admin User List">
            <statement>
            <![CDATA[
				SELECT	DISTINCT A.USER_ID, A.EMAIL
				FROM	TB_COM_USER A
				INNER JOIN TB_COM_ROLE_USER B
					ON A.USER_ID 		= B.USER_ID
				LEFT OUTER JOIN TB_COM_LEGAL_ADMIN L	/* LEGAL ADMIN 수신리스트에 있어야 하는경우 추가 */
					ON L.COMP_CD = A.COMP_CD
					AND L.USE_YN = 'Y'
				WHERE 	A.COMP_CD		= :vo.comp_cd
				AND 	A.BLNGT_ORGNZ 	= 'A00000001'
				AND 	B.ROLE_CD 	 in ('RA01','RD01','RM00') /* legal admin에게 매일 발송 */
				AND		A.EMAIL_RCV_YN = 'Y'	/* 2014-02-17 Kevin. 메일수신 여부 조건 추가*/
				AND 	A.DELETED = 0
            ]]>
            </statement>
        </query> 
        <query id="clm.manage.listConsiderationReReqMailInfo" isCamelCase="false" comment="(재)접수 알림 메일 전송">
            <statement>
            <![CDATA[
			SELECT DISTINCT USER_ID, EMAIL
			FROM (
				
				SELECT RESPMAN_ID AS USER_ID, B.EMAIL
			    FROM  TN_CLM_CONT_CNSDREQ_RESPMAN A			    
				INNER JOIN TB_COM_USER B ON A.RESPMAN_ID = b.USER_ID 
			    WHERE CNSDREQ_ID = :vo.cnsdreq_id
					
			) AA
            ]]>
            </statement>
        </query> 
        <query id="clm.manage.listConsiderationReviewerInfo" isCamelCase="false" comment="검토발신 시 전자검토자에게 알림메일 전송">
            <statement>
            <![CDATA[
			SELECT	T2.USER_ID
			FROM	TN_COM_SEC_MNG_COMP T1
			        ,TB_COM_USER T2
			WHERE   T1.USER_ID 		= T2.USER_ID
			AND     T1.MNG_COMP_CD 	= :vo.comp_cd
			AND     T2.USER_NM  	= /* DECODE(:vo.solo_yn,'1','검토자(국내)','2','검토자(해외)',' ') */
			                          CASE :vo.solo_yn
			                            WHEN '1' THEN 'Reviewer(KOREA)'
			                            WHEN '2' THEN 'Reviewer(GLOBAL)'
			                          ELSE
			                            ' '
			                          END
            ]]>
            </statement>
        </query>   
        
        <query id="clm.manage.listConsiderationRespLegalAdminMailInfo" isCamelCase="false" comment="법무 검토회신 발신 ">
            <statement>
            <![CDATA[
            /*sam0723*/
				SELECT	DISTINCT A.EMAIL
				FROM	TB_COM_USER A
				INNER JOIN TB_COM_ROLE_USER B
					ON A.USER_ID = B.USER_ID
				LEFT OUTER JOIN TB_COM_LEGAL_ADMIN L	/* LEGAL ADMIN 수신리스트에 있어야 하는경우 추가 */
					ON L.COMP_CD = A.COMP_CD
					AND L.USE_YN = 'Y'
				WHERE 	A.COMP_CD		= :vo.comp_cd
				AND		A.EMAIL NOT IN (:vo.cntrt_oppnt_email)
				AND 	A.BLNGT_ORGNZ 	= 'A00000001'
				AND 	B.ROLE_CD 	 in ('RA01','RD01','RM00') /* legal admin에게 매일 발송 */
				AND		A.EMAIL_RCV_YN = 'Y'	/* 2014-02-17 Kevin. 메일수신 여부 조건 추가*/
            ]]>
            </statement>
        </query> 
        
        <query id="clm.manage.reqUserList" isCamelCase="false" comment="Selected Request User List">
            <statement>
            <![CDATA[
	            SELECT DISTINCT A.USER_ID, B.EMAIL
				FROM
				(
				   SELECT  USER_ID
				   FROM (
				    SELECT REQMAN_ID AS USER_ID
				    FROM TN_CLM_CONT_CNSDREQ
				    WHERE CNSDREQ_ID = :vo.cnsdreq_id
	
					UNION ALL	/* SUNGWOO ADDED CCed USER 2014-07-30 */
					
					SELECT	TRGTMAN_ID AS USER_ID
					FROM	TN_CLM_CONT_CNSDREQ R
					INNER JOIN TN_CLM_CONTRACT_CNSD C
					ON R.CNSDREQ_ID = C.CNSDREQ_ID
					INNER JOIN TN_CLM_CONTRACT_AUTHREQ Q
					ON C.CNTRT_ID = Q.CNTRT_ID
					WHERE	R.CNSDREQ_ID = :vo.cnsdreq_id
				    
				   ) AA
				) A, TB_COM_USER B
				WHERE A.USER_ID = B.USER_ID
            ]]>
            </statement>
        </query>
        
    </queries>
</queryservice>