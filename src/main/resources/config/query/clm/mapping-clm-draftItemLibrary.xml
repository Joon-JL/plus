<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
    	<!-- 조항 라이브러리 목록 조회 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.listItemLibrary" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    SELECT *
		    FROM	(
			    SELECT rownum RN, t.*, COUNT(1) over() TOTAL_CNT
			    FROM	(
					    SELECT A.LIB_NO, A.LIB_GBN, A.LANG_GBN, A.BIZ_CLSFCN, A.DEPTH_CLSFCN, A.CNCLSNPURPS_BIGCLSFCN, 
					    		A.CNCLSNPURPS_MIDCLSFCN, A.TITLE, A.CONT, A.RDCNT, A.REG_DT, A.REG_ID, A.REG_NM,
								CASE WHEN :vo.session_user_locale = 'ko' THEN B1.CD_NM
			              			 WHEN :vo.session_user_locale = 'fr' THEN B1.CD_NM_FRA
			              			 WHEN :vo.session_user_locale = 'de' THEN B1.CD_NM_DEU
			              			 ELSE B1.CD_NM_ENG
			              		END AS LANG_GBN_NM,
			                    CASE WHEN :vo.session_user_locale = 'ko' THEN B2.CD_NM
			              			 WHEN :vo.session_user_locale = 'fr' THEN B2.CD_NM_FRA
			              			 WHEN :vo.session_user_locale = 'de' THEN B2.CD_NM_DEU
			              			 ELSE B2.CD_NM_ENG
			              		END AS BIZ_CLSFCN_NM,
			                    CASE WHEN :vo.session_user_locale = 'ko' THEN B3.CD_NM
			              			 WHEN :vo.session_user_locale = 'fr' THEN B3.CD_NM_FRA
			              			 WHEN :vo.session_user_locale = 'de' THEN B3.CD_NM_DEU
			              			 ELSE B3.CD_NM_ENG
			              		END AS DEPTH_CLSFCN_NM,
			                    CASE WHEN :vo.session_user_locale = 'ko' THEN B4.CD_NM
			              			 WHEN :vo.session_user_locale = 'fr' THEN B4.CD_NM_FRA
			              			 WHEN :vo.session_user_locale = 'de' THEN B4.CD_NM_DEU
			              			 ELSE B4.CD_NM_ENG
			              		END AS CNCLSNPURPS_BIGCLSFCN_NM,
			                    CASE WHEN :vo.session_user_locale = 'ko' THEN B5.CD_NM
			              			 WHEN :vo.session_user_locale = 'fr' THEN B5.CD_NM_FRA
			              			 WHEN :vo.session_user_locale = 'de' THEN B5.CD_NM_DEU
			              			 ELSE B5.CD_NM_ENG
			              		END AS CNCLSNPURPS_MIDCLSFCN_NM
						FROM 	(	SELECT  LIB_NO, LIB_GBN, LANG_GBN, BIZ_CLSFCN, DEPTH_CLSFCN, CNCLSNPURPS_BIGCLSFCN, CNCLSNPURPS_MIDCLSFCN, TITLE, CONT, RDCNT
									 ,TO_CHAR(REG_DT, 'YYYYMMDD') AS REG_DT, REG_ID, REG_NM
									FROM 	TN_CLM_CONTRACT_LIBRARY
									WHERE	LIB_GBN = :vo.lib_gbn
									AND	 (DEL_YN = 'N' OR DEL_YN IS NULL)
							    #if (!$vo.srch_biz_clsfcn.equals(""))
								    AND		BIZ_CLSFCN = :vo.srch_biz_clsfcn
								#end
							    #if (!$vo.srch_lang_gbn.equals(""))
								    AND		LANG_GBN = :vo.srch_lang_gbn
								#end
							    #if (!$vo.srch_depth_clsfcn.equals(""))
								    AND		DEPTH_CLSFCN = :vo.srch_depth_clsfcn
								#end
							    #if (!$vo.srch_cnclsnpurps_bigclsfcn.equals(""))
								    AND		CNCLSNPURPS_BIGCLSFCN = :vo.srch_cnclsnpurps_bigclsfcn
								#end
							    #if (!$vo.srch_cnclsnpurps_midclsfcn.equals(""))
								    AND		CNCLSNPURPS_MIDCLSFCN = :vo.srch_cnclsnpurps_midclsfcn
								#end
						    #if (!$vo.srch_keyword_content.equals(""))
						    	#if($vo.srch_keyword.equals("title"))
								    AND		UPPER(TITLE) LIKE '%' + :vo.srch_keyword_content + '%' 
								#else
									AND		UPPER(REG_NM) LIKE '%' + :vo.srch_keyword_content + '%'
								#end
							#end
								    ORDER BY	LIB_NO DESC	
					
									) A, (SELECT CD, CD_NM, CD_ABBR_NM, CD_NM_ENG, CD_ABBR_NM_ENG, CD_NM_FRA, CD_ABBR_NM_FRA, CD_NM_DEU, CD_ABBR_NM_DEU
												FROM TB_COM_CD
												WHERE SYS_CD = 'CLM'
												AND		GRP_CD = 'C045'
												) B1, (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
															 FROM TN_COM_CONTRACTTYPE_CD
															 WHERE UP_TYPE_CD = 'T01'
															 ) B2, (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																			FROM TN_COM_CONTRACTTYPE_CD
																			WHERE UP_TYPE_CD = 'T02'
																			) B3, (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																						 FROM TN_COM_CONTRACTTYPE_CD
																						 WHERE UP_TYPE_CD = 'T03'
																						 ) B4, ( 	SELECT  LEVEL, TYPE_CD, UP_TYPE_CD, CD_NM, CD_NM_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																											FROM  TN_COM_CONTRACTTYPE_CD
																											WHERE LEVEL = '2'
																											START WITH UP_TYPE_CD = 'T03'
																											CONNECT BY PRIOR TYPE_CD = UP_TYPE_CD
																						 				) B5
						WHERE 	A.LANG_GBN = B1.CD(+)
						AND		A.BIZ_CLSFCN = B2.TYPE_CD(+)
						AND		A.DEPTH_CLSFCN = B3.TYPE_CD(+)
						AND		A.CNCLSNPURPS_BIGCLSFCN = B4.TYPE_CD(+)
						AND		A.CNCLSNPURPS_MIDCLSFCN = B5.TYPE_CD(+)
					    ) t
					)
		    WHERE RN between :vo.start_index and :vo.end_index
		    ]]>
		  </statement>
		</query>
		
		<!-- 조항 라이브러리 저장 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.insertItemLibrary" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    INSERT INTO TN_CLM_CONTRACT_LIBRARY (
		           LIB_NO
		               , LIB_GBN
		               , REGION_GBN
		               , LANG_GBN
		               , BIZ_CLSFCN
		               , DEPTH_CLSFCN
		               , CNCLSNPURPS_BIGCLSFCN
		               , CNCLSNPURPS_MIDCLSFCN
		               , TITLE
		               , CONT
		               , RDCNT
		               , REG_DT
		               , REG_ID
		               , REG_NM
		               , DEL_YN
		        ) VALUES (
		           :vo.lib_no
		          ,:vo.lib_gbn
		          , 'C01801'
		          ,:vo.lang_gbn
		          ,:vo.biz_clsfcn
		          ,:vo.depth_clsfcn
		          ,:vo.cnclsnpurps_bigclsfcn
		          ,:vo.cnclsnpurps_midclsfcn
		          ,:vo.title
		          ,:vo.cont
		          ,:vo.rdcnt
		          ,SYSDATE
		          ,:vo.reg_id
		          ,:vo.reg_nm
		          , 'N'
		        )
		    ]]>
		  </statement>
		</query>
		
		<!-- 조항 라이브러리 MAX LIB_NO : 2011.08.31 : 신남원 -->
		<query id="clm.draft.maxLibNoItemLibrary" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        SELECT MAX(LIB_NO) AS MAX_LIB_NO FROM TN_CLM_CONTRACT_LIBRARY
		    ]]>
		  </statement>
		</query>
				
		<!-- 조항 라이브러리 조회수 증가 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.modifyRdcntItemLibrary" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        UPDATE 	TN_CLM_CONTRACT_LIBRARY
	        SET		RDCNT = RDCNT + 1
		    WHERE	LIB_NO = :vo.lib_no
		    AND	 	(DEL_YN = 'N' OR DEL_YN IS NULL)		
		    ]]>
		  </statement>
		</query>
				
    	<!-- 조항 라이브러리 상세 조회 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.detailItemLibrary" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    SELECT A.LIB_NO, A.LIB_GBN, A.LANG_GBN, A.BIZ_CLSFCN, A.DEPTH_CLSFCN, A.CNCLSNPURPS_BIGCLSFCN, 
		    	A.CNCLSNPURPS_MIDCLSFCN, A.TITLE, A.CONT, A.RDCNT, A.REG_DT, A.REG_ID, A.REG_NM,
				CASE WHEN :vo.session_user_locale = 'ko' THEN B1.CD_NM
			         WHEN :vo.session_user_locale = 'fr' THEN B1.CD_NM_FRA
			         WHEN :vo.session_user_locale = 'de' THEN B1.CD_NM_DEU
			         ELSE B1.CD_NM_ENG
			    END AS LANG_GBN_NM,
                CASE WHEN :vo.session_user_locale = 'ko' THEN B2.CD_NM
			         WHEN :vo.session_user_locale = 'fr' THEN B2.CD_NM_FRA
			         WHEN :vo.session_user_locale = 'de' THEN B2.CD_NM_DEU
			         ELSE B2.CD_NM_ENG
			    END AS BIZ_CLSFCN_NM,
                CASE WHEN :vo.session_user_locale = 'ko' THEN B3.CD_NM
			         WHEN :vo.session_user_locale = 'fr' THEN B3.CD_NM_FRA
			         WHEN :vo.session_user_locale = 'de' THEN B3.CD_NM_DEU
			         ELSE B3.CD_NM_ENG
			    END AS DEPTH_CLSFCN_NM,
                CASE WHEN :vo.session_user_locale = 'ko' THEN B4.CD_NM
			         WHEN :vo.session_user_locale = 'fr' THEN B4.CD_NM_FRA
			         WHEN :vo.session_user_locale = 'de' THEN B4.CD_NM_DEU
			         ELSE B4.CD_NM_ENG
			    END AS CNCLSNPURPS_BIGCLSFCN_NM,
                CASE WHEN :vo.session_user_locale = 'ko' THEN B5.CD_NM
			         WHEN :vo.session_user_locale = 'fr' THEN B5.CD_NM_FRA
			         WHEN :vo.session_user_locale = 'de' THEN B5.CD_NM_DEU
			         ELSE B5.CD_NM_ENG
			    END AS CNCLSNPURPS_MIDCLSFCN_NM	 
			FROM (SELECT  LIB_NO
				 	   	 ,LIB_GBN
						 ,LANG_GBN
						 ,BIZ_CLSFCN
						 ,DEPTH_CLSFCN
						 ,CNCLSNPURPS_BIGCLSFCN
						 ,CNCLSNPURPS_MIDCLSFCN
						 ,TITLE
						 ,CONT
						 ,RDCNT
						 ,TO_CHAR(REG_DT, 'YYYYMMDD') AS REG_DT
						 ,REG_ID
						 ,REG_NM
						FROM 	TN_CLM_CONTRACT_LIBRARY
						WHERE	LIB_NO = :vo.lib_no
						AND	 (DEL_YN = 'N' OR DEL_YN IS NULL)
						) A, (SELECT CD, CD_NM, CD_ABBR_NM, CD_NM_ENG, CD_ABBR_NM_ENG
									FROM TB_COM_CD
									WHERE SYS_CD = 'CLM'
									AND		GRP_CD = 'C045'
									) B1, (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
												 FROM TN_COM_CONTRACTTYPE_CD
												 WHERE UP_TYPE_CD = 'T01'
												 ) B2, (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																FROM TN_COM_CONTRACTTYPE_CD
																WHERE UP_TYPE_CD = 'T02'
																) B3, (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																			 FROM TN_COM_CONTRACTTYPE_CD
																			 WHERE UP_TYPE_CD = 'T03'
																			 ) B4, ( 	SELECT  LEVEL, TYPE_CD, UP_TYPE_CD, CD_NM, CD_NM_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																								FROM  TN_COM_CONTRACTTYPE_CD
																								WHERE LEVEL = '2'
																								START WITH UP_TYPE_CD = 'T03'
																								CONNECT BY PRIOR TYPE_CD = UP_TYPE_CD
																			 				) B5
			WHERE 	A.LANG_GBN = B1.CD(+)
			AND		A.BIZ_CLSFCN = B2.TYPE_CD(+)
			AND		A.DEPTH_CLSFCN = B3.TYPE_CD(+)
			AND		A.CNCLSNPURPS_BIGCLSFCN = B4.TYPE_CD(+)
			AND		A.CNCLSNPURPS_MIDCLSFCN = B5.TYPE_CD(+)
		    ]]>
		  </statement>
		</query>
				
		<!-- 조항 라이브러리 수정 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.modifyItemLibrary" isCamelCase="false">
		  <statement>
		    <![CDATA[
			UPDATE TN_CLM_CONTRACT_LIBRARY
	        SET LANG_GBN = :vo.lang_gbn
              , BIZ_CLSFCN = :vo.biz_clsfcn
              , DEPTH_CLSFCN = :vo.depth_clsfcn
              , CNCLSNPURPS_BIGCLSFCN = :vo.cnclsnpurps_bigclsfcn
              , CNCLSNPURPS_MIDCLSFCN = :vo.cnclsnpurps_midclsfcn
              , TITLE = :vo.title
              , CONT = :vo.cont
              , MOD_DT = SYSDATE
              , MOD_ID = :vo.mod_id
              , MOD_NM = :vo.mod_nm
			WHERE	LIB_NO = :vo.lib_no	          
		    ]]>
		  </statement>
		</query>
		
		<!-- 조항 라이브러리 삭제 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.deleteItemLibrary" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        UPDATE 	TN_CLM_CONTRACT_LIBRARY
	        SET		DEL_YN = 'Y'
	        		, DEL_ID = :vo.del_id
	        		, DEL_DT = SYSDATE
	        		, DEL_NM = :vo.del_nm
		    WHERE	LIB_NO = :vo.lib_no
		    ]]>
		  </statement>
		</query>

		<!-- 조항 라이브러리 권한 체크 정보 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.authItemLibrary" isCamelCase="false">
		  <statement>
		    <![CDATA[
			SELECT	LIB_NO, LIB_GBN, LANG_GBN, BIZ_CLSFCN, DEPTH_CLSFCN, CNCLSNPURPS_BIGCLSFCN, CNCLSNPURPS_MIDCLSFCN, TITLE, CONT, RDCNT
				  , TO_CHAR(REG_DT, 'YYYYMMDD') AS REG_DT, REG_ID, REG_NM
			FROM 	TN_CLM_CONTRACT_LIBRARY
			WHERE	LIB_NO = :vo.lib_no
		    ]]>
		  </statement>
		</query>
		
    </queries>
</queryservice>