<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>    
    
		<query id="las.lawservice.listLawyerManage" isCamelCase="false">
		  <statement>
		    <![CDATA[
		        
		    	SELECT *
		              FROM ( SELECT rownum RN, t.*, COUNT(1) over() TOTAL_CNT
		                     FROM (

									 SELECT 
									         A.LWR_NO
									        ,A.LWR_NM
									        ,A.FIRST_NAME
									        ,A.LAST_NAME
									        ,A.LWR_JIKGUP
									        ,D.LWR_JIKGUP_NM
									        ,A.TELNO
									        ,A.PAY_LVL
									        ,A.EMAIL
									        ,A.EXPERT_AREA
									        ,A.FROM_SCHOOL
									        ,A.FROM_SCHOOL_GRDTYEAR
									        -- ,A.CAREER_CONT
									        ,A.LWR_ESTMT
									        ,A.LWR_ESTMT_LVL
									        ,E.LWR_ESTMT_LVL_NM 
									        ,A.LWR_ESTMTDAY
									        ,A.LAWSCHOOL
									        ,F.LAWSCHOOL_NM 
									        ,A.LAWSCHOOL_GRDTYEAR
									        ,A.NATION
									        ,TO_CHAR(A.REG_DT, 'YYYY-MM-DD') AS REG_DT
									        ,A.REG_ID
									        ,A.REG_NM
									        ,A.MOD_DT
									        ,A.MOD_ID
									        ,A.MOD_NM
									        ,A.DEL_YN
									        ,A.DEL_DT
									        ,A.DEL_ID
									        ,A.DEL_NM
									
									     FROM TN_LAS_LAWYERMNG A
									     
									     	  #if (!$vo.srch_event_no.equals("") + !$vo.srch_event_nm.equals("") + !$vo.srch_kbn1.equals("")) 
									          
									          ,( SELECT DISTINCT LWR_NO FROM TN_LAS_EVENT_ACCEPT_LAWYER WHERE EVENT_NO IN ( SELECT EVENT_NO FROM TN_LAS_EVENTMNG
									          		WHERE DEL_YN = 'N' 
									                
									                #if (!$vo.srch_event_no.equals(""))
											                    AND EVENT_NO = :vo.srch_event_no                    
											        #end
									                
									                #if (!$vo.srch_event_nm.equals(""))
											                    AND EVENT_NM LIKE '%' + :vo.srch_event_nm + '%'       
											        #end
									                
									                #if (!$vo.srch_kbn1.equals(""))
											              AND EVENT_GBN1 = :vo.srch_kbn1 
									                     #if (!$vo.srch_kbn2.equals(""))
											                    AND EVENT_GBN2 = :vo.srch_kbn2                    
											             #end
											        #end
									           )) B 
									          
									          #end
									     
									     	   #if (!$vo.srch_lawfirm_id.equals("") + !$vo.srch_lawfirm_nm.equals("") )
									     	
									          ,( SELECT DISTINCT LWR_NO FROM TN_LAS_LAWFIRM_LAWYER WHERE LAWFIRM_ID IN ( SELECT LAWFIRM_ID FROM TN_LAS_LAWFIRMMNG
									                 WHERE DEL_YN = 'N' 
									                    #if (!$vo.srch_lawfirm_id.equals(""))
									                      AND LAWFIRM_ID = :vo.srch_lawfirm_id   
									                    #end
									                    #if (!$vo.srch_lawfirm_nm.equals(""))
									                      AND LAWFIRM_NM LIKE '%' + :vo.srch_lawfirm_nm + '%'        
									                    #end 
									            )) C
									          #end
									            
									            ,(SELECT CD, CD_NM AS LWR_JIKGUP_NM FROM TB_COM_CD WHERE GRP_CD = '109'  ) D
									            ,(SELECT CD, CD_NM AS LWR_ESTMT_LVL_NM FROM TB_COM_CD WHERE GRP_CD = 'C006' ) E 
									            ,(SELECT CD, CD_NM AS LAWSCHOOL_NM FROM TB_COM_CD WHERE GRP_CD = '108' ) F             
									    
									     WHERE A.DEL_YN = 'N'
									     	 
									     	  #if (!$vo.srch_event_no.equals("") + !$vo.srch_event_nm.equals("") + !$vo.srch_kbn1.equals("")) 
									          	AND A.LWR_NO = B.LWR_NO
									          #end  
									         
									          #if (!$vo.srch_lawfirm_id.equals("") + !$vo.srch_lawfirm_nm.equals("") )
									          	AND A.LWR_NO = C.LWR_NO 
									          #end 
									         
									          AND A.LWR_JIKGUP = D.CD(+) 
									          AND A.LWR_ESTMT_LVL = E.CD(+) 
									          AND A.LAWSCHOOL = F.CD(+)
									         
									         #if (!$vo.srch_expert_area.equals(""))
									            AND A.EXPERT_AREA LIKE '%' + :vo.srch_expert_area + '%'  
									         #end 
									         #if (!$vo.srch_lwr_nm.equals(""))
									            AND A.LWR_NM LIKE '%' + :vo.srch_lwr_nm + '%'   
									         #end 
									         #if (!$vo.srch_lwr_estimate_lvl.equals(""))
									            AND A.LWR_ESTMT_LVL = :vo.srch_lwr_estimate_lvl    
									         #end     
		             
		            	 ORDER BY A.LWR_NM ASC 
		            
		             ) t
		            		
		            		)
		            WHERE RN between :vo.start_index and :vo.end_index
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.getListLawfirm" isCamelCase="false">
		  <statement>
		    <![CDATA[
		            SELECT LAWFIRM_ID ,LAWFIRM_NM
		            FROM TN_LAS_LAWFIRMMNG   
		            WHERE DEL_YN = 'N' 
    		        ORDER BY LAWFIRM_NM 
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.listLawyerManage.getEventList" isCamelCase="false">
		  <statement>
		    <![CDATA[
				
				SELECT rownum RN, t.*, COUNT(1) over() TOTAL_CNT
					FROM (
									
							SELECT 
									EVENT_NO
							    	,EVENT_NM 
								  	
							FROM 	TN_LAS_EVENTMNG 
								  	
							WHERE 	DEL_YN = 'N'
								  	
						ORDER BY 	EVENT_NM
								  
						) t
				 
				 ORDER BY RN 
				        		
		      	
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.insertLawyerManage" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
				    INSERT INTO TN_LAS_LAWYERMNG (
				           LWR_NO
				               , LWR_NM
				               , FIRST_NAME
				               , LAST_NAME
				               , LWR_JIKGUP
				               , TELNO
				               , PAY_LVL
				               , EMAIL
				               , EXPERT_AREA
				               , FROM_SCHOOL
				               , FROM_SCHOOL_GRDTYEAR
				               , CAREER_CONT
				               , LWR_ESTMT
				               , LWR_ESTMT_LVL
				               , LWR_ESTMTDAY
				               , LAWSCHOOL
				               , LAWSCHOOL_GRDTYEAR
				               , NATION
				               , REG_DT
				               , REG_ID
				               , REG_NM
				               , MOD_DT
				               , MOD_ID
				               , MOD_NM
				               , DEL_YN
				               , DEL_DT
				               , DEL_ID
				               , DEL_NM
				        ) VALUES (
				           :vo.lwr_no
				          ,:vo.lwr_nm
				          ,:vo.first_name
				          ,:vo.last_name
				          ,:vo.lwr_jikgup
				          ,:vo.telno
				          ,:vo.pay_lvl
				          ,:vo.email
				          ,:vo.expert_area
				          ,:vo.from_school
				          ,:vo.from_school_grdtyear
				          ,:vo.career_cont
				          ,:vo.lwr_estmt
				          ,:vo.lwr_estmt_lvl
				          ,:vo.lwr_estmtday
				          ,:vo.lawschool
				          ,:vo.lawschool_grdtyear
				          ,:vo.nation
				          , SYSDATE
				          ,:vo.reg_id
				          ,:vo.reg_nm
				          ,''
				          ,''
				          ,''
				          ,'N'
				          ,''
				          ,''
				          ,''
				        )
		        
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.insertLawyerEvent" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
				    INSERT INTO TN_LAS_EVENT_ACCEPT_LAWYER (
				               LWR_NO	
				             , SEQNO		
				             , EVENT_NO	
				             , ACPT_NO	
				             , REG_DT	
				             , REG_ID	
				             , REG_NM	
				
				        ) VALUES (
				          			 :vo.lwr_no
				          			,(SELECT	ISNULL(MAX(SEQNO),0) + 1 FROM	TN_LAS_EVENT_ACCEPT_LAWYER WHERE LWR_NO = :vo.lwr_no )
				          			,:vo.event_no_tmp  
				          			,'99999999'
				         			, SYSDATE
				          			,:vo.reg_id
				          			,:vo.reg_nm
				        )
		        
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.deleteLawyerEvent" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
				    DELETE FROM TN_LAS_EVENT_ACCEPT_LAWYER 
				    	WHERE LWR_NO = :vo.lwr_no 
			    	
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.insertLawfirmLawyer" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
			    INSERT INTO TN_LAS_LAWFIRM_LAWYER (
			               LAWFIRM_ID	
			             , LWR_NO		
			             , LWR_SRT	
			             , REG_DT	
			             , REG_ID	
			             , REG_NM	
			
			        ) VALUES (
			          			 :vo.lawfirm_id
			          			,:vo.lwr_no
			          			,''
			         			, SYSDATE
			          			,:vo.reg_id
			          			,:vo.reg_nm
			        )
		        
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.modifyLawfirmLawyer" isCamelCase="false">
		  <statement>
		    <![CDATA[    
		 	
		    MERGE into TN_LAS_LAWFIRM_LAWYER A
				using 
		 	ON (A.LWR_NO =:vo.lwr_no )
		 
		 	when matched then 
		 
		 		UPDATE SET 	LAWFIRM_ID = :vo.lawfirm_id 
		    
			WHEN not matched then
				
				INSERT 
					(
		               LAWFIRM_ID	
		             , LWR_NO		
		             , LWR_SRT	
		             , REG_DT	
		             , REG_ID	
		             , REG_NM	
		
		        ) VALUES (
		          			 :vo.lawfirm_id
		          			,:vo.lwr_no
		          			,''
		         			, SYSDATE
		          			,:vo.reg_id
		          			,:vo.reg_nm
		        )
		        
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.deleteLawfirmLawyer" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
		    	DELETE FROM TN_LAS_LAWFIRM_LAWYER 
		    	WHERE LWR_NO = :vo.lwr_no 
		    	
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.insertLawyerEstimate" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
		          INSERT INTO TN_LAS_LAWYER_ESTIMATION (
					  LWR_NO
		               , SEQNO
		               , ESTMT_TITLE
		               , ESTMT_CONT
		               , REG_DT
		               , REG_ID
		               , REG_NM
		        ) VALUES (
		            :vo.lwr_no
		          , (SELECT	ISNULL(MAX(SEQNO),0) + 1 FROM	TN_LAS_LAWYER_ESTIMATION WHERE LWR_NO = :vo.lwr_no  )
		          , :vo.estmt_title_tmp
		          , :vo.estmt_cont_tmp
		          , SYSDATE
		          , :vo.reg_id
		          , :vo.reg_nm
		        )
		        
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.deleteLawyerEstimate" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
		         DELETE
		           FROM TN_LAS_LAWYER_ESTIMATION
		           WHERE LWR_NO = :vo.lwr_no 
		           
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.getMaxLawyerNo" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
					SELECT	TO_CHAR(ISNULL(MAX(LWR_NO),0) + 1) lwr_no
						  FROM	TN_LAS_LAWYERMNG
						  
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.getMaxLawyerEstimateSeqno" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
				SELECT	ISNULL(MAX(SEQNO),0) + 1 estmt_no 
						FROM	TN_LAS_LAWYER_ESTIMATION
		          		WHERE LWR_NO = :vo.lwr_no
		          		
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.getMaxLawyerEstimationNo" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
			SELECT	ISNULL(MAX(SEQNO),0) + 1 estmt_no 
						  FROM	TN_LAS_LAWYER_ESTIMATION
		          WHERE LWR_NO = :vo.lwr_no 
		          
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.detailLawyerManage" isCamelCase="false">
		  <statement>
		    <![CDATA[
		
		 	SELECT 
		         A.LWR_NO
		        ,A.LWR_NM
		        ,A.FIRST_NAME
		        ,A.LAST_NAME
		        ,A.LWR_JIKGUP
		        ,D.LWR_JIKGUP_NM
		        ,A.TELNO
		        ,A.PAY_LVL
		        ,A.EMAIL
		        ,A.EXPERT_AREA
		        ,A.FROM_SCHOOL
		        ,A.FROM_SCHOOL_GRDTYEAR
		        ,A.CAREER_CONT
		        ,A.LWR_ESTMT
		        ,A.LWR_ESTMT_LVL
		        ,E.LWR_ESTMT_LVL_NM 
		        ,A.LWR_ESTMTDAY
		        ,A.LAWSCHOOL
		        ,F.LAWSCHOOL_NM 
		        ,A.LAWSCHOOL_GRDTYEAR
		        ,A.NATION
		        ,C.NATION_NM 
		        ,G.LAWFIRM_NM 
		        ,H.LAWFIRM_ID
		        ,TO_CHAR(A.REG_DT, 'YYYY-MM-DD') AS REG_DT
		        ,A.REG_ID
		        ,A.REG_NM
		        ,A.MOD_DT
		        ,A.MOD_ID
		        ,A.MOD_NM
		        ,A.DEL_YN
		        ,A.DEL_DT
		        ,A.DEL_ID
		        ,A.DEL_NM
		
		     FROM TN_LAS_LAWYERMNG A     	
		
		     	,(SELECT CD, CD_NM AS NATION_NM FROM TB_COM_CD WHERE GRP_CD = 'L2'  ) C
		        ,(SELECT CD, CD_NM AS LWR_JIKGUP_NM FROM TB_COM_CD WHERE GRP_CD = '109'  ) D
		        ,(SELECT CD, CD_NM AS LWR_ESTMT_LVL_NM FROM TB_COM_CD WHERE GRP_CD = 'C006' ) E 
		        ,(SELECT CD, CD_NM AS LAWSCHOOL_NM FROM TB_COM_CD WHERE GRP_CD = '108' ) F        
		        ,(SELECT LAWFIRM_ID, LAWFIRM_NM FROM TN_LAS_LAWFIRMMNG) G 
		     	,(SELECT LWR_NO,LAWFIRM_ID FROM TN_LAS_LAWFIRM_LAWYER) H 
		     
		     WHERE A.LWR_NO = :vo.lwr_no 
		
		     	AND A.NATION = C.CD(+) 
		        AND A.LWR_JIKGUP = D.CD(+) 
		        AND A.LWR_ESTMT_LVL = E.CD(+) 
		        AND A.LAWSCHOOL = F.CD(+)
		        AND A.LWR_NO = H.LWR_NO(+)
		        AND G.LAWFIRM_ID(+) = H.LAWFIRM_ID     
		
		    ]]>
		  </statement>
		</query>		
		
		<!-- 변호사 평가  리스트 -->
		<query id="las.lawservice.listLawyerEstimate" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
					SELECT 
			  			LWR_NO			
			  			,SEQNO
			  			,ESTMT_TITLE			
			  			,ESTMT_CONT		
			  			,TO_CHAR(REG_DT, 'YYYY-MM-DD') AS REG_DT		
			  			,REG_ID			
			 			,REG_NM			
			       FROM 
			       		TN_LAS_LAWYER_ESTIMATION       
			       WHERE LWR_NO = :vo.lwr_no        
			       ORDER BY REG_DT DESC 
		       
		    ]]>
		  </statement>
		</query>
		
		<!-- 상세 하단 사건링크 조회 -->
		<query id="las.lawservice.getLawyerEventList" isCamelCase="false">
		  <statement>
		    <![CDATA[
			
			SELECT   
					ROWNUM RN
                	,A.EVENT_NM
		            ,A.EVENT_NO
		            ,D.CD_NM AS LAWSUIT_TRGT_NM
		            ,TO_CHAR(TO_DATE(MIN(B.ACPTDAY),'YYYY-MM-DD'),'YYYY-MM-DD') AS ACPTDAY			 
		            ,MIN(B.REG_NM) USER_NM 
		                                                                                                                           
		                                                                                                                                       
		     FROM 	TN_LAS_EVENTMNG A		          
		          	,TN_LAS_EVENT_ACCEPT B
		            ,(SELECT CD,CD_NM FROM TB_COM_CD WHERE GRP_CD = '105' ) D   
				 
		     WHERE 	A.EVENT_NO(+) = B.EVENT_NO  
  				
					AND A.LAWSUIT_TRGT = D.CD(+)   
           
           			AND B.EVENT_NO  IN (	SELECT EVENT_NO FROM TN_LAS_EVENT_ACCEPT_LAWYER Where LWR_NO = :vo.lwr_no )
            
            		AND A.DEL_YN(+) = 'N'

		   
		GROUP BY 	A.EVENT_NM, A.EVENT_NO, D.CD_NM                                                                                                   
		ORDER BY 	D.CD_NM  DESC 
			
		    ]]>
		  </statement>
		</query>
		
		<!-- 변호사 사건 링크 조회(사건의 접수 여부 불문) -->
		<query id="las.lawservice.getLawyerEventList2" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
				SELECT 
						A.EVENT_NO 
				
				FROM 	TN_LAS_EVENTMNG A 

				WHERE 	A.EVENT_NO IN (SELECT 
												EVENT_NO 
										FROM 
												TN_LAS_EVENT_ACCEPT_LAWYER 
										WHERE 	LWR_NO = :vo.lwr_no)
 				AND 	A.DEL_YN = 'N' 
		           
		    ]]>
		  </statement>
		</query>
		
		<query id="las.lawservice.modifyLawyerManage" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    
				         UPDATE TN_LAS_LAWYERMNG
				          SET  LWR_NM = :vo.lwr_nm
				              , FIRST_NAME = :vo.first_name
				              , LAST_NAME = :vo.last_name
				              , LWR_JIKGUP = :vo.lwr_jikgup
				              , TELNO = :vo.telno
				              , PAY_LVL = :vo.pay_lvl
				              , EMAIL = :vo.email
				              , EXPERT_AREA = :vo.expert_area
				              , FROM_SCHOOL = :vo.from_school
				              , FROM_SCHOOL_GRDTYEAR = :vo.from_school_grdtyear
				              , CAREER_CONT = :vo.career_cont
				              , LWR_ESTMT = :vo.lwr_estmt
				              , LWR_ESTMT_LVL = :vo.lwr_estmt_lvl
				              , LWR_ESTMTDAY = :vo.lwr_estmtday
				              , LAWSCHOOL = :vo.lawschool
				              , LAWSCHOOL_GRDTYEAR = :vo.lawschool_grdtyear
				              , NATION = :vo.nation
				              , MOD_DT = SYSDATE
				              , MOD_ID = :vo.mod_id
				              , MOD_NM = :vo.mod_nm
						WHERE LWR_NO = :vo.lwr_no 
				
		    ]]>
		  </statement>
		</query>

		<query id="las.lawservice.deleteLawyerManage" isCamelCase="false">
  			<statement>
			    <![CDATA[
			    
			                UPDATE  TN_LAS_LAWYERMNG
			                   SET  DEL_YN = 'Y' 
				        	      , DEL_DT = SYSDATE 
			    	        	  , DEL_ID = :vo.del_id
			        	     	  , DEL_NM = :vo.del_nm 
			                 WHERE  LWR_NO = :vo.lwr_no
			                 
			    ]]>
  			</statement>
		</query>
		 
		<query id="las.lawservice.insertLawyerPhotoImage" isCamelCase="false">
  			<statement>
			    <![CDATA[			    

			                UPDATE  TN_LAS_LAWYERMNG
			                   SET  LWR_ESTMT = :vo.fileName
			                 WHERE  LWR_NO = :vo.lwr_no
			                 
			    ]]>
  			</statement>
		</query>	
		
	</queries>
</queryservice>