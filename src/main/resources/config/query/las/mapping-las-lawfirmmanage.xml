<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
<query id="las.lawservice.listLawfirmManage" isCamelCase="false">
  <statement>
    <![CDATA[
        	     SELECT *
              FROM ( SELECT rownum RN, t.*, COUNT(1) over() TOTAL_CNT
                     FROM (
						   SELECT 
						   		 A.LAWFIRM_ID
						        ,A.NATION AS NATION
						        ,C.CD_NM AS NATION_NM
						        ,A.LAWFIRM_NM
						        ,A.FST_CNTRTDAY 
						        ,A.RPRSNT_TEL
						        ,A.RPRSNT_FAX
						        ,A.RPRSNT_EMAIL
						        ,A.HOMEPAGE
						        ,A.STATE_GBN
						        ,A.ADDR
						        ,A.MAINFTRE_ESTMT
						        ,A.BANK_ADDR
						        ,A.BANK_NM
						        ,A.ACCNT_NO
						        ,A.BANK_NOTE
						        ,A.LOG_YMD
						        ,TO_CHAR(A.REG_DT, 'YYYY-MM-DD') AS REG_DT
						        ,A.REG_ID
						        ,A.REG_NM
						        ,TO_CHAR(A.MOD_DT, 'YYYY-MM-DD') AS MOD_DT
						        ,A.MOD_ID
						        ,A.MOD_NM
						        ,A.DEL_YN
						        ,A.DEL_DT
						        ,A.DEL_ID
						        ,A.DEL_NM
						        ,A.FST_EVENT_NO
						    FROM TN_LAS_LAWFIRMMNG A  
						    	 
						    	 #if (!$vo.srch_event_nm.equals(""))
								 , ( SELECT EVENT_NO AS sEVENT_NO, EVENT_NM AS sEVENT_NM FROM TN_LAS_EVENTMNG WHERE EVENT_NM LIKE '%' + :vo.srch_event_nm + '%' ) B
			                	 #end
			                	 
			                	 , ( SELECT CD,CD_NM FROM TB_COM_CD WHERE GRP_CD = 'L2' ) C
				                	 
						    WHERE  
								  A.DEL_YN = 'N' 
							#if (!$vo.srch_event_no.equals(""))
								  AND	A.FST_EVENT_NO = :vo.srch_event_no   
			                #end
			                #if (!$vo.srch_event_nm.equals(""))
				                	AND A.FST_EVENT_NO = B.sEVENT_NO 
			                #end
			                #if (!$vo.srch_lawfirm_id.equals(""))
								  AND	A.LAWFIRM_ID = :vo.srch_lawfirm_id   
			                #end
			                #if (!$vo.srch_lawfirm_nm.equals(""))
			                	  AND a.LAWFIRM_NM LIKE '%' + :vo.srch_lawfirm_nm + '%' 
			                #end			                
			                #if (!$vo.srch_nation.equals(""))
								  AND A.NATION = C.CD(+)  
								  AND A.NATION = :vo.srch_nation 
							#else
								  AND	A.NATION = C.CD(+)  
			                #end			                
                            #if (!$vo.srch_mainftre_estmt.equals(""))
			                 	 AND A.MAINFTRE_ESTMT LIKE '%' + :vo.srch_mainftre_estmt + '%'
			                #end
			                
							#if (!$vo.srch_start_dt.equals(""))
								AND	TO_DATE(A.FST_CNTRTDAY,'YYYY-MM-DD') >= date(:vo.srch_start_dt)
			                #end
			                    
			                #if (!$vo.srch_end_dt.equals(""))
								AND	TO_DATE(A.FST_CNTRTDAY,'YYYY-MM-DD') <= date(:vo.srch_end_dt) + 1
			                #end 		                
						    
						    ORDER BY A.LAWFIRM_NM, A.LOG_YMD DESC 
            ) t
            		ORDER BY RN 
            		)
            WHERE RN between :vo.start_index and :vo.end_index
    ]]>
  </statement>
</query>


<query id="las.lawservice.insertLawfirmManage" isCamelCase="false">
  <statement>
    <![CDATA[
    INSERT INTO TN_LAS_LAWFIRMMNG (
           		LAWFIRM_ID
               , NATION
               , FST_EVENT_NO
               , LAWFIRM_NM
               , FST_CNTRTDAY
               , RPRSNT_TEL
               , RPRSNT_FAX
               , RPRSNT_EMAIL
               , HOMEPAGE
               , STATE_GBN
               , ADDR
               , MAINFTRE_ESTMT
               , BANK_ADDR
               , BANK_NM
               , ACCNT_NO
               , BANK_NOTE
               , LOG_YMD
               , REG_DT
               , REG_ID
               , REG_NM
               , MOD_DT
               , MOD_ID
               , MOD_NM
               , DEL_YN
               , DEL_DT
               , DEL_ID
               , DEL_NM
        ) VALUES (
           :vo.lawfirm_id
          ,:vo.nation
          ,:vo.fst_event_no
          ,:vo.lawfirm_nm
          ,:vo.fst_cntrtday
          ,:vo.rprsnt_tel
          ,:vo.rprsnt_fax
          ,:vo.rprsnt_email
          ,:vo.homepage
          ,:vo.state_gbn
          ,:vo.addr
          ,:vo.mainftre_estmt
          ,:vo.bank_addr
          ,:vo.bank_nm
          ,:vo.accnt_no
          ,:vo.bank_note
          ,:vo.log_ymd
          ,SYSDATE 
          ,:vo.reg_id
          ,:vo.reg_nm
          ,:vo.mod_dt
          ,:vo.mod_id
          ,:vo.mod_nm
          ,'N'
          ,:vo.del_dt
          ,:vo.del_id
          ,:vo.del_nm
        )
    ]]>
  </statement>
</query>

<query id="las.lawservice.getMaxLawfirmID" isCamelCase="false">
  <statement>
    <![CDATA[
			SELECT TO_CHAR(ISNULL(TO_NUMBER(MAX(LPAD(SUBSTR(LAWFIRM_ID,3), 3, '0'))), 0)+1) AS LAWFIRM_ID from tn_las_lawfirmmng WHERE  SUBSTR(LAWFIRM_ID,1, 2) = :vo.nation
    ]]>
  </statement>
</query>

<!-- 상세 조회 -->
<query id="las.lawservice.detailLawfirmManage" isCamelCase="false">
    <statement>
    <![CDATA[
		SELECT  LAWFIRM_ID
               , NATION 
               , (SELECT CD_NM  FROM TB_COM_CD WHERE GRP_CD = 'L2' AND CD = NATION) AS NATION_NM
               , FST_EVENT_NO
               , (SELECT EVENT_NM  FROM TN_LAS_EVENTMNG WHERE EVENT_NO = FST_EVENT_NO) AS FST_EVENT_NM
               , LAWFIRM_NM
               , FST_CNTRTDAY
               , RPRSNT_TEL
               , RPRSNT_FAX
               , RPRSNT_EMAIL
               , HOMEPAGE
               , STATE_GBN
               , ADDR
               , MAINFTRE_ESTMT
               , BANK_ADDR
               , BANK_NM
               , ACCNT_NO
               , BANK_NOTE
               , LOG_YMD
               , TO_CHAR(REG_DT, 'yyyy-MM-dd hh24:mi') REG_DT
			   , REG_ID
			   , REG_NM
			   , TO_CHAR(MOD_DT, 'yyyy-MM-dd hh24:mi') MOD_DT
			   , MOD_ID
			   , MOD_NM
			   , DEL_YN
			   , TO_CHAR(DEL_DT, 'yyyy-MM-dd hh24:mi') DEL_DT
			   , DEL_ID
		  FROM  
		  		TN_LAS_LAWFIRMMNG
		 WHERE 
		 		DEL_YN = 'N' 
		  		 AND  LAWFIRM_ID = :vo.lawfirm_id 
    ]]>
    </statement>
</query>

<!-- 상세 하단 사건링크 조회 -->
<query id="las.lawservice.listGetEventList" isCamelCase="false">
  <statement>
    <![CDATA[

		SELECT rownum RN, t.*, COUNT(1) over() TOTAL_CNT
		
		FROM (
		 
						 SELECT 	
								 	B.EVENT_NM
						            , B.EVENT_NO
						            , D.CD_NM AS LAWSUIT_TRGT_NM
						            , TO_CHAR(TO_DATE(MIN(A.ACPTDAY),'YYYY-MM-DD'),'YYYY-MM-DD') AS ACPTDAY			 
						            , B.REG_NM    
						   
						   FROM 
							   		TN_LAS_EVENT_ACCEPT A,                                                                                                                                   
						            TN_LAS_EVENTMNG B,                                                                                                                                       
						            TN_LAS_EVENT_ACCEPT_SRVCCOST C,	                                                                                                                                   
						            ( SELECT CD,CD_NM FROM TB_COM_CD WHERE GRP_CD = '105' ) D                                                                                      
						 
						  WHERE  
						  			A.EVENT_NO = B.EVENT_NO 
							AND     A.ACPT_NO  = C.ACPT_NO 
							AND     B.LAWSUIT_TRGT = D.CD   
							AND     A.LAWFIRM_ID = :vo.lawfirm_id  
						    AND 	A.DEL_YN = 'N'  
							                                                                                                                    
						GROUP BY	B.EVENT_NM, B.EVENT_NO, D.CD_NM ,B.REG_NM                                                                                                      
						ORDER BY	D.CD_NM  DESC 
		
		) t
		
    ]]>
  </statement>
</query>

<!-- 로펌평가 -->
<query id="las.lawservice.insertLawfirmEstimate" isCamelCase="false">
  <statement>
    <![CDATA[
    INSERT INTO TN_LAS_LAWFIRM_ESTIMATION (
			     ESTMT_NO	
			   , LAWFIRM_ID	
			   , ESTMT_NAME	
			   , ESTMT_CONT	
               , REG_DT
               , REG_ID
               , REG_NM
        ) VALUES (          
          :vo.estmt_no  
          ,:vo.lawfirm_id
          ,:vo.estmt_name
          ,:vo.estmt_cont	
          ,SYSDATE 
          ,:vo.reg_id
          ,:vo.reg_nm
        )
    ]]>
  </statement>
</query>

<!-- 로펌평가  리스트 -->
<query id="las.lawservice.listLawfirmEstimate" isCamelCase="false">
  <statement>
    <![CDATA[
		SELECT 
		   	A.ESTMT_NO
			, A.LAWFIRM_ID	
			, A.ESTMT_NAME	
			, A.ESTMT_CONT	
         	, TO_CHAR(A.REG_DT, 'YYYY-MM-DD') AS REG_DT
         	, A.REG_ID
         	, A.REG_NM
         	, B.FILE_ID
         	, B.FILE_PATH
         	, B.REF_KEY
         	, B.ORG_FILE_NM
         	, B.FILE_SZ
       FROM 
       		TN_LAS_LAWFIRM_ESTIMATION A
          ,(SELECT * FROM TN_COM_ATTACH WHERE FILE_MIDCLSFCN = 'F00506') B 
       WHERE A.ESTMT_NO = B.REF_KEY(+) 
       		AND A.LAWFIRM_ID =  :vo.lawfirm_id     
          AND B.DEL_YN(+) = 'N' 
       ORDER BY A.REG_DT DESC 
       
    ]]>
  </statement>
</query>

<query id="las.lawservice.getMaxfirmEstimateNo" isCamelCase="false">
  <statement>
    <![CDATA[
	SELECT	ISNULL(TO_CHAR(MAX(TO_NUMBER(ESTMT_NO))+1),'1') ESTMT_NO
				  FROM	TN_LAS_LAWFIRM_ESTIMATION 
    ]]>
  </statement>
</query>

<!-- 로펌평가 수정 -->
<query id="las.lawservice.modifyLawfirmEstimate" isCamelCase="false">
  <statement>
    <![CDATA[
         UPDATE TN_LAS_LAWFIRM_ESTIMATION
          SET 
		   	 ESTMT_NO 			= :vo.estmt_no
			,LAWFIRM_ID			= :vo.lawfirm_id
			,ESTMT_NAME			= :vo.estmt_name
			,ESTMT_CONT			= :vo.estmt_cont
        WHERE  LAWFIRM_ID = :vo.lawfirm_id 
        AND ESTMT_NO = :vo.estmt_no 
    ]]>
  </statement>
</query>

<!-- 로펌평가 삭제 -->
<query id="las.lawservice.deleteLawfirmEstimate">
	<statement>
           <![CDATA[
               DELETE FROM  TN_LAS_LAWFIRM_ESTIMATION
               WHERE  LAWFIRM_ID = :vo.lawfirm_id 
               AND ESTMT_NO = :vo.estmt_no 
           ]]>
	</statement>
</query>

<!-- 소속 변호사  리스트 -->
<query id="las.lawservice.getListLawfirmLawywer" isCamelCase="false">
  <statement>
    <![CDATA[

		SELECT 
  				LWR_NO,
  				LWR_NM,
  				FIRST_NAME,
  				LAST_NAME,
  				REG_DT
       FROM 
       		TN_LAS_LAWYERMNG   
      WHERE DEL_YN = 'N' 
        AND LWR_NO IN (SELECT LWR_NO FROM TN_LAS_LAWFIRM_LAWYER WHERE LAWFIRM_ID =  :vo.lawfirm_id )     
       ORDER BY REG_DT DESC 
       
    ]]>
  </statement>
</query>

<!-- 로펌관리 수정 -->
<query id="las.lawservice.modifyLawfirmManage" isCamelCase="false">
  <statement>
    <![CDATA[
         UPDATE TN_LAS_LAWFIRMMNG
          SET 
          		Lawfirm_NM = :vo.lawfirm_nm
              , FST_CNTRTDAY = :vo.fst_cntrtday
              , RPRSNT_TEL = :vo.rprsnt_tel
              , RPRSNT_FAX = :vo.rprsnt_fax
              , RPRSNT_EMAIL = :vo.rprsnt_email
              , HOMEPAGE = :vo.homepage
              , STATE_GBN = :vo.state_gbn
              , ADDR = :vo.addr
              , MAINFTRE_ESTMT = :vo.mainftre_estmt
              , BANK_ADDR = :vo.bank_addr
              , BANK_NM = :vo.bank_nm
              , ACCNT_NO = :vo.accnt_no
              , BANK_NOTE = :vo.bank_note
              , LOG_YMD = :vo.log_ymd
              , MOD_DT = SYSDATE 
              , MOD_ID = :vo.mod_id
              , MOD_NM = :vo.mod_nm
              , FST_EVENT_NO = :vo.fst_event_no 
         WHERE  LAWFIRM_ID = :vo.lawfirm_id 
    ]]>
  </statement>
</query>

<!-- 로펌관리 삭제 : DEL_YN을 업데이트 -->
	<query id="las.lawservice.deleteLawfirmManage">
		<statement>
            <![CDATA[
                UPDATE  TN_LAS_LAWFIRMMNG
                   SET  DEL_YN = 'Y' 
	        	      , DEL_DT = SYSDATE 
    	        	  , DEL_ID = :vo.del_id
        	     	  , DEL_NM = :vo.del_nm 
                 WHERE  LAWFIRM_ID = :vo.lawfirm_id 
            ]]>
		</statement>
		</query>
    </queries>
</queryservice>