<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
    	<!-- Library 목록 -->
        <query id="las.contract.listLibrary" isCamelCase="false">
            <statement>
            <![CDATA[
            SELECT *
              FROM ( SELECT rownum RN, t.*, COUNT(1) over() TOTAL_CNT
                     FROM (
                        SELECT	INFO_GBN
						        ,SEQNO
						        ,LIB_GBN
						        ,TITLE
						        ,CONT
						        ,USAGE
						        ,RDCNT
						        ,RD_AUTH
						        ,TO_CHAR(REG_DT, 'YYYY-MM-DD') AS REG_DT
						        ,REG_ID
						        ,REG_NM
						        ,REG_DEPT
						        ,REG_DEPT_NM
						        ,TO_CHAR(MOD_DT, 'YYYY-MM-DD') AS MOD_DT
						        ,MOD_ID
						        ,MOD_NM
						        ,DEL_YN
						        ,DEL_DT
						        ,DEL_ID
						        ,DEL_NM
                         FROM TN_LAS_CONTRACT_LIBRARY
                         WHERE INFO_GBN = :vo.info_gbn
                           AND DEL_YN   = 'N'
                         #if (!$vo.srch_start_dt.equals(""))
                         	AND REG_DT >= TO_DATE(:vo.srch_start_dt,'YYYY-MM-DD')
                         #end
                         #if (!$vo.srch_end_dt.equals(""))
							AND REG_DT <= TO_DATE(:vo.srch_end_dt,'YYYY-MM-DD')+1
                         #end
						 #if (!$vo.srch_name.equals(""))
	                         #if ($vo.srch_combo.equals("title"))
	                            AND TITLE LIKE '%' + :vo.srch_name + '%'
	                         #else
	                            AND CONT LIKE '%' + :vo.srch_name + '%'
	                         #end
	                     #end
	                     #if (!$vo.srch_lib_gbn.equals(""))
							AND	LIB_GBN = :vo.srch_lib_gbn
						 #end
						 #if ($vo.info_gbn.equals("C00403"))
							 #if (!$vo.top_role.equals("A"))
							 	AND RD_AUTH = 'C00502'
							 #end
            			 #end
                         ORDER BY REG_DT DESC
                         ) t
            		ORDER BY RN 
            		)
            WHERE RN between :vo.start_index and :vo.end_index
            ]]>
            </statement>
        </query>
        
        <!-- Library 상세 -->
        <query id="las.contract.getLibrary" isCamelCase="false">
            <statement>
            <![CDATA[
				SELECT	 A.INFO_GBN
				        ,A.SEQNO
				        ,A.LIB_GBN
					#if ($vo.session_user_locale.equals("ko"))
						,B.CD_NM LIB_GBNNM
					#elseif ($vo.session_user_locale.equals("fr"))
				 	  	,B.CD_NM_FRA LIB_GBNNM
				 	#elseif ($vo.session_user_locale.equals("de"))
				 	  	,B.CD_NM_DEU LIB_GBNNM
				 	#elseif ($vo.session_user_locale.equals("it"))
				 	  	,B.CD_NM_ITA LIB_GBNNM
				 	#elseif ($vo.session_user_locale.equals("es"))
				 	  	,B.CD_NM_ESP LIB_GBNNM
					#else
						,B.CD_NM_ENG LIB_GBNNM
					#end
				        ,A.TITLE
				        ,A.CONT
				        ,A.USAGE
				        ,A.RDCNT
				        ,A.RD_AUTH
						,TO_CHAR(A.REG_DT, 'YYYY-MM-DD') AS REG_DT
				        ,A.REG_ID
				        ,A.REG_NM
				        ,A.REG_DEPT
				        ,A.REG_DEPT_NM
				        ,A.MOD_DT
				        ,A.MOD_ID
				        ,A.MOD_NM
				        ,A.DEL_YN
				        ,A.DEL_DT
				        ,A.DEL_ID
				        ,A.DEL_NM
				  FROM	TN_LAS_CONTRACT_LIBRARY A, TB_COM_CD B
				 WHERE	A.INFO_GBN = B.GRP_CD(+)
				   AND  A.LIB_GBN  = B.CD
				   AND  A.INFO_GBN = :vo.info_gbn
				   AND  A.SEQNO    = :vo.seqno
				   AND  B.SYS_CD   = 'LAS'
				   AND	A.DEL_YN   = 'N'
				   AND	B.USE_YN   = 'Y'  
            ]]>
            </statement>
        </query>
        
        <!-- Library 등록 -->
		<query id="las.contract.insertLibrary" isCamelCase="false">
			<statement>
			<![CDATA[
				INSERT INTO TN_LAS_CONTRACT_LIBRARY  
							(
					           INFO_GBN
					         , SEQNO
					         , LIB_GBN
					         , TITLE
					         , CONT
					         , USAGE
					         , RDCNT
					         , RD_AUTH
					         , REG_DT
					         , REG_ID
					         , REG_NM
					         , REG_DEPT
					         , REG_DEPT_NM
					         , DEL_YN
					        ) VALUES (
					           :vo.info_gbn
					          ,:vo.seqno
					          ,:vo.lib_gbn
					          ,:vo.title
					          ,:vo.cont
					          ,:vo.usage
					          ,0
					          ,:vo.rd_auth
					          ,GETDATE()
					          ,:vo.reg_id
					          ,:vo.reg_nm
					          ,:vo.reg_dept
					          ,:vo.reg_dept_nm
					          ,'N'
					        )
			]]>
			</statement>
		</query>
		
		<query id="las.contract.modifyLibrary" isCamelCase="false">
			<statement>
			<![CDATA[
				UPDATE	TN_LAS_CONTRACT_LIBRARY
				   SET	 LIB_GBN = :vo.lib_gbn
				   		,TITLE   = :vo.title  
						,CONT    = :vo.cont
						,USAGE   = :vo.usage
						,RD_AUTH = :vo.rd_auth
						,MOD_DT  = GETDATE()    
						,MOD_ID  = :vo.mod_id 
						,MOD_NM  = :vo.mod_nm         
				WHERE	INFO_GBN = :vo.info_gbn
				  AND	SEQNO    = :vo.seqno
				  AND	DEL_YN   = 'N'
			]]>
			</statement>
		</query>        
		
		<!-- Library 삭제 -->
		<query id="las.contract.deleteLibrary" isCamelCase="false">
			<statement>
			<![CDATA[
				UPDATE	TN_LAS_CONTRACT_LIBRARY
				   SET   DEL_YN  = 'Y'
				        ,DEL_DT  = GETDATE()
				        ,DEL_ID  = :vo.del_id
				        ,DEL_NM  = :vo.del_nm
				WHERE	INFO_GBN = :vo.info_gbn
				  AND	SEQNO    = :vo.seqno
				  AND	DEL_YN   = 'N'
			]]>
			</statement>
		</query>
		
		<!-- Library RDCNT Increase -->
		<query id="las.contract.increseRdcnt" isCamelCase="false">
            <statement>
            <![CDATA[
                UPDATE  TN_LAS_CONTRACT_LIBRARY
                   SET  RDCNT = RDCNT + 1
                 WHERE	INFO_GBN = :vo.info_gbn
				   AND	SEQNO    = :vo.seqno
				   AND	DEL_YN   = 'N'
            ]]>
            </statement>
        </query>
		
		<!-- Library MAX Sequence -->
		<query id="las.contract.makeSeqLibrary" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT	ISNULL(MAX(SEQNO)+1,1) NEXT_SEQNO
				  FROM	TN_LAS_CONTRACT_LIBRARY
				 WHERE	INFO_GBN = :vo.info_gbn
			]]>
			</statement>
		</query>

		<!-- 표준 조항 권한 체크 정보  -->
		<query id="las.lawinformation.authLibrary" isCamelCase="false">
		  	<statement>
			    <![CDATA[
					SELECT	INFO_GBN, SEQNO, TITLE, CONT, RDCNT
						  , TO_CHAR(REG_DT, 'YYYYMMDD') AS REG_DT, REG_ID, REG_NM
					FROM 	TN_LAS_CONTRACT_LIBRARY
					WHERE	INFO_GBN = :vo.info_gbn
					  AND   SEQNO = :vo.seqno
			    ]]>
		  	</statement>
		</query>
		
		
        <!-- *************************************************************
        *****                        가이드라인(교육)                   *****
        *************************************************************  -->
		<!-- 페이징 리스트 조회 -->
		<query id="las.contract.listGuidenedu" isCamelCase="false" isDynamic="true">
			<statement>
            <![CDATA[
            SELECT *
              FROM ( SELECT ROW_NUMBER() OVER (ORDER BY SEQNO DESC) RN, 
              			t.*, CAST(COUNT(1) over() AS NUMERIC) TOTAL_CNT
                     FROM (
		                SELECT INFO_GBN       
                              ,SEQNO              
                              ,TITLE             
                              ,CONT             
                              ,RDCNT           
                              ,CONVERT(CHAR(10), REG_DT, 23) AS REG_DT /*YYYY-MM-DD*/
                              ,REG_ID         
                              ,REG_NM          
                              ,REG_DEPT        
                              ,REG_DEPT_NM     
                              ,CONVERT(CHAR(10), MOD_DT, 23) AS MOD_DT /*YYYY-MM-DD*/
                              ,MOD_ID          
                              ,MOD_NM         
                              ,DEL_YN          
                              ,DEL_DT             
                              ,DEL_ID           
                              ,DEL_NM      
                  		  FROM TN_LAS_CONTRACT_GUIDENEDU	
                         WHERE INFO_GBN = :vo.info_gbn
                         	#if(!$vo.session_auth_comp_cd.equals(""))
								AND COMP_CD IN ($vo.session_auth_comp_cd)
							#end
                           	AND DEL_YN  = 'N'
                         #if (!$vo.srch_start_dt.equals(""))
							AND REG_DT >= CONVERT(DATETIME, REPLACE( :vo.srch_start_dt ,'-',''), 112) /*YYYY-MM-DD*/
                         #end
                         #if (!$vo.srch_end_dt.equals(""))
							AND REG_DT <= CONVERT(DATETIME, REPLACE( :vo.srch_end_dt ,'-',''), 112)+1 /*YYYY-MM-DD*/
                         #end
						 #if (!$vo.srch_word.equals(""))
	                         #if ($vo.srch_type.equals("title"))
	                            AND TITLE LIKE '%' + :vo.srch_word + '%'
	                         #else
	                         	#if ($vo.srch_type.equals("reg_nm"))
	                         		AND REG_NM LIKE '%' + :vo.srch_word + '%'
	                         	#else
	                            	AND CONT LIKE '%' + :vo.srch_word + '%'
	                            #end
	                         #end
	                     #end
                         
                         ) t
            		)TA
            WHERE RN between :vo.start_index and :vo.end_index
            ORDER BY RN 
            ]]>
			</statement>
		</query>		
					
		<query id="las.contract.getGuidenedu" isCamelCase="false">
			<statement>
			<![CDATA[
			SELECT INFO_GBN       
                  ,SEQNO              
                  ,TITLE             
                  ,CONT             
                  ,RDCNT           
                  ,CONVERT(CHAR(10), A.REG_DT, 23) AS REG_DT /*YYYY-MM-DD*/	
                  ,REG_ID         
                  ,REG_NM   
				  ,JIKGUP_NM
				  ,DEPT_NM
                  ,REG_DEPT        
                  ,REG_DEPT_NM     
                  ,CONVERT(CHAR(10), MOD_DT, 23) AS MOD_DT /*YYYY-MM-DD*/
                  ,MOD_ID          
                  ,MOD_NM         
                  ,DEL_YN          
                  ,DEL_DT             
                  ,DEL_ID           
                  ,DEL_NM         
			  FROM TN_LAS_CONTRACT_GUIDENEDU A LEFT OUTER JOIN
			  	  TB_COM_USER B
			  	  ON A.REG_ID  = B.USER_ID 
			 WHERE INFO_GBN  = :vo.info_gbn
			   AND SEQNO 	 = :vo.seqno
			   	#if(!$vo.session_auth_comp_cd.equals(""))
					AND A.COMP_CD IN ($vo.session_auth_comp_cd)
				#end
			   AND DEL_YN 	 = 'N'
			   
			]]>
			</statement>
		</query>			
		<!-- 가이드라인.교육등록 -->				
		<query id="las.contract.insertGuidenedu">
			<statement>
			<![CDATA[
				INSERT INTO TN_LAS_CONTRACT_GUIDENEDU
				      (
			           INFO_GBN        --정보_구분   
                      ,SEQNO           --일련번호
                      ,COMP_CD    	   --사별코드
                      ,TITLE           --제목        
                      ,CONT            --내용        
                      ,RDCNT           --조회수      
                      ,REG_DT          --등록_일시   
                      ,REG_ID          --등록자_ID   
                      ,REG_NM          --등록자_명   
                      ,REG_DEPT        --등록_부서   
                      ,REG_DEPT_NM     --등록_부서_명
                      ,DEL_YN          --삭제_여부   
					  )
				VALUES (
			           :vo.info_gbn       
                      ,:vo.seqno
                      ,#if(!$vo.session_auth_comp_cd.equals(""))
							($vo.session_auth_comp_cd)
						#else
						''
						#end    
                      ,:vo.title          
                      ,:vo.cont           
                      ,:vo.rdcnt          
                      ,GETDATE()         
                      ,:vo.reg_id         
                      ,:vo.reg_nm         
                      ,:vo.reg_dept       
                      ,:vo.reg_dept_nm    
                      ,'N'      
				)
			]]>
			</statement>
		</query>  
		<!-- 가이드라인.교육수정 -->				
		<query id="las.contract.modifyGuidenedu">
			<statement>
			<![CDATA[
				UPDATE TN_LAS_CONTRACT_GUIDENEDU
				SET		TITLE	=:vo.title 
						,CONT	=:vo.cont
						,MOD_DT	=GETDATE()
						,MOD_ID	=:vo.mod_id 
						,MOD_NM	=:vo.mod_nm
				WHERE SEQNO 	= :vo.seqno
				#if(!$vo.session_auth_comp_cd.equals(""))
					AND COMP_CD IN ($vo.session_auth_comp_cd)
				#end
				  AND INFO_GBN 	= :vo.info_gbn				
				  AND DEL_YN = 'N'			
			]]>
			</statement>
		</query> 		
		<!-- 가이드라인.교육삭제 -->				
		<query id="las.contract.deleteGuidenedu">
			<statement>
			<![CDATA[
				UPDATE 	TN_LAS_CONTRACT_GUIDENEDU
				SET		DEL_YN = 'Y',
						DEL_DT = GETDATE(),
						DEL_ID = :vo.del_id,
						DEL_NM = :vo.del_nm				
				WHERE 	SEQNO = :vo.seqno
				#if(!$vo.session_auth_comp_cd.equals(""))
					AND COMP_CD IN ($vo.session_auth_comp_cd)
				#end 
				AND		INFO_GBN 	= :vo.info_gbn		
				AND 	DEL_YN 		= 'N'	
			]]>
			</statement>
		</query>  	
		<!-- 가이드라인.교육삭제 -->				
		<query id="las.contract.deleteGuideline">
			<statement>
			<![CDATA[
				DELETE
				FROM 	TN_LAS_CONTRACT_GUIDENEDU
				WHERE 	SEQNO = :vo.seqno
				#if(!$vo.session_auth_comp_cd.equals(""))
					AND COMP_CD IN ($vo.session_auth_comp_cd)
				#end
				AND		INFO_GBN = :vo.info_gbn		
				AND 	DEL_YN = 'N'							
			]]>
			</statement>
		</query>  
		<!-- read count update -->		
		<query id="las.contract.increseGuideneduRdcnt">
			<statement>
			<![CDATA[
				UPDATE 	TN_LAS_CONTRACT_GUIDENEDU
				SET		RDCNT = RDCNT + 1
				WHERE 	SEQNO = :vo.seqno
				#if(!$vo.session_auth_comp_cd.equals(""))
					AND COMP_CD IN ($vo.session_auth_comp_cd)
				#end
				AND		INFO_GBN = :vo.info_gbn		
			]]>
			</statement>
		</query> 	
		
		<!-- Guidenedu MAX Sequence -->
		<query id="las.contract.makeSeqGuidenedu" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT	ISNULL(MAX(SEQNO)+1,1) NEXT_SEQNO
				  FROM	TN_LAS_CONTRACT_GUIDENEDU
				 WHERE	INFO_GBN = :vo.info_gbn
			]]>
			</statement>
		</query>

		<!-- 표준 조항 권한 체크 정보  -->
		<query id="las.lawinformation.authGuidenedu" isCamelCase="false">
		  	<statement>
			    <![CDATA[
					SELECT	INFO_GBN, SEQNO, TITLE, CONT, RDCNT
							, CONVERT(NVARCHAR, REG_DT, 112) AS REG_DT /*YYYYMMDD*/
							, REG_ID
							, REG_NM
					FROM 	TN_LAS_CONTRACT_GUIDENEDU
					WHERE	INFO_GBN = :vo.info_gbn
					#if(!$vo.session_auth_comp_cd.equals(""))
						AND COMP_CD IN ($vo.session_auth_comp_cd)
					#end
					  	AND SEQNO = :vo.seqno
			    ]]>
		  	</statement>
		</query>
    </queries>
</queryservice>