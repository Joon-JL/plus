<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
		 <query id="las.mainLawInfo.list" isCamelCase="false">
		  <statement>
		    <![CDATA[
		 SELECT *
		     FROM ( SELECT ROW_NUMBER() OVER (ORDER BY SEQNO DESC) RN, 
		     		t.*, CAST(COUNT(1) over() AS NUMERIC) TOTAL_CNT
		            FROM (    
				   SELECT 	 INFO_GBN
					        ,SEQNO
					        ,LAW_GBN
					        ,TITLE
					        ,CONT
					        ,DMSTFRGN_GBN
					        ,RDCNT
					        ,TRGT_NATION
					        ,CONVERT(CHAR(10), REG_DT, 23) AS REG_DT /*YYYY-MM-DD*/
					        ,REG_ID
					        ,REG_NM
					        ,REG_DEPT
					        ,REG_DEPT_NM
					        ,CONVERT(CHAR(10), MOD_DT, 23) AS MOD_DT /*YYYY-MM-DD*/
					        ,MOD_ID
					        ,MOD_NM
					        ,DEL_YN
					        ,DEL_DT
					        ,DEL_ID
					        ,DEL_NM
				    FROM TN_LAS_MAINLAW_INFO
		     	   		 WHERE INFO_GBN = :vo.info_gbn
		     	   	#if(!$vo.session_auth_comp_cd.equals(""))
						AND COMP_CD IN ($vo.session_auth_comp_cd)
					#end
                   		 AND DEL_YN   	= 'N'
                    #if (!$vo.srch_start_dt.equals(""))
                		AND REG_DT >= CONVERT(DATETIME, REPLACE( :vo.srch_start_dt ,'-','') , 112) /*YYYY-MM-DD*/
            		#end
            		#if (!$vo.srch_end_dt.equals(""))
            			AND REG_DT <= CONVERT(DATETIME, REPLACE( :vo.srch_end_dt ,'-',''), 112)+1 /*YYYY-MM-DD*/
           		    #end
           		    #if (!$vo.srch_nation.equals(""))
               			AND TRGT_NATION = :vo.srch_nation
           			#end
                   	#if (!$vo.srch_mainlawexam.equals(""))
               			  AND LAW_GBN = :vo.srch_mainlawexam
           		    #end
                   	#if (!$vo.srch_dmstfrgn_gbn.equals(""))
               			  AND DMSTFRGN_GBN = :vo.srch_dmstfrgn_gbn
           		    #end
           			#if (!$vo.srch_name.equals(""))
                		#if ($vo.srch_combo.equals("title"))
                    		AND TITLE LIKE '%' + :vo.srch_name + '%'
			            #end
			            #if ($vo.srch_combo.equals("cont"))
                     		AND cont LIKE '%' + :vo.srch_name + '%'
			            #end
			            #if ($vo.srch_combo.equals("reg_nm"))
                     		AND reg_nm LIKE '%' + :vo.srch_name + '%'
			            #end
                    #end
            ) t
            ) TA 
       	  WHERE RN between :vo.start_index and :vo.end_index
       	  ORDER BY RN
        ]]>
		  </statement>
		</query>
  

		<query id="las.mainLawInfo.insert" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    INSERT INTO TN_LAS_MAINLAW_INFO (
		                INFO_GBN
		               , SEQNO
		               , COMP_CD
		               , LAW_GBN 
		               , TITLE
		               , CONT
		               , DMSTFRGN_GBN
		               , RDCNT
		               , TRGT_NATION
		               , REG_DT
		               , REG_ID
		               , REG_NM
		               , REG_DEPT
		               , REG_DEPT_NM
		               , DEL_YN
		        ) VALUES (
		           :vo.info_gbn
		          ,:vo.seqno
		          ,#if(!$vo.session_auth_comp_cd.equals(""))
						($vo.session_auth_comp_cd)
					#else
						''
					#end
		          ,:vo.law_gbn
		          ,:vo.title
		          ,:vo.cont
		          ,:vo.dmstfrgn_gbn
		          ,0
		          ,:vo.trgt_nation
		          ,GETDATE()
		          ,:vo.reg_id
		          ,:vo.reg_nm
		          ,:vo.reg_dept
		          ,:vo.reg_dept_nm
		          ,'N'
		        )
		    ]]>
		  </statement>
		</query>


	<query id="las.mainLawInfo.modifyMainLawInfo" isCamelCase="false">
	  <statement>
	    <![CDATA[
	    UPDATE TN_LAS_MAINLAW_INFO
	     SET   LAW_GBN 		= :vo.law_gbn
	     	  ,TITLE   		= :vo.title 
	          ,CONT    		= :vo.cont
	          ,DMSTFRGN_GBN = :vo.dmstfrgn_gbn
	          ,TRGT_NATION 	= :vo.trgt_nation
	          ,MOD_DT  		= GETDATE() 
	          ,MOD_ID  		= :vo.mod_id 
	          ,MOD_NM  		= :vo.mod_nm 
	 	WHERE	INFO_GBN 	= :vo.info_gbn
		AND		SEQNO    	= :vo.seqno
		#if(!$vo.session_auth_comp_cd.equals(""))
			AND COMP_CD IN ($vo.session_auth_comp_cd)
		#end
		AND		DEL_YN   	= 'N'
	    ]]>
	  </statement>
	</query>

 		 <!-- 주요입법동향 삭제 -->
		<query id="las.mainLawInfo.deleteMainLawInfo" isCamelCase="false">
		  <statement>
		    <![CDATA[
		         
		        UPDATE TN_LAS_MAINLAW_INFO
		           SET   DEL_YN  = 'Y'
				        ,DEL_DT  = GETDATE()
				        ,DEL_ID  = :vo.del_id
				        ,DEL_NM  = :vo.del_nm
				WHERE	INFO_GBN = :vo.info_gbn
				  	AND	SEQNO    = :vo.seqno
				#if(!$vo.session_auth_comp_cd.equals(""))
					AND COMP_CD IN ($vo.session_auth_comp_cd)
				#end
				  	AND	DEL_YN   = 'N'
		    ]]>
		  </statement>
		</query>
		
		
		  <!-- 주요입법동향 상세 -->
        <query id="las.mainLawInfo.detailMainLawInfo" isCamelCase="false">
            <statement>
            <![CDATA[
				SELECT	     A.INFO_GBN
					        ,A.SEQNO
					        ,A.LAW_GBN
					        ,A.TITLE
					        ,A.CONT
					        ,A.DMSTFRGN_GBN
					        ,A.RDCNT
					        ,A.TRGT_NATION
					        ,CONVERT(CHAR(10), A.REG_DT, 23) AS REG_DT /*YYYY-MM-DD*/
					        ,A.REG_ID
					        ,A.REG_NM
						    ,JIKGUP_NM
						    ,DEPT_NM
					        ,A.REG_DEPT
					        ,A.REG_DEPT_NM
					        ,A.MOD_DT
					        ,A.MOD_ID
					        ,A.MOD_NM
					        ,A.DEL_YN   
					        ,A.DEL_DT
					        ,A.DEL_ID
					        ,A.DEL_NM
					        ,CASE 
					        	WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM 
					        	WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_FRA
					        	WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_DEU
					        	ELSE B.CD_NM_ENG
					        END AS NATION_NM
					        ,CASE 
					        	WHEN :vo.session_user_locale = 'ko' THEN C.CD_NM 
					        	WHEN :vo.session_user_locale = 'fr' THEN C.CD_NM_FRA
					        	WHEN :vo.session_user_locale = 'de' THEN C.CD_NM_DEU
					        	ELSE C.CD_NM_ENG
					        END AS BRANCH_NM
					        /* ,B.CD_NM AS NATION_NM */
					        /* ,C.CD_NM AS BRANCH_NM */
				   FROM	TN_LAS_MAINLAW_INFO A LEFT OUTER JOIN 
				  		(SELECT * 
		                   FROM TB_COM_CD
		                  WHERE GRP_CD = 'L2'
		                    AND SYS_CD = 'LAS'
		                    AND	USE_YN   = 'Y') B
						ON A.TRGT_NATION = B.CD
						LEFT OUTER JOIN 
		                (SELECT * 
	                       FROM TB_COM_CD
	                      WHERE GRP_CD = :vo.info_gbn) C
						ON A.LAW_GBN  = C.CD
						LEFT OUTER JOIN   
	                    TB_COM_USER D
	                    ON A.REG_ID   = D.USER_ID
				  WHERE A.INFO_GBN = :vo.info_gbn   
					AND  A.SEQNO    = :vo.seqno
					#if(!$vo.session_auth_comp_cd.equals(""))
						AND A.COMP_CD IN ($vo.session_auth_comp_cd)
					#end
					AND	(A.DEL_YN   = 'N' OR A.DEL_YN IS NULL) 
					
            ]]>
            </statement>
        </query>
        
		
		
				<!-- 주요입법동향 RDCNT Increase -->
		<query id="las.mainLawInfo.increseRdcnt" isCamelCase="false">
            <statement>
            <![CDATA[
                UPDATE  TN_LAS_MAINLAW_INFO
                   SET  RDCNT = RDCNT + 1
                 WHERE	INFO_GBN = :vo.info_gbn
				   AND	SEQNO    = :vo.seqno
				   #if(!$vo.session_auth_comp_cd.equals(""))
						AND COMP_CD IN ($vo.session_auth_comp_cd)
					#end
				   AND	DEL_YN   = 'N'
            ]]>
            </statement>
        </query>
        
        		<!-- Library MAX Sequence -->
		<query id="las.mainLawInfo.makeSeqmainLawInfo" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT	ISNULL(MAX(SEQNO)+1,1) NEXT_SEQNO
				  FROM	TN_LAS_MAINLAW_INFO
				 WHERE	INFO_GBN = :vo.info_gbn
			]]>
			</statement>
		</query>
		
		
		<!-- 주요입법동향 목록을 조회(법무메인) -->
		 <query id="las.mainLawInfo.listByMain" isCamelCase="false">
		  <statement>
		    <![CDATA[
				SELECT * FROM 
				( 
					SELECT ROW_NUMBER() OVER (ORDER BY SEQNO DESC) RN, t.*, COUNT(1) over() TOTAL_CNT FROM 
					(
						SELECT 
							INFO_GBN 
							,SEQNO 
							,LAW_GBN 
							,TITLE 
							,CONT 
							,DMSTFRGN_GBN 
							,RDCNT 
							,TRGT_NATION 
							,CONVERT(CHAR(10),REG_DT,23) AS REG_DT /*YYYY-MM-DD*/ 
							,REG_ID 
							,REG_NM 
							,REG_DEPT 
							,REG_DEPT_NM 
							,CONVERT(CHAR(10),MOD_DT,23) AS MOD_DT /*YYYY-MM-DD*/ 
							,MOD_ID 
							,MOD_NM 
							,DEL_YN 
							,DEL_DT 
							,DEL_ID 
							,DEL_NM
							,CASE WHEN REG_DT > GETDATE()-14 THEN 'NEW' ELSE '' END NEW_YN
						FROM TN_LAS_MAINLAW_INFO
						WHERE
							INFO_GBN = :vo.info_gbn
							#if(!$vo.session_auth_comp_cd.equals(""))
								AND COMP_CD IN ($vo.session_auth_comp_cd)
							#end
							AND DEL_YN = 'N'
						ORDER BY SEQNO DESC
					) t 
					ORDER BY RN 
				) WHERE RN between :vo.start_index and :vo.end_index
        	]]>
		  </statement>
		</query>		

		<!-- 표준 조항 권한 체크 정보  -->
		<query id="las.lawinformation.authMainLawInfo" isCamelCase="false">
		  <statement>
		    <![CDATA[
			SELECT	INFO_GBN, SEQNO, LAW_GBN, TITLE, CONT, DMSTFRGN_GBN, RDCNT, TRGT_NATION
				  , REPLACE(CONVERT(CHAR(10), REG_DT, 23),'-','') AS REG_DT /*YYYYMMDD*/
				  , REG_ID, REG_NM
			FROM 	TN_LAS_MAINLAW_INFO
			WHERE	INFO_GBN = :vo.info_gbn
			  	AND	SEQNO    = :vo.seqno
			#if(!$vo.session_auth_comp_cd.equals(""))
				AND COMP_CD IN ($vo.session_auth_comp_cd)
			#end
		    ]]>
		  </statement>
		</query>
        
    </queries>
</queryservice>
