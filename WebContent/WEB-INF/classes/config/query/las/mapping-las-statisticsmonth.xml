<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
		<query id="las.statisticsmonth.selectStatistics" isCamelCase="false" isDynamic="true">
		  <statement>
		    <![CDATA[
			    SELECT 
			      	 COUNT(1) TOTAL_CNT 
			    FROM TN_LAS_ETC_MONTHDUTY A
			    WHERE A.DEL_YN = 'N'
					A.COMP_CD = :vo.session_comp_cd
			    #if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
			    AND	SUBSTRING(CONVERT(VARCHAR, A.REG_DT, 112),1,6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
			    #end
                AND	A.REG_ID = :vo.session_user_id      
		    ]]>
		  </statement>
		</query>

		<query id="las.statisticsmonth.listRespman" isCamelCase="false" isDynamic="true">
		  <statement>
		    <![CDATA[
            	SELECT *                                           
                  FROM(                                            
                    SELECT 
                    	   ROW_NUMBER() OVER(ORDER BY A.RESPMAN_NM DESC) RM                             
                          ,COUNT(1) OVER() TOTAL_CNT               
                          ,A.*                                     
                      FROM 	( 
							SELECT 
							        DISTINCT 
							        RESPMAN_ID,
							        RESPMAN_NM
							FROM TN_LAS_SPEAKCONSULT
							WHERE RESPMAN_ID IS NOT NULL
							AND   	DEL_YN = 'N'
							AND		COMP_CD = :vo.session_comp_cd
														
							#if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
							AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112),1,6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
							#else
							AND SUBSTRING(CONVERT(VARCHAR, REG_DT, 112),1,6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112),1,6)
							#end
						    #if (!$vo.display_yn.equals("Y"))
                            	AND WEEKDUTYYN='Y'
                            #end
                            #if (!$vo.display_conf_yn.equals("Y") && $vo.reg_id.equals(""))
                            	AND CONF_WEEKDUTYYN='Y'	
                            #end 							 
							                            							 
							UNION
							SELECT 
							        DISTINCT A.RESPMAN_ID,
							        A.RESPMAN_NM
							FROM 	TN_CLM_CONT_CNSDREQ_RESPMAN A,
									TN_CLM_CONTRACT_CNSD B,
									TN_CLM_CONT_CNSDREQ C,
									TN_CLM_CONTRACT_MASTER D,
									(
									SELECT	DISTINCT CNSDREQ_ID, CNTRT_ID, MONTHDUTYYN, CONF_MONTHDUTYYN 
									FROM	TN_CLM_CONTRACT_DEPTCNSD
									) E
							WHERE 	A.RESPMAN_ID IS NOT NULL 
							AND		A.CNSDREQ_ID = B.CNSDREQ_ID
							AND		B.CNSDREQ_ID = C.CNSDREQ_ID 
							AND    	C.DEL_YN 	 = 'N'
							AND     D.CNTRT_ID 	 = B.CNTRT_ID 
							AND     B.CNTRT_ID 	 = E.CNTRT_ID 
							AND     B.CNSDREQ_ID = E.CNSDREQ_ID 
							AND		B.COMP_CD	 = :vo.session_comp_cd
							AND		C.COMP_CD	 = :vo.session_comp_cd
							AND		D.COMP_CD	 = :vo.session_comp_cd 
							#if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
							AND	SUBSTRING(CONVERT(VARCHAR, B.REG_DT, 112),1,6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
							#else
							AND SUBSTRING(CONVERT(VARCHAR, B.REG_DT, 112),1,6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112),1,6)
							#end
								
						    #if (!$vo.display_yn.equals("Y")) 
                               AND 	UPPER(E.MONTHDUTYYN)='Y'
                            #end
                            #if (!$vo.display_conf_yn.equals("Y")  && $vo.reg_id.equals(""))
                               AND 	UPPER(E.CONF_MONTHDUTYYN)='Y'	
                            #end 																				
							UNION

							SELECT  DISTINCT F.RESPMAN_ID,
							        F.RESPMAN_NM							        
							FROM    TN_LAS_CONSULT DD,
							        (
				     
							        SELECT  CNSLT_NO,
							                HSTRY_NO 
							        FROM	TN_LAS_CONSULT	
							        WHERE   1 = 1
							        AND		COMP_CD	 = :vo.session_comp_cd
							        AND     DEL_YN = 'N'
								    #if (!$vo.display_yn.equals("Y"))
		                            	AND WEEKDUTYYN='Y'
		                            #end
		                            #if (!$vo.display_conf_yn.equals("Y") && $vo.reg_id.equals(""))
		                            	AND CONF_WEEKDUTYYN='Y'	
		                            #end 
		                            						        
									#if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
									AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112),1,6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
									#else
									AND SUBSTRING(CONVERT(VARCHAR, REG_DT, 112),1,6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112),1,6)
									#end							        
					
							        ) EE,
							        TN_LAS_CONSULT_RESPMAN F
							WHERE   DD.CNSLT_NO=EE.CNSLT_NO 
							AND     DD.HSTRY_NO=EE.HSTRY_NO
						 	AND   	DD.CNSLT_NO = F.CNSLT_NO
						 	AND 	DD.COMP_CD	= :vo.session_comp_cd
						 	AND 	F.COMP_CD	= :vo.session_comp_cd
													 								
							UNION
							
							SELECT	DISTINCT REG_ID,
									REG_NM
							FROM	TN_LAS_ETC_MONTHDUTY
							WHERE	1=1
							AND     DEL_YN = 'N'
							AND 	COMP_CD	= :vo.session_comp_cd
							#if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
							AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112),1,6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
							#else
							AND SUBSTRING(CONVERT(VARCHAR, REG_DT, 112),1,6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112),1,6) 
							#end	
							
                            #if (!$vo.display_conf_yn.equals("Y"))
                            	AND (MONTHDUTY_RSLTYN='Y' OR MONTHDUTY_PLANYN = 'Y')	
                            #end 
																											                      		    
                        ) A  
                        WHERE A.RESPMAN_NM IS NOT NULL
                         
				    ) B      
		    ]]>
		  </statement>
		</query>
				    
		<query id="las.statisticsmonth.listStatistics" isCamelCase="false" isDynamic="true">
		  <statement>
		    <![CDATA[
            	SELECT *                                           
                  FROM(                                            
                    SELECT ROW_NUMBER() OVER(ORDER BY A.REG_DT DESC) RM                               
                          ,COUNT(1) OVER() TOTAL_CNT               
                          ,A.*                                     
                      FROM 	( 
                      #if ($vo.page_gbn && $vo.page_gbn.equals("C")) 
							SELECT  CASE WHEN :vo.session_user_locale= 'ko' 
										THEN A.CNTRT_NM 
										ELSE ISNULL(A.CNTRT_NM_EN, A.CNTRT_NM) 
									END AS TITLE, 
							        B.REQ_DEPT_NM DEPT_NM, 
							        D.RESPMAN_NM,
							        'TN_CLM_CONTRACT_CNSD' TAB,
							        A.CNTRT_ID + '@' + B.CNSDREQ_ID SEQNO, 
							        A.CNTRT_ID, 
							        ISNULL(B.MAIN_MATR_CONT,' ') CONT, 
							        A.CNTRT_OPPNT_NM COMPANY, 
							        CONVERT(VARCHAR, B.REG_DT, 112) REG_DT,
						            ISNULL(B.MONTHDUTYYN, 'Y') MONTHDUTYYN,
						            ISNULL(B.CONF_MONTHDUTYYN, 'Y') CONF_MONTHDUTYYN 							        
							FROM   TN_CLM_CONTRACT_MASTER A, 
							       (
							       SELECT	TT.CNTRT_ID, 
							              	SS.CNSDREQ_ID, 
							              	E.MAIN_MATR_CONT,
							              	SS.REQ_DEPT_NM, 
							              	TT.REG_DT,
							              	E.MONTHDUTYYN,
							              	E.CONF_MONTHDUTYYN
							       FROM   	TN_CLM_CONT_CNSDREQ SS,  
							              	TN_CLM_CONTRACT_CNSD TT,
											(
											SELECT	CNSDREQ_ID, CNTRT_ID, MONTHDUTYYN, CONF_MONTHDUTYYN,MAIN_MATR_CONT 
											FROM	TN_CLM_CONTRACT_DEPTCNSD
											) E							              	        	
							       WHERE  	SS.CNSDREQ_ID	= TT.CNSDREQ_ID 
							       AND    	SS.DEL_YN 		= 'N'
								   AND      TT.CNTRT_ID 	= E.CNTRT_ID 
								   AND      TT.CNSDREQ_ID	= E.CNSDREQ_ID
								   AND 		SS.COMP_CD		= :vo.session_comp_cd
								   AND 		TT.COMP_CD		= :vo.session_comp_cd					       
							    #if (!$vo.display_yn.equals("Y")) --display_yn가 'Y'이면 전체를 보여주고 아니면 해당건만
	                               AND 		UPPER(E.MONTHDUTYYN)='Y'
	                            #end
	                            #if (!$vo.display_conf_yn.equals("Y"))
	                               AND 		UPPER(E.CONF_MONTHDUTYYN)='Y'	
	                            #end 
                            							       
                     			#if ($vo.result_yn && $vo.result_yn.equals("P"))  								       
							       AND    	SS.PRGRS_STATUS < 'C04205'
							    #end
                     			#if (!$vo.result_yn || $vo.result_yn.equals("R"))								       
							       AND    	SS.PRGRS_STATUS IN ('C04207', 'C04205')
							    #end	
							    #if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
							   		AND	  	SUBSTRING(CONVERT(VARCHAR, TT.REG_DT, 112),1,6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
							    #else 
							   		AND	  	SUBSTRING(CONVERT(VARCHAR, TT.REG_DT, 112),1,6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112),1,6)					   		
							    #end							    							    
							       ) B,
							       TN_CLM_CONT_CNSDREQ_RESPMAN D 
							WHERE 1=1               
							AND	  A.COMP_CD	= :vo.session_comp_cd
							AND   A.CNTRT_ID = B.CNTRT_ID 
						 	AND   B.CNSDREQ_ID = D.CNSDREQ_ID
						#if ($vo.reg_id && !$vo.reg_id.equals(""))						 	
						 	AND   D.RESPMAN_ID = :vo.reg_id	
						#end
						
                     #elseif ($vo.page_gbn && $vo.page_gbn.equals("S"))
							SELECT  DD.TITLE, 
							        DD.REG_DEPT_NM DEPT_NM, 
							        F.RESPMAN_NM,
							        'TN_LAS_CONSULT' TAB,  
							        EE.CNSLT_NO + '@' + CONVERT(VARCHAR, EE.HSTRY_NO) SEQNO, 
							        CONVERT(VARCHAR, EE.HSTRY_NO) CNTRT_ID,
							        ISNULL(DD.MAIN_MATR_CONT, ' ') CONT,
                                 	'' COMPANY,
                                	CONVERT(VARCHAR, DD.REG_DT, 112) REG_DT,
                                	ISNULL(DD.MONTHDUTYYN, 'Y') MONTHDUTYYN,
							        ISNULL(DD.CONF_MONTHDUTYYN, 'Y') CONF_MONTHDUTYYN
							FROM    TN_LAS_CONSULT DD,
							        (
							     #if (!$vo.result_yn || $vo.result_yn.equals("R"))      
							        SELECT  CNSLT_NO,
							                HSTRY_NO 
							        FROM	TN_LAS_CONSULT	
							        WHERE   RE_DT IS NOT NULL
							        AND     DEL_YN = 'N'
							        AND		COMP_CD = :vo.session_comp_cd
								    #if (!$vo.display_yn.equals("Y"))
		                            	AND UPPER(MONTHDUTYYN)='Y'
		                            #end
		                            #if (!$vo.display_conf_yn.equals("Y"))
		                            	AND UPPER(CONF_MONTHDUTYYN)='Y'	
		                            #end 
		                            						        
								    #if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
								    	AND	SUBSTRING(CONVERT(VARCHAR, RE_DT, 112), 1, 6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
								    	    
							    	#else 
							   			AND	SUBSTRING(CONVERT(VARCHAR, RE_DT, 112), 1, 6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112), 1, 6)						    
								    #end							        
							     #end					        
							     #if ($vo.result_yn && $vo.result_yn.equals("P"))      
							        SELECT  CNSLT_NO,
							                HSTRY_NO 
							        FROM	TN_LAS_CONSULT	
							        WHERE   EXTNL_PRGRS_STATUS = 'S02'
							        AND		COMP_CD = :vo.session_comp_cd
							        AND     DEL_YN = 'N'
								    #if (!$vo.display_yn.equals("Y"))
		                            	AND UPPER(MONTHDUTYYN)='Y'
		                            #end
		                            #if (!$vo.display_conf_yn.equals("Y"))
		                            	AND UPPER(CONF_MONTHDUTYYN)='Y'	
		                            #end   	
		                            						        
							        #if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
								    	AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112), 1, 6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
							    	#else 
							   			AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112), 1, 6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112), 1, 6)						    
								    #end
							     #end
							        ) EE,
							        TN_LAS_CONSULT_RESPMAN F
							WHERE   DD.CNSLT_NO=EE.CNSLT_NO 
							AND     DD.HSTRY_NO=EE.HSTRY_NO
						 	AND   	DD.CNSLT_NO = F.CNSLT_NO
						 	AND		DD.COMP_CD = :vo.session_comp_cd
						 	AND		F.COMP_CD = :vo.session_comp_cd
						 	#if ($vo.reg_id && !$vo.reg_id.equals(""))	
						 		AND   	F.RESPMAN_ID = :vo.reg_id	
						 	#end	
						 	
					    #if (!$vo.result_yn || $vo.result_yn.equals("R"))                            
                            UNION ALL
                            
                            SELECT TITLE
                                , REQMAN_DEPT_NM DEPT_NM
                                , RESPMAN_NM
                                , 'TN_LAS_SPEAKCONSULT' TAB
                                , CONVERT(VARCHAR, SEQNO) SEQNO
                                , '' CNTRT_ID
                                , ISNULL(RE_CONT_REF, ' ') CONT
                                , REQMAN_DEPT_NM COMPANY
                                , CONVERT(VARCHAR, REG_DT, 112) REG_DT
					            , ISNULL(MONTHDUTYYN, 'Y') MONTHDUTYYN
					            , ISNULL(CONF_MONTHDUTYYN, 'Y') CONF_MONTHDUTYYN                                  
                            FROM  TN_LAS_SPEAKCONSULT 
                            WHERE 1=1
                            AND	  COMP_CD = :vo.session_comp_cd
                            AND   DEL_YN = 'N'
							                            
                            #if ($vo.reg_id && !$vo.reg_id.equals(""))	
                            	AND RESPMAN_ID =:vo.reg_id
                            #end
                            
						    #if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
						    	AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112), 1, 6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
					    	#else 
					   			AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112), 1, 6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112), 1, 6)						    
						    #end
						    
						    #if (!$vo.display_yn.equals("Y"))
                            	AND UPPER(MONTHDUTYYN)='Y'
                            #end
                            #if (!$vo.display_conf_yn.equals("Y"))
                            	AND UPPER(CONF_MONTHDUTYYN)='Y'	
                            #end                                
                        #end  
                     #elseif ($vo.page_gbn && $vo.page_gbn.equals("E"))
						#if (!$vo.result_yn || $vo.result_yn.equals("P"))
							 
							SELECT  '' TITLE, 
							        REG_NM DEPT_NM, 
							        'TN_LAS_ETC_MONTHDUTY' TAB,
							        SEQNO, 
							        '' CNTRT_ID, 
							        ISNULL(NEXTMONTH_PLAN,' ') CONT,
                                 	'' COMPANY,
                                	CONVERT(VARCHAR, REG_DT, 112) REG_DT,
                                	ISNULL(MONTHDUTY_PLANYN, 'Y') MONTHDUTYYN,
							        ISNULL(MONTHDUTY_PLANYN, 'Y') CONF_MONTHDUTYYN  
						    FROM TN_LAS_ETC_MONTHDUTY A
						    WHERE A.DEL_YN = 'N'
						    AND	  A.COMP_CD = :vo.session_comp_cd
                            #if (!$vo.display_conf_yn.equals("Y"))
                            	AND MONTHDUTY_PLANYN='Y'	
                            #end 						    
						    #if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
						    	AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112), 1, 6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
					    	#else 
					   			AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112), 1, 6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112), 1, 6)						    
						    #end
						    
						    #if ($vo.reg_id && !$vo.reg_id.equals(""))	
						    	AND	A.REG_ID = :vo.reg_id
						    #end
						    						    
						#elseif (!$vo.result_yn || $vo.result_yn.equals("R"))                           

							SELECT  '' TITLE, 
							        REG_NM DEPT_NM, 
							        'TN_LAS_ETC_MONTHDUTY' TAB,
							        SEQNO, 
							        '' CNTRT_ID, 
							        ISNULL(CRNTMONTH_RSLT, ' ') CONT,
                                 	'' COMPANY,
                                	CONVERT(VARCHAR, REG_DT, 112) REG_DT,
                                	ISNULL(MONTHDUTY_RSLTYN, 'Y') MONTHDUTYYN,
							        ISNULL(MONTHDUTY_RSLTYN, 'Y') CONF_MONTHDUTYYN  
						    FROM TN_LAS_ETC_MONTHDUTY A
						    WHERE A.DEL_YN = 'N'
						    AND	  A.COMP_CD = :vo.session_comp_cd
                            #if (!$vo.display_conf_yn.equals("Y"))
                            	AND MONTHDUTY_RSLTYN='Y'	
                            #end 						    
						    #if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
						    	AND	SUBSTRING(CONVERT(VARCHAR, A.REG_DT, 112), 1, 6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
					    	#else 
					   			AND	SUBSTRING(CONVERT(VARCHAR, A.REG_DT, 112), 1, 6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112), 1, 6)						    
						    #end
						    #if ($vo.reg_id && !$vo.reg_id.equals(""))	
						    AND	A.REG_ID = :vo.reg_id    
						    #end   
                        #end                                        
                     #end
                        ) A  
                          
				    ) B                                            
                                                                   
				--WHERE B.RM BETWEEN :vo.start_index and :vo.end_index 		           
		    ]]>
		  </statement>
		</query>  
		
 		<query id="las.statisticsmonth.listStatisticsConsult" isCamelCase="false" isDynamic="true">
		  <statement>
		    <![CDATA[
            	SELECT *                                           
                  FROM(                                            
                    SELECT ROW_NUMBER() OVER(ORDER BY A.REG_DT DESC) RM                               
                          ,COUNT(1) OVER() TOTAL_CNT               
                          ,A.*                                     
                      FROM 	( 
							SELECT  DD.TITLE, 
							        DD.REG_DEPT_NM DEPT_NM, 
							        'TN_LAS_CONSULT' TAB,
							        EE.CNSLT_NO + '@' + CONVERT(VARCHAR, EE.HSTRY_NO) SEQNO, 
							        CONVERT(VARCHAR, EE.HSTRY_NO) CNTRT_ID, 
							        ISNULL(DD.MAIN_MATR_CONT, ' ') CONT,
                                 	'' COMPANY,
                                	DD.REG_DT,
					                ISNULL(DD.MONTHDUTYYN, 'Y') MONTHDUTYYN,
					                ISNULL(DD.CONF_MONTHDUTYYN, 'Y') CONF_MONTHDUTYYN                                 	 							        
							FROM    TN_LAS_CONSULT DD,
							        (
							       #if (!$vo.result_yn  || $vo.result_yn.equals("R"))      
								        SELECT  CNSLT_NO,
								                HSTRY_NO 
								        FROM	TN_LAS_CONSULT	
								        WHERE   RE_DT IS NOT NULL
								        AND     DEL_YN = 'N'
								        AND 	COMP_CD = :vo.session_comp_cd
									    #if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
									    AND	SUBSTRING(CONVERT(VARCHAR, RE_DT, 112), 1, 6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
								    	#else 
								   		AND	SUBSTRING(CONVERT(VARCHAR, RE_DT, 112), 1, 6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112), 1, 6)						    
									    #end	
									    
									    #if (!$vo.display_yn || !$vo.display_yn.equals("Y"))
			                            	AND UPPER(MONTHDUTYYN)='Y'
			                            #end 
							       #end					        
							       #if ($vo.result_yn && $vo.result_yn.equals("P"))      
								        SELECT  CNSLT_NO,
								                HSTRY_NO 
								        FROM	TN_LAS_CONSULT	
								        WHERE   EXTNL_PRGRS_STATUS = 'S02'
								        AND     DEL_YN = 'N'
								        AND 	COMP_CD = :vo.session_comp_cd
									    #if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
									    	AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112), 1, 6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
								    	#else 
								   			AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112), 1, 6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112), 1, 6)						    
									    #end
									    
									    #if (!$vo.display_yn || !$vo.display_yn.equals("Y"))
			                            	AND UPPER(MONTHDUTYYN)='Y'
			                            #end 
		                            								    							        
							       #end
							        ) EE,
							        TN_LAS_CONSULT_RESPMAN F
							WHERE   DD.CNSLT_NO=EE.CNSLT_NO 
							AND 	DD.COMP_CD = :vo.session_comp_cd
							AND 	F.COMP_CD = :vo.session_comp_cd
			                #if ($vo.dmstfrgn_gbn && !$vo.dmstfrgn_gbn.equals(""))
			                AND 	DD.DMSTFRGN_GBN = :vo.dmstfrgn_gbn	                	
			                #end 	
			                						
							AND     DD.HSTRY_NO=EE.HSTRY_NO
						 	AND   	DD.CNSLT_NO = F.CNSLT_NO
						 	AND   	F.RESPMAN_ID = :vo.session_user_id									
					    #if (!$vo.result_yn || $vo.result_yn.equals("R"))                           
                            UNION ALL
                            
                            SELECT TITLE
                                , REQMAN_DEPT_NM DEPT_NM
                                , 'TN_LAS_SPEAKCONSULT' TAB
                                , CONVERT(VARCHAR, SEQNO) SEQNO
                                , '' CNTRT_ID
                                , ISNULL(RE_CONT_REF, ' ') CONT
                                , REQMAN_DEPT_NM COMPANY
                                , REG_DT 
					            , ISNULL(MONTHDUTYYN, 'Y') MONTHDUTYYN
					            , ISNULL(CONF_MONTHDUTYYN, 'Y') CONF_MONTHDUTYYN                                 
                            FROM  TN_LAS_SPEAKCONSULT 
                            WHERE 1=1
                            AND   DEL_YN = 'N'
                            AND   COMP_CD = :vo.session_comp_cd
						    #if ($vo.reg_id && !$vo.reg_id.equals(""))	
						    AND	RESPMAN_ID = :vo.reg_id    
						    #end 
						     				     
						    #if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
						    AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112), 1, 6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
					    	#else 
					   		AND	SUBSTRING(CONVERT(VARCHAR, REG_DT, 112), 1, 6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112), 1, 6)						    
						    #end
						    #if (!$vo.display_yn || !$vo.display_yn.equals("Y"))
                            	AND UPPER(MONTHDUTYYN)='Y'
                            #end                                
                           #end
                        ) A  
                        
				    ) B           	           
		    ]]>
		  </statement>
		</query>
		
		<query id="las.statisticsmonth.detailMonthduty" isCamelCase="false" isDynamic="true">
		  <statement>
		    <![CDATA[ 
            	SELECT *                                           
                  FROM(                                            
                    SELECT ROW_NUMBER() OVER(ORDER BY A.REG_DT DESC) RM                               
                          ,COUNT(1) OVER() TOTAL_CNT               
                          ,A.*                                     
                      FROM ( 		    
						    SELECT 
						      	 A.CRNTMONTH_RSLT
						        ,A.NEXTMONTH_PLAN
						        ,CONVERT(VARCHAR, A.REG_DT, 112) REG_DT
						        ,A.SEQNO
						    FROM TN_LAS_ETC_MONTHDUTY A
						    WHERE A.DEL_YN = 'N'
						    AND   A.COMP_CD = :vo.session_comp_cd
			                			    
						    #if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
						    AND	SUBSTRING(CONVERT(VARCHAR, A.REG_DT, 112), 1, 6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
					    	#else 
					   		AND	SUBSTRING(CONVERT(VARCHAR, A.REG_DT, 112), 1, 6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112), 1, 6)						    
						    #end
						    
						    AND	A.REG_ID = :vo.session_user_id
                            ) A

				    ) B                                            
                                                                   
				WHERE B.RM = 1	    
		    ]]>
		  </statement>
		</query>		
		<query id="las.statisticsmonth.insertMonthduty" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    INSERT INTO TN_LAS_ETC_MONTHDUTY (
                         SEQNO
                       , COMP_CD
                       , DMSTFRGN_GBN
                       , CRNTMONTH_RSLT
                       , NEXTMONTH_PLAN
                       , GRPMGR_REDEPT
                       , REG_DT
                       , REG_ID
                       , REG_NM
		               
		        ) VALUES (		        
                         :vo.seqno
                       , :vo.session_comp_cd
                       , :vo.dmstfrgn_gbn
                       , :vo.crntmonth_rslt
                       , :vo.nextmonth_plan
                       , :vo.grpmgr_redept
                       , GETDATE()
                       , :vo.session_user_id
                       , :vo.session_user_nm
		        )
		    ]]>
		  </statement>
		</query>
		
		
		<query id="las.statisticsmonth.modifyMonthContract" isCamelCase="false">
		  <statement>
		    <![CDATA[
				#if ($vo.tab && $vo.tab.equals("TN_LAS_CONSULT"))
				 		    
		         UPDATE TN_LAS_CONSULT
		          SET 
		          	#if ($vo.page_gbn && $vo.page_gbn.equals("A"))
		          	  	CONF_MONTHDUTYYN = :vo.monthdutyyn
		            #else
		            	MAIN_MATR_CONT = :vo.cont
		            , 	MONTHDUTYYN = :vo.monthdutyyn
		            #end            
		         WHERE 	CNSLT_NO = :vo.cntrt_id
		         AND	HSTRY_NO = :vo.cnsdreq_id
		         
				#elseif ($vo.tab && $vo.tab.equals("TN_LAS_SPEAKCONSULT")) 
						    
		         UPDATE TN_LAS_SPEAKCONSULT
		          SET 
		          	#if ($vo.page_gbn && $vo.page_gbn.equals("A"))
		              CONF_MONTHDUTYYN = :vo.monthdutyyn
		            #else
		            	RE_CONT_REF = :vo.cont
		            , 	MONTHDUTYYN = :vo.monthdutyyn
		            #end 		                    
		         WHERE 	SEQNO = :vo.seqno		         
				
				#elseif ($vo.tab && $vo.tab.equals("TN_CLM_CONTRACT_CNSD"))
				 		    
		         UPDATE TN_CLM_CONTRACT_DEPTCNSD
		          SET 
		          	#if ($vo.page_gbn && $vo.page_gbn.equals("A"))
		                CONF_MONTHDUTYYN = :vo.monthdutyyn
		            #else
		            	MAIN_MATR_CONT = :vo.cont
		              , MONTHDUTYYN = :vo.monthdutyyn
		            #end        
		         WHERE 	CNTRT_ID = :vo.cntrt_id
		         AND	CNSDREQ_ID = :vo.cnsdreq_id
				#elseif ($vo.tab && $vo.tab.equals("TN_LAS_ETC_MONTHDUTY") && !$vo.page_gbn.equals("A"))
				 		    
		         UPDATE TN_LAS_ETC_MONTHDUTY
		          SET 
		          	  CRNTMONTH_RSLT = :vo.crntmonth_rslt
		            , NEXTMONTH_PLAN = :vo.nextmonth_plan            
		         WHERE 	SEQNO = :vo.seqno
				#elseif ($vo.tab && $vo.tab.equals("TN_LAS_ETC_MONTHDUTY") && $vo.page_gbn.equals("A"))
				 		    
		         UPDATE TN_LAS_ETC_MONTHDUTY
		          SET 
		          	#if ($vo.page_gbn && $vo.page_gbn.equals("A"))
                  		#if ($vo.result_yn && $vo.result_yn.equals("P"))  								       
					      	MONTHDUTY_PLANYN = :vo.monthdutyyn,
					    #else
					    	MONTHDUTY_RSLTYN = :vo.monthdutyyn,
					    #end
		            #end   		          
		          	    MOD_DT = GETDATE()         
		         WHERE 	SEQNO = :vo.seqno 		          
		        #end	        		        		        		        
		    ]]>
		  </statement>
		</query>
 
 		<query id="las.statisticsmonth.listStatisticsContract" isCamelCase="false" isDynamic="true">
		  <statement>
		    <![CDATA[
            	SELECT *                                           
                  FROM(                                            
                    SELECT ROW_NUMBER() OVER(ORDER BY A.REG_DT DESC) RM                               
                          ,COUNT(1) OVER() TOTAL_CNT               
                          ,A.*                                     
                      FROM 	( 
							SELECT  B.REQ_TITLE,
									CASE WHEN :vo.session_user_locale= 'ko' 
										THEN A.CNTRT_NM 
										ELSE ISNULL(A.CNTRT_NM_EN, A.CNTRT_NM) 
									END AS TITLE,
									B.REQ_DEPT_NM DEPT_NM, 
							        'TN_CLM_CONTRACT_CNSD' TAB,
							        A.CNTRT_ID + '@' + B.CNSDREQ_ID SEQNO, 
							        A.CNTRT_ID, 
							        ISNULL(B.MAIN_MATR_CONT, ' ') CONT,
							        A.CNTRT_OPPNT_NM COMPANY, 
							        B.REG_DT,
						            ISNULL(B.MONTHDUTYYN, 'Y') MONTHDUTYYN,
						            ISNULL(B.CONF_MONTHDUTYYN, 'Y') CONF_MONTHDUTYYN 							        
							FROM   TN_CLM_CONTRACT_MASTER A, 
							       (
							       SELECT TT.CNTRT_ID, 
							              SS.CNSDREQ_ID, 
							              SS.REQ_TITLE,
							              E.MAIN_MATR_CONT,
							              SS.REQ_DEPT_NM, 
							              TT.REG_DT,
							              E.MONTHDUTYYN,
							              E.CONF_MONTHDUTYYN 							              							               
							       From   TN_CLM_CONT_CNSDREQ SS,  
							              TN_CLM_CONTRACT_CNSD TT,
										  (
										  SELECT	 
										            CNSDREQ_ID, 
										            CNTRT_ID, 
										            MONTHDUTYYN, 
										            CONF_MONTHDUTYYN,
										            MAIN_MATR_CONT
										  FROM		TN_CLM_CONTRACT_DEPTCNSD
										  ) E								                      	
							       WHERE  SS.CNSDREQ_ID	= TT.CNSDREQ_ID
								   AND    TT.CNTRT_ID 	= E.CNTRT_ID 
								   AND    TT.CNSDREQ_ID = E.CNSDREQ_ID 							       
							       AND	  SS.DEL_YN = 'N' 
							       AND 	  TT.COMP_CD = :vo.session_comp_cd
							       AND 	  SS.COMP_CD = :vo.session_comp_cd
							    #if (!$vo.display_yn.equals("Y")) 
	                            	AND   UPPER(E.MONTHDUTYYN)='Y'
	                            #end							       
                     			#if ($vo.result_yn && $vo.result_yn.equals("P"))  								       
							       AND    SS.PRGRS_STATUS < 'C04205'
							    #end
                     			#if (!$vo.result_yn || $vo.result_yn.equals("R"))								       
							       AND    SS.PRGRS_STATUS IN ('C04207', 'C04205')
							    #end								    
							       ) B,
							       TN_CLM_CONT_CNSDREQ_RESPMAN D 
							WHERE 1=1
							
						#if ($vo.dmstfrgn_gbn && $vo.dmstfrgn_gbn.equals("H")) 
							AND	  A.REGION_GBN = 'C01801'
						#elseif ($vo.dmstfrgn_gbn && $vo.dmstfrgn_gbn.equals("F")) 
							AND	  A.REGION_GBN = 'C01802'
						#end
													        
							AND   A.CNTRT_ID = B.CNTRT_ID 
						 	AND   B.CNSDREQ_ID = D.CNSDREQ_ID
						 	AND   D.RESPMAN_ID = :vo.session_user_id						
					    #if ($vo.srch_regdt1 && !$vo.srch_regdt1.equals(""))
					   		AND	SUBSTRING(CONVERT(VARCHAR, B.REG_DT, 112), 1, 6) LIKE :vo.srch_regdt1 + CASE WHEN LEN(:vo.srch_regdt2) = 1 THEN '0' + :vo.srch_regdt2 ELSE :vo.srch_regdt2  END + '%'
					    #else 
					   		AND	SUBSTRING(CONVERT(VARCHAR, B.REG_DT, 112), 1, 6) = SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112), 1, 6)					   		
					    #end					    
                        ) A  
                        
				    ) B                                            
                                                                   
				--WHERE B.RM BETWEEN :vo.start_index and :vo.end_index 		           
		    ]]>
		  </statement>
		</query>  	  		
    </queries>
</queryservice>