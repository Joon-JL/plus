<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN" "http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
	<queries>
		<query id="clm.manage.detailMyApproval" isCamelCase="false" comment="MyApproval상세">
		  	<statement>
		    <![CDATA[
	    	SELECT * 
			  FROM (
			        SELECT DISTINCT A.CNSDREQ_ID AS CNSDREQ_ID
			              ,A.REQMAN_ID
			              ,A.REQMAN_NM
			              ,A.REQ_DEPT_NM
			              ,A.REQMAN_JIKGUP_NM
			              ,C.CNTRT_UNTPRC_EXPL			              
			              ,CONVERT(CHAR(10), A.REQ_DT, 23) AS REQ_DT  /*YYYY-MM-DD*/
			              ,D.AGREEMAN_ID
			              ,D.AGREEMAN_NM
			              ,D.AGREE_CAUSE
			              ,D.AGREE_YN
			              ,D.AGREEDAY
			              ,A.PRGRS_STATUS
			          FROM TN_CLM_CONT_CNSDREQ  A
			              , TN_CLM_CONTRACT_CNSD B
			              , TN_CLM_CONTRACT_MASTER C LEFT OUTER JOIN
			                TN_CLM_CNCLSN_AGREE D ON C.CNTRT_ID = D.CNTRT_ID AND D.DEL_YN = 'N'
			        WHERE A.CNSDREQ_ID = B.CNSDREQ_ID
			          AND B.CNTRT_ID = C.CNTRT_ID			         
			          AND A.DEL_YN = 'N'			          
			          AND A.CNSDREQ_ID = :vo.cnsdreq_id
			        ) A LEFT OUTER JOIN
			       ( 
			         SELECT A.TITLE
			              , A.MODULE_ID
			              , A.MIS_ID			              
			              , CONVERT(CHAR(10), CONVERT(DATETIME,SUBSTRING(A.CREATE_DATE,1,8),112), 23) AS CREATE_DATE 
			              , A.REF_KEY
			              , B.ACTIVITY
			              , B.USER_NAME + ' / ' + B.DUTY + ' / ' + B.DEPT_NAME AS USER_INFO
			            FROM TB_COM_START_PROCESS_WSVO A
			               , TB_COM_ROUTE_WSVO B
			          WHERE A.MODULE_ID = B.MODULE_ID
			            AND A.MIS_ID = B.MIS_ID
			            AND A.APPRVL_CLSFCN = 'C03002'
			            AND A.REF_KEY = :vo.cnsdreq_id
			            AND A.MODULE_ID = 'LAS'
			        ) B ON A.CNSDREQ_ID = B.REF_KEY	       
		    ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.detailMyApprovalContractMaster" isCamelCase="false" comment="마스터테이블정보 가져오기">
			<statement>
		  	<![CDATA[
		   SELECT ROW_NUMBER() OVER(ORDER BY A.CNTRT_ID) AS RN
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.BIZ_CLSFCN ) AS BIZ_CLSFCN_NM
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.DEPTH_CLSFCN ) AS DEPTH_CLSFCN_NM
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNCLSNPURPS_BIGCLSFCN ) AS CNCLSNPURPS_BIGCLSFCN_NM
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNCLSNPURPS_MIDCLSFCN ) AS CNCLSNPURPS_MIDCLSFCN_NM
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNCLSNPURPS_MIDCLSFCN_ETC ) AS CNCLSNPURPS_MIDCLSFCN_ETC_NM
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	  ELSE CD_NM_ENG
			             END CD_NM FROM TN_COM_CONTRACTTYPE_CD WHERE TYPE_CD = A.CNTRT_TRGT ) AS CNTRT_TRGT_NM				      
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              ELSE CD_NM_ENG
			          END CD_NM FROM TB_COM_CD WHERE CD = A.PAYMENT_GBN ) AS PAYMENT_GBN_NM 
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			   				  WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			   				  WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			    			  ELSE CD_NM_ENG END FROM TB_COM_CD WHERE CD = A.BFHDCSTN_APBT_MTHD) AS BFHDCSTN_APBT_MTHD_NM 
			   , A.CNTRT_OPPNT_CD
			   , A.CNTRT_OPPNT_TELNO						
  			   , A.CNTRT_OPPNT_EMAIL
  			   , A.CNTRT_OPPNT_RPRSNTMAN				
  			   , A.CNTRT_INFO_GBN							
  			   , A.CNTRT_OPPNT_TYPE
  			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              ELSE CD_NM_ENG
			          END CD_NM FROM TB_COM_CD WHERE CD = A.CNTRT_OPPNT_TYPE)  AS CNTRT_OPPNT_TYPE_NM
  			   , A.CNTRT_OPPNT_NM
			   , A.CNTRT_OPPNT_RESPMAN
			   , A.CNTRT_ID
			   , A.CNTRT_NM
			   , A.REGION_GBN
			   , A.BIZ_CLSFCN
			   , A.DEPTH_CLSFCN
			   , A.CNCLSNPURPS_BIGCLSFCN
			   , A.CNCLSNPURPS_MIDCLSFCN
			   , A.CNCLSNPURPS_MIDCLSFCN_ETC
			   , A.CNTRT_TRGT
			   , A.CNTRT_TRGT_DET
			   , A.PSHDBKGRND_PURPS
			   , A.PAYMENT_GBN
			   , A.ANTCPTNEFCT
			   /* , TO_CHAR(TO_DATE(A.CNTRTPERIOD_STARTDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNTRTPERIOD_STARTDAY */
			   , CONVERT(DATE,A.CNTRTPERIOD_STARTDAY,120) AS CNTRTPERIOD_STARTDAY			   
    		   /* , TO_CHAR(TO_DATE(A.CNTRTPERIOD_ENDDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD')   AS CNTRTPERIOD_ENDDAY */
    		   , CONVERT(DATE,A.CNTRTPERIOD_ENDDAY,120) AS CNTRTPERIOD_ENDDAY
			   , A.SECRET_KEEPPERIOD
			   /* , TRIM(TO_CHAR(A.CNTRT_UNTPRC, '999,999,999,999,999')) AS CNTRT_UNTPRC */
			   , RTRIM(REPLACE(CONVERT(VARCHAR,CONVERT(MONEY,ISNULL(A.CNTRT_UNTPRC,'0')),1),'.00','')) AS CNTRT_UNTPRC
			   , A.CNTRT_UNTPRC_EXPL
			   /* , TRIM(TO_CHAR(A.CNTRT_AMT, '999,999,999,999,999')) AS CNTRT_AMT */
			   , RTRIM(REPLACE(CONVERT(VARCHAR,CONVERT(MONEY,ISNULL(A.CNTRT_AMT,'0')),1),'.00','')) AS CNTRT_AMT
			   , A.CRRNCY_UNIT
			   , A.PAYMENT_COND
			   , A.AUTO_RNEW_YN
			   /* , TO_CHAR(TO_DATE(A.EXPRT_NOTIDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS EXPRT_NOTIDAY */
			   , CONVERT(DATE,A.EXPRT_NOTIDAY,120) AS EXPRT_NOTIDAY
			   , A.OBLGT_LMT
			   , A.SPCL_COND
			   /* , TO_CHAR(TO_DATE(A.CNCLSN_PLNDDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNCLSN_PLNDDAY */
			   , CONVERT(DATE,A.CNCLSN_PLNDDAY,120) AS CNCLSN_PLNDDAY 
			   , A.CNTRT_RESPMAN_ID
			   , A.CNTRT_RESPMAN_NM
			   , A.CNTRT_RESP_DEPT_NM
			   , A.CNTRT_RESPMAN_JIKGUP_NM
			   , A.CNTRT_OPPNT_CD
			   , A.SIGN_PLNDMAN_ID
			   , A.SIGN_PLNDMAN_NM
			   , A.SIGN_PLNDMAN_JIKGUP_NM
			   , A.SIGN_PLND_DEPT_NM
			   , A.SEAL_MTHD
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              ELSE CD_NM_ENG
			          END CD_NM FROM TB_COM_CD WHERE CD = A.SEAL_MTHD) SEAL_MTHD_NM
			   , COALESCE(A.CNTRT_CNCLSN_YN, 'N') AS CNTRT_CNCLSN_YN
			   , A.SIGNMAN_ID
			   , A.SIGNMAN_NM
			   , A.SIGN_DEPT_NM
			   , A.SIGNMAN_JIKGUP_NM
			   /* , TO_CHAR(TO_DATE(A.SIGNDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS SIGNDAY */
			   , CASE WHEN A.SIGNDAY = ''
               		THEN ''
               		ELSE CONVERT(VARCHAR, CONVERT(DATE, A.SIGNDAY), 23)
               		END AS SIGNDAY 
			   , A.OPPNT_SIGNMAN_NM
			   , A.OPPNT_SIGNMAN_JIKGUP
			   , A.OPPNT_SIGNMAN_DEPT
			   /* , TO_CHAR(TO_DATE(A.OPPNT_SIGNDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS OPPNT_SIGNDAY */
			   , CASE WHEN A.OPPNT_SIGNDAY = ''
               		THEN ''
               		ELSE CONVERT(VARCHAR, CONVERT(DATE, A.OPPNT_SIGNDAY), 23)
               		END AS OPPNT_SIGNDAY 
			   /* , TO_CHAR(TO_DATE(A.CNTRT_CNCLSNDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNTRT_CNCLSNDAY */
			   , CONVERT(DATE,A.CNTRT_CNCLSNDAY,120) AS CNTRT_CNCLSNDAY
			   /* , TO_CHAR(TO_DATE(A.CPY_REGDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD')  AS CPY_REGDAY */
			   , CONVERT(DATE,A.CPY_REGDAY,120) AS CPY_REGDAY
			   , CASE COAlESCE(A.CPY_REGDAY,'N') WHEN 'N' THEN ''
                                                          ELSE 
                                                          		CASE WHEN :vo.session_user_locale = 'ko' THEN
                                                          			'체결본등록완료'
                                                          		WHEN :vo.session_user_locale = 'fr' THEN
                                                          			'Finalisation de l‘enregistrement du contrat conclu'
                                                          		WHEN :vo.session_user_locale = 'de' THEN
                                                          			'Fertigstellung der Registrierung des abgeschlossenen Vertrags'
                                                          		ELSE 'Completion of Concluded Contract Registration'
                                                          		END
			        END                         AS CPY_REGYN
			   , A.CNTRT_NO
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              ELSE CD_NM_ENG
			          END CD_NM FROM TB_COM_CD WHERE CD = A.LOAC) AS LOAC
			   , ISNULL(A.LOAC_ETC, ' ') AS LOAC_ETC
			   , (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              ELSE CD_NM_ENG
			          END CD_NM FROM TB_COM_CD WHERE CD = A.DSPT_RESOLT_MTHD) AS DSPT_RESOLT_MTHD
			   , ISNULL(A.DSPT_RESOLT_MTHD_DET, ' ') AS DSPT_RESOLT_MTHD_DET
			   , A.ORG_ACPT_DLAY_CAUSE
			   /* , TO_CHAR(TO_DATE(A.ORG_ACPTDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS ORG_ACPTDAY */
			   , CONVERT(DATE,A.ORG_ACPTDAY,120) AS ORG_ACPTDAY
			   , A.ORG_TKOVMAN_ID
			   , A.ORG_TKOVMAN_NM
			   , A.ORG_TKOVMAN_JIKGUP_NM
			   , A.ORG_TKOV_DEPT_NM
			   , A.ORG_HDOVMAN_ID
			   , A.ORG_HDOVMAN_NM
			   , A.ORG_HDOVMAN_JIKGUP_NM
			   , A.ORG_HDOV_DEPT_NM
			   , A.ORG_STRG_POS
			   , A.PRCS_DEPTH
			   , A.DEPTH_STATUS
			   , A.CNTRT_STATUS
			   , A.REG_DT
			   , A.REG_ID
			   , A.REG_NM
			   , A.MOD_DT
			   , A.MOD_ID
			   , A.MOD_NM
			   , A.DEL_YN
			   , A.DEL_DT
			   , A.DEL_ID
			   , A.DEL_NM
			   , A.CNTRT_CHGE_DEMNDDAY
			   , A.CNTRT_CHGE_DEMNDMAN_ID
			   , A.CNTRT_CHGE_DEMNDMAN_NM
			   , A.CNTRT_CHGE_DEMND_CAUSE
			   /* , TO_CHAR(TO_DATE(A.CNTRT_CHGE_PLNDDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNTRT_CHGE_PLNDDAY */
			   , CONVERT(DATE,A.CNTRT_CHGE_PLNDDAY,120) AS CNTRT_CHGE_PLNDDAY
			   , A.CNTRT_CHGE_CONF_YN
			   /* , TO_CHAR(TO_DATE(A.CNTRT_CHGE_CONFDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNTRT_CHGE_CONFDAY */
			   , CONVERT(DATE,A.CNTRT_CHGE_CONFDAY,120) AS CNTRT_CHGE_CONFDAY
			   , A.CNTRT_CHGE_CONFMAN_ID
			   , A.CNTRT_CHGE_CONFMAN_NM
			   , A.BFHDCSTN_MTNMAN_ID
			   , A.BFHDCSTN_MTNMAN_NM
			   , A.BFHDCSTN_MTNMAN_JIKGUP_NM
			   , A.BFHDCSTN_MTN_DEPT_NM
			   , A.BFHDCSTN_MTNMAN_EMAIL
			   , A.BFHDCSTN_APBT_MTHD
			   , A.BFHDCSTN_APBTMAN_ID
			   , A.BFHDCSTN_APBTMAN_NM
			   , A.BFHDCSTN_APBTMAN_JIKGUP_NM
			   , A.BFHDCSTN_APBT_DEPT_NM
			   , A.BFHDCSTN_APBTDAY
			   , A.SEAL_RQSTDAY
			   , A.SEAL_RQSTMAN_ID
			   , A.SEAL_RQSTMAN_NM
			   , A.SEAL_FFMTMAN_ID
			   , A.SEAL_FFMTMAN_NM
			   , A.SEAL_FFMTMAN_JIKGUP_NM
			   , A.SEAL_FFMT_DEPT_NM
			   , A.SEAL_FFMTDAY
			   , A.REG_OPERDIV
			   , COALESCE(A.CPY_REGMAN_ID, :vo.session_user_id) AS CPY_REGMAN_ID
			   , COALESCE(A.CPY_REGMAN_NM, :vo.session_user_nm) AS CPY_REGMAN_NM
			   , A.CPY_REGMAN_JIKGUP_NM
			   , A.CPY_REG_DEPT_NM
			   /* , TO_CHAR(TO_DATE(C.AGREEDAY,'YYYY-MM-DD'), 'YYYY-MM-DD') AS AGREEDAY */
			   , CONVERT(DATE,C.AGREEDAY,120) AS AGREEDAY
         	   , CASE WHEN :vo.session_user_locale = 'ko' THEN
         	   		/* DECODE(C.AGREE_YN, 'Y', '합의', 'N', '미합의', ' ') */
         	   	 	CASE C.AGREE_YN 
					       WHEN 'Y' THEN '합의'
					       WHEN 'N' THEN '미합의'
					  ELSE 
					       '' 
					  END
				 WHEN :vo.session_user_locale = 'fr' THEN
         	   		/* DECODE(C.AGREE_YN, 'Y', 'Accord', 'N', 'L‘opération a échoué', ' ') */
         	   	 	CASE C.AGREE_YN 
					       WHEN 'Y' THEN 'Accord'
					       WHEN 'N' THEN 'L‘opération a échoué'
					  ELSE 
					       '' 
					  END
				 WHEN :vo.session_user_locale = 'de' THEN
         	   		/* DECODE(C.AGREE_YN, 'Y', 'Vereinbarung', 'N', 'Fehlgeschlagen', ' ') */
         	   	 	CASE C.AGREE_YN 
					       WHEN 'Y' THEN 'Vereinbarung'
					       WHEN 'N' THEN 'Fehlgeschlagen'
					  ELSE 
					       '' 
					  END
         	   	 ELSE
         	   	 	/* DECODE(C.AGREE_YN, 'Y', 'Agreement', 'N', 'Failed', ' ') */
         	   		  CASE C.AGREE_YN 
					       WHEN 'Y' THEN 'Agreement'
					       WHEN 'N' THEN 'Failed'
					  ELSE 
					       '' 
					  END
         	   	 END AS AGREE_YN
         	   , ISNULL(C.AGREE_CAUSE,'') AS AGREE_CAUSE
         	   , (SELECT CUSTOMER_CD FROM TN_CLM_CUSTOMER WHERE A.CNTRT_OPPNT_CD = CUSTOMER_CD AND A.CNTRT_ID = :vo.cntrt_id) AS CUSTOMER_CD
         	   , (SELECT DODUN FROM TN_CLM_CUSTOMER WHERE A.CNTRT_OPPNT_CD = CUSTOMER_CD AND A.CNTRT_ID = :vo.cntrt_id) AS DODUN
         	   , A.IF_SYS_CD
	 	    FROM TN_CLM_CONTRACT_MASTER A
			  LEFT OUTER JOIN (
			        SELECT *
			          FROM TN_CLM_CNCLSN_AGREE
			         WHERE CNTRT_ID = :vo.cntrt_id
			           AND AGREE_SEQNO = (
			                              SELECT MAX(AGREE_SEQNO)
			                                FROM TN_CLM_CNCLSN_AGREE
			                               WHERE CNTRT_ID = :vo.cntrt_id
			                                 AND DEL_YN = 'N'
			                             )
			           AND DEL_YN = 'N'     
			       )  C ON A.CNTRT_ID = C.CNTRT_ID 
		     WHERE 1=1
			   AND A.CNTRT_ID = :vo.cntrt_id
		  	]]>
			</statement>
		</query>
		
		<query id="clm.manage.modifyMyApproval" isCamelCase="false" comment="합의내용수정">
		  	<statement>
		    <![CDATA[
		   	UPDATE TN_CLM_CNCLSN_AGREE
		   	   SET AGREE_YN		= :vo.agree_yn
		   	     , AGREEDAY		=   CONVERT(VARCHAR,SYSDATETIME(),112)  /* TO_CHAR(SYSDATE, 'YYYYMMDD') */
		   	     , AGREE_CAUSE	= :vo.agree_cause
		     WHERE CNTRT_ID	 	= :vo.cntrt_id
		       AND AGREE_SEQNO	= :vo.agree_seqno
		      ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.insertMyApprovalAgree" isCamelCase="false" comment="합의내용추가">
		  	<statement>
		    <![CDATA[
		   	INSERT INTO TN_CLM_CNCLSN_AGREE (
		   	       CNTRT_ID
		   	      ,AGREE_SEQNO
		   	      ,AGREEMAN_ID
		   	      ,AGREEMAN_NM
		   	      ,AGREEMAN_JIKGUP_NM
		   	      ,AGREEMAN_DEPT_NM
		   	      ,AGREE_YN
		   	      ,REG_DT
		   	      ,REG_ID
		   	      ,DEL_YN )
		   	 VALUES (
		   	      :vo.cntrt_id
		   	     ,:vo.agree_seqno
		   	     ,:vo.session_user_id
		   	     ,:vo.session_user_nm
		   	     ,:vo.session_jikgup_nm
		   	     ,:vo.session_dept_nm
		   	     ,:vo.agree_yn
		   	     ,GETDATE()
		   	     ,:vo.session_user_id
		   	     ,'N'
		   	   )   
		      ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.modifyMyApprovalCntrtStatus" isCamelCase="false" comment="계약상태수정">
		  	<statement>
		    <![CDATA[
		    UPDATE TN_CLM_CONTRACT_MASTER
		       SET MOD_DT				= GETDATE()
			   	 , MOD_ID	 			= :vo.session_user_id
			     , MOD_NM    			= :vo.session_user_nm
		    #if($vo.getDepth_status().equals('C02636'))

		   	   #if($vo.agree_yn.equals("Y"))
		   	   	 , PRCS_DEPTH				= 'C02504'	
		   	     , DEPTH_STATUS				= 'C02662'
			   #else
			     , PRCS_DEPTH				= 'C02508'
			   	 , DEPTH_STATUS				= 'C02631'
			   #end
			
			#elseif($vo.getDepth_status().equals('C02642'))
				 , PRCS_DEPTH				= 'C02504'	
		   	     , DEPTH_STATUS				= 'C02662'
		   	#end

			#if($vo.getDepth_status().equals('C02642') || $vo.getDepth_status().equals('C02636') && $vo.agree_yn.equals("Y")) 	

			   	     , ORG_HDOVMAN_ID		= :vo.org_hdovman_id
					 , ORG_HDOVMAN_NM		= :vo.org_hdovman_nm
					 , ORG_HDOV_DEPT_NM     = :vo.org_hdov_dept_nm
					 , ORG_HDOVMAN_JIKGUP_NM= :vo.org_hdovman_jikgup_nm
					 , ORG_TKOVMAN_ID		= :vo.session_user_id	
					 , ORG_TKOVMAN_NM		= :vo.session_user_nm
					 , ORG_TKOV_DEPT_NM	    = :vo.session_dept_nm
					 , ORG_TKOVMAN_JIKGUP_NM= :vo.session_jikgup_nm
					 , ORG_STRG_POS			= :vo.org_strg_pos
					 , ORG_ACPTDAY			= :vo.org_acptday
					 , ORG_ACPT_DLAY_CAUSE  = :vo.org_acpt_dlay_cause
	             #end
			   	    
			     WHERE CNTRT_ID	 			= :vo.cntrt_id
		      ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.modifyMyApprovalCntrtStatus2" isCamelCase="false" comment="계약상태수정">
		  	<statement>
		    <![CDATA[
		    UPDATE TN_CLM_CONTRACT_MASTER
		       SET MOD_DT				= GETDATE()
			   	 , MOD_ID	 			= :vo.session_user_id
			     , MOD_NM    			= :vo.session_user_nm
		    #if($vo.getDepth_status().equals('C02636'))

		   	   #if($vo.agree_yn.equals("Y"))
		   	   	 , PRCS_DEPTH				= 'C02504'	
		   	     , DEPTH_STATUS				= 'C02662'
			   #else
			     , PRCS_DEPTH				= 'C02508'
			   	 , DEPTH_STATUS				= 'C02631'
			   #end
			
			#elseif($vo.getDepth_status().equals('C02642'))
				 , PRCS_DEPTH				= 'C02504'	
		   	     , DEPTH_STATUS				= 'C02662'
		   	#end

			#if($vo.getDepth_status().equals('C02642') || $vo.getDepth_status().equals('C02636') && $vo.agree_yn.equals("Y")) 	

			   	     , ORG_HDOVMAN_ID		= :vo.org_hdovman_id
					 , ORG_HDOVMAN_NM		= :vo.org_hdovman_nm
					 , ORG_HDOV_DEPT_NM     = :vo.org_hdov_dept_nm
					 , ORG_HDOVMAN_JIKGUP_NM= :vo.org_hdovman_jikgup_nm
					 , ORG_TKOVMAN_ID		= :vo.session_user_id	
					 , ORG_TKOVMAN_NM		= :vo.session_user_nm
					 , ORG_TKOV_DEPT_NM	    = :vo.session_dept_nm
					 , ORG_TKOVMAN_JIKGUP_NM= :vo.session_jikgup_nm
					 , ORG_STRG_POS			= :vo.org_strg_pos
					 , ORG_ACPTDAY			= :vo.org_acptday
					 , ORG_ACPT_DLAY_CAUSE  = :vo.org_acpt_dlay_cause
					 , CNTRT_CNCLSNDAY = :vo.cntrt_cnclsnday
					 /*
					 #if($vo.getDepth_status().equals('C02642'))
			   	     , CNTRT_NO				= (
												SELECT 
												  CASE
														WHEN CNT1 = 0 	THEN AUTO_CNTRD_NM + '0001'
													  ELSE AUTO_CNTRD_NM + RIGHT(REPLICATE('0', 4) + CONVERT(VARCHAR,CONVERT(NUMERIC,SUBSTRING(MAX1,LEN(MAX1)-3,4))+1), 4)													  
													END AS AUTO_CNTRD_NM 
												FROM     
												(    
													SELECT
														(SELECT COUNT(CNTRT_ID) FROM TN_CLM_CONTRACT_MASTER A  WHERE CHARINDEX(TA.AUTO_CNTRD_NM,CNTRT_NO ) > 0) AS CNT1,
												    (SELECT MAX(CNTRT_NO) FROM TN_CLM_CONTRACT_MASTER A  WHERE CHARINDEX(TA.AUTO_CNTRD_NM,CNTRT_NO) > 0) AS MAX1,
												    AUTO_CNTRD_NM
													FROM 
													(
														SELECT 
															C.CNTRT_ID
															, A.USEMAN_MNG_ITM1 + RIGHT(ISNULL(:vo.cntrt_cnclsnday,'00000000'),6) + '_' AS AUTO_CNTRD_NM															
												    FROM 
															TB_COM_CD A
															, TN_CLM_CONTRACT_MASTER C
														WHERE 
															C.CNTRT_ID = :vo.cntrt_id
															AND A.CD	= C.COMP_CD    
															AND A.SYS_CD = 'LAS'
	 														AND A.grp_cd = 'COMP2'
													) TA
												) TB
	          								)
	          		
	          		#end
	          		*/
	             #end
			   	    
			     WHERE CNTRT_ID	 			= :vo.cntrt_id


		      ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.modifyMyApprovalCnsdReqStatus" isCamelCase="false" comment="계약의뢰상태수정">
		  	<statement>
		    <![CDATA[
		    
		     UPDATE TN_CLM_CONT_CNSDREQ
		     #if($vo.agree_yn.equals("Y"))
		   	   SET PRGRS_STATUS				= 'C04219'
		   	 #else
		   	   SET PRGRS_STATUS				= 'C04211'
		   	 #end  
		   	     , MOD_DT					= GETDATE()
		   	     , MOD_ID	 				= :vo.session_user_id
		       	 , MOD_NM    				= :vo.session_user_nm
		     WHERE CNSDREQ_ID 				= :vo.cnsdreq_id
		      ]]>
		  	</statement>
		</query>
		
		
		<query id="clm.manage.listMyApprovalAgree" isCamelCase="false" comment="합의내역조회">
		  	<statement>
		    <![CDATA[
		   	SELECT D.CNTRT_ID
			     , D.AGREE_SEQNO
			  FROM TN_CLM_CONT_CNSDREQ A
			     , TN_CLM_CONTRACT_CNSD B
			     , TN_CLM_CONTRACT_MASTER C
			     , TN_CLM_CNCLSN_AGREE D
			  WHERE A.CNSDREQ_ID 	= B.CNSDREQ_ID
			    AND B.CNTRT_ID 		= C.CNTRT_ID
			    AND C.CNTRT_ID 		= D.CNTRT_ID
			    AND A.CNSDREQ_ID 	= :vo.cnsdreq_id
			    AND A.DEL_YN 		= 'N'
			    AND C.DEL_YN 		= 'N'
			    AND C.CNTRT_STATUS 	<> 'C02406'
			    AND D.DEL_YN = 'N'
			ORDER BY C.CNTRT_ID
		      ]]>
		  	</statement>
		</query>
		
		<query id="clm.manage.AgreeMaxSeqno" isCamelCase="false" comment="agree max seqno">
		  	<statement>
		    <![CDATA[
		     SELECT ISNULL(MAX(AGREE_SEQNO+1),0) MAX_SEQ
		       FROM TN_CLM_CNCLSN_AGREE
		      WHERE DEL_YN = 'N'
		        AND CNTRT_ID = :vo.cntrt_id
		      ]]>
		  	</statement>		
		</query>
		
		<!-- 2014-05-20 Kevin changed. [SP_14MAY01] -->
		<query id="clm.manage.getCntrtCnclsnday" isCamelCase="false" comment="get cntrt_cnclsnday">
		  	<statement>
		    <![CDATA[
		     SELECT ISNULL(CNTRT_CNCLSNDAY,'') CNTRT_CNCLSNDAY
		     /*2014-05-20 Kevin added.*/
		       ,PRCS_DEPTH, DEPTH_STATUS
		       FROM TN_CLM_CONTRACT_MASTER
		      WHERE CNTRT_ID = :vo.cntrt_id
		      ]]>
		  	</statement>		
		</query>
		
		<query id="clm.manage.printMyApproval" isCamelCase="false" comment="get cntrt_cnclsnday">
		  	<statement>
		    <![CDATA[
			SELECT REQ.CNSDREQ_ID ,
				   REQ.REQ_TITLE,
			       CNSD.CNSDMAN_NM, 
			       MASTER.CNTRT_NM,
			      /*  ,TO_CHAR(TO_DATE(MASTER.CNTRT_CNCLSNDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNTRT_CNCLSNDAY, */
                   CONVERT(DATE,MASTER.CNTRT_CNCLSNDAY,120) AS CNTRT_CNCLSNDAY,
			       REQ.REQMAN_NM ,
			       REQ.REQ_DEPT_NM ,
			       REQ.REQMAN_JIKGUP_NM ,
			       MASTER.CNTRT_RESPMAN_NM ,
			       MASTER.CNTRT_OPPNT_RPRSNTMAN,
			       MASTER.CNTRT_RESP_DEPT_NM ,
			       MASTER.CNTRT_RESPMAN_JIKGUP_NM ,
			       /* TO_CHAR(TO_DATE(MASTER.ORG_ACPTDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS ORG_ACPTDAY, */
			       CONVERT(DATE,MASTER.ORG_ACPTDAY,120) AS ORG_ACPTDAY,
			       MASTER.CNTRT_ID ,
			       MASTER.CNTRT_NO ,
			       MASTER.CNTRT_RESPMAN_NM ,
			       (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	    WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	    WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	    ELSE CD_NM_ENG
			               END CD_NM
			          FROM TN_COM_CONTRACTTYPE_CD
			         WHERE TYPE_CD = MASTER.BIZ_CLSFCN ) AS BIZ_CLSFCN_NM ,
			       (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	    WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	    WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	    ELSE CD_NM_ENG
			               END CD_NM
			          FROM TN_COM_CONTRACTTYPE_CD
			         WHERE TYPE_CD = MASTER.DEPTH_CLSFCN ) AS DEPTH_CLSFCN_NM ,
			       (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	    WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	    WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	    ELSE CD_NM_ENG
			               END CD_NM
			          FROM TN_COM_CONTRACTTYPE_CD
			         WHERE TYPE_CD = MASTER.CNCLSNPURPS_BIGCLSFCN ) AS CNCLSNPURPS_BIGCLSFCN_NM ,
			       (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              	    WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              	    WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              	    ELSE CD_NM_ENG
			               END CD_NM
			          FROM TN_COM_CONTRACTTYPE_CD
			         WHERE TYPE_CD = MASTER.CNCLSNPURPS_MIDCLSFCN ) AS CNCLSNPURPS_MIDCLSFCN_NM ,
			       MASTER.CNTRT_OPPNT_NM ,
			       (SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              ELSE CD_NM_ENG
			          END CD_NM
			          FROM TB_COM_CD
			         WHERE CD = MASTER.CNTRT_OPPNT_TYPE) AS CNTRT_OPPNT_TYPE_NM ,
			       MASTER.CNTRT_OPPNT_TYPE,
			       /* TO_CHAR(TO_DATE(MASTER.CNTRTPERIOD_STARTDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS CNTRTPERIOD_STARTDAY, */
			       CONVERT(DATE,MASTER.CNTRTPERIOD_STARTDAY,120) AS CNTRTPERIOD_STARTDAY,
			       /* TO_CHAR(TO_DATE(MASTER.CNTRTPERIOD_ENDDAY, 'YYYY-MM-DD'), 'YYYY-MM-DD')   AS CNTRTPERIOD_ENDDAY, */
			       CONVERT(DATE,MASTER.CNTRTPERIOD_ENDDAY,120) AS CNTRTPERIOD_ENDDAY,
			       /* TRIM(TO_CHAR(MASTER.CNTRT_AMT, '999,999,999,999,999')) AS CNTRT_AMT, */
			       RTRIM(REPLACE(CONVERT(VARCHAR,CONVERT(MONEY,ISNULL(MASTER.CNTRT_AMT,'0')),1),'.00','')) AS CNTRT_AMT,
			       MASTER.CRRNCY_UNIT ,
			       (SELECT 	CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
			              		WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
			              		WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
			              		ELSE CD_NM_ENG
			          		END CD_NM
			          FROM TB_COM_CD
			         WHERE CD = MASTER.PAYMENT_GBN ) AS PAYMENT_GBN_NM ,
			       MASTER.AUTO_RNEW_YN ,
			       MASTER.IF_SYS_CD ,			      
			        (SELECT CONVERT(VARCHAR,SB.REQ_DT,23)  /* TO_CHAR(REQ_DT, 'YYYY-MM-DD') */
			         FROM (SELECT TOP 1 CNSDREQ_ID  FROM DBO.[COM.GET_LINK_CNSDREQ_ID]  (  :vo.cnsdreq_id )  ORDER BY  LEVEL ASC) SA, TN_CLM_CONT_CNSDREQ SB
			        WHERE SA.CNSDREQ_ID = SB.CNSDREQ_ID ) REQ_DT			        				
			  FROM TN_CLM_CONT_CNSDREQ REQ,
			       TN_CLM_CONTRACT_CNSD CNSD,
			       TN_CLM_CONTRACT_MASTER MASTER
			 WHERE REQ.CNSDREQ_ID = CNSD.CNSDREQ_ID
			   AND CNSD.CNTRT_ID = MASTER.CNTRT_ID
			   AND REQ.CNSDREQ_ID = :vo.cnsdreq_id
			   AND MASTER.CNTRT_ID = :vo.cntrt_id
		      ]]>
		  	</statement>		
		</query>
		
    </queries>
</queryservice>