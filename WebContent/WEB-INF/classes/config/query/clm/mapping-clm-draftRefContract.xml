<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
    	<!-- reference 계약서 목록 조회 : 2011.08.29 : 신남원 -->
		<query id="clm.draft.listRefContract" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    SELECT *
		    FROM	(
			    SELECT ROW_NUMBER() OVER (ORDER BY LIB_NO DESC, REG_DT DESC) RN,
			     t.*, COUNT(1) over() TOTAL_CNT
			    FROM	(
					    SELECT A.LIB_NO, A.LIB_GBN, A.LANG_GBN, A.BIZ_CLSFCN, A.DEPTH_CLSFCN, A.CNCLSNPURPS_BIGCLSFCN, 
					    	A.CNCLSNPURPS_MIDCLSFCN, A.TITLE, A.CONT, A.RDCNT, A.REG_DT, A.REG_ID, A.REG_NM,
							ISNULL(CASE WHEN :vo.session_user_locale = 'ko' THEN B1.CD_NM
			              			    WHEN :vo.session_user_locale = 'fr' THEN B1.CD_NM_FRA
			              			    WHEN :vo.session_user_locale = 'de' THEN B1.CD_NM_DEU
			              			    ELSE B1.CD_NM_ENG
			              		   END,'') AS LANG_GBN_NM,
		                    ISNULL(CASE WHEN :vo.session_user_locale = 'ko' THEN B2.CD_NM
			              			    WHEN :vo.session_user_locale = 'fr' THEN B2.CD_NM_FRA
			              			    WHEN :vo.session_user_locale = 'de' THEN B2.CD_NM_DEU
			              			    ELSE B2.CD_NM_ENG
			              		   END,'') AS BIZ_CLSFCN_NM,
		                    ISNULL(CASE WHEN :vo.session_user_locale = 'ko' THEN B3.CD_NM
			              			    WHEN :vo.session_user_locale = 'fr' THEN B3.CD_NM_FRA
			              			    WHEN :vo.session_user_locale = 'de' THEN B3.CD_NM_DEU
			              			    ELSE B3.CD_NM_ENG
			              		   END,'') AS DEPTH_CLSFCN_NM,
		                    ISNULL(CASE WHEN :vo.session_user_locale = 'ko' THEN B4.CD_NM
			              			    WHEN :vo.session_user_locale = 'fr' THEN B4.CD_NM_FRA
			              			    WHEN :vo.session_user_locale = 'de' THEN B4.CD_NM_DEU
			              			    ELSE B4.CD_NM_ENG
			              		   END,'') AS CNCLSNPURPS_BIGCLSFCN_NM,
		                    ISNULL(CASE WHEN :vo.session_user_locale = 'ko' THEN B5.CD_NM
			              			    WHEN :vo.session_user_locale = 'fr' THEN B5.CD_NM_FRA
			              			    WHEN :vo.session_user_locale = 'de' THEN B5.CD_NM_DEU
			              			    ELSE B5.CD_NM_ENG
			              		   END,'') AS CNCLSNPURPS_MIDCLSFCN_NM	 
						FROM 	(	SELECT  LIB_NO, LIB_GBN, LANG_GBN, BIZ_CLSFCN, DEPTH_CLSFCN, CNCLSNPURPS_BIGCLSFCN, CNCLSNPURPS_MIDCLSFCN, TITLE, CONT, RDCNT
									 , REPLACE(CONVERT(CHAR(10), REG_DT, 23),'-','') AS REG_DT /*YYYYMMDD*/
									 , REG_ID, REG_NM
									FROM 	TN_CLM_CONTRACT_LIBRARY
									WHERE	LIB_GBN = :vo.lib_gbn
									#if(!$vo.session_auth_comp_cd(""))
									   AND 	COMP_CD IN ($vo.session_auth_comp_cd)
									#end
									AND	 (DEL_YN = 'N' OR DEL_YN IS NULL)
							    #if (!$vo.srch_biz_clsfcn.equals(""))
								    AND		BIZ_CLSFCN = :vo.srch_biz_clsfcn
								#end
							    #if (!$vo.srch_lang_gbn.equals(""))
								    AND		LANG_GBN = :vo.srch_lang_gbn
								#end
							    #if (!$vo.srch_depth_clsfcn.equals(""))
								    AND		DEPTH_CLSFCN = :vo.srch_depth_clsfcn
								#end
							    #if (!$vo.srch_cnclsnpurps_bigclsfcn.equals(""))
								    AND		CNCLSNPURPS_BIGCLSFCN = :vo.srch_cnclsnpurps_bigclsfcn
								#end
							    #if (!$vo.srch_cnclsnpurps_midclsfcn.equals(""))
								    AND		CNCLSNPURPS_MIDCLSFCN = :vo.srch_cnclsnpurps_midclsfcn
								#end
						    #if (!$vo.srch_keyword_content.equals(""))
						    	#if($vo.srch_keyword.equals("title"))
								    AND		UPPER(TITLE) LIKE '%' + :vo.srch_keyword_content + '%' 
								#else
									AND		UPPER(REG_NM) LIKE '%' + :vo.srch_keyword_content + '%'
								#end
							#end
								    
									) A LEFT OUTER JOIN
										 (SELECT CD, CD_NM, CD_ABBR_NM, CD_NM_ENG, CD_ABBR_NM_ENG, CD_NM_FRA, CD_ABBR_NM_FRA, CD_NM_DEU, CD_ABBR_NM_DEU
												FROM TB_COM_CD
												WHERE SYS_CD = 'LAS'
												AND		GRP_CD = 'C045'
												) B1 ON A.LANG_GBN = B1.CD
												LEFT OUTER JOIN
												 (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
															 FROM TN_COM_CONTRACTTYPE_CD
															 WHERE UP_TYPE_CD = 'T01'
															 ) B2 ON A.BIZ_CLSFCN = B2.TYPE_CD
															 LEFT OUTER JOIN
															 (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																			FROM TN_COM_CONTRACTTYPE_CD
																			WHERE UP_TYPE_CD = 'T02'
																			) B3 ON A.DEPTH_CLSFCN = B3.TYPE_CD
																			LEFT OUTER JOIN
																			(SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																						 FROM TN_COM_CONTRACTTYPE_CD
																						 WHERE UP_TYPE_CD = 'T03'
																						 ) B4 ON A.CNCLSNPURPS_BIGCLSFCN = B4.TYPE_CD
																						 LEFT OUTER JOIN
																						 ( 	SELECT * FROM DBO.[CLM.DRAFT.LISTREFCONTRACT]()
																						 				) B5 ON A.CNCLSNPURPS_MIDCLSFCN = B5.TYPE_CD
						) t
					) TA
		    WHERE RN between :vo.start_index and :vo.end_index
		    ORDER BY RN
		    ]]>
		  </statement>
		</query>
		
		<!-- reference 계약서 저장 : 2011.08.29 : 신남원 -->
		<query id="clm.draft.insertRefContract" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    INSERT INTO TN_CLM_CONTRACT_LIBRARY (
		           		LIB_NO
		           	   , COMP_CD
		               , LIB_GBN
		               , REGION_GBN
		               , LANG_GBN
		               , BIZ_CLSFCN
		               , DEPTH_CLSFCN
		               , CNCLSNPURPS_BIGCLSFCN
		               , CNCLSNPURPS_MIDCLSFCN
		               , TITLE
		               , CONT
		               , RDCNT
		               , REG_DT
		               , REG_ID
		               , REG_NM
		               , DEL_YN
		        ) VALUES (
		           :vo.lib_no
		          ,#if(!$vo.session_auth_comp_cd.equals(""))
			       	($vo.session_auth_comp_cd)
			       #else
			       	'' 
			       #end
		          ,:vo.lib_gbn
		          ,'C01801'
		          ,:vo.lang_gbn
		          ,:vo.biz_clsfcn
		          ,:vo.depth_clsfcn
		          ,:vo.cnclsnpurps_bigclsfcn
		          ,:vo.cnclsnpurps_midclsfcn
		          ,:vo.title
		          ,:vo.cont
		          ,:vo.rdcnt
		          ,GETDATE()
		          ,:vo.reg_id
		          ,:vo.reg_nm
		          , 'N'
		        )
		    ]]>
		  </statement>
		</query>
		
		<!-- reference 계약서 MAX LIB_NO : 2011.08.29 : 신남원 -->
		<query id="clm.draft.maxLibNoRefContract" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        SELECT ISNULL(MAX(LIB_NO),0) AS MAX_LIB_NO FROM TN_CLM_CONTRACT_LIBRARY
		    ]]>
		  </statement>
		</query>
				
		<!-- reference 계약서 조회수 증가 : 2011.08.29 : 신남원 -->
		<query id="clm.draft.modifyRdcntRefContract" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        UPDATE 	TN_CLM_CONTRACT_LIBRARY
	        SET		RDCNT = RDCNT + 1
		    WHERE	LIB_NO = :vo.lib_no
		    AND	 	(DEL_YN = 'N' OR DEL_YN IS NULL)		
		    ]]>
		  </statement>
		</query>
				
    	<!-- reference 계약서 상세 조회 : 2011.08.29 : 신남원 -->
		<query id="clm.draft.detailRefContract" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    SELECT A.LIB_NO, A.LIB_GBN, A.LANG_GBN, A.BIZ_CLSFCN, A.DEPTH_CLSFCN, A.CNCLSNPURPS_BIGCLSFCN, 
		    	A.CNCLSNPURPS_MIDCLSFCN, A.TITLE, A.CONT, A.RDCNT, A.REG_DT, A.REG_ID, A.REG_NM,
				ISNULL(CASE WHEN :vo.session_user_locale = 'ko' THEN B1.CD_NM
			              	WHEN :vo.session_user_locale = 'fr' THEN B1.CD_NM_FRA
			              	WHEN :vo.session_user_locale = 'de' THEN B1.CD_NM_DEU
			              	ELSE B1.CD_NM_ENG
			           END, '') AS LANG_GBN_NM,
                ISNULL(CASE WHEN :vo.session_user_locale = 'ko' THEN B2.CD_NM
			              	WHEN :vo.session_user_locale = 'fr' THEN B2.CD_NM_FRA
			              	WHEN :vo.session_user_locale = 'de' THEN B2.CD_NM_DEU
			              	ELSE B2.CD_NM_ENG
			           END, '') AS BIZ_CLSFCN_NM,
                ISNULL(CASE WHEN :vo.session_user_locale = 'ko' THEN B3.CD_NM
			              	WHEN :vo.session_user_locale = 'fr' THEN B3.CD_NM_FRA
			              	WHEN :vo.session_user_locale = 'de' THEN B3.CD_NM_DEU
			              	ELSE B3.CD_NM_ENG
			           END, '') AS DEPTH_CLSFCN_NM,
                ISNULL(CASE WHEN :vo.session_user_locale = 'ko' THEN B4.CD_NM
			              	WHEN :vo.session_user_locale = 'fr' THEN B4.CD_NM_FRA
			              	WHEN :vo.session_user_locale = 'de' THEN B4.CD_NM_DEU
			              	ELSE B4.CD_NM_ENG
			           END, '') AS CNCLSNPURPS_BIGCLSFCN_NM,
                ISNULL(CASE WHEN :vo.session_user_locale = 'ko' THEN B5.CD_NM
			              	WHEN :vo.session_user_locale = 'fr' THEN B5.CD_NM_FRA
			              	WHEN :vo.session_user_locale = 'de' THEN B5.CD_NM_DEU
			              	ELSE B5.CD_NM_ENG
			           END, '') AS CNCLSNPURPS_MIDCLSFCN_NM	 
			FROM (SELECT  LIB_NO
				 	   	 ,LIB_GBN
						 ,LANG_GBN
						 ,BIZ_CLSFCN
						 ,DEPTH_CLSFCN
						 ,CNCLSNPURPS_BIGCLSFCN
						 ,CNCLSNPURPS_MIDCLSFCN
						 ,TITLE
						 ,CONT
						 ,RDCNT
						 ,REPLACE(CONVERT(CHAR(10), REG_DT, 23),'-','') AS REG_DT /*YYYYMMDD*/
						 ,REG_ID
						 ,REG_NM
						FROM 	TN_CLM_CONTRACT_LIBRARY
						WHERE	LIB_NO = :vo.lib_no
						#if(!$vo.session_auth_comp_cd.equals(""))
						    AND 	COMP_CD IN ($vo.session_auth_comp_cd) 
						#end
						AND	 (DEL_YN = 'N' OR DEL_YN IS NULL)
						) A LEFT OUTER JOIN (SELECT CD, CD_NM, CD_ABBR_NM, CD_NM_ENG, CD_ABBR_NM_ENG, CD_NM_FRA, CD_ABBR_NM_FRA, CD_NM_DEU, CD_ABBR_NM_DEU
									FROM TB_COM_CD
									WHERE SYS_CD = 'LAS'
									AND		GRP_CD = 'C045'
									) B1 ON A.LANG_GBN = B1.CD
									LEFT OUTER JOIN
									(SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
												 FROM TN_COM_CONTRACTTYPE_CD
												 WHERE UP_TYPE_CD = 'T01'
												 ) B2 ON A.BIZ_CLSFCN = B2.TYPE_CD
												 LEFT OUTER JOIN
												 (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																FROM TN_COM_CONTRACTTYPE_CD
																WHERE UP_TYPE_CD = 'T02'
																) B3 ON A.DEPTH_CLSFCN = B3.TYPE_CD
																LEFT OUTER JOIN
																(SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																			 FROM TN_COM_CONTRACTTYPE_CD
																			 WHERE UP_TYPE_CD = 'T03'
																			 ) B4 ON A.CNCLSNPURPS_BIGCLSFCN = B4.TYPE_CD
																			 LEFT OUTER JOIN
																			( 	SELECT * FROM DBO.[CLM.DRAFT.LISTREFCONTRACT]()
																			 				) B5 ON A.CNCLSNPURPS_MIDCLSFCN = B5.TYPE_CD
			 
		    ]]>
		  </statement>
		</query>
				
		<!-- reference 계약서 수정 : 2011.08.29 : 신남원 -->
		<query id="clm.draft.modifyRefContract" isCamelCase="false">
		  <statement>
		    <![CDATA[
			UPDATE TN_CLM_CONTRACT_LIBRARY
	        SET LANG_GBN = :vo.lang_gbn
              , BIZ_CLSFCN = :vo.biz_clsfcn
              , DEPTH_CLSFCN = :vo.depth_clsfcn
              , CNCLSNPURPS_BIGCLSFCN = :vo.cnclsnpurps_bigclsfcn
              , CNCLSNPURPS_MIDCLSFCN = :vo.cnclsnpurps_midclsfcn
              , TITLE = :vo.title
              , CONT = :vo.cont
              , MOD_DT = GETDATE()
              , MOD_ID = :vo.mod_id
              , MOD_NM = :vo.mod_nm
			WHERE	LIB_NO = :vo.lib_no
			    #if(!$vo.session_auth_comp_cd.equals(""))
			        AND COMP_CD IN ($vo.session_auth_comp_cd)
			    #end
		    ]]>
		  </statement>
		</query>
		
		<!-- reference 계약서 삭제 : 2011.08.29 : 신남원 -->
		<query id="clm.draft.deleteRefContract" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        UPDATE 	TN_CLM_CONTRACT_LIBRARY
	        SET		DEL_YN = 'Y'
	        		, DEL_ID = :vo.del_id
	        		, DEL_DT = GETDATE()
	        		, DEL_NM = :vo.del_nm
		    WHERE	LIB_NO = :vo.lib_no
		    	#if(!$vo.session_auth_comp_cd.equals(""))
			        AND COMP_CD IN ($vo.session_auth_comp_cd)
			    #end			    
		    ]]>
		  </statement>
		</query>

		<!-- reference 계약서 권한 체크 정보 : 2011.08.29 : 신남원 -->
		<query id="clm.draft.authRefContract" isCamelCase="false">
		  <statement>
		    <![CDATA[
			SELECT	LIB_NO, LIB_GBN, LANG_GBN, BIZ_CLSFCN, DEPTH_CLSFCN, CNCLSNPURPS_BIGCLSFCN, CNCLSNPURPS_MIDCLSFCN, TITLE, CONT, RDCNT
				  , REPLACE(CONVERT(CHAR(10), REG_DT, 23),'-','') AS REG_DT /*YYYYMMDD*/
				  , REG_ID, REG_NM
			FROM 	TN_CLM_CONTRACT_LIBRARY
			WHERE	LIB_NO = :vo.lib_no
			    #if(!$vo.session_auth_comp_cd.equals(""))
			        AND COMP_CD IN ($vo.session_auth_comp_cd)
			    #end
				
		    ]]>
		  </statement>
		</query>
		
		<!-- 표준계약서조회 -->
		<query id="clm.draft.listStdContract" isCamelCase="false">
			<statement>
    		<![CDATA[
			SELECT  *
                  FROM  (
                        SELECT  ROW_NUMBER() OVER(ORDER BY A.CNSLT_NO) RM
                               ,COUNT(1) over() TOTAL_CNT
                               ,A.*
                          FROM (SELECT CASE WHEN PRGRS_STATUS_1 IN ('S02','S04','S11') THEN
                                              CASE WHEN PRGRS_STATUS_1 = 'S11' THEN 'S09'
                                                   ELSE
			                                            CASE WHEN RESPMAN_NM IS NOT NULL THEN 'V02'
			                                                 ELSE 'V01'
			                                            END
			                                  END         
                                            ELSE PRGRS_STATUS_1
                                       END AS PRGRS_STATUS
                                      ,CASE WHEN PRGRS_STATUS_1 IN ('S02','S04') THEN
                                            CASE WHEN RESPMAN_NM IS NOT NULL THEN 
                                            	CASE WHEN :vo.session_user_locale = 'ko' THEN
                                            		'검토중'
                                            	WHEN :vo.session_user_locale = 'fr' THEN
                                            		'revue en cours de traitement'
                                            	WHEN :vo.session_user_locale = 'de' THEN
                                            		'Prüfung in Bearbeitung'
                                            	WHEN :vo.session_user_locale = 'it' THEN
                                            		'IT_검토중'
                                            	WHEN :vo.session_user_locale = 'es' THEN
                                            		'ES_검토중'
                                            	ELSE
                                            		'Review in Process'
                                            	END
                                            ELSE
                                                CASE WHEN :vo.session_user_locale = 'ko' THEN
                                                  	'미배정'
                                                WHEN :vo.session_user_locale = 'fr' THEN
                                            		'En attente de désignation'
                                            	WHEN :vo.session_user_locale = 'de' THEN
                                            		'Benennung steht aus.'
                                            	WHEN :vo.session_user_locale = 'it' THEN
                                            		'IT_미배정'
                                            	WHEN :vo.session_user_locale = 'es' THEN
                                            		'ES_미배정'
                                                ELSE
                                                  	'Not Designated'
                                                END
                                            END
                                            ELSE PRGRS_STATUS_NAME
                                       END AS PRGRS_STATUS_NAME_100     
                                      ,A1.*                                  
                                FROM
                                (
                                SELECT  TLC.CNSLT_NO
								       ,TLC.HSTRY_NO
								       ,TLC.DMSTFRGN_GBN
								       ,TLC.TITLE
								       ,TLC.INTNL_PRGRS_STATUS AS PRGRS_STATUS_1
								       ,TCC.CD_NM AS PRGRS_STATUS_NAME
								       ,dbo.LAS_CONSULT_RESPMAN(TLC.CNSLT_NO, ',') RESPMAN_NM
								       ,CONVERT(CHAR(16),MIN_TLC.MIN_REG_DT,120) AS REG_DT /*YYYY-MM-DD HH24:MI*/
                                       ,CONVERT(CHAR(10), MIN_TLC.MIN_REG_DT, 23) AS REG_DT_DATE /*YYYY-MM-DD*/
								       ,TLC.REG_NM
								       ,TLC.REG_DEPT_NM
								       ,USR.COMP_NM
								       ,MIN_TLC.MIN_REG_DT
                                  FROM  TN_LAS_CONSULT TLC, 
                                        TB_COM_CD TCC,
                                        TN_LAS_CONSULT_TYPE TNCT,
                                        (SELECT MAX(HSTRY_NO) MAX_HSTRY_NO, CNSLT_NO
                                           FROM TN_LAS_CONSULT
                                          WHERE DEL_YN = 'N'
                                          #if ($vo.srch_cont && !$vo.srch_cont.equals("")) 
                                   			AND    CONT LIKE '%' + :vo.srch_cont +  '%'
                                   		  #end
		                                  #if ($vo.srch_title && !$vo.srch_title.equals("")) 
		                                    AND  UPPER(TITLE) LIKE '%' + UPPER(:vo.srch_title) +  '%'
		                                  #end
                                       GROUP BY CNSLT_NO ) MAX_TLC
                                       ,(SELECT MIN(REG_DT) MIN_REG_DT, CNSLT_NO
                                           FROM TN_LAS_CONSULT
                                          WHERE DEL_YN = 'N'
                                          #if ($vo.srch_cont && !$vo.srch_cont.equals("")) 
                                   			AND    CONT LIKE '%' + :vo.srch_cont +  '%'
                                   		  #end
		                                  #if ($vo.srch_title && !$vo.srch_title.equals("")) 
		                                    AND  UPPER(TITLE) LIKE '%' + UPPER(:vo.srch_title) +  '%'
		                                  #end
                                       GROUP BY CNSLT_NO ) MIN_TLC
                                       ,TB_COM_USER USR
                                 WHERE TLC.DEL_YN = 'N' 
                                   AND TLC.INTNL_PRGRS_STATUS = TCC.CD
                                   AND TLC.INTNL_PRGRS_STATUS = 'S03'
                                   AND TCC.GRP_CD = 'N1_I'
                                   AND TLC.CNSLT_NO = MAX_TLC.CNSLT_NO
                                   AND TLC.HSTRY_NO = MAX_TLC.MAX_HSTRY_NO
                                   AND TLC.CNSLT_NO = MIN_TLC.CNSLT_NO
                                   AND TLC.CNSLT_NO = TNCT.CNSLT_NO
                                   AND TLC.HSTRY_NO = TNCT.HSTRY_NO
                                   AND TNCT.CNSLT_TYPE = 'A20'
                                   AND USR.USER_ID = :vo.user_id
                                   #if(!$vo.session_auth_comp_cd.equals(""))
                                       AND TLC.COMP_CD IN ($vo.session_auth_comp_cd)
                                   #end
                                   #if ($vo.isForeign.equals("false"))
                                       AND TLC.DMSTFRGN_GBN = 'H'
                                   #else
                                       AND TLC.DMSTFRGN_GBN = 'F'
                                   #end
                                   #if ($vo.srch_reg_nm && !$vo.srch_reg_nm.equals("")) 
                                       AND UPPER(TLC.REG_NM) LIKE '%' + UPPER(:vo.srch_reg_nm) +  '%'
                                   #end
                                   #if ($vo.srch_reg_id && !$vo.srch_reg_id.equals("")) 
                                       AND  TLC.REG_ID LIKE '%' + :vo.srch_reg_id +  '%'
                                   #end
                                   #if ($vo.srch_start_ymd && !$vo.srch_start_ymd.equals(""))
                                       /* AND  MIN_TLC.MIN_REG_DT >= TO_DATE(:vo.srch_start_ymd) */
                                       AND  MIN_TLC.MIN_REG_DT >= CONVERT(DATETIME, REPLACE(:vo.srch_start_ymd,'-','') , 112)
                                   #end
                                   #if ($vo.srch_end_ymd && !$vo.srch_end_ymd.equals(""))
                                       /* AND  MIN_TLC.MIN_REG_DT <= TO_DATE(:vo.srch_end_ymd) + 1 */
                                       AND  MIN_TLC.MIN_REG_DT <= CONVERT(DATETIME, REPLACE(:vo.srch_end_ymd,'-','') , 112) + 1
                                   #end
                                   #if($vo.srch_consult_type && !$vo.srch_consult_type.equals(""))
                                       AND EXISTS ( SELECT *
                                   				  FROM TN_LAS_CONSULT_TYPE TLCT
                                   				 WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
                                   				   AND TLC.HSTRY_NO = TLCT.HSTRY_NO
                                   				   AND TLCT.CNSLT_TYPE = :vo.srch_consult_type
                                             )
                                  #end
                                 ) A1 ) A
                            WHERE 1=1
                            #if ($vo.srch_respman_nm && !$vo.srch_respman_nm.equals("")) 
                            AND UPPER(RESPMAN_NM) LIKE '%' + UPPER(:vo.srch_respman_nm) +  '%'
                            #end
                            #if ($vo.srch_prgrs_status && !$vo.srch_prgrs_status.equals("")) 
                            AND  PRGRS_STATUS LIKE '%' + :vo.srch_prgrs_status +  '%'
                            #end 
                            ) B
                            ORDER  BY B.MIN_REG_DT DESC
             ]]>
			</statement>
		</query>
		
		<!-- 표준계약서 상세조회 쿼리 -->
		<query id="clm.draft.detailStdContract" isCamelCase="false">
			<statement>
    		<![CDATA[
				WITH GRP_TABLE( CNSLT_NO, HSTRY_NO, CNSLT_TYPENM, CNSLT_TYPE,RNUM,CNSLT_TYPENM2,D1) AS
				(
				  SELECT 
							 SA.*,SB.*
							
						FROM (SELECT CNSLT_NO, HSTRY_NO, CNSLT_TYPENM, CNSLT_TYPE, 
	 		                           ROW_NUMBER() OVER (PARTITION BY CNSLT_NO, HSTRY_NO ORDER BY CNSLT_TYPENM) RNUM
	 		                      FROM TN_LAS_CONSULT_TYPE
	 		                     WHERE CNSLT_NO = :vo.cnslt_no
	 		               		   AND HSTRY_NO = :vo.hstry_no
							   ) SA  JOIN (SELECT ' ' CNSLT_TYPENM2, 1 D1 UNION ALL SELECT ' ' CNSLT_TYPENM2, 2 D1) SB ON 1=1
				)
				SELECT TLC.CNSLT_NO
	    			  ,TLC.HSTRY_NO
	    			  ,TLC.TITLE
	 				  ,TLC.INTNL_PRGRS_STATUS PRGRS_STATUS
					  ,TLC.REG_DT AS REG_DT
	 		  		  ,TLC.REG_ID
	 		  		  ,TLC.REG_NM
	  	 			  ,TLC.REG_TELNO
	  	 			  ,TLC.REG_DEPT_NM
	  	 			  ,TLC.REG_DEPT
	      			  ,TLC.CONT
	      			  ,TLC.HOLD_CAUSE
	      			  ,TLC.REJCT_CAUSE
	      			  ,TLC.ORDR_CONT
	      			  ,TLC.GRPMGR_RE_YN
	      			  ,TLC.EXTNL_CNSLTYN
	      			  ,TLC.CNSD_OPNN
	      			  ,TLC.CNSDMAN_NM
	      			  ,TLC.MAIN_MATR_CONT
	      			  ,TLC.APBT_OPNN
	      			  ,TLC.DMSTFRGN_GBN
	      			  ,TLC.REGMAN_JIKGUP_NM
	      			  ,TLC.REG_OPERDIV
			  		  ,(SELECT CD_NM
	 		      		  FROM TB_COM_CD
	  	     			 WHERE CD = TLC.INTNL_PRGRS_STATUS
	  	     			   AND GRP_CD = 'N1_I'
	 		   		   ) PRGRS_STATUS_NAME
	 				  ,TLCT.CONSULT_TYPE_NAME
	      			  ,TLCT.CONSULT_TYPE
					  ,DBO.[LAS_CONSULT_RESPMAN](TLC.CNSLT_NO,',') RESPMAN_NM
	  			 FROM (
				    	SELECT * FROM (	
						SELECT 
							 STUFF((		
							 SELECT ','+ CNSLT_TYPENM FROM GRP_TABLE WHERE D1=1 FOR XML PATH('')) , 1,1, '')    CONSULT_TYPE_NAME,
							 STUFF((		
							 SELECT ','+ CNSLT_TYPE FROM GRP_TABLE WHERE D1=1 FOR XML PATH('')) , 1,1, '')    CONSULT_TYPE,
							 CNSLT_NO TLCT_CNSLT_NO, HSTRY_NO TLCT_HSTRY_NO
							 FROM GRP_TABLE ) TA
							 GROUP BY TLCT_CNSLT_NO, TLCT_HSTRY_NO, CONSULT_TYPE_NAME, CONSULT_TYPE
				      ) TLCT LEFT OUTER JOIN TN_LAS_CONSULT TLC 
					  ON TLC.CNSLT_NO = TLCT.TLCT_CNSLT_NO AND TLC.HSTRY_NO = TLCT.TLCT_HSTRY_NO 
			    WHERE CNSLT_NO = :vo.cnslt_no
	   			  AND HSTRY_NO = :vo.hstry_no
   			  ]]>
			</statement>
		</query>
		
		<!-- 표준계약서 의뢰List 쿼리 -->
		<query id="clm.draft.listHistory_reqman" isCamelCase="false">
			<statement>
    		<![CDATA[
            SELECT  TLC.CNSLT_NO
			       ,TLC.HSTRY_NO
			       ,TLC.CNSLT_POS
			       ,TLC.CNSLT_SRT
			       ,TLC.DMSTFRGN_GBN
			       ,TLC.TITLE
			       ,TLC.INTNL_PRGRS_STATUS PRGRS_STATUS
			       ,TCC.CD_NM AS PRGRS_STATUS_NAME
			       ,CONVERT(CHAR(16),TLC.REG_DT,120) AS REG_DT /*YYYY-MM-DD HH24:MI*/
                   ,ISNULL(CONVERT(CHAR(10), CONVERT(DATE, TLC.CNSD_DT), 23), CONVERT(CHAR(10), CONVERT(DATE, TLC.REG_DT), 23)) AS REG_DT_DATE /*YYYY-MM-DD*/
			       ,ISNULL(TLC.CNSDMAN_NM, TLC.REG_NM) REG_NM
			       ,DBO.LAS_CONSULT_RESPMAN(TLC.CNSLT_NO, ',') RESPMAN_NM
                    FROM  TN_LAS_CONSULT TLC, TB_COM_CD TCC

                    WHERE  TLC.DEL_YN = 'N' 
                    AND TLC.PUB_YN = 'Y'
                    AND TLC.INTNL_PRGRS_STATUS = TCC.CD
                    AND TCC.GRP_CD = 'N1_I'
                    AND TLC.CNSLT_NO = :vo.cnslt_no
                                 
                    #if ($vo.isForeign.equals("false"))
                    AND TLC.DMSTFRGN_GBN = 'H'
                    #else
                    AND TLC.DMSTFRGN_GBN = 'F'
                    #end
                                   
                    ORDER  BY TLC.CNSLT_SRT
             ]]>
			</statement>
		</query>
    </queries>
</queryservice>