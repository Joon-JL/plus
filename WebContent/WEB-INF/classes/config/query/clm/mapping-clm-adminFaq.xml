<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
    
        <!-- FAQ 목록 조회 : 2011.09.05 : 신남원 -->
		<query id="clm.counsel.listFaq" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    SELECT X.*,
		    		CASE WHEN :vo.session_user_locale = 'ko' THEN Y.CD_NM
		    			 WHEN :vo.session_user_locale = 'fr' THEN Y.CD_NM_FRA
		    			 WHEN :vo.session_user_locale = 'de' THEN Y.CD_NM_DEU
		    			 WHEN :vo.session_user_locale = 'it' THEN Y.CD_NM_ITA
		    			 WHEN :vo.session_user_locale = 'es' THEN Y.CD_NM_ESP
		    			 ELSE Y.CD_NM_ENG
		    		END AS CONT_TYPE_NM
		    FROM	(
				   	SELECT *
				    FROM	(
							SELECT rownum RN, t.*, COUNT(1) over() TOTAL_CNT
						    FROM	(
									SELECT  SEQNO, TITLE, TITLE_EN, CONT, CONT_EN, CONT_TYPE, RDCNT, TO_CHAR(REG_DT, 'YYYYMMDD') AS REG_DT
								    FROM 	TN_CLM_ANNOUNCE
									WHERE	SEQNO IN (SELECT 	SEQNO
													  FROM		TN_CLM_ANNOUNCE
													  WHERE		DEL_YN='N'
													  AND		ANNCE_GBN = 'C01302'
													  AND		RD_TRGT1 = 'C01601' 
													
													  UNION
													
													  SELECT 	SEQNO
													  FROM 		TN_CLM_ANNOUNCE
													  WHERE		DEL_YN='N'
													  AND		ANNCE_GBN = 'C01302'
													  AND		RD_TRGT1 = 'C01602' 
													  AND 		SEQNO IN (SELECT DISTINCT SEQNO 
																	  		FROM TN_CLM_ANNCE_TRGTORGNZ 
																	  		WHERE ORGNZ_CD = :vo.session_blngt_orgnz)									
													 )								    
					        #if (!$vo.srch_keyword_content.equals(""))
						    	#if($vo.srch_keyword.equals("title"))
									AND		UPPER(TITLE) LIKE '%' + :vo.srch_keyword_content + '%' 
								#else
									AND		UPPER(CONT) LIKE '%' + :vo.srch_keyword_content + '%'
								#end
							#end
								#if(!$vo.srch_cont_type.equals(""))
									AND		CONT_TYPE = :vo.srch_cont_type
								#end
									ORDER BY RDCNT DESC
								     ) t
							 ) 
				    WHERE RN between :vo.start_index and :vo.end_index
				    ) X, TB_COM_CD Y
			WHERE 	Y.SYS_CD = 'CLM'
			AND		Y.GRP_CD = 'C015'
			AND		X.CONT_TYPE = Y.CD
			ORDER BY X.RN
		    ]]>
		  </statement>
		</query>
    
    	<!-- ADMIN FAQ 목록 조회 : 2011.09.05 : 신남원 -->
		<query id="clm.admin.listFaq" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    SELECT MASTER.*, TO_CHAR(DETAIL1.ORG_NM) AS ORGNZ_NM, ISNULL(DETAIL2.ORGNZ_NMS, '') AS ORGNZ_NMS
		    FROM	(
				    SELECT X.*,
				    		CASE WHEN :vo.session_user_locale = 'ko' THEN Y.CD_NM
				    			 WHEN :vo.session_user_locale = 'fr' THEN Y.CD_NM_FRA
								 WHEN :vo.session_user_locale = 'de' THEN Y.CD_NM_DEU
								 WHEN :vo.session_user_locale = 'it' THEN Y.CD_NM_ITA
								 WHEN :vo.session_user_locale = 'es' THEN Y.CD_NM_ESP
				    			 ELSE Y.CD_NM_ENG
				    		END AS CONT_TYPE_NM,
				    		CASE WHEN :vo.session_user_locale = 'ko' THEN Z.CD_NM
				    		     WHEN :vo.session_user_locale = 'fr' THEN Z.CD_NM_FRA
				    		     WHEN :vo.session_user_locale = 'de' THEN Z.CD_NM_DEU
				    		     WHEN :vo.session_user_locale = 'it' THEN Z.CD_NM_ITA
				    		     WHEN :vo.session_user_locale = 'es' THEN Z.CD_NM_ESP
				    			 ELSE Z.CD_NM_ENG
				    		END AS RD_TRGT1_NM
				    FROM	(
						   	SELECT *
						    FROM	(
									SELECT rownum RN, t.*, COUNT(1) over() TOTAL_CNT
								    FROM	(
								    		SELECT SEQNO, TITLE, TITLE_EN, CONT_TYPE, CONT, CONT_EN, RD_TRGT1, RDCNT, TO_CHAR(REG_DT, 'YYYYMMDD') AS REG_DT, REG_ID, REG_NM, REGMAN_JIKGUP_NM, REG_DEPT_NM
										    FROM 	TN_CLM_ANNOUNCE
										    WHERE	DEL_YN='N'
										    AND		ANNCE_GBN = 'C01302'
							        #if (!$vo.srch_keyword_content.equals(""))
								    	#if($vo.srch_keyword.equals("title"))
											AND		UPPER(TITLE) LIKE '%' + :vo.srch_keyword_content + '%' 
										#else
											AND		UPPER(CONT) LIKE '%' + :vo.srch_keyword_content + '%'
										#end
									#end
										#if(!$vo.srch_cont_type.equals(""))
											AND		CONT_TYPE = :vo.srch_cont_type
										#end
											ORDER BY RDCNT DESC
										    ) t
									 ) 
						    WHERE RN between :vo.start_index and :vo.end_index
						    ) X, TB_COM_CD Y, TB_COM_CD Z
					WHERE 	Y.SYS_CD = 'CLM'
					AND		Y.GRP_CD = 'C015'
					AND		X.CONT_TYPE = Y.CD			
					AND		Z.SYS_CD = 'CLM'
					AND		Z.GRP_CD = 'C016'
					AND		X.RD_TRGT1 = Z.CD
					) MASTER, (
								SELECT M.SEQNO, 
											CASE WHEN M.ORGNZ_CNT > 1 THEN 
												CASE WHEN :vo.session_user_locale = 'ko' THEN
													D.ORGNZ_NM + ' 외 ' + TO_CHAR(M.ORGNZ_CNT - 1) + '개'
												ELSE
													D.ORGNZ_NM_ENG + ' and ' + TO_CHAR(M.ORGNZ_CNT - 1) + ' others'
												END
												   ELSE 
                           						CASE WHEN :vo.session_user_locale = 'ko' THEN
                            						ISNULL(D.ORGNZ_NM, '')
                            					ELSE
                            						ISNULL(D.ORGNZ_NM_ENG, '')
                            					END
											END AS ORG_NM
								FROM	(
											SELECT SEQNO, MIN(ORGNZ_CD) AS ORGNZ_CD, COUNT(ORGNZ_CD) AS ORGNZ_CNT
											FROM	TN_CLM_ANNCE_TRGTORGNZ
											GROUP BY SEQNO
											) M, TN_CLM_UNITORGNZ D
								WHERE M.ORGNZ_CD = D.ORGNZ_CD
								AND		D.DEL_YN = 'N'						
							  )	DETAIL1, (
									  	SELECT SEQNO, SUBSTRING(MAX(SYS_CONNECT_BY_PATH(ORGNZ_NM, ', ')), 2) AS ORGNZ_NMS
										FROM	(
													SELECT O.SEQNO, P.ORGNZ_NM, row_number() OVER(PARTITION BY O.SEQNO ORDER BY P.ORGNZ_NM ) AS rn
													FROM 	TN_CLM_ANNCE_TRGTORGNZ O, TN_CLM_UNITORGNZ P
													WHERE O.ORGNZ_CD = P.ORGNZ_CD
													)
										START WITH rn = 1
										CONNECT BY PRIOR rn = rn - 1 AND PRIOR SEQNO = SEQNO
										GROUP BY SEQNO
							  			 ) DETAIL2
			WHERE 	MASTER.SEQNO = DETAIL1.SEQNO(+)
			AND		MASTER.SEQNO = DETAIL2.SEQNO(+)
			ORDER BY MASTER.RN
		    ]]>
		  </statement>
		</query>
				
		<!-- ADMIN FAQ 등록 : 2011.09.05 : 신남원 -->
		<query id="clm.admin.insertFaq" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    INSERT INTO TN_CLM_ANNOUNCE (
	           		 SEQNO
	               , ANNCE_GBN
	               , TITLE
	               , TITLE_EN
	               , CONT
	               , CONT_EN
				   , CONT_TYPE
				   , RD_TRGT1
	               , REG_DT
	               , REG_ID
	               , REG_NM
	               , REGMAN_JIKGUP_NM
	               , REG_DEPT_NM
	               , DEL_YN
		        ) VALUES (
		           :vo.seqno
		          ,'C01302'
		          ,:vo.title
		          ,:vo.title_en
		          ,:vo.cont
		          ,:vo.cont_en
		          ,:vo.cont_type
		          ,:vo.rd_trgt1
		          ,SYSDATE
		          ,:vo.reg_id
		          ,:vo.reg_nm
		          ,:vo.regman_jikgup_nm
		          ,:vo.reg_dept_nm
		          ,'N'
		        )
		    ]]>
		  </statement>
		</query>

		<!-- ADMIN FAQ 조직 조회 : 2011.09.05 : 신남원 -->
		<query id="clm.admin.listFaqOrgnz" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    SELECT  A.SEQNO, A.ORGNZ_CD, B.ORGNZ_NM
		    FROM	TN_CLM_ANNCE_TRGTORGNZ A, TN_CLM_UNITORGNZ B
			WHERE 	A.ORGNZ_CD = B.ORGNZ_CD
			AND		A.SEQNO = :vo.seqno
		    ]]>
		  </statement>
		</query>
		
		<!-- ADMIN FAQ 조직 등록 : 2011.09.05 : 신남원 -->
		<query id="clm.admin.insertFaqOrgnz" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    INSERT INTO TN_CLM_ANNCE_TRGTORGNZ (
	           		 SEQNO
	           		,ORGNZ_CD
		        ) VALUES (
		           :vo.seqno
		          ,:vo.orgnz_cd
		        )
		    ]]>
		  </statement>
		</query>		
		
		<!-- ADMIN FAQ 조직 삭제 : 2011.09.05 : 신남원 -->
		<query id="clm.admin.deleteFaqOrgnz" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    DELETE FROM TN_CLM_ANNCE_TRGTORGNZ
		    WHERE SEQNO = :vo.seqno
		    ]]>
		  </statement>
		</query>		
		
		<!-- ADMIN FAQ MAX SEQ_NO : 2011.09.05 : 신남원 -->
		<query id="clm.admin.maxSeqNoFaq" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        SELECT MAX(SEQNO) AS MAX_SEQ_NO FROM TN_CLM_ANNOUNCE
		    ]]>
		  </statement>
		</query>
				
		<!-- ADMIN FAQ 상세 : 2011.09.05 : 신남원 -->
		<query id="clm.admin.detailFaq" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    SELECT A.*,
		    		CASE WHEN :vo.session_user_locale = 'ko' THEN B.CD_NM
		    			 WHEN :vo.session_user_locale = 'fr' THEN B.CD_NM_FRA
		    			 WHEN :vo.session_user_locale = 'de' THEN B.CD_NM_DEU
		    			 WHEN :vo.session_user_locale = 'it' THEN B.CD_NM_ITA
		    			 WHEN :vo.session_user_locale = 'es' THEN B.CD_NM_ESP
		    			 ELSE B.CD_NM_ENG
		    		END AS RD_TRGT1_NM,
		    		CASE WHEN :vo.session_user_locale = 'ko' THEN C.CD_NM
		    			 WHEN :vo.session_user_locale = 'fr' THEN C.CD_NM_FRA
		    			 WHEN :vo.session_user_locale = 'de' THEN C.CD_NM_DEU
		    			 WHEN :vo.session_user_locale = 'it' THEN C.CD_NM_ITA
		    			 WHEN :vo.session_user_locale = 'es' THEN C.CD_NM_ESP
		    			 ELSE C.CD_NM_ENG
		    		END AS CONT_TYPE_NM
			FROM	(
				    SELECT 	 SEQNO
					        ,TITLE
					        ,TITLE_EN
					        ,CONT
					        ,CONT_EN
					        ,RDCNT
					        ,RD_TRGT1
					        ,CONT_TYPE
					        ,TO_CHAR(REG_DT, 'YYYYMMDD') AS REG_DT
					        ,REG_ID
					        ,REG_NM
					        ,REGMAN_JIKGUP_NM
					        ,REG_DEPT_NM
				    FROM 	TN_CLM_ANNOUNCE
				    WHERE 	SEQNO = :vo.seqno
				    AND		ANNCE_GBN = 'C01302'
				    AND		DEL_YN ='N'
				    ) A, TB_COM_CD B, TB_COM_CD C
			WHERE	B.SYS_CD = 'CLM'
			AND   	B.GRP_CD = 'C016'
			AND		A.RD_TRGT1 = B.CD
			AND		C.SYS_CD = 'CLM'
			AND		C.GRP_CD = 'C015'
			AND   	A.CONT_TYPE = C.CD 		    
		    ]]>
		  </statement>
		</query>
		
		<!-- ADMIN FAQ 조회수 증가 : 2011.09.05 : 신남원 -->
		<query id="clm.admin.modifyRdcntFaq" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        UPDATE 	TN_CLM_ANNOUNCE
	        SET		RDCNT = RDCNT + 1
		    WHERE	SEQNO = :vo.seqno
		    AND	 	(DEL_YN = 'N' OR DEL_YN IS NULL)		
		    ]]>
		  </statement>
		</query>		
		
		<!-- ADMIN FAQ 수정 : 2011.09.05 : 신남원 -->
		<query id="clm.admin.modifyFaq" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        UPDATE TN_CLM_ANNOUNCE
	        SET	TITLE = :vo.title
              , CONT_TYPE = :vo.cont_type
              , CONT = :vo.cont
              , CONT_EN = :vo.cont_en
              ,	RD_TRGT1 = :vo.rd_trgt1
              , MOD_DT = SYSDATE
              , MOD_ID = :vo.mod_id
              , MOD_NM = :vo.mod_nm
	        WHERE SEQNO = :vo.seqno
		    ]]>
		  </statement>
		</query>
		
		<!-- ADMIN FAQ 삭제 : 2011.09.05 : 신남원 -->
		<query id="clm.admin.deleteFaq" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    UPDATE	TN_CLM_ANNOUNCE
		    SET		DEL_YN = 'Y'
		    	  ,	DEL_ID = :vo.del_id
		    	  , DEL_DT = SYSDATE
		    	  , DEL_NM = :vo.del_nm
		    WHERE	SEQNO = :vo.seqno
		    ]]>
		  </statement>
		</query>
		
		<!-- ADMIN FAQ 권한 체크 정보 : 2011.09.05 : 신남원 -->
		<query id="clm.admin.authFaq" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    SELECT 	 SEQNO, ANNCE_GBN, TITLE, TITLE_EN, CONT_TYPE, CONT, CONT_EN, RDCNT, ANNCE_STARTDAY, ANNCE_ENDDAY, RD_TRGT1, RD_TRGT2, REGMAN_JIKGUP_NM
					,REG_DEPT_NM, REG_DT, REG_ID, REG_NM, MOD_DT, MOD_ID, MOD_NM, DEL_YN, DEL_DT, DEL_ID, DEL_NM
		    FROM 	TN_CLM_ANNOUNCE
		    WHERE 	SEQNO = :vo.seqno
		    AND		(DEL_YN IS NULL OR DEL_YN ='N')
		    ]]>
		  </statement>
		</query>
				
    </queries>
</queryservice>		