<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
    	<!-- 표준 Template 목록 조회 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.listTemplate" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    SELECT *
		    FROM	(
			    SELECT rownum RN, t.*, COUNT(1) over() TOTAL_CNT
			    FROM	(
					    SELECT A.LIB_NO, A.LIB_GBN, A.LANG_GBN, A.BIZ_CLSFCN, A.DEPTH_CLSFCN, A.CNCLSNPURPS_BIGCLSFCN, 
					    	A.CNCLSNPURPS_MIDCLSFCN, A.TITLE, A.CONT, A.RDCNT, A.REG_DT, A.REG_ID, A.REG_NM, A.CNTRT_OPPNT,
							CASE WHEN :vo.session_user_locale = 'ko' THEN B1.CD_NM
			              		 WHEN :vo.session_user_locale = 'fr' THEN B1.CD_NM_FRA
			              		 WHEN :vo.session_user_locale = 'de' THEN B1.CD_NM_DEU
			              		 ELSE B1.CD_NM_ENG
			              	END AS LANG_GBN_NM,
			                CASE WHEN :vo.session_user_locale = 'ko' THEN B2.CD_NM
			              		 WHEN :vo.session_user_locale = 'fr' THEN B2.CD_NM_FRA
			              		 WHEN :vo.session_user_locale = 'de' THEN B2.CD_NM_DEU
			              		 ELSE B2.CD_NM_ENG
			              	END AS BIZ_CLSFCN_NM,
			                CASE WHEN :vo.session_user_locale = 'ko' THEN B3.CD_NM
			              		 WHEN :vo.session_user_locale = 'fr' THEN B3.CD_NM_FRA
			              		 WHEN :vo.session_user_locale = 'de' THEN B3.CD_NM_DEU
			              		 ELSE B3.CD_NM_ENG
			              	END AS DEPTH_CLSFCN_NM,
			                CASE WHEN :vo.session_user_locale = 'ko' THEN B4.CD_NM
			              		 WHEN :vo.session_user_locale = 'fr' THEN B4.CD_NM_FRA
			              		 WHEN :vo.session_user_locale = 'de' THEN B4.CD_NM_DEU
			              		 ELSE B4.CD_NM_ENG
			              	END AS CNCLSNPURPS_BIGCLSFCN_NM,
			                CASE WHEN :vo.session_user_locale = 'ko' THEN B5.CD_NM
			              		 WHEN :vo.session_user_locale = 'fr' THEN B5.CD_NM_FRA
			              		 WHEN :vo.session_user_locale = 'de' THEN B5.CD_NM_DEU
			              		 ELSE B5.CD_NM_ENG
			              	END AS CNCLSNPURPS_MIDCLSFCN_NM
						FROM 	(	SELECT  M.LIB_NO, M.LIB_GBN, M.LANG_GBN, M.BIZ_CLSFCN, M.DEPTH_CLSFCN, M.CNCLSNPURPS_BIGCLSFCN, M.CNCLSNPURPS_MIDCLSFCN, M.TITLE, M.CONT, M.RDCNT, M.REG_DT, M.REG_ID, M.REG_NM
										,	CASE WHEN M.CNTRT_OPPNT_NM IS NULL THEN ''
											WHEN M.CNTRT_OPPNT_NM IS NOT NULL AND M.CNTRT_OPPNT_CNT = 0 THEN CNTRT_OPPNT_NM
											ELSE 
												CASE WHEN :vo.session_user_locale = 'ko' THEN
													M.CNTRT_OPPNT_NM +' 외 '+CNTRT_OPPNT_CNT +'개'
												ELSE
													M.CNTRT_OPPNT_NM +' and '+CNTRT_OPPNT_CNT + ' others'
												END
											END AS CNTRT_OPPNT
									FROM 	(
											SELECT M11.*
											FROM	(
													SELECT 	M1.LIB_NO, M1.LIB_GBN, M1.LANG_GBN, M1.BIZ_CLSFCN, M1.DEPTH_CLSFCN, M1.CNCLSNPURPS_BIGCLSFCN, M1.CNCLSNPURPS_MIDCLSFCN
															  , M1.TITLE, M1.CONT, M1.RDCNT, TO_CHAR(M1.REG_DT, 'YYYYMMDD') AS REG_DT, M1.REG_ID, M1.REG_NM,  M2.CNTRT_OPPNT_NM, CASE WHEN (ISNULL(M2.CNTRT_OPPNT_CNT, 0) -1) <= 0 THEN 0 ELSE ISNULL(M2.CNTRT_OPPNT_CNT, 0) -1 END AS CNTRT_OPPNT_CNT
													FROM 		TN_CLM_CONTRACT_LIBRARY M1, (									
																							SELECT LIB_NO, COUNT(CNTRT_OPPNT_CD) AS CNTRT_OPPNT_CNT, MIN(CNTRT_OPPNT_NM) AS CNTRT_OPPNT_NM 
																							FROM	(
																										SELECT	LIB_NO, CNTRT_OPPNT_CD, CNTRT_OPPNT_NM
																										FROM	TN_CLM_CONT_LIB_CUSTOMER
																										)
																							GROUP BY LIB_NO
																							) M2
													WHERE   M1.LIB_NO = M2.LIB_NO(+)
													AND		M1.LIB_GBN = :vo.lib_gbn		
													AND	    M1.DEL_YN = 'N'							
													) M11  
														  #if (!$vo.srch_keyword_content.equals("") && $vo.srch_keyword.equals("oppnt_cd"))
														  ,	(
															 SELECT LIB_NO
															 FROM	TN_CLM_CONT_LIB_CUSTOMER
															 WHERE  UPPER(CNTRT_OPPNT_NM) LIKE '%' + :vo.srch_keyword_content + '%'
															 GROUP BY LIB_NO
															 )M12
											WHERE M11.LIB_NO = M12.LIB_NO
														  #end
											) M
									WHERE	1=1
							    #if (!$vo.srch_biz_clsfcn.equals(""))
								    AND		M.BIZ_CLSFCN = :vo.srch_biz_clsfcn
								#end						
							    #if (!$vo.srch_lang_gbn.equals(""))
								    AND		M.LANG_GBN = :vo.srch_lang_gbn
								#end
							    #if (!$vo.srch_depth_clsfcn.equals(""))
								    AND		M.DEPTH_CLSFCN = :vo.srch_depth_clsfcn
								#end
							    #if (!$vo.srch_cnclsnpurps_bigclsfcn.equals(""))
								    AND		M.CNCLSNPURPS_BIGCLSFCN = :vo.srch_cnclsnpurps_bigclsfcn
								#end
							    #if (!$vo.srch_cnclsnpurps_midclsfcn.equals(""))
								    AND		M.CNCLSNPURPS_MIDCLSFCN = :vo.srch_cnclsnpurps_midclsfcn
								#end
						    #if (!$vo.srch_keyword_content.equals(""))
						    	#if($vo.srch_keyword.equals("title"))
								    AND		UPPER(M.TITLE) LIKE '%' + :vo.srch_keyword_content + '%' 
								#elseif($vo.srch_keyword.equals("reg_nm"))
									AND		UPPER(M.REG_NM) LIKE '%' + :vo.srch_keyword_content + '%'
								#end
							#end
								    ORDER BY	LIB_NO DESC	
					
									) A, (SELECT CD, CD_NM, CD_ABBR_NM, CD_NM_ENG, CD_ABBR_NM_ENG, CD_NM_FRA, CD_ABBR_NM_FRA, CD_NM_DEU, CD_ABBR_NM_DEU
												FROM TB_COM_CD
												WHERE SYS_CD = 'CLM'
												AND		GRP_CD = 'C045'
												) B1, (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
															 FROM TN_COM_CONTRACTTYPE_CD
															 WHERE UP_TYPE_CD = 'T01'
															 ) B2, (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																			FROM TN_COM_CONTRACTTYPE_CD
																			WHERE UP_TYPE_CD = 'T02'
																			) B3, (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																						 FROM TN_COM_CONTRACTTYPE_CD
																						 WHERE UP_TYPE_CD = 'T03'
																						 ) B4, ( 	SELECT  LEVEL, TYPE_CD, UP_TYPE_CD, CD_NM, CD_NM_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																											FROM  TN_COM_CONTRACTTYPE_CD
																											WHERE LEVEL = '2'
																											START WITH UP_TYPE_CD = 'T03'
																											CONNECT BY PRIOR TYPE_CD = UP_TYPE_CD
																						 				) B5
						WHERE 	A.LANG_GBN = B1.CD(+)
						AND		A.BIZ_CLSFCN = B2.TYPE_CD(+)
						AND		A.DEPTH_CLSFCN = B3.TYPE_CD(+)
						AND		A.CNCLSNPURPS_BIGCLSFCN = B4.TYPE_CD(+)
						AND		A.CNCLSNPURPS_MIDCLSFCN = B5.TYPE_CD(+)
					    ) t
					)
		    WHERE RN between :vo.start_index and :vo.end_index
		    ]]>
		  </statement>
		</query>
		
		<!-- 표준 Template 저장 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.insertTemplate" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    INSERT INTO TN_CLM_CONTRACT_LIBRARY (
		           LIB_NO
		               , LIB_GBN
		               , REGION_GBN
		               , LANG_GBN
		               , BIZ_CLSFCN
		               , DEPTH_CLSFCN
		               , CNCLSNPURPS_BIGCLSFCN
		               , CNCLSNPURPS_MIDCLSFCN
		               , TITLE
		               , CONT
		               , RDCNT
		               , REG_DT
		               , REG_ID
		               , REG_NM
		               , DEL_YN
		        ) VALUES (
		           :vo.lib_no
		          ,:vo.lib_gbn
		          ,'C01801'
		          ,:vo.lang_gbn
		          ,:vo.biz_clsfcn
		          ,:vo.depth_clsfcn
		          ,:vo.cnclsnpurps_bigclsfcn
		          ,:vo.cnclsnpurps_midclsfcn
		          ,:vo.title
		          ,:vo.cont
		          ,:vo.rdcnt
		          ,SYSDATE
		          ,:vo.reg_id
		          ,:vo.reg_nm
		          , 'N'
		        )
		    ]]>
		  </statement>
		</query>

		<!-- 표준 Template 거래상대방 저장 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.insertTemplateOppntCd" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    INSERT INTO TN_CLM_CONT_LIB_CUSTOMER (
		           LIB_NO
		               , CNTRT_OPPNT_CD
		               , CNTRT_OPPNT_NM
		               , REG_DT
		               , REG_ID
		               , REG_NM
		        ) VALUES (
		           :vo.lib_no
		          ,:vo.cntrt_oppnt_cd
		          ,:vo.cntrt_oppnt_nm
		          ,SYSDATE
		          ,:vo.reg_id
		          ,:vo.reg_nm
		        )
		    ]]>
		  </statement>
		</query>
		
		<!-- 표준 Template MAX LIB_NO : 2011.08.31 : 신남원 -->
		<query id="clm.draft.maxLibNoTemplate" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        SELECT MAX(LIB_NO) AS MAX_LIB_NO FROM TN_CLM_CONTRACT_LIBRARY
		    ]]>
		  </statement>
		</query>
				
		<!-- 표준 Template 조회수 증가 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.modifyRdcntTemplate" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        UPDATE 	TN_CLM_CONTRACT_LIBRARY
	        SET		RDCNT = RDCNT + 1
		    WHERE	LIB_NO = :vo.lib_no
		    AND	 	(DEL_YN = 'N' OR DEL_YN IS NULL)		
		    ]]>
		  </statement>
		</query>
				
    	<!-- 표준 Template 상세 조회 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.detailTemplate" isCamelCase="false">
		  <statement>
		    <![CDATA[
		    SELECT A.LIB_NO, A.LIB_GBN, A.LANG_GBN, A.BIZ_CLSFCN, A.DEPTH_CLSFCN, A.CNCLSNPURPS_BIGCLSFCN, 
		    	A.CNCLSNPURPS_MIDCLSFCN, A.TITLE, A.CONT, A.RDCNT, A.REG_DT, A.REG_ID, A.REG_NM,
				CASE WHEN :vo.session_user_locale = 'ko' THEN B1.CD_NM
			         WHEN :vo.session_user_locale = 'fr' THEN B1.CD_NM_FRA
			         WHEN :vo.session_user_locale = 'de' THEN B1.CD_NM_DEU
			         ELSE B1.CD_NM_ENG
			    END AS LANG_GBN_NM,
                CASE WHEN :vo.session_user_locale = 'ko' THEN B2.CD_NM
			         WHEN :vo.session_user_locale = 'fr' THEN B2.CD_NM_FRA
			         WHEN :vo.session_user_locale = 'de' THEN B2.CD_NM_DEU
			         ELSE B2.CD_NM_ENG
			    END AS BIZ_CLSFCN_NM,
                CASE WHEN :vo.session_user_locale = 'ko' THEN B3.CD_NM
			         WHEN :vo.session_user_locale = 'fr' THEN B3.CD_NM_FRA
			         WHEN :vo.session_user_locale = 'de' THEN B3.CD_NM_DEU
			         ELSE B3.CD_NM_ENG
			    END AS DEPTH_CLSFCN_NM,
                CASE WHEN :vo.session_user_locale = 'ko' THEN B4.CD_NM
			         WHEN :vo.session_user_locale = 'fr' THEN B4.CD_NM_FRA
			         WHEN :vo.session_user_locale = 'de' THEN B4.CD_NM_DEU
			         ELSE B4.CD_NM_ENG
			    END AS CNCLSNPURPS_BIGCLSFCN_NM,
                CASE WHEN :vo.session_user_locale = 'ko' THEN B5.CD_NM
			         WHEN :vo.session_user_locale = 'fr' THEN B5.CD_NM_FRA
			         WHEN :vo.session_user_locale = 'de' THEN B5.CD_NM_DEU
			         ELSE B5.CD_NM_ENG
			    END AS CNCLSNPURPS_MIDCLSFCN_NM
			FROM (SELECT  LIB_NO
				 	   	 ,LIB_GBN
						 ,LANG_GBN
						 ,BIZ_CLSFCN
						 ,DEPTH_CLSFCN
						 ,CNCLSNPURPS_BIGCLSFCN
						 ,CNCLSNPURPS_MIDCLSFCN
						 ,TITLE
						 ,CONT
						 ,RDCNT
						 ,TO_CHAR(REG_DT, 'YYYYMMDD') AS REG_DT
						 ,REG_ID
						 ,REG_NM
						FROM 	TN_CLM_CONTRACT_LIBRARY
						WHERE	LIB_NO = :vo.lib_no
						AND	 (DEL_YN = 'N' OR DEL_YN IS NULL)
						) A, (SELECT CD, CD_NM, CD_ABBR_NM, CD_NM_ENG, CD_ABBR_NM_ENG, CD_NM_FRA, CD_ABBR_NM_FRA, CD_NM_DEU, CD_ABBR_NM_DEU
									FROM TB_COM_CD
									WHERE SYS_CD = 'CLM'
									AND		GRP_CD = 'C045'
									) B1, (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
												 FROM TN_COM_CONTRACTTYPE_CD
												 WHERE UP_TYPE_CD = 'T01'
												 ) B2, (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																FROM TN_COM_CONTRACTTYPE_CD
																WHERE UP_TYPE_CD = 'T02'
																) B3, (SELECT TYPE_CD, CD_NM, CD_NM_ABBR, CD_NM_ENG, CD_NM_ABBR_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																			 FROM TN_COM_CONTRACTTYPE_CD
																			 WHERE UP_TYPE_CD = 'T03'
																			 ) B4, ( 	SELECT  LEVEL, TYPE_CD, UP_TYPE_CD, CD_NM, CD_NM_ENG, CD_NM_FRA, CD_NM_ABBR_FRA, CD_NM_DEU, CD_NM_ABBR_DEU
																								FROM  TN_COM_CONTRACTTYPE_CD
																								WHERE LEVEL = '2'
																								START WITH UP_TYPE_CD = 'T03'
																								CONNECT BY PRIOR TYPE_CD = UP_TYPE_CD
																			 				) B5
			WHERE 	A.LANG_GBN = B1.CD(+)
			AND		A.BIZ_CLSFCN = B2.TYPE_CD(+)
			AND		A.DEPTH_CLSFCN = B3.TYPE_CD(+)
			AND		A.CNCLSNPURPS_BIGCLSFCN = B4.TYPE_CD(+)
			AND		A.CNCLSNPURPS_MIDCLSFCN = B5.TYPE_CD(+)
		    ]]>
		  </statement>
		</query>

		<!-- 표준 Template 거래상대방 목록 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.listTemplateOppntCd" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        SELECT 	LIB_NO, CNTRT_OPPNT_CD, CNTRT_OPPNT_NM
			FROM 	TN_CLM_CONT_LIB_CUSTOMER
			WHERE 	LIB_NO = :vo.lib_no
		    ]]>
		  </statement>
		</query>
				
		<!-- 표준 Template 수정 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.modifyTemplate" isCamelCase="false">
		  <statement>
		    <![CDATA[
			UPDATE TN_CLM_CONTRACT_LIBRARY
	        SET LANG_GBN = :vo.lang_gbn
              , BIZ_CLSFCN = :vo.biz_clsfcn
              , DEPTH_CLSFCN = :vo.depth_clsfcn
              , CNCLSNPURPS_BIGCLSFCN = :vo.cnclsnpurps_bigclsfcn
              , CNCLSNPURPS_MIDCLSFCN = :vo.cnclsnpurps_midclsfcn
              , TITLE = :vo.title
              , CONT = :vo.cont
              , MOD_DT = SYSDATE
              , MOD_ID = :vo.mod_id
              , MOD_NM = :vo.mod_nm
			WHERE	LIB_NO = :vo.lib_no	          
		    ]]>
		  </statement>
		</query>
		
		<!-- 표준 Template 삭제 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.deleteTemplate" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        UPDATE 	TN_CLM_CONTRACT_LIBRARY
	        SET		DEL_YN = 'Y'
	        		, DEL_ID = :vo.del_id
	        		, DEL_DT = SYSDATE
	        		, DEL_NM = :vo.del_nm
		    WHERE	LIB_NO = :vo.lib_no
		    ]]>
		  </statement>
		</query>

		<!-- 표준 Template 거래상대방 삭제 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.deleteTemplateOppntCd" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        DELETE FROM TN_CLM_CONT_LIB_CUSTOMER
		    WHERE	LIB_NO = :vo.lib_no
		    ]]>
		  </statement>
		</query>
				
		<!-- 표준 Template 권한 체크 정보 : 2011.08.31 : 신남원 -->
		<query id="clm.draft.authTemplate" isCamelCase="false">
		  <statement>
		    <![CDATA[
			SELECT	LIB_NO, LIB_GBN, LANG_GBN, BIZ_CLSFCN, DEPTH_CLSFCN, CNCLSNPURPS_BIGCLSFCN, CNCLSNPURPS_MIDCLSFCN, TITLE, CONT, RDCNT
				  , TO_CHAR(REG_DT, 'YYYYMMDD') AS REG_DT, REG_ID, REG_NM
			FROM 	TN_CLM_CONTRACT_LIBRARY
			WHERE	LIB_NO = :vo.lib_no
		    ]]>
		  </statement>
		</query>
		
		<!-- 표준 Template 거래상대방 검색 팝업 : 2011.09.29 : dawn -->
		<query id="clm.draft.listTemplatePop" isCamelCase="false">
		  <statement>
		    <![CDATA[
			SELECT PATNR
			     , BURKS
			     , ZL_SPRAS
			     , NAME1
			     , NAME2
			     , NAME3
			     , NAME4
			     , STRAS
			     , STRAS_2
			     , STRAS_3
			     , STRAS_4
			     , STRAS_5
			     , ORT01
			     , ORT02
			  FROM TN_CIS_CUSTOMER
			 WHERE NAME1 LIKE '%'+ :vo.customer +'%'
		    ]]>
		  </statement>
		</query>
		
    </queries>
</queryservice>