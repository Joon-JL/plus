<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
   		<!-- 지법인 코드 리스트 조회 -->
 		<query id="common.clmscom.listLocCdByGrpCd" isCamelCase="false">                                                                                 
			<statement>                                                                                                   
				<![CDATA[
					SELECT	
						SYS_CD
						,GRP_CD
						,CD
						,CD_NM
						,CD_ABBR_NM
						,CD_NM_ENG
						,CD_ABBR_NM_ENG
						,CD_NM_FRA
						,CD_ABBR_NM_FRA
						,CD_NM_DEU
						,CD_ABBR_NM_DEU
						,USEMAN_MNG_ITM2
					FROM
						TB_COM_CD
					WHERE
						SYS_CD = :sys_cd
						#if (($useman_mng_itm1.equals("") && $useman_mng_itm2.equals("")) || !$grp_cd.equals(""))
							AND	GRP_CD = :grp_cd
						#end						
						#if(!$top_role.equals("RA00"))
						--	AND CD = :comp_cd
						#end						
						#if (!$selectCd.equals(""))
							AND CD NOT IN(
								#foreach($select_cd in $select_cd_list)
									#if($velocityCount == 1)
										'$select_cd'
									#else
										,'$select_cd'
									#end
								#end
							)
						#end 
						
						#if ($limit_cd && !$limit_cd.equals("") && !$limit_cd.equals("#"))
							AND CD IN(
								#foreach($select_cd in $limit_cd_list)
									#if($velocityCount == 1)
										'$select_cd'
									#else
										,'$select_cd'
									#end
								#end
							)
						#end 
						
						#if (!$useman_mng_itm1.equals(""))
						AND USEMAN_MNG_ITM1 = :useman_mng_itm1
						#end
						
						#if (!$useman_mng_itm2.equals(""))
						AND USEMAN_MNG_ITM2 = :useman_mng_itm2
						#end
						
						#if (!$useman_mng_itm3.equals(""))
						AND USEMAN_MNG_ITM3 = :useman_mng_itm3
						#end
						
						#if (!$useman_mng_itm4.equals(""))
						AND USEMAN_MNG_ITM4 = :useman_mng_itm4
						#end
						
						#if (!$useman_mng_itm5.equals(""))
						AND USEMAN_MNG_ITM5 = :useman_mng_itm5
						#end
				#if ($del_yn.equals("N"))
				    	AND USE_YN <> 'N'
				#end
					ORDER BY CD_ORDER
				]]>
			</statement>				                                         	
		</query>
		
		<!-- 대분류에 의한 공통 코드 리스트 조회 -->
 		<query id="common.clmscom.listComCdByGrpCd" isCamelCase="false">                                                                                 
			<statement>                                                                                                   
				<![CDATA[
					SELECT	
						SYS_CD
						,GRP_CD
						,CD
						,CD_NM
						,CD_ABBR_NM
						,CD_NM_ENG
						,CD_ABBR_NM_ENG
						,CD_NM_FRA
						,CD_ABBR_NM_FRA
						,CD_NM_DEU
						,CD_ABBR_NM_DEU
						,USEMAN_MNG_ITM2
					FROM
						TB_COM_CD
					WHERE
						SYS_CD = :sys_cd
						#if (($useman_mng_itm1.equals("") && $useman_mng_itm2.equals("")) || !$grp_cd.equals(""))
						AND	GRP_CD = :grp_cd
						#end
						#if (!$selectCd.equals(""))
							AND CD NOT IN(
								#foreach($select_cd in $select_cd_list)
									#if($velocityCount == 1)
										'$select_cd'
									#else
										,'$select_cd'
									#end
								#end
							)
						#end 
						#if (!$useman_mng_itm1.equals(""))
						AND USEMAN_MNG_ITM1 = :useman_mng_itm1
						#end
						
						#if (!$useman_mng_itm2.equals(""))
						AND USEMAN_MNG_ITM2 = :useman_mng_itm2
						#end
						
						#if (!$useman_mng_itm3.equals(""))
						AND USEMAN_MNG_ITM3 = :useman_mng_itm3
						#end
						
						#if (!$useman_mng_itm4.equals(""))
						AND USEMAN_MNG_ITM4 = :useman_mng_itm4
						#end
						
						#if (!$useman_mng_itm5.equals(""))
						AND USEMAN_MNG_ITM5 = :useman_mng_itm5
						#end
						
						#if ($comp_cd.equals("PCO"))
						AND CD NOT IN ('C02105')
						#end
						
				#if ($del_yn.equals("N"))
				    	AND USE_YN <> 'N'
				#end
					ORDER BY CD_ORDER
				]]>
			</statement>				                                         	
		</query>
		
		<!-- 대분류에 의한 공통 코드 리스트 조회 통화의 경우 CD_명으로 정렬-->
 		<query id="common.clmscom.listComCdByGrpCd_crrncyUnit" isCamelCase="false">                                                                                 
			<statement>                                                                                                   
				<![CDATA[
					SELECT	
						SYS_CD
						,GRP_CD
						,CD
						,CD_NM
						,CD_ABBR_NM
						,CD_NM_ENG
						,CD_ABBR_NM_ENG
						,CD_NM_FRA
						,CD_ABBR_NM_FRA
						,CD_NM_DEU
						,CD_ABBR_NM_DEU
						,USEMAN_MNG_ITM2
					FROM
						TB_COM_CD
					WHERE
						SYS_CD = :sys_cd
						#if (($useman_mng_itm1.equals("") && $useman_mng_itm2.equals("")) || !$grp_cd.equals(""))
						AND	GRP_CD = :grp_cd
						#end
						#if (!$selectCd.equals(""))
							AND CD NOT IN(
								#foreach($select_cd in $select_cd_list)
									#if($velocityCount == 1)
										'$select_cd'
									#else
										,'$select_cd'
									#end
								#end
							)
						#end 
						#if (!$useman_mng_itm1.equals(""))
						AND USEMAN_MNG_ITM1 = :useman_mng_itm1
						#end
						
						#if (!$useman_mng_itm2.equals(""))
						AND USEMAN_MNG_ITM2 = :useman_mng_itm2
						#end
						
						#if (!$useman_mng_itm3.equals(""))
						AND USEMAN_MNG_ITM3 = :useman_mng_itm3
						#end
						
						#if (!$useman_mng_itm4.equals(""))
						AND USEMAN_MNG_ITM4 = :useman_mng_itm4
						#end
						
						#if (!$useman_mng_itm5.equals(""))
						AND USEMAN_MNG_ITM5 = :useman_mng_itm5
						#end
						
				#if ($del_yn.equals("N"))
				    	AND USE_YN <> 'N'
				#end
					ORDER BY CD_ORDER, CD_NM
				]]>
			</statement>				                                         	
		</query>
		
		
		
		<!-- 대분류에 의한 공통 코드 리스트 조회 (전자 변호사일 경우 해당 회사만 보여줘야 함.) -->
 		<query id="common.clmscom.listComCdByGrpCd_Comp" isCamelCase="false">                                                                                 
			<statement>                                                                                                   
				<![CDATA[
					SELECT	
						SYS_CD
						,GRP_CD
						,CD
						,CD_NM AS REL_CD_NM
						,CD_ABBR_NM AS CD_NM
						,CD_NM_ENG AS REL_CD_NM_ENG
						,CD_ABBR_NM_ENG AS CD_NM_ENG
						,CD_NM_FRA AS CD_NM_FRA
						,CD_ABBR_NM_FRA AS CD_NM_FRA
						,CD_NM_DEU AS CD_NM_DEU
						,CD_ABBR_NM_DEU AS CD_NM_DEU
					FROM
						TB_COM_CD
					WHERE
						SYS_CD = :sys_cd
						#if (($useman_mng_itm1.equals("") && $useman_mng_itm2.equals("")) || !$grp_cd.equals(""))
						AND	GRP_CD = 'COMP2'
						#end
						AND CD IN (SELECT MNG_COMP_CD
                                     FROM TN_COM_SEC_MNG_COMP  
                                    WHERE USER_ID = :user_id)
						#if (!$selectCd.equals(""))
							AND CD NOT IN(
								#foreach($select_cd in $select_cd_list)
									#if($velocityCount == 1)
										'$select_cd'
									#else
										,'$select_cd'
									#end
								#end
							)
						#end 
						#if (!$useman_mng_itm1.equals(""))
						AND USEMAN_MNG_ITM1 = :useman_mng_itm1
						#end
						
						#if (!$useman_mng_itm2.equals(""))
						AND USEMAN_MNG_ITM2 = :useman_mng_itm2
						#end
						
						#if (!$useman_mng_itm3.equals(""))
						AND USEMAN_MNG_ITM3 = :useman_mng_itm3
						#end
						
						#if (!$useman_mng_itm4.equals(""))
						AND USEMAN_MNG_ITM4 = :useman_mng_itm4
						#end
						
						#if (!$useman_mng_itm5.equals(""))
						AND USEMAN_MNG_ITM5 = :useman_mng_itm5
						#end
						
				#if ($del_yn.equals("N"))
				    	AND USE_YN <> 'N'
				#end
					ORDER BY CD_ORDER
				]]>
			</statement>				                                         	
		</query>
		
		<!-- 대분류에 의한 공통 코드 리스트 조회 (전자 담당자일 경우 해당 모든 회사가 보여줘야 함.) -->
 		<query id="common.clmscom.listComCdByGrpAllCd_Comp" isCamelCase="false">                                                                                 
			<statement>                                                                                                   
				<![CDATA[
					SELECT	
						SYS_CD
						,GRP_CD
						,CD
						,CD_NM AS REL_CD_NM
						,CD_ABBR_NM AS CD_NM
						,CD_NM_ENG AS REL_CD_NM_ENG
						,CD_ABBR_NM_ENG AS CD_NM_ENG
						,CD_NM_FRA AS CD_NM_FRA
						,CD_ABBR_NM_FRA AS CD_NM_FRA
						,CD_NM_DEU AS CD_NM_DEU
						,CD_ABBR_NM_DEU AS CD_NM_DEU
					FROM
						TB_COM_CD
					WHERE
						SYS_CD = :sys_cd
						#if (($useman_mng_itm1.equals("") && $useman_mng_itm2.equals("")) || !$grp_cd.equals(""))
						    AND	GRP_CD = 'COMP2'
						#end
						#if (!$selectCd.equals(""))
							AND CD NOT IN(
								#foreach($select_cd in $select_cd_list)
									#if($velocityCount == 1)
										'$select_cd'
									#else
										,'$select_cd'
									#end
								#end
							)
						#end 
						#if (!$useman_mng_itm1.equals(""))
						AND USEMAN_MNG_ITM1 = :useman_mng_itm1
						#end
						
						#if (!$useman_mng_itm2.equals(""))
						AND USEMAN_MNG_ITM2 = :useman_mng_itm2
						#end
						
						#if (!$useman_mng_itm3.equals(""))
						AND USEMAN_MNG_ITM3 = :useman_mng_itm3
						#end
						
						#if (!$useman_mng_itm4.equals(""))
						AND USEMAN_MNG_ITM4 = :useman_mng_itm4
						#end
						
						#if (!$useman_mng_itm5.equals(""))
						AND USEMAN_MNG_ITM5 = :useman_mng_itm5
						#end
						
				#if ($del_yn.equals("N"))
				    	AND USE_YN <> 'N'
				#end
					ORDER BY CD_ORDER
				]]>
			</statement>				                                         	
		</query>
		
		<!-- 대분류에 의한 공통 코드 리스트 조회 (날인 신청/수정시엔 계약용(법무시스템)이 보이면 안됨.) -->
 		<query id="common.clmscom.listComCdByGrpCdSign" isCamelCase="false">                                                                                 
			<statement>                                                                                                   
				<![CDATA[
					SELECT	
						SYS_CD
						,GRP_CD
						,CD
						,CD_NM
						,CD_ABBR_NM
						,CD_NM_ENG
						,CD_ABBR_NM_ENG
						,CD_NM_FRA
						,CD_ABBR_NM_FRA
						,CD_NM_DEU
						,CD_ABBR_NM_DEU
					FROM
						TB_COM_CD
					WHERE
						SYS_CD = :sys_cd
						#if (($useman_mng_itm1.equals("") && $useman_mng_itm2.equals("")) || !$grp_cd.equals(""))
						AND	GRP_CD = :grp_cd
						#end
						#if (!$selectCd.equals(""))
							AND CD NOT IN(
								#foreach($select_cd in $select_cd_list)
									#if($velocityCount == 1)
										'$select_cd'
									#else
										,'$select_cd'
									#end
								#end
							)
						#end 
						#if (!$useman_mng_itm1.equals(""))
						AND USEMAN_MNG_ITM1 = :useman_mng_itm1
						#end
						
						#if (!$useman_mng_itm2.equals(""))
						AND USEMAN_MNG_ITM2 = :useman_mng_itm2
						#end
						
						#if (!$useman_mng_itm3.equals(""))
						AND USEMAN_MNG_ITM3 = :useman_mng_itm3
						#end
						
						#if (!$useman_mng_itm4.equals(""))
						AND USEMAN_MNG_ITM4 = :useman_mng_itm4
						#end
						
						#if (!$useman_mng_itm5.equals(""))
						AND USEMAN_MNG_ITM5 = :useman_mng_itm5
						#end
						
						#if ($comp_cd.equals("PCO"))
						AND CD NOT IN ('C02105')
						#end
						
				#if ($del_yn.equals("N"))
				    	AND USE_YN <> 'N'
				#end
				        AND CD NOT IN ('AT0104')
					ORDER BY CD_ORDER
				]]>
			</statement>				                                         	
		</query>
		

		<!-- 계약유형 리스트 Combo -->
 		<query id="common.clmscom.getContracttypeCombo" isCamelCase="false">                                                                                 
			<statement>                                                                                                   
				<![CDATA[        
					SELECT
						TYPE_CD AS CD
						,CD_NM 
						,CD_NM_ABBR
						,CD_NM_ENG
						,CD_NM_ABBR_ENG
						,CD_NM_FRA
						,CD_NM_ABBR_FRA
						,CD_NM_DEU
						,CD_NM_ABBR_DEU
						,USE_YN
					FROM 
						TN_COM_CONTRACTTYPE_CD
					WHERE 1=1
						AND UP_TYPE_CD = :up_cd
				#if ($del_yn.equals("N"))
				    	AND USE_YN <> 'N'
				#end
					ORDER BY PRNT_SRT
				]]>
			</statement>				                                         	
		</query>        

		<!-- 사업부 코드 리스트 -->
 		<query id="common.clmcom.listOperdivCd" isCamelCase="false">                                                                                 
			<statement>                                                                                                   
				<![CDATA[        
        		SELECT  OPERDIV_CD AS CD
        			  , OPERDIV_NM AS CD_NM
        			  , OPERDIV_NM AS CD_NM_ABBR
        			  , OPERDIV_NM_ENG AS CD_NM_ENG
        			  , OPERDIV_NM_ENG AS CD_NM_ABBR_ENG
        		FROM	TN_COM_OPERDIV_CD
				WHERE	DEL_YN = :del_yn
				ORDER BY OPERDIV_CD
				]]>
			</statement>				                                         	
		</query>        
        
		<!-- 부서 정보 (트리구조) 리스트 -->
		<query id="common.clmscom.listDeptTree" isCamelCase="false">
			<statement>
				<![CDATA[
					SELECT 
						DEPT_CD
					    ,CASE 
					    	WHEN :vo.session_user_locale = 'ko'
							THEN DEPT_NM
					        ELSE DEPT_NM_ENG
						END AS DEPT_NM
					    ,DEPT_LEVEL
					    ,DEPT_ORDER
					    ,DOWN_DEPT_YN
					    ,UP_DEPT_CD
					FROM 
						TB_COM_DEPT
					WHERE 
						UP_DEPT_CD = :vo.up_dept_cd
					ORDER BY DEPT_ORDER ASC
				]]>
			</statement>
		</query>

		<!-- 본인이 속한 부서 및 검색된 부서의 트리리스트를 반환한다. (수직계층만) -->
		<query id="common.clmscom.userDeptTree" isCamelCase="false">
			<statement>
				<![CDATA[
					SELECT DEPT_CD
					FROM TB_COM_DEPT
					START WITH DEPT_CD = :vo.dept_cd
					CONNECT BY PRIOR UP_DEPT_CD = DEPT_CD
				]]>
			</statement>
		</query>


		<!-- 검색어와 일치하는 부서명에 대한 부서코드 추출 -->
		<query id="common.clmscom.searchDeptCd" isCamelCase="false">
			<statement>
				<![CDATA[
					SELECT DEPT_CD
					FROM TB_COM_DEPT
					WHERE UPPER(DEPT_NM) = UPPER(:vo.dept_nm) OR UPPER(DEPT_NM_ENG) = UPPER(:vo.dept_nm)
				]]>
			</statement>
		</query>        

		<!-- 일부이름으로 부서명을 조회한다. -->
		<query id="common.clmscom.searchDept" isCamelCase="false">
			<statement>
				<![CDATA[
					SELECT 
						CASE 
							WHEN :vo.session_user_locale = 'ko'
					        THEN DEPT_NM
					        ELSE DEPT_NM_ENG
						END AS DEPT_NM
					FROM TB_COM_DEPT
					WHERE UPPER(DEPT_NM) LIKE UPPER(:vo.dept_nm) OR UPPER(DEPT_NM_ENG) LIKE UPPER(:vo.dept_nm)
				]]>
			</statement>
		</query>		

		<!-- 조직부서를 조회한다. -->
		<query id="common.clmscom.getUnitOrgnzCombo" isCamelCase="false">
			<statement>
				<![CDATA[
					SELECT ORGNZ_CD, ORGNZ_NM, ORGNZ_NM_ENG, ORGNZ_NM_ABBR, ORGNZ_NM_ABBR_ENG
					FROM TN_CLM_UNITORGNZ
					WHERE 
						UP_ORGNZ_CD = :up_orgnz_cd
						AND CDCRTN_VAL IS NOT NULL
				]]>
			</statement>
		</query>

		<!-- 법무담당자 리스트를 조회한다. -->
		<query id="common.clmscom.getLasPersonCombo" isCamelCase="false">
			<statement>
				<![CDATA[
					SELECT A.USER_ID,
						   A.USER_NM
						+ '('
						+ dbo.Function_lpad (ISNULL (D.CNSDREQ_CNT, 0), 3, '_')
						+ '/'
						+ dbo.Function_lpad (ISNULL (E.CNSDREQ_CNT, 0), 3, '_')
						+ '/'
						+ dbo.Function_lpad (ISNULL (F.CNSDREQ_CNT, 0), 3, '_')
						+ '/'
						+ dbo.Function_lpad (ISNULL (G.CNSDREQ_CNT, 0), 3, '_')
						+ ')'
						   AS USER_NM,
						   A.USER_NM_ENG
						+ '('
						+ dbo.Function_lpad (ISNULL (D.CNSDREQ_CNT, 0), 3, '_')
						+ '/'
						+ dbo.Function_lpad (ISNULL (E.CNSDREQ_CNT, 0), 3, '_')
						+ '/'
						+ dbo.Function_lpad (ISNULL (F.CNSDREQ_CNT, 0), 3, '_')
						+ '/'
						+ dbo.Function_lpad (ISNULL (G.CNSDREQ_CNT, 0), 3, '_')
						+ ')'
						   AS USER_NM_ENG
					FROM	TB_COM_USER A 
						INNER JOIN 
							TB_COM_ROLE_USER B ON A.USER_ID = B.USER_ID
		
						LEFT OUTER JOIN
							TN_CLM_CONT_CNSDREQ_RESPMAN C ON A.USER_ID = C.RESPMAN_ID
							
						LEFT OUTER JOIN
							(SELECT RESPMAN_ID, COUNT (CNSDREQ_ID) AS CNSDREQ_CNT
          					 FROM TN_CLM_CONT_CNSDREQ_RESPMAN
         					 WHERE ASGN_DT BETWEEN dbo.GREATES (
									CONVERT(DATETIME,(CONVERT(VARCHAR,YEAR(GETDATE()) + '0101'))), GETDATE()-7) AND GETDATE()
        					 GROUP BY RESPMAN_ID) D ON A.USER_ID = D.RESPMAN_ID
		
						LEFT OUTER JOIN
       						(SELECT RESPMAN_ID, COUNT (CNSDREQ_ID) AS CNSDREQ_CNT
          					 FROM TN_CLM_CONT_CNSDREQ_RESPMAN
         					 WHERE ASGN_DT BETWEEN dbo.GREATES (
									CONVERT(DATETIME,(CONVERT(VARCHAR,YEAR(GETDATE()) + '0101'))), DATEADD(M,-1,GETDATE())) AND GETDATE()
        					 GROUP BY RESPMAN_ID) E ON A.USER_ID = E.RESPMAN_ID
		
						LEFT OUTER JOIN 
       						(SELECT RESPMAN_ID, COUNT (CNSDREQ_ID) AS CNSDREQ_CNT
          					 FROM 	TN_CLM_CONT_CNSDREQ_RESPMAN
         					 WHERE 	ASGN_DT BETWEEN dbo.GREATES (
									CONVERT(DATETIME,(CONVERT(VARCHAR,YEAR(GETDATE()) + '0101'))), DATEADD(M,-12,GETDATE())) AND GETDATE()
        					 GROUP BY RESPMAN_ID) F ON A.USER_ID = F.RESPMAN_ID
       					
       					LEFT OUTER JOIN
	   						(SELECT A.RESPMAN_ID, COUNT (A.CNSDREQ_ID) AS CNSDREQ_CNT
          					 FROM 	TN_CLM_CONT_CNSDREQ_RESPMAN A, TN_CLM_CONT_CNSDREQ B
         					 WHERE	A.CNSDREQ_ID = B.CNSDREQ_ID
               					AND B.PRGRS_STATUS IN ('C04203', 'C04204', 'C04205')
        					 GROUP BY RESPMAN_ID) G ON A.USER_ID = G.RESPMAN_ID
					WHERE	B.SYS_CD =  :sys_cd
       					AND B.ROLE_CD IN ('RA02')
       					AND A.BLNGT_ORGNZ = :blngt_orgnz

					GROUP BY 	A.USER_ID,	
         						A.USER_NM,
								A.USER_NM_ENG,
								A.JIKGUP_NM,
								A.JIKGUP_NM_ENG,
								A.DEPT_NM,
								D.CNSDREQ_CNT,
								E.CNSDREQ_CNT,
								F.CNSDREQ_CNT,
								G.CNSDREQ_CNT
				]]>
			</statement>
		</query>			
        
        <!-- 검토의뢰 기준 법무담당자 리스트를 조회한다. -->
		<query id="common.clmscom.getLasCnsdreqPersonCombo" isCamelCase="false">
			<statement>
				<![CDATA[
					SELECT 
						A.USER_ID, 
						A.USER_NM AS USER_NM,
						A.USER_NM_ENG AS USER_NM_ENG
					 FROM TB_COM_USER A         
                          RIGHT OUTER JOIN TN_CLM_CONT_CNSDREQ_RESPMAN C ON A.USER_ID = C.RESPMAN_ID
                          RIGHT OUTER JOIN (  SELECT RESPMAN_ID, COUNT (CNSDREQ_ID) AS CNSDREQ_CNT
                               FROM TN_CLM_CONT_CNSDREQ_RESPMAN
                              WHERE ASGN_DT BETWEEN dbo.GREATES ( CONVERT(VARCHAR, YEAR(GETDATE())) + '0101' ,  CONVERT(VARCHAR, REPLACE(CONVERT(DATE, DATEADD(D, -7, GETDATE())), '-', ''))  )
                                AND REPLACE(CONVERT(VARCHAR, GETDATE(), 23),'-','')
                           GROUP BY RESPMAN_ID) D ON A.USER_ID = D.RESPMAN_ID
                          RIGHT OUTER JOIN (  SELECT RESPMAN_ID, COUNT (CNSDREQ_ID) AS CNSDREQ_CNT
                               FROM TN_CLM_CONT_CNSDREQ_RESPMAN
                              WHERE ASGN_DT BETWEEN dbo.GREATES ( CONVERT(VARCHAR, YEAR(GETDATE())) + '0101' ,  CONVERT(VARCHAR, REPLACE(CONVERT(DATE, DATEADD(D, -1, GETDATE())), '-', ''))  )
                                                AND REPLACE(CONVERT(VARCHAR, GETDATE(), 23),'-','')
                           GROUP BY RESPMAN_ID) E ON A.USER_ID = E.RESPMAN_ID
                          RIGHT OUTER JOIN (  SELECT RESPMAN_ID, COUNT (CNSDREQ_ID) AS CNSDREQ_CNT
                               FROM TN_CLM_CONT_CNSDREQ_RESPMAN
                              WHERE ASGN_DT BETWEEN dbo.GREATES ( CONVERT(VARCHAR, YEAR(GETDATE())) + '0101' ,  CONVERT(VARCHAR, REPLACE(CONVERT(DATE, DATEADD(D, -12, GETDATE())), '-', ''))  )
                                                AND REPLACE(CONVERT(VARCHAR, GETDATE(), 23),'-','')
                           GROUP BY RESPMAN_ID) F ON A.USER_ID = F.RESPMAN_ID
                          RIGHT OUTER JOIN (  SELECT A.RESPMAN_ID, COUNT (A.CNSDREQ_ID) AS CNSDREQ_CNT
                               FROM TN_CLM_CONT_CNSDREQ_RESPMAN A, TN_CLM_CONT_CNSDREQ B
                              WHERE     A.CNSDREQ_ID = B.CNSDREQ_ID
                                    AND B.PRGRS_STATUS IN ('C04203', 'C04204', 'C04205')
                           GROUP BY RESPMAN_ID) G ON A.USER_ID = G.RESPMAN_ID,
                           TB_COM_ROLE_USER B
					WHERE
						A.USER_ID = B.USER_ID
						AND B.SYS_CD = :sys_cd
						AND B.ROLE_CD IN ('RA01', 'RA02') 
					#if ($srch_dept.equals("law"))
						AND A.BLNGT_ORGNZ IN ('A00000001', 'A00000002')
					#elseif($srch_dept.equals("ip"))
						AND A.BLNGT_ORGNZ IN ('A00000003')
					#elseif ($opp_dept_div.equals("Y") || $opp_dept_div.equals("y"))
						AND A.BLNGT_ORGNZ <> :blngt_orgnz
					#else
						AND A.BLNGT_ORGNZ = :blngt_orgnz
					#end
						AND C.CNSDREQ_ID = :cnsdreq_id
				  GROUP BY A.USER_ID, A.USER_NM, A.USER_NM_ENG, A.JIKGUP_NM, A.JIKGUP_NM_ENG, A.DEPT_NM, D.CNSDREQ_CNT, E.CNSDREQ_CNT, F.CNSDREQ_CNT, G.CNSDREQ_CNT
				]]>
			</statement>
		</query>
		
        <!-- 법무담당자 리스트를 조회한다. 
		     TN_LAS_CONSULT_RESPMAN 테이블을 조회해서 담당자별로 작업완료한 카운트 (일/월/년) 및 작업할 갯수를 리턴한다.
		     author : 김현구 2011-10-06
		 -->
		<query id="common.clmscom.getLasPersonCombo2" isCamelCase="false">
			<statement>
				<![CDATA[
					SELECT A.USER_ID,
						A.USER_NM,
						A.USER_NM_ENG,
						   '('
						+ dbo.Function_lpad (ISNULL (C.DAY_COUNT, 0), 3, '_')
						+ '/'
						+ dbo.Function_lpad (ISNULL (D.MONTH_COUNT, 0), 3, '_')
						+ '/'
						+ dbo.Function_lpad (ISNULL (E.YEAR_COUNT, 0), 3, '_')
						+ '/'
						+ dbo.Function_lpad (ISNULL (F.PENDING, 0), 3, '_')
						+ ')'
						   USER_STATS
					FROM TB_COM_USER A
       
	   				INNER JOIN 
	   					TB_COM_ROLE_USER B ON A.USER_ID = B.USER_ID
       
	   				LEFT OUTER JOIN
	    				(SELECT RESPMAN_ID, COUNT (*) ALL_COUNT
          				 FROM TN_LAS_CONSULT_RESPMAN
        				 GROUP BY RESPMAN_ID) G ON A.USER_ID = G.RESPMAN_ID

					LEFT OUTER JOIN
	   					(SELECT RESPMAN_ID, COUNT (*) DAY_COUNT
          				 FROM TN_LAS_CONSULT_RESPMAN A1,
               				(SELECT CNSLT_NO
                  			 FROM TN_LAS_CONSULT
                 			 WHERE INTNL_PRGRS_STATUS = 'S03') B1
         				 WHERE	A1.CNSLT_NO = B1.CNSLT_NO
               				AND REG_DT BETWEEN (SELECT DATEADD(D,-1,GETDATE())) AND GETDATE()
        				 GROUP BY RESPMAN_ID) C ON C.RESPMAN_ID = G.RESPMAN_ID
		
					LEFT OUTER JOIN
	   					(SELECT RESPMAN_ID, COUNT (*) MONTH_COUNT
          				 FROM TN_LAS_CONSULT_RESPMAN A1,
               				(SELECT CNSLT_NO
                  			 FROM TN_LAS_CONSULT
                 			 WHERE INTNL_PRGRS_STATUS = 'S03') B1
         				 WHERE  A1.CNSLT_NO = B1.CNSLT_NO
               				AND REG_DT BETWEEN (SELECT DATEADD(D,-30,GETDATE())) AND GETDATE()
        				GROUP BY RESPMAN_ID) D ON D.RESPMAN_ID = G.RESPMAN_ID
       
	   				LEFT OUTER JOIN
	   					(SELECT RESPMAN_ID, COUNT (*) YEAR_COUNT
          				 FROM TN_LAS_CONSULT_RESPMAN A1,
               				(SELECT CNSLT_NO
                  			 FROM TN_LAS_CONSULT
                 			 WHERE INTNL_PRGRS_STATUS = 'S03') B1
         				 WHERE	A1.CNSLT_NO = B1.CNSLT_NO
               				AND REG_DT BETWEEN (SELECT DATEADD(D,-365,GETDATE())) AND GETDATE()
        				GROUP BY RESPMAN_ID) E ON E.RESPMAN_ID = G.RESPMAN_ID
       
	   				LEFT OUTER JOIN
	   					(SELECT RESPMAN_ID, COUNT (*) PENDING
          				 FROM TN_LAS_CONSULT_RESPMAN A1,
               				(SELECT CNSLT_NO
                  			 FROM TN_LAS_CONSULT
                 			 WHERE INTNL_PRGRS_STATUS = 'S02') B1
         				 WHERE	A1.CNSLT_NO = B1.CNSLT_NO
               				AND REG_DT BETWEEN (SELECT DATEADD(D,-365,GETDATE())) AND GETDATE()
        				 GROUP BY RESPMAN_ID) F ON F.RESPMAN_ID = G.RESPMAN_ID
 
 				WHERE	B.SYS_CD 		= 'LAS'
       				AND B.ROLE_CD IN 	('RA01', 'RA02')
       				AND A.BLNGT_ORGNZ 	= :blngt_orgnz
				]]>
			</statement>
			</query>	
			
			<!-- 법무시스템 총괄 부서를 조회한다. -->
			<query id="common.clmscom.getLasEpsuborgCombo" isCamelCase="false">
			<statement>
				<![CDATA[
					SELECT DEPT_NM 
					      ,GRP_DEPT_CD
					      ,INTNL_DEPT_CD 
					      ,CRTRNDAY
					      ,DEPT_LVL
					 FROM TN_LAS_YEAR_DEPT
					WHERE GRP_DEPT_CD = 'C04801'
						AND CRTRNDAY = (SELECT MAX(CRTRNDAY) FROM TN_LAS_YEAR_DEPT WHERE GRP_DEPT_CD = 'C04801')
				]]>
			</statement>
			</query>
			
			<!-- TB_COM_CD 정보조회 -->
			<query id="common.clmscom.listTbComCd" isCamelCase="false">
			<statement>
				<![CDATA[
					SELECT	SYS_CD, GRP_CD, CD, CD_NM, CD_ABBR_NM
					  		, CD_NM_ENG, CD_ABBR_NM_ENG, USE_YN
					  		, CD_NM_FRA, CD_ABBR_NM_FRA, CD_NM_DEU, CD_ABBR_NM_DEU
					  		, COMMENTS, USEMAN_MNG_ITM1, USEMAN_MNG_ITM2, USEMAN_MNG_ITM3
					  		, USEMAN_MNG_ITM4, USEMAN_MNG_ITM5
					  FROM	TB_COM_CD
					 WHERE	USE_YN = 'Y'
					 #if (!$sys_cd.equals(""))
					   AND	SYS_CD = :sys_cd
					 #end
					 #if (!$grp_cd.equals(""))
					   AND	GRP_CD = :grp_cd
					 #end
					 #if (!$cd.equals(""))
					   AND	CD LIKE :cd + '%'
					 #end
					 #if (!$cd_nm.equals(""))
					   AND	CD_NM = :cd_nm
					 #end
					 #if (!$cd_abbr_nm.equals(""))
					   AND	CD_ABBR_NM = :cd_abbr_nm
					 #end
					 #if (!$cd_nm_eng.equals(""))
					   AND	CD_NM_ENG = :cd_nm_eng
					 #end
					 #if (!$cd_abbr_nm_eng.equals(""))
					   AND	CD_ABBR_NM_ENG = :cd_abbr_nm_eng
					 #end
					 #if (!$cd_nm_fra.equals(""))
					   AND	CD_NM_FRA = :cd_nm_fra
					 #end
					 #if (!$cd_abbr_nm_fra.equals(""))
					   AND	CD_ABBR_NM_FRA = :cd_abbr_nm_fra
					 #end
					 #if (!$cd_nm_deu.equals(""))
					   AND	CD_NM_DEU = :cd_nm_deu
					 #end
					 #if (!$cd_abbr_nm_deu.equals(""))
					   AND	CD_ABBR_NM_DEU = :cd_abbr_nm_deu
					 #end
					 #if (!$useman_mng_itm1.equals(""))
					   AND	USEMAN_MNG_ITM1 = :useman_mng_itm1
					 #end
					 #if (!$useman_mng_itm2.equals(""))
					   AND	USEMAN_MNG_ITM2 = :useman_mng_itm2
					 #end
					 #if (!$useman_mng_itm3.equals(""))
					   AND	USEMAN_MNG_ITM3 = :useman_mng_itm3
					 #end
					 #if (!$useman_mng_itm4.equals(""))
					   AND	USEMAN_MNG_ITM4 = :useman_mng_itm4
					 #end
					 #if (!$useman_mng_itm5.equals(""))
					   AND	USEMAN_MNG_ITM5 = :useman_mng_itm5
					 #end
				]]>
			</statement>
			</query>
		
		<!-- CLM시스템의 조회, 수정권한을 조회한다. -->
		<query id="common.clmscom.getTrCheck" isCamelCase="false">
			<statement>
				<![CDATA[
				 	SELECT  COM_CHECK_PAGEROLE( :sys_cd , 
					    :user_id ,
					    :cnsdreq_id ,
					    :cntrt_id ,
					    :rc_flag ,
					    :event_but ,
					    :menu_id ,
					    :las_mem ) AS RET1
				]]>
			</statement>
		</query>
		
		<!-- LAS시스템의 조회, 수정권한을 조회한다. -->
		<query id="common.clmscom.getTrCheck2" isCamelCase="false">
			<statement>
				<![CDATA[
				 	SELECT  LAS_CHECK_PAGEROLE( :sys_cd , 
					    :user_id ,
					    :cnsdreq_id ,
					    :cntrt_id ,
					    :rc_flag ,
					    :event_but ,
					    :menu_id ,
					    :las_mem ) AS RET1
				]]>
			</statement>
		</query>
		
		<!-- 단위조직을  조회한다. -->
		<query id="common.clmscom.searchOrgnz" isCamelCase="false">
			<statement>
				<![CDATA[
				SELECT ORGNZ_CD, ORGNZ_NM, ORGNZ_NM_ENG, UP_ORGNZ_CD, DEPT_CD, CDCRTN_VAL, ORGNZ_NM_ABBR, 'N' AS ORG_CHK
				FROM TN_CLM_UNITORGNZ
				WHERE ORGNZ_GBN = 'C04702'
				AND	DEL_YN = 'N'
				AND UP_ORGNZ_CD != 'TOP'
			#if (!$vo.srch_up_orgnz_cd.equals(""))
				AND	UP_ORGNZ_CD = :vo.srch_up_orgnz_cd
			#end	
				START WITH UP_ORGNZ_CD = 'TOP'
				CONNECT BY PRIOR ORGNZ_CD = UP_ORGNZ_CD
				ORDER BY ORGNZ_SRT
				]]>
			</statement>
		</query>
		<!-- 원본접수건수  : 계약(담당자) -->
		<query id="common.clmscom.getCntrtAdiminCnt1" isCamelCase="false">
			<statement>
				<![CDATA[
				SELECT count(*) as cnt
				  FROM (SELECT REQ.CNSDREQ_ID
				          FROM TN_CLM_CONT_CNSDREQ REQ,
				               (SELECT FST_CNSDREQ_ID,
				                       MAX(CNSD_LEVEL) AS LVL,
				                       MIN(NVL(REQ_DT, REG_DT)) AS REQ_DT
				                  FROM TN_CLM_CONT_CNSDREQ
				                 WHERE DEL_YN = 'N'
				                 GROUP BY FST_CNSDREQ_ID) REQ_MAX
				         WHERE REQ.FST_CNSDREQ_ID = REQ_MAX.FST_CNSDREQ_ID
				           AND REQ.CNSD_LEVEL = REQ_MAX.LVL
				           AND REQ.DEL_YN = 'N'
				           AND ( REQ.CNSDREQ_ID IN (SELECT DISTINCT CNSD.CNSDREQ_ID
				                          FROM TN_CLM_CONTRACT_CNSD CNSD,
				                               TN_CLM_CONTRACT_AUTHREQ AUTHREQ
				                         WHERE CNSD.CNTRT_ID = AUTHREQ.CNTRT_ID
				                           AND AUTHREQ.DEL_YN       = 'N'
				                           AND AUTHREQ.DEMND_GBN    = 'C04601'
				                           AND AUTHREQ.DEMND_STATUS = 'C03702'
				                           AND AUTHREQ.TRGTMAN_ID   = :vo.session_user_id )
				                    OR REQ.COMP_CD              = :vo.session_auth_comp_cd ) 
				                    ) X,
				       (SELECT A1.CNSDREQ_ID ,
				               A1.CNTRT_ID 
				          FROM (SELECT CNSDREQ_ID,
				                       MIN(CNTRT_ID) AS CNTRT_ID,
				                       COUNT(CNTRT_ID) AS CNTRT_CNT
				                  FROM (SELECT CNSD.CNSDREQ_ID,
				                               MASTER.CNTRT_ID,
				                               MASTER.CNTRT_NM
				                          FROM TN_CLM_CONTRACT_CNSD CNSD,
				                               TN_CLM_CONTRACT_MASTER MASTER
				                         WHERE CNSD.CNTRT_ID = MASTER.CNTRT_ID
				                           AND MASTER.DEL_YN = 'N'
				                           AND MASTER.CNTRT_INFO_GBN IN ('C05401','C05404')
				                           AND MASTER.CNTRT_STATUS < 'C02406' 
				                           AND MASTER.COMP_CD   = :vo.session_auth_comp_cd
				                           AND MASTER.DEPTH_STATUS  = 'C02642' 
				                           )
				                 GROUP BY CNSDREQ_ID ) A1 ,
				               TN_CLM_CONTRACT_MASTER A2
				         WHERE A1.CNTRT_ID = A2.CNTRT_ID ) Y
				 WHERE X.CNSDREQ_ID = Y.CNSDREQ_ID 
				]]>
			</statement>
		</query>
		<!-- 자동연장승인  : 계약(담당자) -->
		<query id="common.clmscom.getCntrtAdiminCnt2" isCamelCase="false">
			<statement>
				<![CDATA[
				 SELECT count(*) as cnt
				  FROM (SELECT REQ.CNSDREQ_ID
				          FROM TN_CLM_CONT_CNSDREQ REQ,
				               (SELECT FST_CNSDREQ_ID,
				                       MAX(CNSD_LEVEL) AS CNSD_LEVEL,
				                       MIN(NVL(REQ_DT, REG_DT)) AS REQ_DT
				                  FROM TN_CLM_CONT_CNSDREQ
				                 WHERE DEL_YN = 'N'
				                 GROUP BY FST_CNSDREQ_ID) REQ_MAX
				         WHERE REQ.FST_CNSDREQ_ID = REQ_MAX.FST_CNSDREQ_ID
				           AND REQ.CNSD_LEVEL = REQ_MAX.CNSD_LEVEL
				           AND REQ.DEL_YN = 'N'  ) X,
				       (SELECT CNSDREQ_ID
				          FROM (SELECT CNSD.CNSDREQ_ID,
				                       MASTER.CNTRT_ID,
				                       MASTER.CNTRT_NM,
				                       MASTER.CNTRT_NO
				                  FROM TN_CLM_CONTRACT_CNSD CNSD,
				                       TN_CLM_CONTRACT_MASTER MASTER,
				                       TH_CLM_ORG_MNG HIS
				                 WHERE CNSD.CNTRT_ID = MASTER.CNTRT_ID
				                   AND CNSD.CNTRT_ID = HIS.CNTRT_ID
				                   AND MASTER.DEL_YN = 'N'
				                   AND MASTER.CNTRT_STATUS  = 'C02402'
				                   AND MASTER.PRCS_DEPTH    = 'C02505'
				                   AND MASTER.DEPTH_STATUS  = 'C02685'
				                   AND MASTER.COMP_CD   = :vo.session_auth_comp_cd
				                   AND HIS.GUBUN = 'R'  )
				         GROUP BY CNSDREQ_ID ) Y
				 WHERE X.CNSDREQ_ID = Y.CNSDREQ_ID 
				]]>
			</statement>
		</query>
		<!-- 체결후등록 건수  : 계약(담당자) -->
		<query id="common.clmscom.getCntrtAdiminCnt3" isCamelCase="false">
			<statement>
				<![CDATA[
				SELECT count(*) as cnt
				FROM (SELECT REQ.CNSDREQ_ID
				      FROM TN_CLM_CONT_CNSDREQ REQ,
				           (SELECT FST_CNSDREQ_ID,
				                   MAX(CNSD_LEVEL) AS LVL,
				                   MIN(NVL(REQ_DT, REG_DT)) AS REQ_DT
				              FROM TN_CLM_CONT_CNSDREQ
				             WHERE DEL_YN = 'N'
				             GROUP BY FST_CNSDREQ_ID) REQ_MAX
				     WHERE REQ.FST_CNSDREQ_ID = REQ_MAX.FST_CNSDREQ_ID
				       AND REQ.CNSD_LEVEL = REQ_MAX.LVL
				       AND REQ.DEL_YN = 'N') X,
				   (SELECT CNSD.CNSDREQ_ID
				      FROM TN_CLM_CONTRACT_CNSD CNSD,
				           TN_CLM_CONTRACT_MASTER MASTER
				     WHERE CNSD.CNTRT_ID        = MASTER.CNTRT_ID
				       AND MASTER.DEL_YN        = 'N'
				       AND MASTER.CNTRT_STATUS  = 'C02401'
				       AND MASTER.PRCS_DEPTH    = 'C02502'
				       AND MASTER.DEPTH_STATUS  = 'C02636'
				       AND MASTER.CNTRT_INFO_GBN = 'C05404'
				       AND MASTER.COMP_CD   = :vo.session_auth_comp_cd ) Y
				WHERE X.CNSDREQ_ID = Y.CNSDREQ_ID
				]]>
			</statement>
		</query>
		<!-- 표준계약서승인건수  : 계약(담당자) -->
		<query id="common.clmscom.getCntrtAdiminCnt4" isCamelCase="false">
			<statement>
				<![CDATA[
				SELECT count(*) as cnt
				FROM (SELECT REQ.CNSDREQ_ID
				      FROM TN_CLM_CONT_CNSDREQ REQ,
				           (SELECT FST_CNSDREQ_ID,
				                   MAX(CNSD_LEVEL) AS LVL,
				                   MIN(NVL(REQ_DT, REG_DT)) AS REQ_DT
				              FROM TN_CLM_CONT_CNSDREQ
				             WHERE DEL_YN = 'N'
				             GROUP BY FST_CNSDREQ_ID) REQ_MAX
				     WHERE REQ.FST_CNSDREQ_ID = REQ_MAX.FST_CNSDREQ_ID
				       AND REQ.CNSD_LEVEL = REQ_MAX.LVL
				       AND REQ.DEL_YN = 'N'
				       AND ( REQ.CNSDREQ_ID IN (SELECT DISTINCT CNSD.CNSDREQ_ID
				                      FROM TN_CLM_CONTRACT_CNSD CNSD,
				                           TN_CLM_CONTRACT_AUTHREQ AUTHREQ
				                     WHERE CNSD.CNTRT_ID = AUTHREQ.CNTRT_ID
				                       AND AUTHREQ.DEL_YN       = 'N'
				                       AND AUTHREQ.DEMND_GBN    = 'C04601'
				                       AND AUTHREQ.DEMND_STATUS = 'C03702'
				                       AND AUTHREQ.TRGTMAN_ID   = :vo.session_user_id )
				                OR REQ.COMP_CD              = :vo.session_auth_comp_cd ) ) X,
				   (SELECT A1.CNSDREQ_ID 
				      FROM (SELECT CNSDREQ_ID,
				                   MIN(CNTRT_ID) AS CNTRT_ID,
				                   COUNT(CNTRT_ID) AS CNTRT_CNT
				              FROM (SELECT CNSD.CNSDREQ_ID,
				                           MASTER.CNTRT_ID,
				                           MASTER.CNTRT_NM
				                      FROM TN_CLM_CONTRACT_CNSD CNSD,
				                           TN_CLM_CONTRACT_MASTER MASTER
				                     WHERE CNSD.CNTRT_ID = MASTER.CNTRT_ID
				                       AND MASTER.DEL_YN = 'N'
				                       AND LENGTH(MASTER.CNSLT_NO) > 0
				                       AND DEPTH_STATUS = 'C02602'
				                       AND (MASTER.CNTRT_INFO_GBN IN ('C05401')
				                                OR (MASTER.CNTRT_INFO_GBN IN ('C05404')
				                                       AND MASTER.PRCS_DEPTH IN ('C02504','C02505'))) )
				             GROUP BY CNSDREQ_ID ) A1 ,
				           TN_CLM_CONTRACT_MASTER A2
				     WHERE A1.CNTRT_ID = A2.CNTRT_ID ) Y
				WHERE X.CNSDREQ_ID = Y.CNSDREQ_ID
				]]>
			</statement>
		</query>	
		<!-- 최근 5분간배정 건수  : 법무(담당자) -->
		<query id="common.clmscom.getCntrtReqsCnt" isCamelCase="false">
			<statement>
				<![CDATA[
				select count(*) as reqs_cnt
		          from TN_CLM_CONT_CNSDREQ_RESPMAN A
		         where respman_id =:vo.session_user_id
		           and asgn_dt > ( sysdate - ((1/24)/60)*5)
		           AND NOT EXISTS (SELECT 1
		                                  FROM tn_clm_cont_cnsdreq_hold
		                                 WHERE CNSDREQ_ID = A.CNSDREQ_ID
		                                   AND HOLD_SEQNO = '1' )
				]]>
			</statement>
		</query>	
		<!-- 최근 5분간 반려 건수  : 법무(담당자) -->
		<query id="common.clmscom.getCntrtCnt" isCamelCase="false">
			<statement>
				<![CDATA[
				select  nvl(reqs_cnt,0)     as reqs_cnt
				        ,nvl(reutns_cnt,0)  as returns_cnt
				from  ( select count(*) as reqs_cnt
				          from TN_CLM_CONT_CNSDREQ_RESPMAN A
				         where respman_id =:vo.session_user_id
				           and asgn_dt > ( sysdate - ((1/24)/60)*5)
				           AND NOT EXISTS (SELECT 1
		                                  FROM tn_clm_cont_cnsdreq_hold
		                                 WHERE CNSDREQ_ID = A.CNSDREQ_ID
		                                   AND HOLD_SEQNO = '1' )
				      ) A
				     ,( select nvl(count(*),0) as reutns_cnt
				          from th_clm_contract_cnsdrejct A,
				               TN_CLM_CONT_CNSDREQ_RESPMAN b
				         where a.rejct_dt >  ( sysdate - ((1/24)/60)*5)
				           and b.respman_id =:vo.session_user_id
				           AND NOT EXISTS (SELECT 1
				                  FROM tn_clm_cont_cnsdreq_hold
				                 WHERE CNSDREQ_ID = A.CNSDREQ_ID
				                   AND HOLD_SEQNO = '1' )
				       ) B
				where 1=1
				]]>
			</statement>
		</query>	
		<!-- 5분간 배정,반려 된 것의 개수 : 자문(담당자) -->
		<query id="common.clmscom.getCnsltCnt" isCamelCase="false">
			<statement>
				<![CDATA[
				SELECT nvl(sum(decode(INTNL_PRGRS_STATUS, 'S02', 1, 0)),0) as req,
				       nvl(sum(decode(INTNL_PRGRS_STATUS, 'S04', 1, 0)),0) as re_req,
				       nvl(sum(decode(INTNL_PRGRS_STATUS, 'S02', 1, 0)),0) + nvl(sum(decode(INTNL_PRGRS_STATUS, 'S04', 1, 0)),0) as reqs_cnt,
				       nvl(sum(decode(INTNL_PRGRS_STATUS, 'S11', 1, 0)),0) as returns_cnt       
				  FROM (select A.CNSLT_NO,
				               INTNL_PRGRS_STATUS,
				               (
                                  CASE
                                    WHEN A.INTNL_PRGRS_STATUS = 'S02' THEN B.REG_DT 
                                    WHEN A.INTNL_PRGRS_STATUS = 'S04' THEN A.REG_DT 
                                    WHEN A.INTNL_PRGRS_STATUS = 'S11' THEN A.MOD_DT 
                                  END) AS LAS_TIME
				          from tn_las_consult A,
				               (select cnslt_no,
				                       reg_dt
				                  from tn_las_consult_respman
				                 where del_yn = 'N'
				                   and respman_id = :vo.session_user_id) B
				         where A.DEL_YN ='N'
				           and A.cnslt_no = B.cnslt_no
				           and A.intnl_prgrs_status in ('S02',
				                       'S11',
				                       'S04') )
				 WHERE LAS_TIME > (sysdate - ((1/24)/60)*5)
				]]>
			</statement>
		</query>	
		<!-- 최근 5분간배정,반려 건수  : 계약(관리자) -->
		<query id="common.clmscom.getAdminCntrtCnt" isCamelCase="false">
			<statement>
				<![CDATA[
				SELECT MAX(TOTAL_CNT) AS TOTAL_CNT
      ,SUM(UNASSIGN_CNT) AS UNASSIGN_CNT
      ,SUM(CONSIDER_CNT) AS CONSIDER_CNT
      ,SUM(TEMPSAVE_CNT) AS TEMPSAVE_CNT
      ,SUM(PENDDING_CNT) AS PENDDING_CNT
      ,SUM(TRANSFER_CNT) AS TRANSFER_CNT
  FROM (
        SELECT COUNT(1) OVER() AS TOTAL_CNT
#if ($vo.session_blngt_orgnz.equals("A00000003"))
              ,CASE WHEN IP_STATUS_NEW = 'C04224' THEN 1 ELSE 0 END AS UNASSIGN_CNT
              ,CASE WHEN IP_STATUS_NEW = 'C04204' THEN 1 ELSE 0 END AS CONSIDER_CNT
              ,CASE WHEN IP_STATUS_NEW = 'C04225' THEN 1 ELSE 0 END AS TEMPSAVE_CNT
              ,CASE WHEN IP_STATUS_NEW = 'C04205' THEN 1 ELSE 0 END AS PENDDING_CNT
              ,CASE WHEN IP_STATUS_NEW = 'C04206' THEN 1 ELSE 0 END AS TRANSFER_CNT
#else
              ,CASE WHEN LAW_STATUS_NEW = 'C04224' THEN 1 ELSE 0 END AS UNASSIGN_CNT
              ,CASE WHEN LAW_STATUS_NEW = 'C04204' THEN 1 ELSE 0 END AS CONSIDER_CNT
              ,CASE WHEN LAW_STATUS_NEW = 'C04225' THEN 1 ELSE 0 END AS TEMPSAVE_CNT
              ,CASE WHEN LAW_STATUS_NEW = 'C04205' THEN 1 ELSE 0 END AS PENDDING_CNT
              ,CASE WHEN LAW_STATUS_NEW = 'C04206' THEN 1 ELSE 0 END AS TRANSFER_CNT
#end
          FROM (
                 SELECT C.CNSDREQ_ID
                       ,CASE WHEN E.DEPTH_STATUS = 'C02607' THEN 'C04210' 
                             ELSE C.PRGRS_STATUS END AS PRGRS_STATUS	-- 검토의뢰의 보류만 보류로 유지
                       ,C.LAW_STATUS_NEW ,C.IP_STATUS_NEW
                   FROM (
                          SELECT CNSDREQ_ID
                                ,PRGRS_STATUS ,CNSD_DEPT ,RESPMAN_APNT_YN ,PRGRS_STATUS_WORK
                                ,LAW_STATUS_NEW ,IP_STATUS_NEW
                            FROM (
                                   SELECT CNSDREQ_ID
                                         ,PRGRS_STATUS ,CNSD_DEPT ,RESPMAN_APNT_YN ,PRGRS_STATUS_WORK
                                         ,CASE WHEN MN_CNSD_DEPT IN ('A00000001', 'A00000002') OR VC_CNSD_DEPT IN ('A00000001', 'A00000002')
                                                    THEN CASE WHEN PRGRS_STATUS > 'C04205'
                                                                   THEN PRGRS_STATUS		-- 의뢰상태가 (이관요청/회신/Drop/구시스템이관) 이면 그대로 사용
                                                                   ELSE CASE WHEN LAW_STATUS = 'C04302' THEN 'C04225'	-- 임시저장
                                                                             WHEN LAW_STATUS = 'C04303' THEN 'C04205'	-- 미결
                                                                                  ELSE CASE WHEN LAW_STATUS IS NULL
                                                                                                 THEN CASE WHEN MN_CNSD_DEPT IN ('A00000001', 'A00000002')
                                                                                                                THEN CASE WHEN MN_RESPMAN_APNT_YN = 'Y'
                                                                                                                               THEN 'C04204'	-- 검토중
                                                                                                                               ELSE 'C04224'	-- 미배정
                                                                                                                     END
                                                                                                                ELSE CASE WHEN VC_RESPMAN_APNT_YN = 'Y'
                                                                                                                               THEN 'C04204'	-- 검토중
                                                                                                                               ELSE 'C04224'	-- 미배정
                                                                                                                     END
                                                                                                      END
                                                                                                 ELSE 'C04204'	-- Default 검토중 상태 (완료상태 포함)
                                                                                       END
                                                                        END
                                                         END
                                                    ELSE ''
                                          END AS LAW_STATUS_NEW
                                         ,CASE WHEN MN_CNSD_DEPT IN ('A00000003') OR VC_CNSD_DEPT IN ('A00000003')
                                                    THEN CASE WHEN PRGRS_STATUS > 'C04205'
                                                                   THEN PRGRS_STATUS		-- 의뢰상태가 (이관요청/회신/Drop/구시스템이관) 이면 그대로 사용
                                                                   ELSE CASE WHEN IP_STATUS = 'C04302' THEN 'C04225'	-- 임시저장
                                                                             WHEN IP_STATUS = 'C04303' THEN 'C04205'	-- 미결
                                                                                  ELSE CASE WHEN IP_STATUS IS NULL
                                                                                                 THEN CASE WHEN MN_CNSD_DEPT IN ('A00000003')
                                                                                                                THEN CASE WHEN MN_RESPMAN_APNT_YN = 'Y'
                                                                                                                               THEN 'C04204'	-- 검토중
                                                                                                                               ELSE 'C04224'	-- 미배정
                                                                                                                     END
                                                                                                                ELSE CASE WHEN VC_RESPMAN_APNT_YN = 'Y'
                                                                                                                               THEN 'C04204'	-- 검토중
                                                                                                                               ELSE 'C04224'	-- 미배정
                                                                                                                     END
                                                                                                      END
                                                                                                 ELSE 'C04204'	-- Default 검토중 상태 (완료상태 포함)
                                                                                       END
                                                                        END
                                                         END
                                                    ELSE ''
                                          END AS IP_STATUS_NEW
                                         ,LAW_STATUS ,IP_STATUS
                                     FROM (
                                            SELECT CNSDREQ_ID ,MN_CNSD_DEPT
                                                  ,PRGRS_STATUS ,CNSD_DEPT ,RESPMAN_APNT_YN ,PRGRS_STATUS_WORK
                                                  ,VC_CNSD_DEPT
                                                  ,MN_RESPMAN_APNT_YN , VC_RESPMAN_APNT_YN
                                                  ,MIN(LAW_STATUS) AS LAW_STATUS ,MIN(IP_STATUS) AS IP_STATUS
                                              FROM (
                                                     SELECT F.CNSDREQ_ID ,F.MN_CNSD_DEPT
                                                           ,F.PRGRS_STATUS ,F.CNSD_DEPT ,F.RESPMAN_APNT_YN ,F.PRGRS_STATUS_WORK
                                                           ,F.VC_CNSD_DEPT
                                                           ,CASE WHEN G.CNSD_DEPT = 'A00000003' THEN ''            ELSE G.CNSD_STATUS END AS LAW_STATUS
                                                           ,CASE WHEN G.CNSD_DEPT = 'A00000003' THEN G.CNSD_STATUS ELSE ''            END AS IP_STATUS
                                                           ,F.MN_RESPMAN_APNT_YN , F.VC_RESPMAN_APNT_YN
                                                       FROM (
                                                              SELECT A.CNSDREQ_ID
                                                                    ,A.MN_CNSD_DEPT ,A.PRGRS_STATUS
                                                                    ,CASE WHEN :vo.session_blngt_orgnz = A.MN_CNSD_DEPT THEN A.MN_CNSD_DEPT
                                                                          WHEN :vo.session_blngt_orgnz = A.VC_CNSD_DEPT THEN A.VC_CNSD_DEPT
                                                                                                                        ELSE ''
                                                                     END AS CNSD_DEPT
                                                                    ,CASE WHEN :vo.session_blngt_orgnz = A.MN_CNSD_DEPT THEN A.MN_RESPMAN_APNT_YN
                                                                          WHEN :vo.session_blngt_orgnz = A.VC_CNSD_DEPT THEN A.VC_RESPMAN_APNT_YN
                                                                                                                        ELSE ''
                                                                     END AS RESPMAN_APNT_YN
                                                                    ,CASE WHEN A.PRGRS_STATUS IN ('C04203', 'C04204', 'C04205')
                                                                               THEN CASE WHEN :vo.session_blngt_orgnz = A.MN_CNSD_DEPT
                                                                                              THEN A.PRGRS_STATUS
                                                                                              ELSE ''
                                                                                    END
                                                                               ELSE A.PRGRS_STATUS
                                                                     END AS PRGRS_STATUS_WORK
                                                                    ,A.VC_CNSD_DEPT
                                                                    ,A.MN_RESPMAN_APNT_YN , A.VC_RESPMAN_APNT_YN
                                                                FROM TN_CLM_CONT_CNSDREQ A
                                                                    ,(
SELECT A.CNSDREQ_ID
  FROM TN_CLM_CONT_CNSDREQ A,
			(SELECT FST_CNSDREQ_ID,
              MAX(CNSD_LEVEL) AS CNSD_LEVEL,
							MIN(NVL(ACPT_DT, REG_DT)) AS ACPT_DT
          FROM TN_CLM_CONT_CNSDREQ
				WHERE PRGRS_STATUS <> 'C04201'
				  AND DEL_YN = 'N'
        GROUP BY FST_CNSDREQ_ID) B
 WHERE A.FST_CNSDREQ_ID = B.FST_CNSDREQ_ID
   AND A.CNSD_LEVEL = B.CNSD_LEVEL
   AND A.DEL_YN = 'N'
                                                                     ) B
                                                               WHERE A.DEL_YN = 'N'
                                                                 AND A.PRGRS_STATUS < 'C04207'			-- My Work 본인 할일은 회신 이전 상태만 조회
                                                                 AND A.CNSDREQ_ID = B.CNSDREQ_ID
                                                                 AND A.REQ_OPERDIV IS NOT NULL			-- 2012-07-25 null이 아닌 건수만 카운트
                                                            ) F
                                                           ,TN_CLM_CONTRACT_DEPTCNSD G
                                                      WHERE F.CNSDREQ_ID = G.CNSDREQ_ID(+)
                                                   )
                                             GROUP BY CNSDREQ_ID ,MN_CNSD_DEPT
                                                     ,PRGRS_STATUS ,CNSD_DEPT ,RESPMAN_APNT_YN ,PRGRS_STATUS_WORK
                                                     ,VC_CNSD_DEPT
                                                     ,MN_RESPMAN_APNT_YN , VC_RESPMAN_APNT_YN
                                          )
                                 )
                           WHERE 1 = 1
                             AND CNSD_DEPT = :vo.session_blngt_orgnz							-- My Work 일 경우 이하 조건이 필요 (Default 본인 할일만 조회할 때)
#if (!$vo.top_role.equals("RA01"))
                             AND CNSDREQ_ID IN (
                                                 SELECT CNSDREQ_ID								-- 본인이 배정받은것
                                                   FROM TN_CLM_CONT_CNSDREQ_RESPMAN
                                                  WHERE RESPMAN_ID = :vo.session_user_id
                                                  GROUP BY CNSDREQ_ID
                                               )
#end
#if ($vo.session_blngt_orgnz.equals("A00000001") || $vo.session_blngt_orgnz.equals("A00000002"))
                             AND (LAW_STATUS IS NULL OR LAW_STATUS IN ('C04301', 'C04302', 'C04303'))	-- 유관부서일 경우 의견전달 완료는 제외 (법무팀)
#end
#if ($vo.session_blngt_orgnz.equals("A00000003"))
                             AND (IP_STATUS IS NULL OR IP_STATUS IN ('C04301', 'C04302', 'C04303'))		-- 유관부서일 경우 의견전달 완료는 제외 (IP센터)
#end
                        ) C
                       ,(
                          SELECT CCC.CNSDREQ_ID ,MIN(CCC.CNTRT_ID) AS CNTRT_ID	-- 의뢰건별 첫번째 계약만 추출 (주계약)
                            FROM TN_CLM_CONTRACT_CNSD CCC
                                ,TN_CLM_CONTRACT_MASTER CCM
                           WHERE CCC.CNTRT_ID = CCM.CNTRT_ID
                             AND CCM.DEL_YN = 'N'
                             AND CCM.CNTRT_INFO_GBN IN ('C05401')
                           GROUP BY CCC.CNSDREQ_ID
                        ) D
                       ,(
                          SELECT CNTRT_ID ,DEPTH_STATUS
                            FROM TN_CLM_CONTRACT_MASTER
                           WHERE DEL_YN = 'N'
                        ) E
                  WHERE C.CNSDREQ_ID = D.CNSDREQ_ID
                    AND D.CNTRT_ID   = E.CNTRT_ID
                    AND NOT EXISTS ( SELECT 1 FROM tn_clm_cont_cnsdreq_hold WHERE CNSDREQ_ID = C.CNSDREQ_ID AND HOLD_SEQNO = '1' ) --- 보류 후 보류 해제 중 작성 중인것을 위해 추가 20120712 PYD  
               )
         WHERE PRGRS_STATUS < 'C04207'	-- 보류 제외를 위해 다시 한번 체크
       )
				]]>
			</statement>
		</query>		
		<!-- 내가할일 : 자문(관리자) -->
		<query id="common.clmscom.getAdiminCnsltCnt" isCamelCase="false">
			<statement>
				<![CDATA[
				SELECT SUM(NOASSIGN_CNT) AS NOASSIGN_CNT
					     ,SUM(REVIEW_CNT) AS REVIEW_CNT
					     ,SUM(TEMP_CNT) AS TEMP_CNT
					     ,SUM(PENDING_CNT) AS PENDING_CNT
					     ,SUM(NOASSIGN_CNT+REVIEW_CNT+TEMP_CNT+PENDING_CNT) AS TOTAL_CNT
					 FROM (
					SELECT CASE WHEN PRGRS_STATUS = 'V01' THEN 1 ELSE 0 END AS NOASSIGN_CNT
					      ,CASE WHEN PRGRS_STATUS = 'V02' THEN 1 ELSE 0 END AS REVIEW_CNT
					      ,CASE WHEN PRGRS_STATUS = 'S09' THEN 1 ELSE 0 END AS TEMP_CNT
					      ,CASE WHEN PRGRS_STATUS = 'S08' THEN 1 ELSE 0 END AS PENDING_CNT
					      ,PRGRS_STATUS
					  FROM (
					   SELECT CASE WHEN INTNL_PRGRS_STATUS IN ('S02','S04','S11') THEN
					                    CASE WHEN INTNL_PRGRS_STATUS = 'S11' THEN 'S09'
					                         ELSE
								                 CASE WHEN RESPMAN_NM IS NOT NULL THEN 'V02'
								                      ELSE 'V01'
								                 END
					     	             END         
					                     ELSE INTNL_PRGRS_STATUS
					               END AS PRGRS_STATUS
					               , TLC.CNSLT_NO, TLC.HSTRY_NO, TLC.REG_ID, TLC.DMSTFRGN_GBN
					           FROM (SELECT CNSLT_NO, HSTRY_NO, REG_ID, DMSTFRGN_GBN, INTNL_PRGRS_STATUS, LAS_CONSULT_RESPMAN(CNSLT_NO, ',') RESPMAN_NM
					                   FROM TN_LAS_CONSULT
					                ) TLC
					               ,(SELECT CNSLT_NO , MAX(HSTRY_NO) AS HSTRY_NO
					                   FROM TN_LAS_CONSULT
					                  WHERE DEL_YN = 'N'
					                    --AND REG_OPERDIV IN ('B00000001','B00000002','B00000003','B00000017') -- 부서추가 'B00000017' MSC
					                  GROUP BY CNSLT_NO ) MLC
					          WHERE TLC.CNSLT_NO = MLC.CNSLT_NO
					            AND TLC.HSTRY_NO = MLC.HSTRY_NO
					            
					           -- 법무담당자(변호사)일 경우
			                   /* AND TLC.CNSLT_NO IN (
			                                       SELECT CNSLT_NO
			                                         FROM TN_LAS_CONSULT_RESPMAN
			                                        WHERE DEL_YN = 'N'
			                                          AND RESPMAN_ID = :vo.session_user_id
			                                       )
			                   AND TLC.INTNL_PRGRS_STATUS IN ('S02', 'S04', 'S08', 'S09', 'S11')
				               */
				               -- 법무결재자(그룹장)일 경우
			                   AND TLC.INTNL_PRGRS_STATUS IN ('S02', 'S04', 'S08', 'S09')
				               
						       -- 법무팀 소속일 경우
			                   AND TLC.DMSTFRGN_GBN = 'H'
							  
							   -- 해외법무팀 소속일 경우
			                   --AND TLC.DMSTFRGN_GBN = 'F'
			
							   -- 그외 소속일 경우 (IP센터)
			                   --AND TLC.DMSTFRGN_GBN = 'X'
							   
					     ))
				]]>
			</statement>
		</query>
		
		<!--  필수 항목에 대한 체크 리스트를 가지고 온다. -->
		<query id="common.clmscom.checkList" isCamelCase="false">
			<statement>
				<![CDATA[
				SELECT ROW_NUMBER() OVER(ORDER BY A.ITEM_CD) AS NO
				     , A.COMP_CD
				     , A.ITEM_CD
				     , A.DIS_YN
				     , B.CD_NM
				     , ROW_NUMBER() OVER(ORDER BY A.ITEM_CD) -1 AS CHK_NO
                  FROM TB_COM_REQU_ITEM A
                  JOIN TB_COM_CD B ON A.ITEM_CD = B.CD
                 WHERE B.GRP_CD = 'RI01'
                   AND A.COMP_CD = :vo.comp_cd
              ORDER BY ITEM_CD
				]]>
			</statement>
		</query>
		
		<!--  필수 항목에 대한 체크 한 값을 가지고 변경 한다. -->
		<query id="common.clmscom.modifyCheckItem" isCamelCase="false">
			<statement>
				<![CDATA[
				UPDATE TB_COM_REQU_ITEM
                   SET DIS_YN = :vo.dis_yn
                 WHERE ITEM_CD = :vo.item_cd
                   AND COMP_CD = :vo.comp_cd
				]]>
			</statement>
		</query>
		
		<!-- 대분류에 의한 공통 코드 리스트 조회 (전자 담당자일 경우 해당 모든 회사가 보여줘야 함.) -->
 		<query id="common.clmscom.listComCdByGrpAllCd_MultCOMP" isCamelCase="false">                                                                                 
			<statement>                                                                                                   
				<![CDATA[
					
				  SELECT DISTINCT
				         A.SYS_CD
						,A.GRP_CD
						,A.CD
						,A.CD_NM AS REL_CD_NM
						,A.CD_ABBR_NM AS CD_NM
						,A.CD_NM_ENG AS REL_CD_NM_ENG
						,A.CD_ABBR_NM_ENG AS CD_NM_ENG
						,A.CD_NM_FRA AS CD_NM_FRA
						,A.CD_ABBR_NM_FRA AS CD_NM_FRA
						,A.CD_NM_DEU AS CD_NM_DEU
						,A.CD_ABBR_NM_DEU AS CD_NM_DEU
					FROM TN_COM_SEC_MNG_REVIEWER_COMP B
					LEFT OUTER JOIN TB_COM_CD A ON A.CD = B.COMP_CD
				   WHERE SYS_CD = :sys_cd
				   #if (($useman_mng_itm1.equals("") && $useman_mng_itm2.equals("")) || !$grp_cd.equals(""))
					 AND GRP_CD = 'COMP2'
				   #end
				   #if (!$selectCd.equals(""))
					 AND CD NOT IN(
								#foreach($select_cd in $select_cd_list)
									#if($velocityCount == 1)
										'$select_cd'
									#else
										,'$select_cd'
									#end
								#end
							)
						#end 
				   	  AND USE_YN <> 'N'
				       OR A.CD = (SELECT COMP_CD
					                FROM TB_COM_USER
								   WHERE USER_ID = :user_id)
					  AND B.USER_ID = :user_id
				   ORDER BY CD_NM, CD
				
				]]>
			</statement>				                                         	
		</query>
						
    </queries>
</queryservice>
