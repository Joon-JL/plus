<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
	   <queries>
	   <!-- 협상포인트 목록조회 : 2011.10.05 : 유영섭 -->
<query id="clm.share.ListNegoPoint" isCamelCase="false">
  <statement>
    <![CDATA[
			 SELECT *
			  		 FROM ( 
			     		    SELECT rownum RN, t.*, COUNT(1) over() TOTAL_CNT
							FROM(
				           			 SELECT NEGO_NO
						                   ,CNTRT_OPPNT_CD
						                   ,CNTRT_OPPNT_NM
						                   ,TITLE
						                   ,CONT
						                   ,RDCNT
						                   ,TO_CHAR(REG_DT, 'YYYYMMDD') AS REG_DT
						                   ,REG_ID
						                   ,REG_NM
						                   ,MOD_DT
						                   ,MOD_ID
						                   ,MOD_NM
						                   ,DEL_YN
						                   ,DEL_DT
						                   ,DEL_ID
						                   ,DEL_NM
			          			    FROM TN_CLM_NEGO_POINT
			          			    WHERE CNTRT_OPPNT_NM LIKE '%' + :vo.cntrt_oppnt_nm + '%'
			          			    AND DEL_YN   = 'N'
			          				ORDER BY  NEGO_NO DESC
			       				 ) t
						 ) 
			 WHERE RN between :vo.start_index and :vo.end_index
    ]]>
  </statement>
</query>

 <!-- 협상포인트 등록 : 2011.10.06 : 유영섭 -->
<query id="clm.share.InsertNegoPoint" isCamelCase="false">
  <statement>
    <![CDATA[
    INSERT INTO TN_CLM_NEGO_POINT (
          		 NEGO_NO
               , CNTRT_OPPNT_CD
               , CNTRT_OPPNT_NM
               , TITLE
               , CONT
               , RDCNT
               , REG_DT
               , REG_ID
               , REG_NM
               , DEL_YN
        ) VALUES (
           :vo.nego_no
          ,:vo.customer_cd
          ,:vo.cntrt_oppnt_nm
          ,:vo.title
          ,:vo.cont
          ,:vo.rdcnt
          ,SYSDATE
          ,:vo.reg_id
          ,:vo.reg_nm
          ,'N'
        )
    ]]>
  </statement>
</query>

 <!-- 협상포인트 상세조회 : 2011.10.07 : 유영섭 -->
<query id="clm.share.DetailNegoPoint" isCamelCase="false">
  <statement>
    <![CDATA[
				        SELECT 				NEGO_NO
						                   ,CNTRT_OPPNT_CD
						                   ,CNTRT_OPPNT_NM
						                   ,TITLE
						                   ,CONT
						                   ,RDCNT
						                   ,TO_CHAR(REG_DT, 'YYYY-MM-DD') AS REG_DT
						                   ,REG_ID
						                   ,REG_NM
						                   ,MOD_DT
						                   ,MOD_ID
						                   ,MOD_NM
						                   ,DEL_YN
						                   ,DEL_DT
						                   ,DEL_ID
						                   ,DEL_NM
									 FROM	TN_CLM_NEGO_POINT
								     WHERE 	NEGO_NO = :vo.nego_no
			    
    ]]>
  </statement>
</query>   

<!-- 협상포인트 MAX NEGO_NO : 2011.10.05 : 유영섭 -->
		<query id="clm.share.maxNegoNoNegoPoint" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        SELECT MAX(NEGO_NO) AS MAX_NEGO_NO FROM TN_CLM_NEGO_POINT
		    ]]>
		  </statement>
		</query>
		
		
	<!-- 협상포인트 조회수 증가 : 2011.10.05 : 유영섭 -->
		<query id="clm.share.modifyRdcntNegoPoint" isCamelCase="false">
		  <statement>
		    <![CDATA[
	        UPDATE 	TN_CLM_NEGO_POINT
	        SET		RDCNT = RDCNT + 1
		    WHERE	NEGO_NO = :vo.nego_no
		    AND	 	(DEL_YN = 'N' OR DEL_YN IS NULL)		
		    ]]>
		  </statement>
		</query>
		
<!-- 협상포인트 수정: 2011.10.05 : 유영섭 -->		
<query id="clm.share.ModifyNegoPoint" isCamelCase="false">
  <statement>
    <![CDATA[
         UPDATE TN_CLM_NEGO_POINT
          SET NEGO_NO = :vo.nego_no
              , CNTRT_OPPNT_CD = :vo.cntrt_oppnt_cd
              , CNTRT_OPPNT_NM = :vo.cntrt_oppnt_nm
              , TITLE = :vo.title
              , CONT = :vo.cont
          	  , MOD_DT = :vo.mod_dt
              , MOD_ID = :vo.mod_id
              , MOD_NM = :vo.mod_nm
          WHERE NEGO_NO =:vo.nego_no
          AND DEL_YN = 'N' 
    ]]>
  </statement>
</query>

<!-- 협상포인트 삭제 : 2011.10.05 : 유영섭 -->
<query id="clm.share.DeleteNegoPoint" isCamelCase="false">
  <statement>
    <![CDATA[
          UPDATE 		TN_CLM_NEGO_POINT
		  SET            DEL_YN  = 'Y'
				        ,DEL_DT  = SYSDATE
				        ,DEL_ID  = :vo.del_id
				        ,DEL_NM  = :vo.del_nm
		  WHERE	NEGO_NO    = :vo.nego_no
		  AND		DEL_YN   = 'N'	
    ]]>
  </statement>
		</query>
		
<!-- NegoPoint MAX Sequence -->
		<query id="clm.share.makeSeqNegoPoint" isCamelCase="false">
			<statement>
			<![CDATA[
				SELECT	ISNULL(MAX(NEGO_NO)+1,1) NEXT_NEGO
				  FROM	TN_CLM_NEGO_POINT
				 
	
			]]>
			</statement>
		</query>	
<!-- 표준 조항 권한 체크 정보  -->
		<query id="clm.share.authContractNegoPoint" isCamelCase="false">
		  	<statement>
			    <![CDATA[
					SELECT	NEGO_NO, CNTRT_OPPNT_CD, CNTRT_OPPNT_NM, TITLE, CONT, RDCNT
						  , TO_CHAR(REG_DT, 'YYYYMMDD') AS REG_DT, REG_ID, REG_NM
					FROM 	TN_CLM_NEGO_POINT
					WHERE NEGO_NO = :vo.nego_no
					 
			    ]]>
		  	</statement>
		</query>	
		
 	</queries>
</queryservice>	