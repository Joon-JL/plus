<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">
 
<queryservice>
	<queries>
	    <!-- 법률자문의뢰 목록 : 표준계약서 분리로 목록에서 제외(2013.04.04) -->
		<query id="las.lawconsult.list_reqman" isCamelCase="false">
			<statement>
    		<![CDATA[
                SELECT *
                  FROM (
                        SELECT ROW_NUMBER() OVER(ORDER BY MIN_REG_DT DESC) AS RM
                             , COUNT(1) OVER() TOTAL_CNT
                             , A.*
                          FROM (
                                SELECT TLC.CNSLT_NO
                                     , TLC.HSTRY_NO
                                     , TLC.DMSTFRGN_GBN
                                     , TLC.TITLE
                                     , TLC.EXTNL_PRGRS_STATUS AS PRGRS_STATUS
                                     ,CASE WHEN :vo.session_user_locale = 'ko' THEN TCC.CD_NM 
                                     	   WHEN :vo.session_user_locale = 'fr' THEN TCC.CD_NM_FRA
                                     	   WHEN :vo.session_user_locale = 'de' THEN TCC.CD_NM_DEU
                                     	   ELSE TCC.CD_NM_ENG END  AS PRGRS_STATUS_NAME
                                     , DBO.LAS_CONSULT_RESPMAN(TLC.CNSLT_NO, ',') RESPMAN_NM
                                     , CONVERT(VARCHAR, MIN_TLC.MIN_REG_DT, 120) REG_DT
                                     , CONVERT(VARCHAR, MIN_TLC.MIN_REG_DT, 23) REG_DT_DATE
                                     , TLC.REG_NM, MIN_TLC.MIN_REG_DT
                                     , CONVERT(VARCHAR, TLC.REQ_REPLY_DT, 23) AS REQ_REPLY_DT
                                  FROM 
										(select TN_LAS_CONSULT.*,TN_LAS_CARBON_MAN.RESPMAN_ID CC  from TN_LAS_CONSULT left join TN_LAS_CARBON_MAN on :vo.session_user_id =TN_LAS_CARBON_MAN.RESPMAN_ID AND TN_LAS_CONSULT.CNSLT_NO= TN_LAS_CARBON_MAN.CNSLT_NO AND  TN_LAS_CONSULT.EXTNL_PRGRS_STATUS <> 'S01') TLC
                                  	 , TB_COM_CD TCC
                                     , (SELECT MAX(HSTRY_NO) MAX_HSTRY_NO, CNSLT_NO
                                          FROM TN_LAS_CONSULT
                                         WHERE DEL_YN = 'N'
                                           AND INTNL_PRGRS_STATUS NOT IN ('S09','S11')
                                         GROUP BY CNSLT_NO) MAX_TLC
                                     , (SELECT MIN(REG_DT) MIN_REG_DT, CNSLT_NO
                                          FROM TN_LAS_CONSULT
                                         WHERE DEL_YN = 'N'
                                         GROUP BY CNSLT_NO) MIN_TLC
                                 WHERE TLC.DEL_YN   = 'N'
                                   AND TLC.PUB_YN   = 'Y'
                                   AND TLC.EXTNL_PRGRS_STATUS = TCC.CD
                                   AND TCC.GRP_CD   = 'N1_E'
                                   AND TLC.CNSLT_NO = MAX_TLC.CNSLT_NO
                                   AND TLC.HSTRY_NO = MAX_TLC.MAX_HSTRY_NO
                                   AND TLC.CNSLT_NO = MIN_TLC.CNSLT_NO
                                   AND (TLC.REG_ID = :vo.reg_id OR TLC.CC is not null)
                                   
                                   #if(!$vo.session_auth_comp_cd.equals(""))
                                   AND TLC.COMP_CD IN ($vo.session_auth_comp_cd)
                                   #end
                            #if ($vo.srch_title && !$vo.srch_title.equals(""))
                                   AND UPPER(TLC.TITLE) LIKE '%' + UPPER(:vo.srch_title) +  '%'
                            #end
                            #if ($vo.srch_prgrs_status && !$vo.srch_prgrs_status.equals(""))
                                   AND TLC.EXTNL_PRGRS_STATUS LIKE '%' + :vo.srch_prgrs_status +  '%'
                            #end
                            #if ($vo.srch_start_ymd && !$vo.srch_start_ymd.equals(""))
                                   AND MIN_TLC.MIN_REG_DT >= CONVERT(DATETIME, :vo.srch_start_ymd)
                            #end
                            #if ($vo.srch_end_ymd && !$vo.srch_end_ymd.equals(""))
                                   
                                   AND MIN_TLC.MIN_REG_DT <= CONVERT(DATETIME, :vo.srch_end_ymd) + 1
                            #end
                                   AND EXISTS (SELECT *
                                                 FROM TN_LAS_CONSULT_TYPE TLCT
                                                WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
                                                  AND TLC.HSTRY_NO = TLCT.HSTRY_NO
                                                  AND TLCT.CNSLT_TYPE NOT IN ('A20'))
                                 
                               ) A
                    #if ($vo.srch_respman_nm && !$vo.srch_respman_nm.equals(""))
                         WHERE 'Y' = CASE WHEN UPPER(RESPMAN_NM) LIKE '%' + UPPER(:vo.srch_respman_nm) + '%' THEN 'Y'
										WHEN 
										ISNULL((SELECT MAX(CASE WHEN UPPER(USER_NM) LIKE '%' + UPPER( :vo.srch_respman_nm ) + '%' THEN 'Y'
									  		WHEN UPPER(USER_NM_ENG) LIKE '%' + UPPER( :vo.srch_respman_nm ) + '%' THEN 'Y'
									  		ELSE 'N' END)
											FROM TB_COM_USER SA, TN_LAS_CONSULT_RESPMAN SB WHERE SB.CNSLT_NO=A.CNSLT_NO AND SA.USER_ID = SB.RESPMAN_ID),'N') = 'Y' THEN 'Y'
										ELSE 'N' END
                    #end
                       ) B
                 WHERE B.RM BETWEEN :vo.start_index AND :vo.end_index
             ]]>
			</statement>
		</query>
		
		
		<!-- 2014-03-03 Kevin. CC된 내역 조회 쿼리. -->
		<query id="las.lawconsult.ccedConsultationList" isCamelCase="false">
			<statement>
				<![CDATA[
		               SELECT *	FROM (
							SELECT ROW_NUMBER() OVER (ORDER BY REG_DT DESC) AS RM, 
											COUNT(1) OVER () TOTAL_CNT,
											 AA.*
							FROM (
								SELECT	TLC.CNSLT_NO, TLC.HSTRY_NO, TLC.DMSTFRGN_GBN, TLC.TITLE, 
										TLC.EXTNL_PRGRS_STATUS AS PRGRS_STATUS, 
										CASE	WHEN :vo.session_user_locale = 'ko'	THEN TCC.CD_NM
												WHEN :vo.session_user_locale = 'fr'	THEN TCC.CD_NM_FRA
												WHEN :vo.session_user_locale = 'de'	THEN TCC.CD_NM_DEU
										ELSE TCC.CD_NM_ENG	END AS PRGRS_STATUS_NAME, 
										DBO.LAS_CONSULT_RESPMAN(TLC.CNSLT_NO, ',') RESPMAN_NM, 
										CONVERT(VARCHAR, TLC.REG_DT, 120) REG_DT, 
										CONVERT(VARCHAR, TLC.REG_DT, 23) REG_DT_DATE, 
										TLC.REG_NM, TLC.REG_DT AS MIN_REG_DT, 
										CONVERT(VARCHAR, TLC.REQ_REPLY_DT, 23) AS REQ_REPLY_DT
								FROM	dbo.TN_LAS_CARBON_MAN AS A(NOLOCK)
										INNER JOIN dbo.TN_LAS_CONSULT AS TLC(NOLOCK) ON A.CNSLT_NO = TLC.CNSLT_NO AND TLC.HSTRY_NO = 0
										INNER JOIN (SELECT CNSLT_NO, MAX(HSTRY_NO) AS MAX_HIST FROM dbo.TN_LAS_CONSULT(NOLOCK) 
													WHERE CNSLT_NO IN (SELECT CNSLT_NO FROM dbo.TN_LAS_CARBON_MAN(NOLOCK) WHERE RESPMAN_ID = :vo.session_user_id)
													GROUP BY CNSLT_NO
													) AS MAX_CST ON A.CNSLT_NO = MAX_CST.CNSLT_NO
										INNER JOIN dbo.TN_LAS_CONSULT AS B(NOLOCK) ON B.CNSLT_NO = MAX_CST.CNSLT_NO AND B.HSTRY_NO = MAX_CST.MAX_HIST
										INNER JOIN dbo.TB_COM_CD AS TCC(NOLOCK) ON TCC.GRP_CD = 'N1_E' AND TCC.CD = B.EXTNL_PRGRS_STATUS
								WHERE	TLC.DEL_YN = 'N' AND TLC.PUB_YN = 'Y' AND A.RESPMAN_ID = :vo.session_user_id
								) AA
							) BB
						WHERE BB.RM BETWEEN :vo.start_index AND :vo.end_index
				]]>
			</statement>
		</query>	
		
		
	    <!-- 법률자문의뢰 목록 : 표준계약서 분리로 목록에서 제외(2013.04.04) -->
		<query id="las.stalawconsult.list_reqman" isCamelCase="false">
			<statement>
    		<![CDATA[
                SELECT *
                  FROM (
                        SELECT ROW_NUMBER() OVER (ORDER BY MIN_REG_DT DESC) RM
                             , COUNT(1) OVER() TOTAL_CNT
                             , A.*
                          FROM (
                                SELECT TLC.CNSLT_NO
                                     , TLC.HSTRY_NO
                                     , TLC.DMSTFRGN_GBN
                                     , TLC.TITLE
                                     , TLC.EXTNL_PRGRS_STATUS AS PRGRS_STATUS
                                     ,CASE WHEN :vo.session_user_locale = 'ko' THEN TCC.CD_NM
                                     	   WHEN :vo.session_user_locale = 'fr' THEN TCC.CD_NM_FRA
                                     	   WHEN :vo.session_user_locale = 'de' THEN TCC.CD_NM_DEU
                                      	   ELSE TCC.CD_NM_ENG END  AS PRGRS_STATUS_NAME
                                     , DBO.LAS_CONSULT_RESPMAN(TLC.CNSLT_NO, ',') RESPMAN_NM
                                     , CONVERT(CHAR(16),MIN_TLC.MIN_REG_DT,120) AS REG_DT /*YYYY-MM-DD HH24:MI*/
                                     , CONVERT(CHAR(10),MIN_TLC.MIN_REG_DT, 23) AS REG_DT_DATE /*YYYY-MM-DD*/
                                     , TLC.REG_NM, MIN_TLC.MIN_REG_DT
                                  FROM TN_LAS_CONSULT TLC
                                     , TB_COM_CD TCC
                                     , (SELECT MAX(HSTRY_NO) MAX_HSTRY_NO, CNSLT_NO
                                          FROM TN_LAS_CONSULT
                                         WHERE DEL_YN = 'N'
                                           AND INTNL_PRGRS_STATUS NOT IN ('S09','S11')
                                         GROUP BY CNSLT_NO) MAX_TLC
                                     , (SELECT MIN(REG_DT) MIN_REG_DT, CNSLT_NO
                                          FROM TN_LAS_CONSULT
                                         WHERE DEL_YN = 'N'
                                         GROUP BY CNSLT_NO) MIN_TLC
                                 WHERE TLC.DEL_YN   = 'N'
                                   AND TLC.PUB_YN   = 'Y'
                                   AND TLC.EXTNL_PRGRS_STATUS = TCC.CD
                                   AND TCC.GRP_CD   = 'N1_E'
                                   AND TLC.CNSLT_NO = MAX_TLC.CNSLT_NO
                                   AND TLC.HSTRY_NO = MAX_TLC.MAX_HSTRY_NO
                                   AND TLC.CNSLT_NO = MIN_TLC.CNSLT_NO
                            #if(!$vo.top_role.equals("adminRole"))
                                   AND TLC.REG_ID = :vo.reg_id
                            #end
                                   AND TLC.DMSTFRGN_GBN = 'H'
                            #if(!$vo.session_auth_comp_cd.equals(""))
                                   AND TLC.COMP_CD IN ($vo.session_auth_comp_cd)
                            #end
                            #if ($vo.srch_title && !$vo.srch_title.equals(""))
                                   AND UPPER(TLC.TITLE) LIKE '%' + UPPER(:vo.srch_title) +  '%'
                            #end
                            #if ($vo.srch_prgrs_status && !$vo.srch_prgrs_status.equals(""))
                                   AND TLC.EXTNL_PRGRS_STATUS LIKE '%' + :vo.srch_prgrs_status +  '%'
                            #end
                             #if ($vo.srch_start_ymd && !$vo.srch_start_ymd.equals(""))
                                   AND MIN_TLC.MIN_REG_DT >= CONVERT(DATETIME, REPLACE( :vo.srch_start_ymd ,'-',''), 112)
                            #end
                            #if ($vo.srch_end_ymd && !$vo.srch_end_ymd.equals(""))
                                   AND MIN_TLC.MIN_REG_DT <= CONVERT(DATETIME, REPLACE( :vo.srch_end_ymd ,'-',''), 112) + 1
                            #end
                                   AND EXISTS (SELECT *
                                                 FROM TN_LAS_CONSULT_TYPE TLCT
                                                WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
                                                  AND TLC.HSTRY_NO = TLCT.HSTRY_NO
                                                  AND TLCT.CNSLT_TYPE IN ('A20'))
                                 
                               ) A
                    #if ($vo.srch_respman_nm && !$vo.srch_respman_nm.equals(""))
                         WHERE 'Y' = CASE WHEN UPPER(RESPMAN_NM) LIKE '%' + UPPER(:vo.srch_respman_nm) + '%' THEN 'Y'
										WHEN 
										ISNULL((SELECT MAX(CASE WHEN UPPER(USER_NM) LIKE '%' + UPPER( :vo.srch_respman_nm ) + '%' THEN 'Y'
									  		WHEN UPPER(USER_NM_ENG) LIKE '%' + UPPER( :vo.srch_respman_nm ) + '%' THEN 'Y'
									  		ELSE 'N' END)
											FROM TB_COM_USER SA, TN_LAS_CONSULT_RESPMAN SB WHERE SB.CNSLT_NO=A.CNSLT_NO AND SA.USER_ID = SB.RESPMAN_ID),'N') = 'Y' THEN 'Y'
										ELSE 'N' END
                    #end
                       ) B
                 WHERE B.RM BETWEEN :vo.start_index AND :vo.end_index
             ]]>
			</statement>
		</query>

	    <!-- 법률자문검토 목록 : 표준계약서 분리로 목록에서 제외(2013.04.04) -->
		<query id="las.lawconsult.list_grpmgr" isCamelCase="false">
			<statement>
    		<![CDATA[
                        SELECT *
                          FROM (
                                SELECT 
                                		ROW_NUMBER() OVER(ORDER BY A.REG_DT DESC) AS RM
                             			, COUNT(1) OVER() TOTAL_CNT
                             			, A.*
                          		FROM (
                                	SELECT CASE WHEN PRGRS_STATUS_1 IN ('S02','S04','S11') THEN 
                                                 CASE WHEN PRGRS_STATUS_1 = 'S11' THEN 'S07'/* 신성우 변경처리 2014-04-29 S09->S07 */
                                                      ELSE
                                                           CASE WHEN RESPMAN_NM IS NOT NULL THEN 'V02'
                                                                ELSE 'V01'
                                                           END
                                                 END
                                            ELSE PRGRS_STATUS_1
                                       END AS PRGRS_STATUS100
                                      ,CASE 
                                      	WHEN :vo.session_user_locale = 'ko' THEN
                                        CASE WHEN PRGRS_STATUS_1 IN ('S02','S04') THEN
                                            CASE WHEN RESPMAN_NM IS NOT NULL THEN '검토중'
                                                 ELSE '미배정'
                                            END
                                            ELSE PRGRS_STATUS_NAME
                                       	END
                                       WHEN :vo.session_user_locale = 'fr' THEN
                                        CASE WHEN PRGRS_STATUS_1 IN ('S02','S04') THEN
                                            CASE WHEN RESPMAN_NM IS NOT NULL THEN 'revue en cours de traitement'
                                                 ELSE 'En attente de désignation'
                                            END
                                            ELSE PRGRS_STATUS_NAME
                                       	END
                                       WHEN :vo.session_user_locale = 'de' THEN
                                        CASE WHEN PRGRS_STATUS_1 IN ('S02','S04') THEN
                                            CASE WHEN RESPMAN_NM IS NOT NULL THEN 'Prüfung in Bearbeitung'
                                                 ELSE 'Benennung steht aus.'
                                            END
                                            ELSE PRGRS_STATUS_NAME
                                       	END
                                       ELSE
                                       	CASE WHEN PRGRS_STATUS_1 IN ('S02','S04') THEN
                                            CASE WHEN RESPMAN_NM IS NOT NULL THEN 'Review in Process'
                                                 ELSE 'Not Assigned'
                                            END
                                            ELSE PRGRS_STATUS_NAME
                                       	END
                                       END AS PRGRS_STATUS_NAME100     
                                      ,A1.*                                  
                                FROM (
                                SELECT  TLC.CNSLT_NO
								       ,TLC.HSTRY_NO
								       ,TLC.DMSTFRGN_GBN
								       ,TLC.TITLE
								       ,TLC.INTNL_PRGRS_STATUS AS PRGRS_STATUS_1
								       ,CASE WHEN :vo.session_user_locale = 'ko' THEN TCC.CD_NM
								       		 WHEN :vo.session_user_locale = 'fr' THEN TCC.CD_NM_FRA
								       		 WHEN :vo.session_user_locale = 'de' THEN TCC.CD_NM_DEU
								        	 ELSE TCC.CD_NM_ENG END  AS PRGRS_STATUS_NAME
								       ,DBO.LAS_CONSULT_RESPMAN(TLC.CNSLT_NO, ',') RESPMAN_NM
								       ,CONVERT(VARCHAR,MIN_TLC.MIN_REG_DT, 120) REG_DT
                                       ,CONVERT(VARCHAR,MIN_TLC.MIN_REG_DT, 23) REG_DT_DATE
								       ,TLC.REG_NM
								       ,MIN_TLC.MIN_REG_DT
								       ,TLC.REG_DEPT_NM
								       ,TCU.ORGNZ_NM
								       ,(CASE WHEN :vo.session_user_locale = 'ko' 
								                 THEN (SELECT CD_ABBR_NM FROM TB_COM_CD TCC1 WHERE TLC.COMP_CD = TCC1.CD AND TCC1.GRP_CD='COMP2')
								              WHEN :vo.session_user_locale = 'fr'
								              	 THEN (SELECT CD_ABBR_NM_FRA FROM TB_COM_CD TCC1 WHERE TLC.COMP_CD = TCC1.CD AND TCC1.GRP_CD='COMP2')
								              WHEN :vo.session_user_locale = 'de'
								              	 THEN (SELECT CD_ABBR_NM_DEU FROM TB_COM_CD TCC1 WHERE TLC.COMP_CD = TCC1.CD AND TCC1.GRP_CD='COMP2')
								              ELSE (SELECT CD_ABBR_NM_ENG FROM TB_COM_CD TCC1 WHERE TLC.COMP_CD = TCC1.CD AND TCC1.GRP_CD='COMP2')
								         END
								         )COMP_NM
								       ,TLC.SOLO_YN
								       ,TLC.COMPLETE_YN
								       ,CASE WHEN TLC.COMPLETE_YN = 'Y' THEN 'Complete'
								       		 ELSE 'Incomplete'
								        END AS COMPLETE_STATUS
								       ,CONVERT(VARCHAR, TLC.REQ_REPLY_DT, 23) AS REQ_REPLY_DT
								       ,ISNULL(MARK_NUM,'1') AS MARK_NUM
                                  FROM  TN_LAS_CONSULT TLC LEFT OUTER JOIN TN_CLM_UNITORGNZ TCU
                                  			ON TLC.REG_OPERDIV = TCU.ORGNZ_CD
                                  		, TB_COM_CD TCC
                                       ,(SELECT MAX(HSTRY_NO) MAX_HSTRY_NO, CNSLT_NO
                                           FROM TN_LAS_CONSULT
                                          WHERE DEL_YN = 'N' 
                                          #if ($vo.srch_cont && !$vo.srch_cont.equals("")) 
                                   			AND    CONT LIKE '%' + :vo.srch_cont +  '%'
                                   		  #end
		                                   #if ($vo.srch_title && !$vo.srch_title.equals("")) 
		                                   AND  UPPER(TITLE) LIKE '%' + UPPER(:vo.srch_title) +  '%'
		                                   #end                                   		  
                                       GROUP BY CNSLT_NO ) MAX_TLC
                                       ,(SELECT MIN(REG_DT) MIN_REG_DT, CNSLT_NO
                                           FROM TN_LAS_CONSULT
                                          WHERE DEL_YN = 'N' 
                                          #if ($vo.srch_cont && !$vo.srch_cont.equals("")) 
                                   			AND    CONT LIKE '%' + :vo.srch_cont +  '%'
                                   		  #end
									#if ($vo.srch_title && !$vo.srch_title.equals(""))
                                                   AND UPPER(TITLE) LIKE '%' + UPPER(:vo.srch_title) +  '%'
                                    #end
                                                 GROUP BY CNSLT_NO) MIN_TLC
                                             , TB_COM_USER USR
                                         WHERE TLC.DEL_YN = 'N'
                                           AND TLC.INTNL_PRGRS_STATUS = TCC.CD
                                           AND TCC.GRP_CD   = 'N1_I'
                                           AND TLC.CNSLT_NO = MAX_TLC.CNSLT_NO
                                           AND TLC.HSTRY_NO = MAX_TLC.MAX_HSTRY_NO
                                           AND TLC.CNSLT_NO = MIN_TLC.CNSLT_NO
                                           AND USR.USER_ID = :vo.user_id
                                           
                                           /* 전자검토자 권한자의 검색조건 */
                                           #if ($vo.srch_elcomp && !$vo.srch_elcomp.equals(""))
                                           		AND TLC.COMP_CD = :vo.srch_elcomp
                                           
                                           /* 통계메뉴에서 활용 */
                                           #elseif ($vo.srch_comp_cd && !$vo.srch_comp_cd.equals(""))
                                           		AND TLC.COMP_CD = :vo.srch_comp_cd
                                           
                                           #else
                                       	   		#if(!$vo.session_auth_comp_cd.equals(""))
                                           			AND TLC.COMP_CD IN ($vo.session_auth_comp_cd)
                                           		#end
                                       	   #end
                                       	   
                                    #if ($vo.srch_reception.equals("Y") && $vo.isRespman.equals("Y"))
                                           AND TLC.INTNL_PRGRS_STATUS IN ('S02','S04','S08','S09','S11')
                                    #end
                                    #if ($vo.srch_reception.equals("Y") && $vo.isRespman.equals("N"))
                                           AND TLC.INTNL_PRGRS_STATUS IN ('S02','S04','S09','S08')
                                    #end
                                    #if ($vo.srch_reg_nm && !$vo.srch_reg_nm.equals(""))
                                           AND 'Y' = CASE WHEN UPPER(TLC.REG_NM)  LIKE '%' + UPPER( :vo.srch_reg_nm ) + '%' THEN 'Y'
								          		WHEN
									           		ISNULL((SELECT CASE WHEN UPPER(USER_NM) LIKE '%' + UPPER( :vo.srch_reg_nm ) + '%' THEN 'Y'
														  WHEN UPPER(USER_NM_ENG) LIKE '%' + UPPER( :vo.srch_reg_nm ) + '%' THEN 'Y'
														  ELSE 'N' END
													    FROM TB_COM_USER WHERE USER_ID = TLC.REG_ID),'N') = 'Y' THEN 'Y'
												ELSE 'N' END
                                    #end
                                    #if ($vo.srch_reg_id && !$vo.srch_reg_id.equals(""))
                                           AND TLC.REG_ID LIKE '%' + :vo.srch_reg_id +  '%'
                                    #end
									
		                            #if ($vo.srch_solo_yn && !$vo.srch_solo_yn.equals(""))
		                                   AND TLC.SOLO_YN = :vo.srch_solo_yn
		                            #end
		                            #if ($vo.srch_complete_yn && !$vo.srch_complete_yn.equals(""))
		                                   AND ISNULL(TLC.COMPLETE_YN,'N') = :vo.srch_complete_yn
		                            #end
                                    #if ($vo.srch_start_ymd && !$vo.srch_start_ymd.equals(""))
                                   			AND MIN_TLC.MIN_REG_DT >= CONVERT(DATETIME, :vo.srch_start_ymd)
		                            #end
		                            #if ($vo.srch_end_ymd && !$vo.srch_end_ymd.equals(""))
		                                   AND MIN_TLC.MIN_REG_DT <= CONVERT(DATETIME, :vo.srch_end_ymd) + 1
		                            #end
		                            
		                            /* 자문유형 검색어 팝업선택에서, Key-in으로 변경 */
		                            #if($vo.srch_consult_type_name && !$vo.srch_consult_type_name.equals(""))
		                                   AND EXISTS (SELECT *
		                                                 FROM TN_LAS_CONSULT_TYPE TLCT
		                                                WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
		                                                  AND TLC.HSTRY_NO = TLCT.HSTRY_NO
		                                                  AND TLCT.CNSLT_TYPENM LIKE ('%' + :vo.srch_consult_type_name + '%')                           
		                                               )
		                            #end
		                            
		                            /* 자문유형 검색이 팝업선택일 경우 적용됨 : 변경시 상단의 키인 검색조건 지워야함 */
		                            
                                    #if($vo.srch_consult_type && !$vo.srch_consult_type.equals(""))
                                           AND EXISTS (SELECT *
                                                         FROM TN_LAS_CONSULT_TYPE TLCT
                                                        WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
                                                          AND TLC.HSTRY_NO = TLCT.HSTRY_NO
                                                          AND TLCT.CNSLT_TYPE IN (
                                            #foreach($consult_type in $vo.srch_consult_type_list)
                                                #if($velocityCount == 1)
                                                          '$consult_type'
                                                #else
                                                          ,'$consult_type'
                                                #end
                                            #end
                                                                                 )
                                                      )
                                    #end
                                           AND EXISTS (SELECT *
                                                         FROM TN_LAS_CONSULT_TYPE TLCT
                                                        WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
                                                          AND TLC.HSTRY_NO = TLCT.HSTRY_NO
                                                          AND TLCT.CNSLT_TYPE NOT IN ('A20'))
                                        
                                       ) A1
                               ) A
                         WHERE 1 = 1
                    #if ($vo.srch_respman_nm && !$vo.srch_respman_nm.equals(""))
                           AND 'Y' = CASE WHEN UPPER(RESPMAN_NM) LIKE '%' + UPPER(:vo.srch_respman_nm) + '%' THEN 'Y'
										WHEN 
										ISNULL((SELECT MAX(CASE WHEN UPPER(USER_NM) LIKE '%' + UPPER( :vo.srch_respman_nm ) + '%' THEN 'Y'
									  		WHEN UPPER(USER_NM_ENG) LIKE '%' + UPPER( :vo.srch_respman_nm ) + '%' THEN 'Y'
									  		ELSE 'N' END)
											FROM TB_COM_USER SA, TN_LAS_CONSULT_RESPMAN SB WHERE SB.CNSLT_NO=A.CNSLT_NO AND SA.USER_ID = SB.RESPMAN_ID),'N') = 'Y' THEN 'Y'
										ELSE 'N' END
                    #end
                    #if ($vo.srch_prgrs_status && !$vo.srch_prgrs_status.equals(""))
                           AND PRGRS_STATUS100 LIKE '%' + :vo.srch_prgrs_status + '%'
                    #end
                    #if ($vo.srch_prgrs_status_cd && !$vo.srch_prgrs_status_cd.equals(""))
                           AND PRGRS_STATUS_1 = :vo.srch_prgrs_status_cd
                    #end
                       ) B
                  WHERE B.RM BETWEEN :vo.start_index AND :vo.end_index
             ]]>
			</statement>
		</query>
		
		<!-- 법률자문검토 목록 : 표준계약서 분리로 목록에서 제외(2013.04.04) -->
		<query id="las.stalawconsult.list_grpmgr" isCamelCase="false">
			<statement>
    		<![CDATA[
                SELECT *
                  FROM (
                        SELECT ROW_NUMBER() OVER(ORDER BY A.REG_DT DESC) RM
                             , COUNT(1) OVER() TOTAL_CNT
                             , A.*
                          FROM (
                                SELECT CASE WHEN PRGRS_STATUS_1 IN ('S02','S04','S11') THEN
                                                 CASE WHEN PRGRS_STATUS_1 = 'S11' THEN 'S09'
                                                      ELSE
                                                           CASE WHEN RESPMAN_NM IS NOT NULL THEN 'V02'
                                                                ELSE 'V01'
                                                           END
                                                 END
                                            ELSE PRGRS_STATUS_1
                                       END AS PRGRS_STATUS100
                                      ,CASE WHEN :vo.session_user_locale = 'ko' THEN
                                      	CASE WHEN PRGRS_STATUS_1 IN ('S02','S04') THEN
                                            CASE WHEN RESPMAN_NM IS NOT NULL THEN '검토중'
                                                 ELSE '미배정'
                                            END
                                            ELSE PRGRS_STATUS_NAME
                                       	END
                                       WHEN :vo.session_user_locale = 'fr' THEN
                                      	CASE WHEN PRGRS_STATUS_1 IN ('S02','S04') THEN
                                            CASE WHEN RESPMAN_NM IS NOT NULL THEN 'revue en cours de traitement'
                                                 ELSE 'En attente de désignation'
                                            END
                                            ELSE PRGRS_STATUS_NAME
                                       	END
                                       WHEN :vo.session_user_locale = 'de' THEN
                                      	CASE WHEN PRGRS_STATUS_1 IN ('S02','S04') THEN
                                            CASE WHEN RESPMAN_NM IS NOT NULL THEN 'Prüfung in Bearbeitung'
                                                 ELSE 'Benennung steht aus.'
                                            END
                                            ELSE PRGRS_STATUS_NAME
                                       	END
                                       ELSE
                                       	CASE WHEN PRGRS_STATUS_1 IN ('S02','S04') THEN
                                            CASE WHEN RESPMAN_NM IS NOT NULL THEN 'Review in Process'
                                                 ELSE 'Not Designated'
                                            END
                                            ELSE PRGRS_STATUS_NAME
                                       	END
                                       END AS PRGRS_STATUS_NAME100     
                                      ,A1.*                                  
                                FROM (
                                SELECT  TLC.CNSLT_NO
								       ,TLC.HSTRY_NO
								       ,TLC.DMSTFRGN_GBN
								       ,TLC.TITLE
								       ,TLC.INTNL_PRGRS_STATUS AS PRGRS_STATUS_1
								       ,CASE WHEN :vo.session_user_locale = 'ko' THEN TCC.CD_NM
								       		 WHEN :vo.session_user_locale = 'fr' THEN TCC.CD_NM_FRA
								       		 WHEN :vo.session_user_locale = 'de' THEN TCC.CD_NM_DEU
								        	 ELSE TCC.CD_NM_ENG END  AS PRGRS_STATUS_NAME
								       ,DBO.LAS_CONSULT_RESPMAN(TLC.CNSLT_NO, ',') RESPMAN_NM
								       ,CONVERT(VARCHAR,MIN_TLC.MIN_REG_DT, 120) REG_DT
                                       ,CONVERT(VARCHAR,MIN_TLC.MIN_REG_DT, 23) REG_DT_DATE
								       ,TLC.REG_NM
								       ,TLC.REG_DEPT_NM
								       ,TCU.ORGNZ_NM
								       ,(CASE WHEN :vo.session_user_locale = 'ko' 
								                 THEN (SELECT CD_ABBR_NM FROM TB_COM_CD TCC1 WHERE TLC.COMP_CD = TCC1.CD AND TCC1.GRP_CD='COMP2')
								              WHEN :vo.session_user_locale = 'fr' 
								                 THEN (SELECT CD_ABBR_NM_FRA FROM TB_COM_CD TCC1 WHERE TLC.COMP_CD = TCC1.CD AND TCC1.GRP_CD='COMP2')
								              WHEN :vo.session_user_locale = 'de' 
								                 THEN (SELECT CD_ABBR_NM_DEU FROM TB_COM_CD TCC1 WHERE TLC.COMP_CD = TCC1.CD AND TCC1.GRP_CD='COMP2')
								              ELSE (SELECT CD_ABBR_NM_ENG FROM TB_COM_CD TCC1 WHERE TLC.COMP_CD = TCC1.CD AND TCC1.GRP_CD='COMP2')
								          END
								         )COMP_NM
								       ,TLC.SOLO_YN
                                  FROM  TN_LAS_CONSULT TLC LEFT OUTER JOIN TN_CLM_UNITORGNZ TCU
                                  			ON TLC.REG_OPERDIV = TCU.ORGNZ_CD
                                  		, TB_COM_CD TCC
                                       ,(SELECT MAX(HSTRY_NO) MAX_HSTRY_NO, CNSLT_NO
                                           FROM TN_LAS_CONSULT
                                          WHERE DEL_YN = 'N' 
                                          #if ($vo.srch_cont && !$vo.srch_cont.equals("")) 
                                   			AND    CONT LIKE '%' + :vo.srch_cont +  '%'
                                   		  #end
		                                   #if ($vo.srch_title && !$vo.srch_title.equals("")) 
		                                   AND  UPPER(TITLE) LIKE '%' + UPPER(:vo.srch_title) +  '%'
		                                   #end                                   		  
                                       GROUP BY CNSLT_NO ) MAX_TLC
                                       ,(SELECT MIN(REG_DT) MIN_REG_DT, CNSLT_NO
                                           FROM TN_LAS_CONSULT
                                          WHERE DEL_YN = 'N' 
                                          #if ($vo.srch_cont && !$vo.srch_cont.equals("")) 
                                   			AND    CONT LIKE '%' + :vo.srch_cont +  '%'
                                   		  #end
									#if ($vo.srch_title && !$vo.srch_title.equals(""))
                                                   AND UPPER(TITLE) LIKE '%' + UPPER(:vo.srch_title) +  '%'
                                    #end
                                                 GROUP BY CNSLT_NO) MIN_TLC
                                             , TB_COM_USER USR
                                         WHERE TLC.DEL_YN = 'N'
                                           AND TLC.INTNL_PRGRS_STATUS = TCC.CD
                                           AND TCC.GRP_CD   = 'N1_I'
                                           AND TLC.CNSLT_NO = MAX_TLC.CNSLT_NO
                                           AND TLC.HSTRY_NO = MAX_TLC.MAX_HSTRY_NO
                                           AND TLC.CNSLT_NO = MIN_TLC.CNSLT_NO
                                           AND USR.USER_ID = :vo.user_id
                                           #if(!$vo.session_auth_comp_cd.equals(""))
                                           AND TLC.COMP_CD IN ($vo.session_auth_comp_cd)
                                           #end
                                    #if ($vo.isForeign.equals("H"))
                                           AND TLC.DMSTFRGN_GBN = 'H'
                                    #elseif ($vo.isForeign.equals("F"))
                                           AND TLC.DMSTFRGN_GBN = 'F'
                                    #else
                                           AND TLC.DMSTFRGN_GBN = 'IP'
                                    #end
                                    #if ($vo.srch_reception.equals("Y") && $vo.isRespman.equals("Y"))
                                           AND TLC.INTNL_PRGRS_STATUS IN ('S02','S04','S08','S09','S11')
                                    #end
                                    #if ($vo.srch_reception.equals("Y") && $vo.isRespman.equals("N"))
                                           AND TLC.INTNL_PRGRS_STATUS IN ('S02','S04','S09','S08')
                                    #end
                                    #if ($vo.srch_reg_nm && !$vo.srch_reg_nm.equals(""))
                                           AND UPPER(TLC.REG_NM) LIKE '%' + UPPER(:vo.srch_reg_nm) +  '%'
                                    #end
                                    #if ($vo.srch_solo_yn && !$vo.srch_solo_yn.equals(""))
		                                   AND TLC.SOLO_YN = :vo.srch_solo_yn
		                            #end
                                    #if ($vo.srch_reg_id && !$vo.srch_reg_id.equals(""))
                                           AND TLC.REG_ID LIKE '%' + :vo.srch_reg_id +  '%'
                                    #end
   									#if ($vo.srch_elcomp && !$vo.srch_elcomp.equals(""))
		                                   AND TLC.COMP_CD = :vo.srch_elcomp
		                            #end
                                     #if ($vo.srch_start_ymd && !$vo.srch_start_ymd.equals(""))
                                   			AND MIN_TLC.MIN_REG_DT >= CONVERT(DATETIME, :vo.srch_start_ymd)
		                            #end
		                            #if ($vo.srch_end_ymd && !$vo.srch_end_ymd.equals(""))
		                                   AND MIN_TLC.MIN_REG_DT <= CONVERT(DATETIME, :vo.srch_end_ymd) + 1
		                            #end
                                    #if($vo.srch_consult_type && !$vo.srch_consult_type.equals(""))
                                           AND EXISTS (SELECT *
                                                         FROM TN_LAS_CONSULT_TYPE TLCT
                                                        WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
                                                          AND TLC.HSTRY_NO = TLCT.HSTRY_NO
                                                          AND TLCT.CNSLT_TYPE IN (
                                            #foreach($consult_type in $vo.srch_consult_type_list)
                                                #if($velocityCount == 1)
                                                          '$consult_type'
                                                #else
                                                          ,'$consult_type'
                                                #end
                                            #end
                                                                                 )
                                                      )
                                    #end
                                           AND EXISTS (SELECT *
                                                         FROM TN_LAS_CONSULT_TYPE TLCT
                                                        WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
                                                          AND TLC.HSTRY_NO = TLCT.HSTRY_NO
                                                          AND TLCT.CNSLT_TYPE IN ('A20'))
                                         
                                       ) A1
                               ) A
                         WHERE 1 = 1
                    #if ($vo.srch_respman_nm && !$vo.srch_respman_nm.equals(""))
                           AND 'Y' = CASE WHEN UPPER(RESPMAN_NM) LIKE '%' + UPPER(:vo.srch_respman_nm) + '%' THEN 'Y'
										WHEN 
										ISNULL((SELECT MAX(CASE WHEN UPPER(USER_NM) LIKE '%' + UPPER( :vo.srch_respman_nm ) + '%' THEN 'Y'
									  		WHEN UPPER(USER_NM_ENG) LIKE '%' + UPPER( :vo.srch_respman_nm ) + '%' THEN 'Y'
									  		ELSE 'N' END)
											FROM TB_COM_USER SA, TN_LAS_CONSULT_RESPMAN SB WHERE SB.CNSLT_NO=A.CNSLT_NO AND SA.USER_ID = SB.RESPMAN_ID),'N') = 'Y' THEN 'Y'
										ELSE 'N' END
                    #end
                    #if ($vo.srch_prgrs_status && !$vo.srch_prgrs_status.equals(""))
                           AND PRGRS_STATUS100 LIKE '%' + :vo.srch_prgrs_status + '%'
                    #end
                       ) B
                  WHERE B.RM BETWEEN :vo.start_index AND :vo.end_index
             ]]>
			</statement>
		</query>
		

	    <!-- ??? 목록 : 표준계약서 분리로 목록에서 제외(2013.04.04) -->
		<query id="las.lawconsult.list_admin" isCamelCase="false">
			<statement>
    		<![CDATA[
                SELECT *
                  FROM (
                        SELECT ROW_NUMBER() OVER(ORDER BY MIN_REG_DT DESC) AS RM
                             , COUNT(1) OVER() TOTAL_CNT
                             , A.*
                          FROM (
                                SELECT TLC.CNSLT_NO
                                     , TLC.HSTRY_NO
                                     , TLC.DMSTFRGN_GBN
                                     , TLC.TITLE
                                     , TLC.INTNL_PRGRS_STATUS AS PRGRS_STATUS
                                     , CASE WHEN :vo.session_user_locale = 'ko' THEN TCC.CD_NM
                                     		WHEN :vo.session_user_locale = 'fr' THEN TCC.CD_NM_FRA
                                     		WHEN :vo.session_user_locale = 'de' THEN TCC.CD_NM_DEU
                                      		ELSE TCC.CD_NM_ENG END  AS PRGRS_STATUS_NAME
                                     , DBO.LAS_CONSULT_RESPMAN(TLC.CNSLT_NO, ',') RESPMAN_NM
                                     , CONVERT(CHAR(16),MIN_TLC.MIN_REG_DT,120) AS REG_DT /*YYYY-MM-DD HH24:MI*/
                                     , CONVERT(CHAR(10),MIN_TLC.MIN_REG_DT, 23) AS REG_DT_DATE /*YYYY-MM-DD*/
                                     , TLC.REG_NM
                                     , MIN_TLC.MIN_REG_DT
                                     , TLC.REG_DEPT_NM
                                     , TCU.ORGNZ_NM
                                  FROM TN_LAS_CONSULT TLC LEFT OUTER JOIN TN_CLM_UNITORGNZ TCU
                                  			ON TLC.REG_OPERDIV = TCU.ORGNZ_CD
                                     , TB_COM_CD TCC
                                     , (SELECT MAX(HSTRY_NO) MAX_HSTRY_NO, CNSLT_NO
                                         FROM TN_LAS_CONSULT
                                        WHERE DEL_YN = 'N'
                            #if ($vo.srch_title && !$vo.srch_title.equals(""))
                                          AND UPPER(TITLE) LIKE '%' + UPPER(:vo.srch_title) + '%'
                            #end
                            #if ($vo.srch_cont && !$vo.srch_cont.equals(""))
                                          AND CONT LIKE '%' + :vo.srch_cont + '%'
                            #end
                                        GROUP BY CNSLT_NO) MAX_TLC
                                     , (SELECT MIN(REG_DT) MIN_REG_DT, CNSLT_NO
                                          FROM TN_LAS_CONSULT
                                         WHERE DEL_YN = 'N'
                            #if ($vo.srch_cont && !$vo.srch_cont.equals(""))
                                           AND CONT LIKE '%' + :vo.srch_cont + '%'
                            #end
                            #if ($vo.srch_title && !$vo.srch_title.equals(""))
                                           AND UPPER(TITLE) LIKE '%' + UPPER(:vo.srch_title) + '%'
                            #end
                                         GROUP BY CNSLT_NO) MIN_TLC
                                     
                                 WHERE TLC.DEL_YN   = 'N'
                                   AND TLC.INTNL_PRGRS_STATUS = TCC.CD
                                   AND TCC.GRP_CD   = 'N1'
                                   AND TLC.CNSLT_NO = MAX_TLC.CNSLT_NO
                                   AND TLC.HSTRY_NO = MAX_TLC.MAX_HSTRY_NO
                                   AND TLC.CNSLT_NO = MIN_TLC.CNSLT_NO
                                   #if(!$vo.session_auth_comp_cd.equals(""))
                                   AND TLC.COMP_CD IN ($vo.session_auth_comp_cd)
                                   #end
                            #if ($vo.srch_reg_nm && !$vo.srch_reg_nm.equals(""))
                                   AND UPPER(TLC.REG_NM) LIKE '%' + UPPER(:vo.srch_reg_nm) + '%'
                            #end
                            #if ($vo.srch_reg_id && !$vo.srch_reg_id.equals(""))
                                   AND TLC.REG_ID LIKE '%' + :vo.srch_reg_id +  '%'
                            #end
                            #if ($vo.srch_reg_dept && !$vo.srch_reg_dept.equals(""))
                                   AND TLC.REG_DEPT LIKE '%' + :vo.srch_reg_dept +  '%'
                            #end
                            #if ($vo.srch_prgrs_status && !$vo.srch_prgrs_status.equals(""))
                                   AND TLC.INTNL_PRGRS_STATUS LIKE '%' + :vo.srch_prgrs_status + '%'
                            #end
                             #if ($vo.srch_start_ymd && !$vo.srch_start_ymd.equals(""))
                                   AND MIN_TLC.MIN_REG_DT >= CONVERT(DATETIME, :vo.srch_start_ymd)
                            #end
                            #if ($vo.srch_end_ymd && !$vo.srch_end_ymd.equals(""))
                                   AND MIN_TLC.MIN_REG_DT <= CONVERT(DATETIME, :vo.srch_end_ymd) + 1
                            #end
                            
                            /*  자문유형 검색어 팝업선택에서, Key-in으로 변경 */
                            #if($vo.srch_consult_type_name && !$vo.srch_consult_type_name.equals(""))
                                   AND EXISTS (SELECT *
                                                 FROM TN_LAS_CONSULT_TYPE TLCT
                                                WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
                                                  AND TLC.HSTRY_NO = TLCT.HSTRY_NO
                                                  AND TLCT.CNSLT_TYPENM LIKE '%'+:vo.srch_consult_type_name+'%'                           
                                               )
                            #end
                            
                            /* 자문유형 검색이 팝업선택일 경우 적용됨 : 변경시 상단의 키인 검색조건 지워야함 */
                            #if($vo.srch_consult_type && !$vo.srch_consult_type.equals(""))
                                   AND EXISTS (SELECT *
                                                 FROM TN_LAS_CONSULT_TYPE TLCT
                                                WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
                                                  AND TLC.HSTRY_NO = TLCT.HSTRY_NO
                                                  AND TLCT.CNSLT_TYPE IN (
                                    #foreach($consult_type in $vo.srch_consult_type_list)
                                        #if($velocityCount == 1)
                                                          '$consult_type'
                                        #else
                                                          ,'$consult_type'
                                        #end
                                    #end
                                                                         )
                                              )
                            #end
                                   AND EXISTS (SELECT *
                                                 FROM TN_LAS_CONSULT_TYPE TLCT
                                                WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
                                                  AND TLC.HSTRY_NO = TLCT.HSTRY_NO
                                                  AND TLCT.CNSLT_TYPE NOT IN ('A20'))
                                 ORDER BY MIN_TLC.MIN_REG_DT DESC
                               ) A
                    #if ($vo.srch_respman_nm && !$vo.srch_respman_nm.equals(""))
                         WHERE 'Y' = CASE WHEN UPPER(RESPMAN_NM) LIKE '%' + UPPER(:vo.srch_respman_nm) + '%' THEN 'Y'
										WHEN 
										ISNULL((SELECT MAX(CASE WHEN UPPER(USER_NM) LIKE '%' + UPPER( :vo.srch_respman_nm ) + '%' THEN 'Y'
									  		WHEN UPPER(USER_NM_ENG) LIKE '%' + UPPER( :vo.srch_respman_nm ) + '%' THEN 'Y'
									  		ELSE 'N' END)
											FROM TB_COM_USER SA, TN_LAS_CONSULT_RESPMAN SB WHERE SB.CNSLT_NO=A.CNSLT_NO AND SA.USER_ID = SB.RESPMAN_ID),'N') = 'Y' THEN 'Y'
										ELSE 'N' END
                    #end
                       ) B
                 WHERE B.RM BETWEEN :vo.start_index AND :vo.end_index
             ]]>
			</statement>
		</query>
		
	    <!-- 표준계약서등록요청 목록 : 표준계약서 분리(2013.04.04) -->
		<query id="las.lawStaconsult.list_admin" isCamelCase="false">
			<statement>
    		<![CDATA[
			SELECT  *
                  FROM  (
                        SELECT  ROW_NUMBER() OVER(ORDER BY MIN_REG_DT DESC) AS RM
                               ,COUNT(1) over() TOTAL_CNT
                               ,A.*
                          FROM  (
                                SELECT  TLC.CNSLT_NO
								       ,TLC.HSTRY_NO
								       ,TLC.DMSTFRGN_GBN
								       ,TLC.TITLE
								       ,TLC.INTNL_PRGRS_STATUS AS PRGRS_STATUS
								       ,CASE WHEN :vo.session_user_locale = 'ko' THEN TCC.CD_NM
								       		 WHEN :vo.session_user_locale = 'fr' THEN TCC.CD_NM_FRA
								       		 WHEN :vo.session_user_locale = 'de' THEN TCC.CD_NM_DEU
								        	 ELSE TCC.CD_NM_ENG END  AS PRGRS_STATUS_NAME
								       ,DBO.LAS_CONSULT_RESPMAN(TLC.CNSLT_NO, ',') RESPMAN_NM
								       ,CONVERT(VARCHAR, MIN_TLC.MIN_REG_DT, 120) REG_DT
                                       ,CONVERT(VARCHAR, MIN_TLC.MIN_REG_DT, 23) REG_DT_DATE
                                       ,MIN_TLC.MIN_REG_DT
								       ,TLC.REG_NM
								       ,TLC.REG_DEPT_NM
								       ,TCU.ORGNZ_NM
                                  FROM  TN_LAS_CONSULT TLC LEFT OUTER JOIN TN_CLM_UNITORGNZ TCU
                                  			ON TLC.REG_OPERDIV = TCU.ORGNZ_CD
                                  		, TB_COM_CD TCC
                                       	,(SELECT MAX(HSTRY_NO) MAX_HSTRY_NO, CNSLT_NO
                                           FROM TN_LAS_CONSULT
                                          WHERE DEL_YN = 'N'
                                           #if ($vo.srch_title && !$vo.srch_title.equals("")) 
		                                   AND  UPPER(TITLE) LIKE '%' + UPPER(:vo.srch_title) +  '%'
		                                   #end
		                                   #if ($vo.srch_cont && !$vo.srch_cont.equals("")) 
		                                   AND  CONT LIKE '%' + :vo.srch_cont +  '%'
		                                   #end
                                       GROUP BY CNSLT_NO ) MAX_TLC
                                       ,(SELECT MIN(REG_DT) MIN_REG_DT, CNSLT_NO
                                           FROM TN_LAS_CONSULT
                                          WHERE DEL_YN = 'N' 
                                          #if ($vo.srch_cont && !$vo.srch_cont.equals("")) 
                                   			AND    CONT LIKE '%' + :vo.srch_cont +  '%'
                                   		  #end
		                                   #if ($vo.srch_title && !$vo.srch_title.equals("")) 
		                                   AND  UPPER(TITLE) LIKE '%' + UPPER(:vo.srch_title) +  '%'
		                                   #end          
                                       GROUP BY CNSLT_NO ) MIN_TLC
                                 WHERE  TLC.DEL_YN = 'N' 
                                   AND TLC.INTNL_PRGRS_STATUS = TCC.CD
                                   AND TCC.GRP_CD = 'N1'
                                   AND TLC.CNSLT_NO = MAX_TLC.CNSLT_NO
                                   AND TLC.HSTRY_NO = MAX_TLC.MAX_HSTRY_NO
                                   AND TLC.CNSLT_NO = MIN_TLC.CNSLT_NO

                                   AND TLC.DMSTFRGN_GBN = 'H'
                                   #if(!$vo.session_auth_comp_cd.equals(""))
                                   AND TLC.COMP_CD IN ($vo.session_auth_comp_cd)
                                   #end
                                   #if ($vo.srch_reg_nm && !$vo.srch_reg_nm.equals("")) 
                                   AND  UPPER(TLC.REG_NM) LIKE '%' + UPPER(:vo.srch_reg_nm) +  '%'
                                   #end
                                   #if ($vo.srch_reg_id && !$vo.srch_reg_id.equals("")) 
                                   AND  TLC.REG_ID LIKE '%' + :vo.srch_reg_id +  '%'
                                   #end
                                   #if ($vo.srch_reg_dept && !$vo.srch_reg_dept.equals("")) 
                                   AND  TLC.REG_DEPT LIKE '%' + :vo.srch_reg_dept +  '%'
                                   #end
                                   #if ($vo.srch_prgrs_status && !$vo.srch_prgrs_status.equals("")) 
                                   AND  TLC.INTNL_PRGRS_STATUS LIKE '%' + :vo.srch_prgrs_status +  '%'
                                   #end
                                    #if ($vo.srch_start_ymd && !$vo.srch_start_ymd.equals(""))
                                   			AND MIN_TLC.MIN_REG_DT >= CONVERT(DATETIME, :vo.srch_start_ymd)
		                            #end
		                            #if ($vo.srch_end_ymd && !$vo.srch_end_ymd.equals(""))
		                                   AND MIN_TLC.MIN_REG_DT <= CONVERT(DATETIME, :vo.srch_end_ymd) + 1
		                            #end
                                   AND EXISTS ( SELECT *
                                   				  FROM TN_LAS_CONSULT_TYPE TLCT
                                   				 WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
                                   				   AND TLC.HSTRY_NO = TLCT.HSTRY_NO
                                   				   AND TLCT.CNSLT_TYPE IN('A20'
                                                  )
                                             )
                                ) A 
                         #if ($vo.srch_respman_nm && !$vo.srch_respman_nm.equals("")) 
                         WHERE 'Y' = CASE WHEN UPPER(RESPMAN_NM) LIKE '%' + UPPER(:vo.srch_respman_nm) + '%' THEN 'Y'
										WHEN 
										ISNULL((SELECT MAX(CASE WHEN UPPER(USER_NM) LIKE '%' + UPPER( :vo.srch_respman_nm ) + '%' THEN 'Y'
									  		WHEN UPPER(USER_NM_ENG) LIKE '%' + UPPER( :vo.srch_respman_nm ) + '%' THEN 'Y'
									  		ELSE 'N' END)
											FROM TB_COM_USER SA, TN_LAS_CONSULT_RESPMAN SB WHERE SB.CNSLT_NO=A.CNSLT_NO AND SA.USER_ID = SB.RESPMAN_ID),'N') = 'Y' THEN 'Y'
										ELSE 'N' END
                         #end  
                         ) B
                 WHERE  B.RM BETWEEN :vo.start_index AND :vo.end_index
             ]]>
			</statement>
		</query>

		<query id="las.lawconsult.listHistory_reqman" isCamelCase="false">
			<statement>
    		<![CDATA[
            SELECT  TLC.CNSLT_NO
			       ,TLC.HSTRY_NO
			       ,TLC.CNSLT_POS
			       ,TLC.CNSLT_SRT
			       ,TLC.DMSTFRGN_GBN
			       ,TLC.TITLE
			       ,TLC.EXTNL_PRGRS_STATUS PRGRS_STATUS
			       ,TCC.CD_NM AS PRGRS_STATUS_NAME
			       ,CONVERT(VARCHAR, TLC.REG_DT, 120) REG_DT
			       ,ISNULL(TLC.CNSDMAN_NM, TLC.REG_NM) REG_NM
			       ,ISNULL(CONVERT(VARCHAR, TLC.CNSD_DT, 23), CONVERT(VARCHAR, TLC.REG_DT, 23)) REG_DT_DATE
			       ,DBO.LAS_CONSULT_RESPMAN(TLC.CNSLT_NO, ',') RESPMAN_NM
                    FROM  TN_LAS_CONSULT TLC
                    	  ,(SELECT CD, CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
								       		 WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
								       		 WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
								        	 ELSE CD_NM_ENG END AS CD_NM
                    	    FROM TB_COM_CD 
                            WHERE GRP_CD = 'N1_E' ) TCC
       
                    WHERE  TLC.DEL_YN = 'N' 
                    AND TLC.PUB_YN = 'Y'
                    AND TLC.EXTNL_PRGRS_STATUS = TCC.CD
                    AND (TLC.REG_ID = :vo.reg_id OR :vo.session_user_id IN (SELECT RESPMAN_ID FROM TN_LAS_CARBON_MAN WHERE TLC.CNSLT_NO = CNSLT_NO))
                    AND TLC.CNSLT_NO = :vo.cnslt_no
                    AND TLC.INTNL_PRGRS_STATUS IN (SELECT CD FROM TB_COM_CD WHERE GRP_CD = 'N1_E')
                    #if(!$vo.session_auth_comp_cd.equals(""))
                    AND TLC.COMP_CD IN ($vo.session_auth_comp_cd)
                    #end
                    ORDER  BY TLC.CNSLT_SRT
             ]]>
			</statement>
		</query>

		<query id="las.lawconsult.listHistory" isCamelCase="false">
			<statement>
    		<![CDATA[
            SELECT  TLC.CNSLT_NO
			       ,TLC.HSTRY_NO
			       ,TLC.CNSLT_POS
			       ,TLC.CNSLT_SRT
			       ,TLC.DMSTFRGN_GBN
			       ,TLC.TITLE
			       ,TLC.INTNL_PRGRS_STATUS PRGRS_STATUS
			       ,CASE WHEN :vo.session_user_locale = 'ko' THEN TCC.CD_NM 
                    	   WHEN :vo.session_user_locale = 'fr' THEN TCC.CD_NM_FRA
                    	   WHEN :vo.session_user_locale = 'de' THEN TCC.CD_NM_DEU
                    	   ELSE TCC.CD_NM_ENG END  AS PRGRS_STATUS_NAME
			       ,CONVERT(VARCHAR, TLC.REG_DT, 120) REG_DT
                   ,ISNULL(CONVERT(VARCHAR, TLC.CNSD_DT, 23), CONVERT(VARCHAR, TLC.REG_DT, 23)) REG_DT_DATE
			       ,ISNULL(TLC.CNSDMAN_NM, TLC.REG_NM) REG_NM
			       ,DBO.LAS_CONSULT_RESPMAN(TLC.CNSLT_NO, ',') RESPMAN_NM
                    FROM  TN_LAS_CONSULT TLC, TB_COM_CD TCC
                         
                    WHERE  TLC.DEL_YN = 'N' 
                    AND TLC.PUB_YN = 'Y'
                    AND TLC.INTNL_PRGRS_STATUS = TCC.CD
                    AND TCC.GRP_CD = 'N1_I'
                    AND TLC.CNSLT_NO = :vo.cnslt_no
                    #if(!$vo.session_auth_comp_cd.equals("") && (!$vo.srch_elcomp && $vo.srch_elcomp.equals("")))
                    AND TLC.COMP_CD IN ($vo.session_auth_comp_cd)
                    #end
                    #if ($vo.srch_elcomp && !$vo.srch_elcomp.equals(""))
		            AND TLC.COMP_CD = :vo.srch_elcomp
					#end
                    ORDER  BY TLC.CNSLT_SRT
             ]]>
			</statement>
		</query>
		
		<!-- primary key 값 생성 -->
		<query id="las.lawconsult.createPrimaryKey" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT SUBSTRING(:vo.dmstfrgn_gbn,1,1) + SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112),3,8) + dbo.Function_lpad(ISNULL(MAX(SUBSTRING(CNSLT_NO,8,LEN(CNSLT_NO)))+1,1),3,'0') AS PK
    		  FROM TN_LAS_CONSULT
    		 WHERE CNSLT_NO LIKE SUBSTRING(:vo.dmstfrgn_gbn,1,1) + SUBSTRING(CONVERT(VARCHAR, GETDATE(), 112),3,8) + '%'
    		
		    ]]>
			</statement>
		</query>
		

		<!-- insert 쿼리. WEEKDUTYYN, MONTHDUTYYN, CONF_WEEKDUTYYN, CONF_MONTHDUTYYN 
			임시적으로 Y값 세팅 -->
		<query id="las.lawconsult.insert" isCamelCase="false">
			<statement>
    		<![CDATA[
    		INSERT INTO TN_LAS_CONSULT (
           		 CNSLT_NO 
           	   , HSTRY_NO
               , CNSLT_POS
               , CNSLT_SRT
               , DMSTFRGN_GBN
               , TITLE
               , CONT
               , EXTNL_PRGRS_STATUS
               , INTNL_PRGRS_STATUS
               , REJCT_CAUSE
			   , EXTNL_CNSLTYN
               , CNSLT_AMT
               , WEEKDUTYYN
               , MONTHDUTYYN
               , CONF_WEEKDUTYYN
               , CONF_MONTHDUTYYN
               , REG_DT
               , REG_ID
               , REG_NM
               , REG_DEPT
               , REG_INTNL_DEPT
               , REG_DEPT_NM
               , REG_TELNO
               , DEL_YN
               , GRPMGR_RE_YN
               , PUB_YN
               , REGMAN_JIKGUP_NM
               , COMP_CD
               , COMPLETE_YN
               , REQ_REPLY_DT
               , MARK_NUM
       		 ) VALUES (
        	    :vo.cnslt_no
        	   ,:vo.hstry_no
        	   ,:vo.cnslt_pos
        	   ,:vo.cnslt_srt
               ,:vo.dmstfrgn_gbn
               ,:vo.title
               #if(!$vo.cont.equals("") && $vo.cont)
               		,CAST(:vo.cont AS NTEXT)
               #else
               		,NULL
               #end
      	       ,:vo.prgrs_status
      	       ,:vo.prgrs_status
      	       ,:vo.rejct_cause
               ,:vo.extnl_cnsltyn
      	       ,:vo.cnslt_amt
      	       ,:vo.weekdutyyn
      	       ,:vo.monthdutyyn
      	       ,:vo.conf_weekdutyyn
      	       ,:vo.conf_monthdutyyn
			   #if ($vo.reg_dt && !$vo.reg_dt.equals(""))
      	       		,CONVERT(DATETIME,:vo.reg_dt)
      	       #else
      	       		,GETDATE()
      	       #end  
      	       ,:vo.reg_id
      	       ,:vo.reg_nm
      	       ,:vo.reg_dept
      	       ,:vo.reg_intnl_dept
      	       ,:vo.reg_dept_nm
      	       ,:vo.reg_telno
      	       ,:vo.del_yn
      	       ,:vo.grpmgr_re_yn
      	       ,:vo.pub_yn
      	       ,(SELECT JIKGUP_NM FROM TB_COM_USER WHERE USER_ID = :vo.reg_id)
               ,:vo.session_comp_cd
               ,ISNULL((SELECT COMPLETE_YN FROM TN_LAS_CONSULT WHERE CNSLT_NO = :vo.cnslt_no AND HSTRY_NO = 0),'N')
               #if ($vo.req_reply_dt && !$vo.req_reply_dt.equals(""))
      	       		,CONVERT(DATETIME,:vo.req_reply_dt)
      	       #else
      	       		,NULL
      	       #end
      	       ,ISNULL((SELECT MARK_NUM FROM TN_LAS_CONSULT WHERE CNSLT_NO = :vo.cnslt_no AND HSTRY_NO = 0),'1')
      	       
	        )
   			 ]]>
			</statement>
		</query>
		

		<!-- 자문유형(TN_LAS_CONSULT_TYPE) insert 쿼리. -->
		<query id="las.lawconsult.insertConsultType" isCamelCase="false">
			<statement>
    		<![CDATA[
    		INSERT INTO TN_LAS_CONSULT_TYPE (
           		 CNSLT_NO
           	   , HSTRY_NO
           	   , CNSLT_TYPE
           	   , CNSLT_TYPENM
       		 ) VALUES (
        	    :vo.cnslt_no
        	   ,:vo.hstry_no
        	   ,LTRIM(:vo.consult_type)
        	   ,(SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
				       		 WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
				       		 WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
				        	 ELSE CD_NM_ENG END AS CD_NM
        	      FROM TB_COM_CD
        	      WHERE CD = LTRIM(:vo.consult_type)
        	       /* Sungwoo commented 2014-07-31
        	       #if ($vo.isForeign.equals("F"))
        	       AND GRP_CD = 'N3'
        	       #else 
        	       AND GRP_CD = 'N2'
        	       #end
        	       */
        	    )    
	        )
   			 ]]>
			</statement>
		</query>


		<!-- (TN_LAS_CONSULT_RESPMAN) insert 쿼리. -->
		<query id="las.lawconsult.insertRespman" isCamelCase="false">
			<statement>
    		<![CDATA[
    		INSERT INTO TN_LAS_CONSULT_RESPMAN (
           		 CNSLT_NO
           	   , RESPMAN_ID
           	   , RESPMAN_NM
           	   , REG_DT
           	   , REG_ID
           	   , REG_NM
           	   , DEL_YN
           	   , COMP_CD
       		 ) VALUES (
        	    :vo.cnslt_no
        	   ,:vo.respman_id
        	   ,(SELECT USER_NM
        	       FROM TB_COM_USER
        	      WHERE USER_ID = :vo.respman_id)
        	   ,GETDATE()
        	   ,:vo.session_user_id
        	   ,:vo.session_user_nm
        	   ,:vo.del_yn
        	   ,:vo.session_comp_cd
	        )
   			 ]]>
			</statement>
		</query>

		<!-- 조회 -->
		<query id="las.lawconsult.listRespman" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT TLCR.CNSLT_NO
    		     , TLCR.RESPMAN_ID
    		     , TCU.USER_NM RESPMAN_NM
    		     , TCU.EMAIL
    		  FROM TN_LAS_CONSULT_RESPMAN TLCR LEFT OUTER JOIN TB_COM_USER TCU
    		  	ON TLCR.RESPMAN_ID = TCU.USER_ID
    		 WHERE TLCR.CNSLT_NO = :vo.cnslt_no
               
		    ]]>
			</statement>
		</query>
		
		<!-- 조회 -->
		<query id="las.lawconsult.listRespmanOne" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT TLCR.CNSLT_NO
    		     , TLCR.RESPMAN_ID
    		     , TCU.USER_NM RESPMAN_NM
    		     , TCU.EMAIL
    		  FROM TN_LAS_CONSULT_RESPMAN TLCR LEFT OUTER JOIN TB_COM_USER TCU
    		  	ON TLCR.RESPMAN_ID = TCU.USER_ID
    		 WHERE TLCR.CNSLT_NO = :vo.cnslt_no
               AND RESPMAN_ID = :vo.respman_id
		    ]]>
			</statement>
		</query>
		
		<!-- 조회 (그룹장 회신시 그룹장이 에 포함이 안되어 있을 경우 사용)-->
		<query id="las.lawconsult.listRespman2" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT TLCR.CNSLT_NO
    		     , TLCR.RESPMAN_ID
    		     , TCU.USER_NM RESPMAN_NM
    		     , TCU.EMAIL
    		  FROM TN_LAS_CONSULT_RESPMAN TLCR LEFT OUTER JOIN TB_COM_USER TCU
    		  	ON TLCR.RESPMAN_ID 	= TCU.USER_ID
    		 WHERE TLCR.CNSLT_NO 	= :vo.cnslt_no
               AND TLCR.RESPMAN_ID 	= :vo.session_user_id
		    ]]>
			</statement>
		</query>
			
		<!-- 이메일 조회 -->
		<query id="las.lawconsult.findUserEmail" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT 	DISTINCT TCU.EMAIL, 
    				TLC.REG_ID AS USER_ID /* SUNGWOO REPLACEMENT 2014-07-30*/
    		  FROM TN_LAS_CONSULT TLC, TB_COM_USER TCU
    		 WHERE TLC.REG_ID = TCU.USER_ID
    		   AND TLC.CNSLT_NO = :vo.cnslt_no 
		    ]]>
			</statement>
		</query>
		
		<!-- 그룹장 이메일 조회 -->
		<query id="las.lawconsult.findGrpmgrEmail" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT DISTINCT B.EMAIL, B.USER_ID
    		  FROM TN_LAS_CONSULT A, TB_COM_USER B, TB_COM_ROLE_USER C
    		 WHERE A.COMP_CD = B.COMP_CD
    		   AND B.USER_ID = C.USER_ID
    		   AND A.CNSLT_NO = :vo.cnslt_no
    		   AND C.ROLE_CD = 'RA01'
		    ]]>
			</statement>
		</query>

		<!-- 삭제 -->
		<query id="las.lawconsult.deleteRespman" isCamelCase="false">
			<statement>
    		<![CDATA[
    		DELETE
    		  FROM TN_LAS_CONSULT_RESPMAN
    		 WHERE CNSLT_NO = :vo.cnslt_no 
		    ]]>
			</statement>
		</query>

		<!-- 조회 -->
		<query id="las.lawconsult.findRespman" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT RESPMAN_ID
    		  FROM TN_LAS_CONSULT_RESPMAN
    		 WHERE CNSLT_NO = :vo.cnslt_no
               AND RESPMAN_ID = :vo.reg_id
               
		    ]]>
			</statement>
		</query>

		<!-- 자문유형(TN_LAS_CONSULT_TYPE) 전체 삭제 쿼리. -->
		<query id="las.lawconsult.deleteAllConsultType" isCamelCase="false">
			<statement>
    		<![CDATA[
    		DELETE TN_LAS_CONSULT_TYPE 
    		 WHERE CNSLT_NO = :vo.cnslt_no
   			 ]]>
			</statement>
		</query>

		<!-- 자문유형(TN_LAS_CONSULT_TYPE) 삭제 쿼리. -->
		<query id="las.lawconsult.deleteConsultType" isCamelCase="false">
			<statement>
    		<![CDATA[
    		DELETE TN_LAS_CONSULT_TYPE 
    		 WHERE CNSLT_NO = :vo.cnslt_no
    		   AND HSTRY_NO = :vo.hstry_no
   			 ]]>
			</statement>
		</query>

		<!-- 상세조회 쿼리 -->
		<query id="las.lawconsult.detail" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT CNSLT_NO
    		      ,HSTRY_NO
    		      ,CNSLT_POS
    		      ,CNSLT_SRT
    		      ,DMSTFRGN_GBN
    		      ,TITLE
    		      ,CONT
    		      ,EXTNL_PRGRS_STATUS
    		      ,INTNL_PRGRS_STATUS
    		      ,MAIN_MATR_CONT
    		      ,REJCT_CAUSE
    		      ,HOLD_CAUSE
    		      ,EXTNL_CNSLTYN
    		      ,CNSLT_AMT
    		      ,WEEKDUTYYN
    		      ,MONTHDUTYYN
    		      ,CONF_WEEKDUTYYN
    		      ,CONF_MONTHDUTYYN
    		      ,GRPMGR_ID
    		      ,GRPMGR_NM
    		      ,ORDR_CONT
    		      ,GRPMGR_REDEPT
    		      ,GRPMGR_RE_YN
    		      ,APPRVLDAY
    		      ,PUB_YN
    		      ,CNSDMAN_ID
    		      ,CNSDMAN_NM
    		      ,CNSD_DT
    		      ,CNSD_OPNN
    		      ,APBTMAN_ID
    		      ,APBTMAN_NM
    		      ,APBT_OPNN
    		      ,RE_DT
    		      ,CONVERT(VARCHAR, REG_DT, 120) REG_DT
    		      ,REG_ID
    		      ,REG_NM
    		      ,REG_TELNO
    		      ,REG_DEPT
    		      ,REG_DEPT_NM
    		      ,REGMAN_JIKGUP_NM
    		      ,MOD_DT
    		      ,MOD_ID
    		      ,MOD_NM
    		      ,DEL_YN
    		      ,DEL_DT
    		      ,DEL_ID
    		      ,DEL_NM
    		      ,DBO.LAS_CONSULT_RESPMAN(CNSLT_NO, ',') RESPMAN_NM
				  ,SOLO_YN
				  ,COMPLETE_YN
				  ,CASE WHEN COMPLETE_YN = 'Y' THEN 'Complete'
						ELSE 'Incomplete'
					END AS COMPLETE_STATUS
				  ,CONVERT(VARCHAR, REQ_REPLY_DT, 23) AS REQ_REPLY_DT 
				  ,ISNULL(MARK_NUM,'1') AS MARK_NUM
    	     FROM TN_LAS_CONSULT
    	    WHERE CNSLT_NO = :vo.cnslt_no
    	      AND HSTRY_NO = :vo.hstry_no 
    		  ]]>
			</statement>
		</query>

		<!-- 상세조회 쿼리 -->
		<query id="las.lawconsult.detail2" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT CNSLT_NO
    		      ,HSTRY_NO
    		      ,CNSLT_POS
    		      ,CNSLT_SRT
    		      ,DMSTFRGN_GBN
    		      ,TITLE
    		      ,CONT
    		      ,EXTNL_PRGRS_STATUS
    		      ,INTNL_PRGRS_STATUS
    		      ,MAIN_MATR_CONT
    		      ,REJCT_CAUSE
    		      ,HOLD_CAUSE
    		      ,EXTNL_CNSLTYN
    		      ,CNSLT_AMT
    		      ,WEEKDUTYYN
    		      ,MONTHDUTYYN
    		      ,CONF_WEEKDUTYYN
    		      ,CONF_MONTHDUTYYN
    		      ,GRPMGR_ID
    		      ,GRPMGR_NM
    		      ,ORDR_CONT
    		      ,GRPMGR_REDEPT
    		      ,GRPMGR_RE_YN
    		      ,APPRVLDAY
    		      ,PUB_YN
    		      ,CNSDMAN_ID
    		      ,CNSDMAN_NM
    		      ,CNSD_DT
    		      ,CNSD_OPNN
    		      ,APBTMAN_ID
    		      ,APBTMAN_NM
    		      ,APBT_OPNN
    		      ,RE_DT
    		      ,CONVERT(VARCHAR, REG_DT, 120) REG_DT
    		      ,REG_ID
    		      ,REG_NM
    		      ,REG_TELNO
    		      ,REG_DEPT
    		      ,REG_DEPT_NM
    		      ,REGMAN_JIKGUP_NM
    		      ,MOD_DT
    		      ,MOD_ID
    		      ,MOD_NM
    		      ,DEL_YN
    		      ,DEL_DT
    		      ,DEL_ID
    		      ,DEL_NM
    		      ,DBO.LAS_CONSULT_RESPMAN(CNSLT_NO, ',') RESPMAN_NM
    		      ,SOLO_YN
    		      ,COMPLETE_YN
    		      ,CASE WHEN COMPLETE_YN = 'Y' THEN 'Complete'
						ELSE 'Incomplete'
					END AS COMPLETE_STATUS
    		      ,CONVERT(VARCHAR, REQ_REPLY_DT, 23) AS REQ_REPLY_DT
    		      ,ISNULL(MARK_NUM,'1') AS MARK_NUM
    	     FROM TN_LAS_CONSULT
    	    WHERE CNSLT_NO = :vo.cnslt_no 
    		  ]]>
			</statement>
		</query>


		<!-- 상세조회 쿼리 - 의뢰인 -->
		<query id="las.lawconsult.detail_reqman" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT TLC.CNSLT_NO
    			  ,TLC.HSTRY_NO
    			  ,TLC.TITLE
 				  ,TLC.EXTNL_PRGRS_STATUS PRGRS_STATUS
				  ,CONVERT(VARCHAR, TLC.REG_DT, 23) AS REG_DT
				  ,CONVERT(VARCHAR, REQ_REPLY_DT, 23) AS REQ_REPLY_DT
 		  		  ,TLC.REG_ID
 		  		  ,TLC.REG_NM
  	 			  ,TLC.REG_TELNO
  	 			  ,TLC.REG_DEPT_NM
      			  ,(SELECT USER_NM+'/'+DEPT_NM+'/'+JIKGUP_NM FROM TB_COM_USER WHERE USER_ID=TLC.MOD_ID) AS MOD_NM
      			  ,TLC.CONT
      			  ,TLC.HOLD_CAUSE
      			  ,TLC.REJCT_CAUSE
      			  ,TLC.GRPMGR_RE_YN
      			  ,TLC.APBT_OPNN
      			  ,TLC.EXTNL_CNSLTYN
      			  ,TLC.CNSD_OPNN
      			  ,TLC.MAIN_MATR_CONT
      			  ,TLC.DMSTFRGN_GBN
      			  ,TLC.REGMAN_JIKGUP_NM
      			  ,TLC.REG_OPERDIV
      			  ,TLC.IF_KEY_NO
      			  ,TLC.IF_FLAG
		  		  ,(SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
		  		  				WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
		  		  				WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
		  		   				ELSE CD_NM_ENG END
 		      		  FROM TB_COM_CD
  	     			 WHERE CD = TLC.EXTNL_PRGRS_STATUS
  	     			   AND GRP_CD = 'N1_E'
 		   		   ) PRGRS_STATUS_NAME
 				  ,(SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
 				 				WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
		  		  				WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
		  		   				ELSE CD_NM_ENG END
 		      		  FROM TB_COM_CD
  	     			 WHERE SYS_CD = 'LAS' AND GRP_CD = (CASE WHEN TLC.DMSTFRGN_GBN = 'F' THEN 'N3' ELSE 'N2' END)
  	     			 	AND CD = TLCT.CONSULT_TYPE
 		   		   ) AS CONSULT_TYPE_NAME
 				  ,TLCT.CONSULT_TYPE
 				  ,(SELECT dbo.LAS_CONSULT_RESPMAN(:vo.cnslt_no, ', '))AS RESPMAN_NM
 				  ,TLC.COMP_CD
 				  ,(SELECT 'Y' AS VACATION_YN WHERE EXISTS(
						SELECT * FROM TN_LAS_CONSULT_RESPMAN AS A, TN_LAS_CAL AS B
						WHERE 	A.CNSLT_NO 		= :vo.cnslt_no
							AND A.RESPMAN_ID 	= B.REG_ID
							AND B.TYPE1 		= 'C07102'
							AND B.DEL_YN 		= 'N'
							AND GETDATE() BETWEEN B.START_DT AND B.END_DT
						)
					)AS VACATION_YN
  			 FROM TN_LAS_CONSULT TLC LEFT OUTER JOIN
  			 		(
				      	SELECT
							 :vo.cnslt_no AS TLCT_CNSLT_NO
							,:vo.hstry_no AS TLCT_HSTRY_NO
							,CONSULT_TYPE_NAME
				      		,CONSULT_TYPE 
				      	FROM (
							SELECT REPLACE(STUFF((
								SELECT ', '+ CNSLT_TYPE  FROM TN_LAS_CONSULT_TYPE
								WHERE CNSLT_NO = :vo.cnslt_no AND HSTRY_NO = :vo.hstry_no  
								FOR XML PATH('')
								),1,2,''),',',',') AS CONSULT_TYPE
							) AS A,
							(
							SELECT REPLACE(STUFF((
								SELECT ', '+ CNSLT_TYPENM  FROM TN_LAS_CONSULT_TYPE
				 				WHERE CNSLT_NO = :vo.cnslt_no AND HSTRY_NO = :vo.hstry_no  
								FOR XML PATH('')
								),1,2,''),',',',') AS CONSULT_TYPE_NAME
							) AS B
					) AS TLCT			      	
					ON 	TLC.CNSLT_NO = TLCT.TLCT_CNSLT_NO
					AND TLC.HSTRY_NO = TLCT.TLCT_HSTRY_NO
			WHERE	CNSLT_NO = :vo.cnslt_no
   			  	AND HSTRY_NO = :vo.hstry_no
    		
    		  ]]>
			</statement>
		</query>

		<!-- 상세조회 쿼리 - 그룹장 -->
		<query id="las.lawconsult.detail_grpmgr" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT TLC.CNSLT_NO
    			  ,TLC.HSTRY_NO
    			  ,TLC.TITLE
 				  ,TLC.INTNL_PRGRS_STATUS PRGRS_STATUS
				  ,CONVERT(VARCHAR, TLC.REG_DT, 23) AS REG_DT
				  ,CONVERT(VARCHAR, REQ_REPLY_DT, 23) AS REQ_REPLY_DT
 		  		  ,TLC.REG_ID
 		  		  ,TLC.REG_NM
  	 			  ,TLC.REG_TELNO
  	 			  ,TLC.REG_DEPT_NM
  	 			  ,TLC.REG_DEPT	
      			  ,(SELECT USER_NM+'/'+DEPT_NM+'/'+JIKGUP_NM FROM TB_COM_USER WHERE USER_ID=TLC.MOD_ID) AS MOD_NM 			  
      			  ,TLC.CONT
      			  ,TLC.HOLD_CAUSE
      			  ,TLC.REJCT_CAUSE
      			  ,TLC.ORDR_CONT
      			  ,TLC.GRPMGR_RE_YN
      			  ,TLC.EXTNL_CNSLTYN
      			  ,TLC.CNSD_DT
      			  ,TLC.CNSD_OPNN
      			  ,(SELECT USER_NM+'/'+DEPT_NM+'/'+JIKGUP_NM FROM TB_COM_USER WHERE USER_ID=TLC.CNSDMAN_ID) AS CNSDMAN_NM
      			  ,TLC.MAIN_MATR_CONT
      			  ,TLC.APBT_OPNN
      			  ,TLC.DMSTFRGN_GBN
      			  ,TLC.REGMAN_JIKGUP_NM
      			  ,TLC.SOLO_YN
      			  ,TLC.COMPLETE_YN
      			  ,CASE WHEN TLC.COMPLETE_YN = 'Y' THEN 'Complete'
						ELSE 'Incomplete'
					END AS COMPLETE_STATUS
				  ,ISNULL(MARK_NUM,'1') AS MARK_NUM
      			  ,TLC.TO_TRANSFER
		  		  ,(SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
		  		  				WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
		  		  				WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
		  		   				ELSE CD_NM_ENG END
 		      		  FROM TB_COM_CD
  	     			 WHERE CD = TLC.INTNL_PRGRS_STATUS
  	     			   AND GRP_CD = 'N1_I'
 		   		   ) PRGRS_STATUS_NAME
 				  ,(SELECT CASE WHEN :vo.session_user_locale = 'ko' THEN CD_NM
 				   				WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
		  		  				WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
		  		   				ELSE CD_NM_ENG END
 		      		  FROM TB_COM_CD
  	     			 WHERE SYS_CD = 'LAS' AND GRP_CD = (CASE WHEN TLC.DMSTFRGN_GBN = 'F' THEN 'N3' ELSE 'N2' END)
  	     			  AND CD = TLCT.CONSULT_TYPE
 		   		   ) AS CONSULT_TYPE_NAME
 				  ,TLCT.CONSULT_TYPE
      			  ,(SELECT dbo.LAS_CONSULT_RESPMAN(:vo.cnslt_no, ', '))AS RESPMAN_NM
 				  ,TLC.COMP_CD
 				  ,(SELECT REPLACE(STUFF((
						SELECT '/' + ORG_FILE_NM FROM TN_COM_ATTACH 
						WHERE 	DEL_YN = 'N' 
							AND REF_KEY = :vo.cnslt_no + '@' + CONVERT(VARCHAR,:vo.hstry_no)
							AND FILE_BIGCLSFCN = 'F003' 
							AND FILE_MIDCLSFCN = 'F00301' 
					FOR XML PATH('')),1,1,''),'/','/')
				   ) AS FILE_NAME
  			 FROM TN_LAS_CONSULT TLC LEFT OUTER JOIN
  			 		(
				      	SELECT
							 :vo.cnslt_no AS TLCT_CNSLT_NO
							,:vo.hstry_no AS TLCT_HSTRY_NO
							,CONSULT_TYPE_NAME
				      		,CONSULT_TYPE 
				      	FROM (
							SELECT REPLACE(STUFF((
								SELECT ', '+ CNSLT_TYPE  FROM TN_LAS_CONSULT_TYPE
								WHERE CNSLT_NO = :vo.cnslt_no AND HSTRY_NO = :vo.hstry_no  
								FOR XML PATH('')
								),1,2,''),',',',') AS CONSULT_TYPE
							) AS A,
							(
							SELECT REPLACE(STUFF((
								SELECT ', '+ CNSLT_TYPENM  FROM TN_LAS_CONSULT_TYPE
				 				WHERE CNSLT_NO = :vo.cnslt_no AND HSTRY_NO = :vo.hstry_no  
								FOR XML PATH('')
								),1,2,''),',',',') AS CONSULT_TYPE_NAME
							) AS B
					) AS TLCT			      	
					ON 	TLC.CNSLT_NO = TLCT.TLCT_CNSLT_NO
					AND TLC.HSTRY_NO = TLCT.TLCT_HSTRY_NO
			WHERE	CNSLT_NO = :vo.cnslt_no
   			  	AND HSTRY_NO = :vo.hstry_no
    		  ]]>
			</statement>
		</query>
		
		<!-- 상세조회 쿼리 - 복수개의 consult_type_name 조회 -->
		<query id="las.lawconsult.multi_cousult_type_name" isCamelCase="false">
			<statement>
    		<![CDATA[
				SELECT 
					REPLACE(
						STUFF(
							(SELECT   
          						', '+
          						(CASE
									WHEN :vo.session_user_locale = 'ko' THEN CD_NM
									WHEN :vo.session_user_locale = 'fr' THEN CD_NM_FRA
									WHEN :vo.session_user_locale = 'de' THEN CD_NM_DEU
                  					ELSE CD_NM_ENG
                				 END)
          					FROM 	TB_COM_CD
         					WHERE   SYS_CD = 'LAS'
               					AND GRP_CD = (CASE WHEN :vo.dmstfrgn_gbn = 'F' THEN 'N3' ELSE 'N2' END)
               					AND CHARINDEX (CD, :vo.consult_type) > 0      
               				FOR XML PATH('')
    						),1,2,''),',',',') AS CONSULT_TYPE_NAME
    		  ]]>
			</statement>
		</query>
		
		<!-- 수정 -->
		<query id="las.lawconsult.modify" isCamelCase="false">
			<statement>
    		<![CDATA[
        	 UPDATE TN_LAS_CONSULT
        	    SET TITLE = :vo.title
                  , CONT = :vo.cont
                  #if ($vo.req_reply_dt && !$vo.req_reply_dt.equals(""))
      	       		, REQ_REPLY_DT = CONVERT(DATETIME,:vo.req_reply_dt)
      	       	  #else
      	       		, REQ_REPLY_DT = NULL
      	       	  #end
                  , MOD_DT = GETDATE()
                  , MOD_ID = :vo.mod_id
                  , MOD_NM = :vo.mod_nm
              WHERE CNSLT_NO = :vo.cnslt_no
                AND HSTRY_NO = :vo.hstry_no
		    ]]>
			</statement>
		</query>
		
		<!-- 국내/해외 수정 -->
		<query id="las.lawconsult.modifyDmstfrgn" isCamelCase="false">
			<statement>
    		<![CDATA[
        	 UPDATE TN_LAS_CONSULT
        	    SET DMSTFRGN_GBN = :vo.dmstfrgn_gbn
              WHERE CNSLT_NO = :vo.cnslt_no
                AND HSTRY_NO = :vo.hstry_no
		    ]]>
			</statement>
		</query>
		
		<!-- 이관 -->
		<query id="las.lawconsult.transfer" isCamelCase="false">
			<statement>
    		<![CDATA[
			INSERT INTO TN_LAS_CONSULT (
           		 CNSLT_NO 
           	   , HSTRY_NO
               , CNSLT_POS
               , CNSLT_SRT
               , DMSTFRGN_GBN
               , TITLE
               , CONT
               , EXTNL_PRGRS_STATUS
               , INTNL_PRGRS_STATUS
               , EXTNL_CNSLTYN
               , CNSLT_AMT
               , WEEKDUTYYN
               , MONTHDUTYYN
               , CONF_WEEKDUTYYN
               , CONF_MONTHDUTYYN
               , REG_DT
               , REG_ID
               , REG_NM
               , REG_DEPT
               , REG_DEPT_NM
               , REG_TELNO
               , DEL_YN
               , GRPMGR_RE_YN
               , PUB_YN
               , REGMAN_JIKGUP_NM
               , REG_OPERDIV
               , IF_KEY_NO
               , IF_FLAG
       		 ) VALUES (
        	    :vo.cnslt_no
        	   ,0
        	   ,0
        	   ,0
               ,:vo.dmstfrgn_gbn
               ,:vo.title
      	       ,:vo.cont
      	       ,'S02'
      	       ,'S02'
      	       ,:vo.extnl_cnsltyn
      	       ,:vo.cnslt_amt
      	       ,:vo.weekdutyyn
      	       ,:vo.monthdutyyn
      	       ,:vo.conf_weekdutyyn
      	       ,:vo.conf_monthdutyyn
      	       ,:vo.reg_dt_ts
      	       ,:vo.reg_id
      	       ,:vo.reg_nm
      	       ,:vo.reg_dept
      	       ,:vo.reg_dept_nm
      	       ,:vo.reg_telno
      	       ,:vo.del_yn
      	       ,:vo.grpmgr_re_yn
      	       ,:vo.pub_yn
      	       ,:vo.regman_jikgup_nm
      	       ,:vo.reg_operdiv
      	       ,:vo.if_key_no
               ,:vo.if_flag
	        )
    		
    		]]>
			</statement>
		</query>
		

		<!-- 그룹장 상세화면 수정(그룹장 회신 여부, 메모(지시사항) -->
		<query id="las.lawconsult.modifyGrpmgrDetail" isCamelCase="false">
			<statement>
    		<![CDATA[
        	 UPDATE TN_LAS_CONSULT
        	    SET ORDR_CONT = :vo.ordr_cont
        	      , GRPMGR_RE_YN = :vo.grpmgr_re_yn
        	      , SOLO_YN = :vo.solo_yn
              WHERE CNSLT_NO = :vo.cnslt_no
                AND HSTRY_NO = :vo.hstry_no
		    ]]>
			</statement>
		</query>

		<!-- 회신일자 수정 -->
		<query id="las.lawconsult.modifyReDt" isCamelCase="false">
			<statement>
    		<![CDATA[
        	 UPDATE TN_LAS_CONSULT
        	    SET RE_DT = GETDATE()
        	      , APBTMAN_ID = :vo.session_user_id
        	      , APBTMAN_NM = :vo.session_user_nm
        	      ,APBT_OPNN = :vo.apbt_opnn
        	      #if ($vo.prgrs_status.equals("S03"))
				  ,REQ_LT = dbo.COM_REQ_LT( 
				                       (SELECT REG_DT FROM TN_LAS_CONSULT WHERE CNSLT_NO = :vo.cnslt_no AND HSTRY_NO = :vo.hstry_no),
				                       (SELECT CASE WHEN CNSD_DT IS NOT NULL THEN CNSD_DT ELSE GETDATE() END 
				                          FROM TN_LAS_CONSULT
				                         WHERE CNSLT_NO = :vo.cnslt_no AND HSTRY_NO = :vo.hstry_no),
				                        COMP_CD 
				                      )
				  #end
              WHERE CNSLT_NO = :vo.cnslt_no
                AND HSTRY_NO = :vo.hstry_no
		    ]]>
			</statement>
		</query>
		
		
		
		<query id="las.lawconsult.insertReview" isCamelCase="false">
			<statement>
    		<![CDATA[
    		INSERT INTO TN_LAS_CONSULT (
           		 CNSLT_NO 
           	   , HSTRY_NO
               , CNSLT_POS
               , CNSLT_SRT
               , DMSTFRGN_GBN
               , TITLE
               , CONT
               , EXTNL_PRGRS_STATUS
               , INTNL_PRGRS_STATUS
               , EXTNL_CNSLTYN
               , CNSLT_AMT
               , WEEKDUTYYN
               , MONTHDUTYYN
               , CONF_WEEKDUTYYN
               , CONF_MONTHDUTYYN
               , REG_DT
               , REG_ID
               , REG_NM
               , REG_DEPT
               , REG_DEPT_NM
               , REG_TELNO
               , DEL_YN
               , GRPMGR_RE_YN
               , PUB_YN
               , REGMAN_JIKGUP_NM
               , CNSD_DT
               , CNSD_OPNN
               , CNSDMAN_ID
               , CNSDMAN_NM
               , MAIN_MATR_CONT
               , ORDR_CONT
               , REG_OPERDIV
               , IF_KEY_NO
               , IF_FLAG
               , COMP_CD
               , SOLO_YN
               , COMPLETE_YN
               , REQ_REPLY_DT
               , MARK_NUM
       		 ) VALUES (
        	    :vo.cnslt_no
        	   ,:vo.hstry_no
        	   ,:vo.cnslt_pos
        	   ,:vo.cnslt_srt
               ,:vo.dmstfrgn_gbn
               ,:vo.title
      	       ,:vo.cont
      	       ,:vo.extnl_prgrs_status
      	       ,:vo.prgrs_status
      	       ,:vo.extnl_cnsltyn
      	       ,:vo.cnslt_amt
      	       ,:vo.weekdutyyn
      	       ,:vo.monthdutyyn
      	       ,:vo.conf_weekdutyyn
      	       ,:vo.conf_monthdutyyn
      	       #if($vo.prgrs_status.equals("S01") || $vo.prgrs_status.equals("S02") || $vo.prgrs_status.equals("S04"))
      	       		,GETDATE()
      	       #else
			   		,CONVERT(DATETIME, :vo.reg_dt)
      	       #end 
      	       ,:vo.reg_id
      	       ,:vo.reg_nm
      	       ,:vo.reg_dept
      	       ,:vo.reg_dept_nm
      	       ,:vo.reg_telno
      	       ,:vo.del_yn
      	       ,:vo.grpmgr_re_yn
      	       ,:vo.pub_yn
      	       ,:vo.regman_jikgup_nm
      	       ,GETDATE()
      	       ,:vo.cnsd_opnn
      	       ,:vo.session_user_id
      	       ,:vo.session_user_nm
      	       ,:vo.main_matr_cont
      	       ,:vo.ordr_cont
      	       ,:vo.reg_operdiv
      	       ,:vo.if_key_no
               ,:vo.if_flag
               ,:vo.comp_cd
               ,:vo.solo_yn
               ,ISNULL((SELECT COMPLETE_YN FROM TN_LAS_CONSULT WHERE CNSLT_NO = :vo.cnslt_no AND HSTRY_NO = 0),'N')
               ,(SELECT REQ_REPLY_DT FROM TN_LAS_CONSULT WHERE CNSLT_NO = :vo.cnslt_no AND HSTRY_NO = 0)
               ,(SELECT MARK_NUM FROM TN_LAS_CONSULT WHERE CNSLT_NO = :vo.cnslt_no AND HSTRY_NO = 0)
	        )
   			 ]]>
			</statement>
		</query>
		
		

		<!-- 검토회신 -->
		<query id="las.lawconsult.insertReview2" isCamelCase="false">
			<statement>
    		<![CDATA[
        	 UPDATE TN_LAS_CONSULT
        	    SET CNSD_DT = GETDATE()
        	       ,CNSD_OPNN = :vo.cnsd_opnn
        	       ,CNSDMAN_ID = :vo.session_user_id
        	       ,CNSDMAN_NM = :vo.session_user_nm
        	       ,MAIN_MATR_CONT = :vo.main_matr_cont
        	       ,INTNL_PRGRS_STATUS = :vo.prgrs_status
        	       ,EXTNL_CNSLTYN = :vo.extnl_cnsltyn
              WHERE CNSLT_NO = :vo.cnslt_no
                AND HSTRY_NO = :vo.hstry_no
		    ]]>
			</statement>
		</query>


		<!-- 외부기관 추가 -->
		<query id="las.lawconsult.insertExtnlcomp" isCamelCase="false">
			<statement>
    		<![CDATA[
    		INSERT INTO TN_LAS_CONSULT_EXTNLCOMP (
    		         CNSLT_NO
    		       , HSTRY_NO
    		       , SEQNO
    		       , COMP_NM
    		       , CNSLT_AMT
    		       , CRRNCY_UNIT
    		       , KRW_AMT
    		       , PAYDAY
    		)
    		VALUES (
    				 :vo.cnslt_no
    			   , :vo.hstry_no
    		       , :vo.extnl_seq
    		       , :vo.extnl_comp_nm
    		       , :vo.extnl_cnslt_amt
    		       , :vo.extnl_crrncy_unit
    		       , null
    		       , null
    		)
        
		    ]]>
			</statement>
		</query>

		<!-- 외부기관 조회 -->
		<query id="las.lawconsult.listExtnlcomp" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT CNSLT_NO, HSTRY_NO, COMP_NM, CNSLT_AMT, CRRNCY_UNIT, KRW_AMT, PAYDAY
    		     , COMP_NM + '^' + CNSLT_AMT + '^' + CRRNCY_UNIT EXTNL_COMP_VALUE
    		  FROM TN_LAS_CONSULT_EXTNLCOMP
    		 WHERE CNSLT_NO = :vo.cnslt_no
               AND HSTRY_NO = :vo.hstry_no

		    ]]>
			</statement>
		</query>

		<!-- 외부기관 전체(cnslt_no 기준) 삭제 -->
		<query id="las.lawconsult.deleteAllExtnlcomp" isCamelCase="false">
			<statement>
    		<![CDATA[
    		DELETE 
    	 	  FROM TN_LAS_CONSULT_EXTNLCOMP
    		 WHERE CNSLT_NO = :vo.cnslt_no
		    ]]>
			</statement>
		</query>

		<!-- 외부기관 삭제 -->
		<query id="las.lawconsult.deleteExtnlcomp" isCamelCase="false">
			<statement>
    		<![CDATA[
    		DELETE 
    	 	  FROM TN_LAS_CONSULT_EXTNLCOMP
    		 WHERE CNSLT_NO = :vo.cnslt_no
               AND HSTRY_NO = :vo.hstry_no
		    ]]>
			</statement>
		</query>

		<!-- 진행상태,보류,반려 등... 수정 -->
		<query id="las.lawconsult.modifyStatus" isCamelCase="false">
			<statement>
    		<![CDATA[
        	 UPDATE TN_LAS_CONSULT
        	    SET INTNL_PRGRS_STATUS = :vo.prgrs_status
        	    	
        	    	#if ($vo.prgrs_status.equals("S01") || $vo.prgrs_status.equals("S02")|| $vo.prgrs_status.equals("S03") || $vo.prgrs_status.equals("S04")|| $vo.prgrs_status.equals("S05") || $vo.prgrs_status.equals("S07"))
        	    	,EXTNL_PRGRS_STATUS = :vo.prgrs_status
					#end
					
					#if ($vo.prgrs_status.equals("S07"))
					,REQ_LT = dbo.COM_REQ_LT( (SELECT REG_DT FROM TN_LAS_CONSULT WHERE CNSLT_NO = :vo.cnslt_no AND HSTRY_NO = :vo.hstry_no), GETDATE(), COMP_CD )
					#end
					
					#if ($vo.prgrs_status.equals("S02") || $vo.prgrs_status.equals("S04"))
					,REG_DT = GETDATE()
					#end
					
        	        #if ($vo.prgrs_status.equals("S05"))
        	       ,HOLD_CAUSE = :vo.hold_cause
        	       ,MOD_DT = GETDATE()
        	       ,MOD_ID = :vo.session_user_id
        	       ,MOD_NM = :vo.session_user_nm
        	        #end
        	        
        	        #if ($vo.prgrs_status.equals("S07") || $vo.prgrs_status.equals("S11"))
        	       ,REJCT_CAUSE = :vo.rejct_cause
        	       ,MOD_DT = GETDATE()
        	       ,MOD_ID = :vo.session_user_id
        	       ,MOD_NM = :vo.session_user_nm
        	        #end

        	        #if ($vo.ordr_cont && !$vo.ordr_cont.equals("")) 
        	       ,ORDR_CONT = :vo.ordr_cont
        	        #end
        	        
        	        #if ($vo.apbt_opnn && !$vo.apbt_opnn.equals("")) 
        	       ,APBT_OPNN = :vo.apbt_opnn
        	        #end
        	        
        	        #if ($vo.main_matr_cont && !$vo.main_matr_cont.equals("")) 
        	       ,MAIN_MATR_CONT = :vo.main_matr_cont
        	        #end
        	        
        	        #if ($vo.cnsd_opnn && !$vo.cnsd_opnn.equals("")) 
        	       ,CNSD_OPNN = :vo.cnsd_opnn
        	        #end

        	  WHERE CNSLT_NO = :vo.cnslt_no
                AND HSTRY_NO = :vo.hstry_no
		    ]]>
			</statement>
		</query>

		<!-- 진행상태(EXTNL) 수정 -->
		<query id="las.lawconsult.modifyExtnlStatus" isCamelCase="false">
			<statement>
    		<![CDATA[
        	 UPDATE TN_LAS_CONSULT
        	    SET EXTNL_PRGRS_STATUS = :vo.prgrs_status
              WHERE CNSLT_NO = :vo.cnslt_no
                AND HSTRY_NO = :vo.hstry_no
		    ]]>
			</statement>
		</query>

		<!-- 진행상태(INTNL) 수정 -->
		<query id="las.lawconsult.modifyIntnlStatus" isCamelCase="false">
			<statement>
    		<![CDATA[
        	 UPDATE TN_LAS_CONSULT
        	    SET INTNL_PRGRS_STATUS = :vo.prgrs_status
              WHERE CNSLT_NO = :vo.cnslt_no
                AND HSTRY_NO = :vo.hstry_no
		    ]]>
			</statement>
		</query>
		
		<query id="las.lawconsult.modifyTransfer" isCamelCase="false">
			<statement>
    		<![CDATA[
        	 UPDATE TN_LAS_CONSULT
        	    SET INTNL_PRGRS_STATUS = :vo.prgrs_status
        	      , EXTNL_PRGRS_STATUS = :vo.prgrs_status
        	      , TO_TRANSFER = :vo.dmstfrgn_gbn
              WHERE CNSLT_NO = :vo.cnslt_no
                AND HSTRY_NO = :vo.hstry_no
		    ]]>
			</statement>
		</query>

		<!-- 전체삭제. DEL_YN을 Y로 세팅 -->
		<query id="las.lawconsult.deleteAll" isCamelCase="false">
			<statement>
    		<![CDATA[
         		UPDATE TN_LAS_CONSULT
            	   SET DEL_YN = 'Y'
            	      ,DEL_DT = GETDATE()
            	      ,DEL_ID = :vo.del_id
            	      ,DEL_NM = :vo.del_nm
          	     WHERE CNSLT_NO = :vo.cnslt_no
    		]]>
			</statement>
		</query>

		<!-- 삭제. DEL_YN을 Y로 세팅 -->
		<query id="las.lawconsult.delete" isCamelCase="false">
			<statement>
    		<![CDATA[
         		UPDATE TN_LAS_CONSULT
            	   SET DEL_YN = 'Y'
            	      ,DEL_DT = GETDATE()
            	      ,DEL_ID = :vo.del_id
            	      ,DEL_NM = :vo.del_nm
          	     WHERE CNSLT_NO = :vo.cnslt_no          	               	  
          	       AND HSTRY_NO = :vo.hstry_no
    		]]>
			</statement>
		</query>

		<!-- 현재 건의 max hstry_no 리턴 -->
		<query id="las.lawconsult.findMaxHstryNo" isCamelCase="false">
			<statement>
    		<![CDATA[
         		SELECT MAX(HSTRY_NO) HSTRY_NO 
         	      FROM TN_LAS_CONSULT
         	     WHERE CNSLT_NO = :vo.cnslt_no
         	     
    		]]>
			</statement>
		</query>
		
		<!-- 현재 건의 max cnslt_srt 리턴 -->
		<query id="las.lawconsult.findMaxCnsltSrt" isCamelCase="false">
			<statement>
    		<![CDATA[
         		SELECT MAX(CNSLT_SRT) CNSLT_SRT 
         	      FROM TN_LAS_CONSULT
         	     WHERE CNSLT_NO = :vo.cnslt_no
         	       AND DEL_YN = 'N'
         	       
    		]]>
			</statement>
		</query>
		
		<!-- cnslt_srt 업데이트 -->
		<query id="las.lawconsult.modifyCnsltSrt" isCamelCase="false">
			<statement>
    		<![CDATA[
         		UPDATE TN_LAS_CONSULT
            	   SET CNSLT_SRT = :vo.cnslt_srt
          	     WHERE CNSLT_NO = :vo.cnslt_no          	               	  
          	       AND HSTRY_NO = :vo.hstry_no
    		]]>
			</statement>
		</query>

		<query id="las.lawconsult.list_recent" isCamelCase="false">
			<statement>
    		<![CDATA[
                SELECT CNSLT_NO ,HSTRY_NO ,TITLE ,REG_DT ,CNTRT_OPPNT_NM ,CONSULT_CNT ,CONTRACT_CNT, ROWNUM AS RN, CNSLT_TYPE
                  FROM (
                        SELECT CNSLT_NO ,HSTRY_NO ,TITLE ,REG_DT ,CNTRT_OPPNT_NM ,ACPT_DT ,MAX(CONSULT_CNT) CONSULT_CNT ,MAX(CONTRACT_CNT) CONTRACT_CNT, CNSLT_TYPE
                          FROM (
                                SELECT 	 TLC.CNSLT_NO 
                                		,TLC.HSTRY_NO 
                                		,TLC.TITLE 
                                		,CONVERT(VARCHAR, TLC.REG_DT, 23) AS REG_DT
                                      	,'' AS CNTRT_OPPNT_NM 
                                      	,TLC.REG_DT AS ACPT_DT 
                                      	,ROWNUM AS CONSULT_CNT 
                                      	,0 AS CONTRACT_CNT
                                      	, CNSLT_TYPE
                                  FROM (SELECT 	A.*,
                                  				B.CNSLT_TYPE 
                                  			FROM TN_LAS_CONSULT A LEFT OUTER JOIN  
                                  			(SELECT * FROM TN_LAS_CONSULT_TYPE WHERE CNSLT_TYPE = 'A20') B
                                  			ON A.CNSLT_NO = B.CNSLT_NO AND A.HSTRY_NO = B.HSTRY_NO 
                                  		) TLC
                                      ,(
                                        SELECT CNSLT_NO ,MAX(HSTRY_NO) AS HSTRY_NO
                                          FROM TN_LAS_CONSULT
                                         WHERE DEL_YN = 'N'
                                         GROUP BY CNSLT_NO
                                       ) MLC
                                 WHERE TLC.CNSLT_NO = MLC.CNSLT_NO
                                   AND TLC.HSTRY_NO = MLC.HSTRY_NO
                                   #if(!$vo.session_auth_comp_cd.equals(""))
                                   AND TLC.COMP_CD IN ($vo.session_auth_comp_cd)
                                   #end
            #if ($vo.top_role.equals("ETC"))                                                
                                   AND TLC.INTNL_PRGRS_STATUS IN ('S03', 'S07')
                                   AND TLC.REG_ID = :vo.session_user_id
            #else
                #if ($vo.top_role.equals("RA02"))                                           
                                   AND TLC.CNSLT_NO IN (
                                                        SELECT CNSLT_NO
                                                          FROM TN_LAS_CONSULT_RESPMAN
                                                         WHERE DEL_YN = 'N'
                                                           AND RESPMAN_ID = :vo.session_user_id
                                                       )
                                   AND TLC.INTNL_PRGRS_STATUS IN ('S02', 'S04', 'S08', 'S09', 'S11')
                #elseif ($vo.top_role.equals("RA01"))                     
                                   AND TLC.INTNL_PRGRS_STATUS IN ('S02', 'S04', 'S08', 'S09')
                #end
                #if ($vo.session_blngt_orgnz.equals("A00000001"))       
                                   AND TLC.DMSTFRGN_GBN = 'H'
                #elseif ($vo.session_blngt_orgnz.equals("A00000002"))   
                                   AND TLC.DMSTFRGN_GBN = 'F'
                #else                                                   
                                   AND TLC.DMSTFRGN_GBN = 'IP'
                #end
                                UNION
                                
                                SELECT CNSDREQ_ID AS CNSLT_NO ,9999 AS HSTRY_NO ,REQ_TITLE AS TITLE ,REQ_DT AS REG_DT ,CNTRT_OPPNT_NM ,ACPT_DT ,0 AS CONSULT_CNT ,ROWNUM AS CONTRACT_CNT, '' AS CNSLT_TYPE
                                  FROM (
                                        SELECT CNSDREQ_ID ,REQ_TITLE ,REQ_DT ,CNTRT_OPPNT_NM ,ACPT_DT
                                          FROM (
                                                SELECT C.CNSDREQ_ID ,C.REQ_TITLE ,C.REQ_DT ,E.CNTRT_OPPNT_NM ,C.ACPT_DT
                                                  FROM (
                                                        SELECT CNSDREQ_ID ,REQ_TITLE ,REQ_DT ,ACPT_DT
                                                          FROM (
                                                                SELECT CNSDREQ_ID ,REQ_TITLE ,REQ_DT ,ACPT_DT ,CNSD_DEPT ,RESPMAN_APNT_YN
                                                                      ,PRGRS_STATUS_WORK ,MIN(LAW_STATUS) AS LAW_STATUS
                                                                      ,MIN(IP_STATUS) AS IP_STATUS
                                                                  FROM (
                                                                        SELECT F.CNSDREQ_ID, F.FAST_TRACK_DIV, F.REQ_TITLE ,F.REQ_DT ,F.ACPT_DT
                                                                              ,F.CNSD_DEPT ,F.RESPMAN_APNT_YN ,F.PRGRS_STATUS_WORK
                                                                              ,CASE WHEN G.CNSD_DEPT = 'A00000003' THEN ''            ELSE G.CNSD_STATUS END AS LAW_STATUS
                                                                              ,CASE WHEN G.CNSD_DEPT = 'A00000003' THEN G.CNSD_STATUS ELSE ''            END AS IP_STATUS
                                                                          FROM (
                                                                                SELECT A.CNSDREQ_ID, A.FAST_TRACK_DIV, A.REQ_TITLE
                                                                                      ,CONVERT(VARCHAR, ISNULL(A.ACPT_DT, A.REG_DT), 23) AS REQ_DT
                                                                                      ,ISNULL(A.ACPT_DT, A.REG_DT) AS ACPT_DT
                                                                                      ,CASE WHEN :vo.session_blngt_orgnz = A.MN_CNSD_DEPT THEN A.MN_CNSD_DEPT
                                                                                            WHEN :vo.session_blngt_orgnz = A.VC_CNSD_DEPT THEN A.VC_CNSD_DEPT
                                                                                                                                          ELSE ''
                                                                                        END AS CNSD_DEPT
                                                                                      ,CASE WHEN :vo.session_blngt_orgnz = A.MN_CNSD_DEPT THEN A.MN_RESPMAN_APNT_YN
                                                                                            WHEN :vo.session_blngt_orgnz = A.VC_CNSD_DEPT THEN A.VC_RESPMAN_APNT_YN
                                                                                                                                          ELSE ''
                                                                                        END AS RESPMAN_APNT_YN
                                                                                      ,CASE WHEN A.PRGRS_STATUS IN ('C04203', 'C04204', 'C04205')
                                                                                                THEN CASE WHEN :vo.session_blngt_orgnz = A.MN_CNSD_DEPT
                                                                                                              THEN A.PRGRS_STATUS
                                                                                                              ELSE ''
                                                                                                      END
                                                                                                ELSE A.PRGRS_STATUS
                                                                                        END AS PRGRS_STATUS_WORK
                                                                                  FROM TN_CLM_CONT_CNSDREQ A
                                                                                      ,(
                                                                                        SELECT A.CNSD_LEVEL AS LVL,
                                                                                               A.CNSDREQ_ID
                                                                                          FROM TN_CLM_CONT_CNSDREQ A,
                                                                                               (SELECT FST_CNSDREQ_ID,
                                                                                                       MAX(CNSD_LEVEL) AS CNSD_LEVEL,
                                                                                                       MIN(ISNULL(ACPT_DT, REG_DT)) AS ACPT_DT
                                                                                                  FROM TN_CLM_CONT_CNSDREQ
                                                                                                 WHERE PRGRS_STATUS <> 'C04201'
                                                                                                   AND DEL_YN = 'N'
                                                                                                 GROUP BY FST_CNSDREQ_ID) B
                                                                                         WHERE A.FST_CNSDREQ_ID = B.FST_CNSDREQ_ID
                                                                                           AND A.CNSD_LEVEL = B.CNSD_LEVEL
                                                                                           AND A.DEL_YN = 'N'
                                                                                       ) B
                                                                                 WHERE A.DEL_YN = 'N'
                                                                                   AND A.PRGRS_STATUS < 'C04207'            
                                                                                   AND A.CNSDREQ_ID = B.CNSDREQ_ID
                                                                               ) F LEFT OUTER JOIN TN_CLM_CONTRACT_DEPTCNSD G
                                                                        		ON F.CNSDREQ_ID = G.CNSDREQ_ID
                                                                       )
                #if ($vo.session_blngt_orgnz.equals("A00000003"))
                                                                 WHERE ISNULL(FAST_TRACK_DIV, 'Z') <> 'W'
                #end
                                                                 GROUP BY CNSDREQ_ID ,REQ_TITLE ,REQ_DT ,ACPT_DT ,CNSD_DEPT ,RESPMAN_APNT_YN ,PRGRS_STATUS_WORK
                                                               )
                                                         WHERE CNSD_DEPT = :vo.session_blngt_orgnz                          
                #if (!$vo.top_role.equals("RA01"))
                                                           AND CNSDREQ_ID IN (
                                                                              SELECT CNSDREQ_ID                          
                                                                                FROM TN_CLM_CONT_CNSDREQ_RESPMAN
                                                                               WHERE RESPMAN_ID = :vo.session_user_id
                                                                               GROUP BY CNSDREQ_ID
                                                                             )
                #end
                #if ($vo.session_blngt_orgnz.equals("A00000001") || $vo.session_blngt_orgnz.equals("A00000002"))
                                                           AND (LAW_STATUS IS NULL OR LAW_STATUS IN ('C04301', 'C04302', 'C04303')) 
                #end
                #if ($vo.session_blngt_orgnz.equals("A00000003"))
                                                           AND (IP_STATUS IS NULL OR IP_STATUS IN ('C04301', 'C04302', 'C04303'))   
                #end
                                                       ) C
                                                      ,(
                                                        SELECT CCC.CNSDREQ_ID ,MIN(CCC.CNTRT_ID) AS CNTRT_ID    
                                                          FROM TN_CLM_CONTRACT_CNSD CCC
                                                              ,TN_CLM_CONTRACT_MASTER CCM
                                                         WHERE CCC.CNTRT_ID = CCM.CNTRT_ID
                                                           AND CCM.DEL_YN = 'N'
                                                           AND CCM.CNTRT_STATUS < 'C02406'
                                                           AND CCM.CNTRT_INFO_GBN IN ('C05401')
                                                         GROUP BY CCC.CNSDREQ_ID
                                                       ) D
                                                      ,(
                                                        SELECT CM.CNTRT_ID ,CM.CNTRT_OPPNT_NM
                                                          FROM TN_CLM_CONTRACT_MASTER CM
                                                         WHERE CM.DEL_YN = 'N'
                                                           AND CM.DEPTH_STATUS != 'C02607'
                                                           AND CM.CNTRT_STATUS < 'C02406'
                                                       ) E
                                                 WHERE C.CNSDREQ_ID = D.CNSDREQ_ID
                                                   AND D.CNTRT_ID = E.CNTRT_ID
                                                   AND NOT EXISTS ( SELECT 1 FROM tn_clm_cont_cnsdreq_hold WHERE CNSDREQ_ID = C.CNSDREQ_ID AND HOLD_SEQNO = '1' ) 
                                               )
                                       )
            #end
                               )
                         GROUP BY CNSLT_NO ,HSTRY_NO ,TITLE ,REG_DT ,CNTRT_OPPNT_NM ,ACPT_DT, CNSLT_TYPE
                         ORDER BY ACPT_DT DESC
                       )
                 WHERE ROWNUM < 6
             ]]>
			</statement>
		</query>
		
		<!-- 법무 리스트를 조회한다. 
		     TN_LAS_CONSULT_RESPMAN 테이블을 조회해서 별로 작업완료한 카운트 (일/월/년) 및 작업할 갯수를 리턴한다.
		     author : 김현구 2011-10-06
		 -->
		<query id="las.lawconsult.getLasPerson" isCamelCase="false">
			<statement>
				<![CDATA[	
					SELECT 
						A.USER_ID AS RESPMAN_ID,
						A.USER_NM AS RESPMAN_NM,
						A.USER_NM_ENG AS RESPMAN_NM_ENG,
						A.JIKGUP_NM AS RESPMAN_JIKGUP_NM,
						A.JIKGUP_NM_ENG AS RESPMAN_JIKGUP_NM_ENG,
						ISNULL (C.DAY_COUNT, 0) DAY_CNT,
						ISNULL (D.WEEK_COUNT, 0) WEEK_CNT,
						ISNULL (E.MONTH_COUNT, 0) MONTH_CNT,
						ISNULL (F.YEAR_COUNT, 0) YEAR_CNT,
						ISNULL (G.PENDING, 0) PENDING_CNT,
						CASE WHEN ISNULL(I.RESPMAN_ID, 'NULL') = 'NULL' THEN 'N' ELSE 'Y' END AS CHECK_YN,
						B.ROLE_CD
  					FROM( 
	  						SELECT TCU.*
	          				FROM TB_COM_USER TCU
	         				WHERE	1 = 1 
							#if(!$vo.session_auth_comp_cd.equals("")) 
								AND COMP_CD IN ($vo.session_auth_comp_cd)
	               					OR EXISTS (	SELECT 1 FROM TN_COM_SEC_MNG_COMP 
	               								WHERE USER_ID = TCU.USER_ID AND MNG_COMP_CD IN ($vo.session_auth_comp_cd))
							#end
						)AS A INNER JOIN TB_COM_ROLE_USER B ON A.USER_ID = B.USER_ID
       
	   					LEFT OUTER JOIN
	   					(
		   					SELECT 	RESPMAN_ID, 
		   							COUNT (*) ALL_COUNT
	          				FROM TN_LAS_CONSULT_RESPMAN
	        				GROUP BY RESPMAN_ID
        				) AS H ON A.USER_ID = H.RESPMAN_ID

       					LEFT OUTER JOIN
	   					(
	   						SELECT 	RESPMAN_ID, 
	   								COUNT (*) DAY_COUNT
          					FROM TN_LAS_CONSULT_RESPMAN A1,
               				(SELECT CNSLT_NO FROM TN_LAS_CONSULT) B1
							WHERE	A1.CNSLT_NO = B1.CNSLT_NO
               					AND CONVERT (VARCHAR, REG_DT, 112) = CONVERT (VARCHAR, GETDATE (), 112)
        					GROUP BY RESPMAN_ID
        				) AS C ON C.RESPMAN_ID = H.RESPMAN_ID
       
	   					LEFT OUTER JOIN
	   					(	
	   						SELECT 	RESPMAN_ID, 
	   								COUNT (*) WEEK_COUNT
          					FROM TN_LAS_CONSULT_RESPMAN A1,
               					(SELECT CNSLT_NO FROM TN_LAS_CONSULT) B1
         					WHERE	A1.CNSLT_NO = B1.CNSLT_NO
               					AND REG_DT BETWEEN dbo.GREATES (CONVERT (DATETIME,(  SUBSTRING (CONVERT (VARCHAR,GETDATE (),112),1,4)+ '0101')),GETDATE () - 7) AND GETDATE ()
        					GROUP BY RESPMAN_ID
        				) AS D ON D.RESPMAN_ID = H.RESPMAN_ID
       
	   					LEFT OUTER JOIN
					   	(
					   		SELECT 	RESPMAN_ID, 
					   				COUNT (*) MONTH_COUNT
				          	FROM TN_LAS_CONSULT_RESPMAN A1,
				               	(SELECT CNSLT_NO FROM TN_LAS_CONSULT) B1
				         	WHERE	A1.CNSLT_NO = B1.CNSLT_NO
				               	AND REG_DT BETWEEN dbo.GREATES (CONVERT (DATETIME,(  SUBSTRING (CONVERT (VARCHAR,GETDATE (),112),1,4)+ '0101')),GETDATE () - 30)AND GETDATE ()
				        	GROUP BY RESPMAN_ID
				        ) AS E ON E.RESPMAN_ID = H.RESPMAN_ID
       
	   					LEFT OUTER JOIN
	   					(
	   						SELECT 	RESPMAN_ID, 
	   								COUNT (*) YEAR_COUNT
          					FROM TN_LAS_CONSULT_RESPMAN A1,
               					(SELECT CNSLT_NO FROM TN_LAS_CONSULT) B1
         					WHERE	A1.CNSLT_NO = B1.CNSLT_NO
               					AND REG_DT BETWEEN dbo.GREATES ( CONVERT ( DATETIME,(  SUBSTRING ( CONVERT (VARCHAR, GETDATE (),112),1,4)+ '0101')),GETDATE () - 365) AND GETDATE ()
        					GROUP BY RESPMAN_ID
        				) AS F ON F.RESPMAN_ID = H.RESPMAN_ID
       
	   					LEFT OUTER JOIN
	   					(
	   						SELECT 	RESPMAN_ID, 
	   								COUNT (*) PENDING
          					FROM TN_LAS_CONSULT_RESPMAN A1,
               				(	SELECT C1.CNSLT_NO
                  				FROM TN_LAS_CONSULT C1,
                       				(SELECT CNSLT_NO, MAX (HSTRY_NO) AS MAX_HSTRY_NO FROM TN_LAS_CONSULT GROUP BY CNSLT_NO) C2
                 				WHERE     C1.CNSLT_NO = C2.CNSLT_NO
                       				AND C1.HSTRY_NO = C2.MAX_HSTRY_NO
                       				AND C1.INTNL_PRGRS_STATUS IN ('S02', 'S08', 'S09')
                       		) B1
         					WHERE	A1.CNSLT_NO = B1.CNSLT_NO
               					AND REG_DT BETWEEN dbo.GREATES (CONVERT (DATETIME,(  SUBSTRING (CONVERT (VARCHAR,GETDATE (),112),1,4)+ '0101')),GETDATE () - 365)AND GETDATE ()
        					GROUP BY RESPMAN_ID
        				) AS G ON G.RESPMAN_ID = H.RESPMAN_ID

						LEFT OUTER JOIN 
						(
							SELECT * FROM TN_LAS_CONSULT_RESPMAN WHERE CNSLT_NO = :vo.cnslt_no
						) AS I ON I.RESPMAN_ID = A.USER_ID

					WHERE    
							B.SYS_CD = 'LAS'
       					AND B.ROLE_CD IN ('RA02')
					ORDER BY A.USER_SRT;
				]]>
			</statement>
		</query>	

		<!-- 2014-03-07 Kevin. 튜닝 쿼리 적용 -->
		<query id="las.lawconsult.countLawConsult" isCamelCase="false">
			<statement>
			<![CDATA[
                SELECT ISNULL(SUM(NOASSIGN_CNT),0) AS NOASSIGN_CNT -- 미배정 건수
                     , ISNULL(SUM(REVIEW_CNT),0) AS REVIEW_CNT -- 검토중 건수
                     , ISNULL(SUM(RESIGN_CNT),0) AS RESIGN_CNT
                     , ISNULL(SUM(TEMP_CNT),0) AS TEMP_CNT -- 임시저장 건수
                     , ISNULL(SUM(PENDING_CNT),0) AS PENDING_CNT -- 미결 건수
                     , ISNULL(SUM(REG_CNT),0) AS REG_CNT -- 의뢰인 의뢰 건수
                     , ISNULL(SUM(NOASSIGN_CNT+REVIEW_CNT+RESIGN_CNT+TEMP_CNT+PENDING_CNT),0) AS TOTAL_CNT -- 총 건수
                     , (SELECT COUNT(A.CNSLT_NO) FROM dbo.TN_LAS_CARBON_MAN AS A(NOLOCK)
						INNER JOIN TN_LAS_CONSULT AS B(NOLOCK) ON A.CNSLT_NO = B.CNSLT_NO 
						WHERE A.RESPMAN_ID = :vo.session_user_id AND B.HSTRY_NO = 0 AND B.DEL_YN = 'N') AS CCED_CNT	/* 2014-03-03 Kevin CC 된 건수*/
                  FROM (
                        SELECT CASE WHEN PRGRS_STATUS = 'V01' THEN 1 ELSE 0 END AS NOASSIGN_CNT
                             , CASE WHEN PRGRS_STATUS = 'V02' THEN 1 ELSE 0 END AS REVIEW_CNT
                             ,CASE WHEN PRGRS_STATUS = 'V03' THEN 1 ELSE 0 END AS RESIGN_CNT
                             , CASE WHEN PRGRS_STATUS = 'S09' THEN 1 ELSE 0 END AS TEMP_CNT
                             , CASE WHEN PRGRS_STATUS = 'S08' THEN 1 ELSE 0 END AS PENDING_CNT
                             , CASE WHEN EXTNL_PRGRS_STATUS = 'S02' THEN 1 ELSE 0 END AS REG_CNT
                             , PRGRS_STATUS
                          FROM (
                                SELECT 	CASE WHEN INTNL_PRGRS_STATUS IN ('S02','S04','S11') 
											THEN
												CASE WHEN INTNL_PRGRS_STATUS = 'S11' 
													THEN 'S09'
													ELSE
														CASE WHEN DBO.LAS_CONSULT_RESPMAN(TLC.CNSLT_NO, '') IS NOT NULL 
															THEN 
																#if ($vo.top_role.equals("RA01")) --그룹장권한일때만 퇴사자가 있는지 조회
																CASE WHEN EXISTS(SELECT 1 FROM TN_LAS_CONSULT_RESPMAN WHERE CNSLT_NO = TLC.CNSLT_NO AND RESPMAN_ID IN (SELECT USER_ID FROM TN_COM_RESIGN_USER WHERE BLNGT_ORGNZ = :vo.session_blngt_orgnz))
																	THEN 'V03'	-- 재배정
																	ELSE 'V02'	-- 검토중
																END
																#else
																'V02'	
																#end																					
															ELSE 'V01'
														END
												END
											ELSE INTNL_PRGRS_STATUS
										END AS PRGRS_STATUS
									 , TLC.EXTNL_PRGRS_STATUS
                                     , TLC.CNSLT_NO
                                     , TLC.HSTRY_NO
                                     , TLC.REG_ID
                                     , TLC.DMSTFRGN_GBN
                                  FROM TN_LAS_CONSULT TLC (NOLOCK)
                                     , ( SELECT A.CNSLT_NO , MAX(A.HSTRY_NO) AS HSTRY_NO
                                          FROM 	TN_LAS_CONSULT AS A(NOLOCK), 
                                          				TN_LAS_CONSULT_TYPE AS B(NOLOCK)
                                         WHERE DEL_YN = 'N'
                                         AND A.CNSLT_NO = B.CNSLT_NO
                                         AND A.HSTRY_NO = B.HSTRY_NO
                                         AND B.CNSLT_TYPE <> 'A20'
                                         GROUP BY A.CNSLT_NO
                                       ) MLC
                                     , (SELECT CNSLT_NO , MAX(HSTRY_NO) HSTRY_NO  FROM TN_LAS_CONSULT(NOLOCK) GROUP BY CNSLT_NO) TLC2  
                                 WHERE TLC.CNSLT_NO = MLC.CNSLT_NO
                                   AND TLC.HSTRY_NO = MLC.HSTRY_NO
                                   AND TLC.DMSTFRGN_GBN = 'H'
                                   AND TLC.CNSLT_NO = TLC2.CNSLT_NO
                                   AND TLC.HSTRY_NO = TLC2.HSTRY_NO 
                    #if ($vo.top_role.equals("ETC")) -- 의뢰인일 경우
                                   AND TLC.EXTNL_PRGRS_STATUS IN ('S02')
                                   AND TLC.REG_ID = :vo.session_user_id
                    #elseif ($vo.top_role.equals("RA02")) -- 법무(변호사)일 경우
                                   AND TLC.CNSLT_NO IN (
                                                        SELECT CNSLT_NO
                                                          FROM TN_LAS_CONSULT_RESPMAN
                                                         WHERE DEL_YN = 'N'
                                                           AND RESPMAN_ID = :vo.session_user_id
                                                       )
                                   /* AND TLC.INTNL_PRGRS_STATUS IN ('S02', 'S04', 'S08', 'S09', 'S11') */ -- S11(Reject) 제거 2014-04-29 신성우
                                   AND TLC.INTNL_PRGRS_STATUS IN ('S02', 'S04', 'S08', 'S09')
                    #elseif ($vo.top_role.equals("RA01") || $vo.top_role.equals("RB01")) -- 법무결재자(그룹장)일 경우
                                   AND TLC.INTNL_PRGRS_STATUS IN ('S02', 'S04', 'S08', 'S09')
                    #end
                    
                    #if(!$vo.session_auth_comp_cd.equals(""))
                    	AND TLC.COMP_CD IN ($vo.session_auth_comp_cd)
                    #end
                    
                               ) SB
                       ) SC
			]]>
			</statement>
		</query>

		<query id="las.lawconsult.countStandardContract" isCamelCase="false">
			<statement>
			<![CDATA[
                SELECT ISNULL(SUM(NOASSIGN_CNT),0) AS NOASSIGN_CNT -- 미배정 건수
                     , ISNULL(SUM(REVIEW_CNT),0) AS REVIEW_CNT -- 검토중 건수
                     , ISNULL(SUM(TEMP_CNT),0) AS TEMP_CNT -- 임시저장 건수
                     , ISNULL(SUM(PENDING_CNT),0) AS PENDING_CNT -- 미결 건수
                     , ISNULL(SUM(REG_CNT),0) AS REG_CNT -- 의뢰인 의뢰 건수
                     , ISNULL(SUM(NOASSIGN_CNT+REVIEW_CNT+TEMP_CNT+PENDING_CNT),0) AS TOTAL_CNT -- 총 건수
                  FROM (
                        SELECT CASE WHEN PRGRS_STATUS = 'V01' THEN 1 ELSE 0 END AS NOASSIGN_CNT
                             , CASE WHEN PRGRS_STATUS = 'V02' THEN 1 ELSE 0 END AS REVIEW_CNT
                             , CASE WHEN PRGRS_STATUS = 'S09' THEN 1 ELSE 0 END AS TEMP_CNT
                             , CASE WHEN PRGRS_STATUS = 'S08' THEN 1 ELSE 0 END AS PENDING_CNT
                             , CASE WHEN EXTNL_PRGRS_STATUS = 'S02' THEN 1 ELSE 0 END AS REG_CNT
                             , PRGRS_STATUS
                          FROM (
                                SELECT CASE WHEN INTNL_PRGRS_STATUS IN ('S02','S04','S11')
                                                 THEN CASE WHEN INTNL_PRGRS_STATUS = 'S11'
                                                                THEN 'S09'
                                                                ELSE CASE WHEN RESPMAN_NM IS NOT NULL
                                                                               THEN 'V02'
                                                                               ELSE 'V01'
                                                                     END
                                                      END
                                            ELSE INTNL_PRGRS_STATUS
                                       END AS PRGRS_STATUS
                                     , TLC.EXTNL_PRGRS_STATUS
                                     , TLC.CNSLT_NO
                                     , TLC.HSTRY_NO
                                     , TLC.REG_ID
                                     , TLC.DMSTFRGN_GBN
                                  FROM (
                                        SELECT CNSLT_NO
                                             , HSTRY_NO
                                             , REG_ID
                                             , DMSTFRGN_GBN
                                             , EXTNL_PRGRS_STATUS
                                             , INTNL_PRGRS_STATUS
                                             , DBO.LAS_CONSULT_RESPMAN(CNSLT_NO, ',') RESPMAN_NM
                                             , COMP_CD
                                          FROM TN_LAS_CONSULT
                                       ) TLC
                                     , (
                                        SELECT CNSLT_NO , MAX(HSTRY_NO) AS HSTRY_NO
                                          FROM (
											SELECT A.*,
											  B.CNSLT_TYPE
											FROM TN_LAS_CONSULT A,
											  (SELECT * FROM TN_LAS_CONSULT_TYPE WHERE CNSLT_TYPE = 'A20'
											  ) B
											WHERE A.CNSLT_NO = B.CNSLT_NO
												AND A.HSTRY_NO   = B.HSTRY_NO
												) SA
                                         WHERE DEL_YN = 'N'
                                         GROUP BY CNSLT_NO
                                       ) MLC
                                 WHERE TLC.CNSLT_NO = MLC.CNSLT_NO
                                   AND TLC.HSTRY_NO = MLC.HSTRY_NO
                    #if ($vo.top_role.equals("ETC")) -- 의뢰인일 경우
                                   AND TLC.EXTNL_PRGRS_STATUS IN ('S02')
                                   AND TLC.REG_ID = :vo.session_user_id
                    #elseif ($vo.top_role.equals("RA02")) -- 법무검토자(변호사)일 경우
                                   AND TLC.CNSLT_NO IN (
                                                        SELECT CNSLT_NO
                                                          FROM TN_LAS_CONSULT_RESPMAN
                                                         WHERE DEL_YN = 'N'
                                                           AND RESPMAN_ID = :vo.session_user_id
                                                       )
                                   AND TLC.INTNL_PRGRS_STATUS IN ('S02', 'S04', 'S08', 'S09', 'S11')
                    #elseif ($vo.top_role.equals("RA01") || $vo.top_role.equals("RB01")) -- 법무그룹장일 경우
                                   AND TLC.INTNL_PRGRS_STATUS IN ('S02', 'S04', 'S08', 'S09')
                    #end
                    
                    #if(!$vo.session_auth_comp_cd.equals(""))
                    	AND TLC.COMP_CD IN ($vo.session_auth_comp_cd)
                    #end
                               ) SB
                       ) SC
			]]>
			</statement>
		</query>
		
		<query id="las.lawconsult.updateCompleteStatusLawConsult" isCamelCase="false">
			<statement>
				<![CDATA[
					UPDATE TN_LAS_CONSULT SET
						 COMPLETE_YN 	= :vo.complete_yn
						,MOD_DT			= GETDATE()
						,MOD_ID			= :vo.session_user_id
						,MOD_NM			= :vo.session_user_nm 
					WHERE CNSLT_NO = :vo.cnslt_no
				]]>				
			</statement>		
		</query>
		
		<!-- 자문의뢰 참조인 등록 -->
		<query id="las.lawconsult.insertContractAuthreq" isCamelCase="false">
			<statement>
				<![CDATA[
					INSERT INTO TN_LAS_CARBON_MAN
					(
				    	 CNSLT_NO
						,HSTRY_NO
						,RESPMAN_ID
						,RESPMAN_NM
						,RESPMAN_JIKGUP
						,RESP_DEPT
						,CC_YN
						,REG_ID
						,REG_DT
						,MOD_ID
						,MOD_DT
						,SEQNO
					)
					VALUES
					(
				     	 :vo.cnslt_no
						,NULL
						,:vo.trgtman_id
						,:vo.trgtman_nm
						,:vo.trgtman_jikgup_nm
						,:vo.trgtman_dept_nm
						,NULL
						,:vo.session_user_id
						,GETDATE()
						,NULL
						,NULL
						,(SELECT ISNULL(MAX(SEQNO),0)+1 AS MAX_SEQNO FROM TN_LAS_CARBON_MAN)
				   )
				]]>				
			</statement>		
		</query>


		
		<query id="las.lawconsult.deleteContractAuthreq" isCamelCase="false">
			<statement>
				<![CDATA[
					DELETE FROM TN_LAS_CARBON_MAN
					WHERE 	1=1
						AND CNSLT_NO = :vo.cnslt_no
				
				]]>				
			</statement>		
		</query>
				
				
		<query id="las.lawconsult.listContractAuthreq" isCamelCase="false">
			<statement>
				<![CDATA[
					SELECT 
						 CNSLT_NO
					    ,HSTRY_NO
					    ,RESPMAN_ID
					    ,RESPMAN_NM
					    ,RESPMAN_JIKGUP
					    ,RESP_DEPT
					    ,CC_YN
					    ,REG_ID
					    ,REG_DT
					    ,MOD_ID
					    ,MOD_DT
					    ,SEQNO
					FROM TN_LAS_CARBON_MAN
					WHERE CNSLT_NO = :vo.cnslt_no
					ORDER BY SEQNO ASC
				]]>				
			</statement>		
		</query>
		
	
		<query id="las.lawconsult.setMarkUpAJAX" isCamelCase="false">
			<statement>
				<![CDATA[
					UPDATE TN_LAS_CONSULT
					SET MARK_NUM = :vo.mark_num
					WHERE 	CNSLT_NO = :vo.cnslt_no
						AND DEL_YN 	 = 'N'
				]]>				
			</statement>		
		</query>
		

		<!-- LEGARL ADMIN 조회 -->
		<query id="las.lawconsult.listLegalAdmin" isCamelCase="false">
			<statement>
    		<![CDATA[
		    SELECT DISTINCT A.USER_ID, A.EMAIL
		    FROM TB_COM_USER A
		    INNER JOIN TB_COM_ROLE_USER B
		     ON A.USER_ID   = B.USER_ID
		    LEFT OUTER JOIN TB_COM_LEGAL_ADMIN L /* LEGAL ADMIN 수신리스트에 있어야 하는경우 추가 */
		     ON L.COMP_CD = A.COMP_CD
		     AND L.USE_YN = 'Y'
		    WHERE  A.COMP_CD  = :vo.comp_cd
		    AND  A.BLNGT_ORGNZ  = 'A00000001'
		    AND  B.ROLE_CD   in ('RA01','RD01','RM00') /* legal admin에게 매일 발송 */
		    AND  A.EMAIL_RCV_YN = 'Y' /* 2014-02-17 Kevin. 메일수신 여부 조건 추가*/
    		AND A.DELETED=0
		    ]]>
			</statement>
		</query>
				
		<!-- Reviewers 조회 -->
		<query id="las.lawconsult.listReviewer" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT TLCR.CNSLT_NO
    		     , TLCR.RESPMAN_ID AS USER_ID /* SUNGWOO REPLACEMENT 2014-07-30*/
    		     , TCU.USER_NM RESPMAN_NM
    		     , TCU.EMAIL
    		  FROM TN_LAS_CONSULT_RESPMAN TLCR LEFT OUTER JOIN TB_COM_USER TCU
    		  	ON TLCR.RESPMAN_ID = TCU.USER_ID
    		 WHERE TLCR.CNSLT_NO = :vo.cnslt_no
    		 AND   TCU.EMAIL_RCV_YN = 'Y'
               
		    ]]>
			</statement>
		</query>
		
		<!-- Reviewers and LEGARL ADMIN 조회 -->
		<!-- LEGARL ADMIN 제외 by joon  -->
		<query id="las.lawconsult.listReviewerAndLegalAdmin" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT DISTINCT RESPMAN_ID, EMAIL
			FROM
			(
	    		SELECT TLCR.RESPMAN_ID 
	    		     , TCU.EMAIL
	    		  FROM TN_LAS_CONSULT_RESPMAN TLCR LEFT OUTER JOIN TB_COM_USER TCU
	    		  	ON TLCR.RESPMAN_ID = TCU.USER_ID
	    		 WHERE TLCR.CNSLT_NO = :vo.cnslt_no
	    		 AND   TCU.EMAIL_RCV_YN = 'Y'
			) A               
		    ]]>
			</statement>
		</query>
		
	</queries>
		
	
</queryservice>
