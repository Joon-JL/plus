<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE queryservice PUBLIC "-//ANYFRAME//DTD QUERYSERVICE//EN"
"http://www.anyframejava.org/dtd/anyframe-core-query-mapping-3.1.dtd">

<queryservice>
    <queries>
   	<!-- 전자검토자 임시 담당자 지정 목록 -->
		<query id="las.elecreviewer.listChangeReviewer" isCamelCase="false" isDynamic="true">
		  <statement>
		    <![CDATA[
		    SELECT	*
				  FROM	(
				  		SELECT	 T1.*
				  		  		,ROW_NUMBER() OVER(ORDER BY REG_DT DESC ) RN
				  		  		,COUNT(1) OVER() TOTAL_CNT
				  		  FROM	( 	SELECT	TMP_ID
									        ,COMP_CD
									        ,COMP_NM
									        ,ORG_RESP_ID
									        ,ORG_RESP_NM
									        ,ORG_RESP_DEPT
									        ,ORG_RESP_DEPT_NM
									        ,ORG_RESP_JIKGUP_NM
									        ,TMP_RESP_ID
									        ,TMP_RESP_NM
									        ,TMP_RESP_DEPT
									        ,TMP_RESP_DEPT_NM
									        ,TMP_RESP_JIKGUP_NM
									        ,TMP_CAUSE
									        /* ,TO_CHAR(REG_DT,'YYYY-MM-DD') AS REG_DT */
									        ,CONVERT(VARCHAR, CONVERT(DATE, REG_DT), 23) AS REG_DT
									        ,REG_ID
									        ,REG_NM
									        ,DEL_YN
									        /* ,TO_CHAR(DEL_DT,'YYYY-MM-DD') AS DEL_DT */
									        ,CONVERT(VARCHAR, CONVERT(DATE, DEL_DT), 23) AS DEL_DT
									        ,DEL_ID
									        ,DEL_NM
									FROM	TN_LAS_TMPRESP
									WHERE   DEL_YN = 'N'
									/* ORDER BY REG_DT DESC,COMP_NM DESC */
									) T1 ) T2
				WHERE	T2.RN	BETWEEN :vo.start_index AND :vo.end_index
		    ]]>
		  </statement>
		</query>  
		
    	<!-- 전자검토자 조회 -->
		<query id="las.elecreviewer.listReviewers" isCamelCase="false" isDynamic="true">
		  <statement>
		    <![CDATA[
            	SELECT	A.USER_ID
				        ,CASE WHEN :vo.session_user_locale = 'ko' THEN A.USER_NM ELSE A.USER_NM_ENG END AS USER_NM
				        ,CASE WHEN :vo.session_user_locale = 'ko' THEN A.USER_REAL_NM ELSE A.USER_REAL_NM_ENG END AS USER_REAL_NM
				        ,CASE WHEN :vo.session_user_locale = 'ko' THEN A.JIKGUP_NM ELSE A.JIKGUP_NM_ENG END AS JIKGUP_NM
				        ,CASE WHEN :vo.session_user_locale = 'ko' THEN A.DEPT_NM ELSE A.DEPT_NM_ENG END AS DEPT_NM
				        ,A.COMP_CD
				        ,LAS_GET_COMP_NM(A.COMP_CD, :vo.session_user_locale) AS COMP_NM
				        ,C.MNG_COMP_CD
				        ,LAS_GET_COMP_NM(C.MNG_COMP_CD, :vo.session_user_locale) AS MNG_COMP_NM
				        ,A.DEPT_CD
				        ,CASE WHEN D.COMP_CD IS NULL THEN 'N' ELSE 'Y' END CHK_TMP_CD
				FROM    TB_COM_USER A
				        ,TB_COM_ROLE_USER B
				        ,TN_COM_SEC_MNG_COMP C
				        ,(SELECT * FROM TN_LAS_TMPRESP WHERE DEL_YN = 'N') D
				WHERE   1=1 
				AND		A.USER_ID 	= B.USER_ID
				AND     A.USER_ID 	= C.USER_ID
				AND     C.USER_ID   = D.TMP_RESP_ID(+)
				AND     C.MNG_COMP_CD = D.COMP_CD(+) 
				AND 	B.SYS_CD 	= 'LAS' 
				AND 	B.ROLE_CD 	= :vo.role_cd   
				#if (!$vo.srch_user_nm.equals(""))
				AND		( UPPER(A.USER_REAL_NM) LIKE '%' + UPPER( :vo.srch_user_nm ) + '%'
						OR UPPER(A.USER_REAL_NM_ENG) LIKE '%' + UPPER( :vo.srch_user_nm ) + '%' )	
				#end
				ORDER BY A.USER_REAL_NM,C.MNG_COMP_CD                
		    ]]>
		  </statement>
		</query>     		
		
		<!-- 전자검토자 조회>
		<query id="las.elecreviewer.listReviewers2" isCamelCase="false" isDynamic="true">
		  <statement>
		    <![CDATA[
            	SELECT	A.USER_ID
				        ,CASE WHEN :vo.session_user_locale = 'ko' THEN USER_NM ELSE USER_NM_ENG END AS USER_NM
				        ,CASE WHEN :vo.session_user_locale = 'ko' THEN USER_REAL_NM ELSE USER_REAL_NM_ENG END AS USER_REAL_NM
				        ,CASE WHEN :vo.session_user_locale = 'ko' THEN JIKGUP_NM ELSE JIKGUP_NM_ENG END AS JIKGUP_NM
				        ,CASE WHEN :vo.session_user_locale = 'ko' THEN DEPT_NM ELSE DEPT_NM_ENG END AS DEPT_NM
				        ,A.COMP_CD
				        ,LAS_GET_COMP_NM(A.COMP_CD, :vo.session_user_locale) AS COMP_NM
				        ,A.DEPT_CD
				FROM    TB_COM_USER A
				        ,TB_COM_ROLE_USER B
				WHERE   1=1 
				AND		A.USER_ID 	= B.USER_ID 
				AND 	B.SYS_CD 	= 'LAS' 
				AND 	B.ROLE_CD 	= :vo.role_cd   
				#if (!$vo.srch_user_nm.equals(""))
				AND		( UPPER(A.USER_REAL_NM) LIKE '%' + UPPER( :vo.srch_user_nm ) + '%'
						OR UPPER(A.USER_REAL_NM_ENG) LIKE '%' + UPPER( :vo.srch_user_nm ) + '%' )	
				#end
				ORDER BY A.USER_REAL_NM                
		    ]]>
		  </statement>
		</query -->    
		<!-- 전자검토자 조회  -->
		<query id="las.elecreviewer.listReviewers2" isCamelCase="false" isDynamic="true">
		  <statement>
		    <![CDATA[
            	 SELECT  USER_ID
		                ,CASE WHEN :vo.session_user_locale = 'ko' THEN USER_NM ELSE USER_NM_ENG END AS USER_NM
				        ,CASE WHEN :vo.session_user_locale = 'ko' THEN USER_REAL_NM ELSE USER_REAL_NM_ENG END AS USER_REAL_NM
				        ,CASE WHEN :vo.session_user_locale = 'ko' THEN JIKGUP_NM ELSE JIKGUP_NM_ENG END AS JIKGUP_NM
				        ,CASE WHEN :vo.session_user_locale = 'ko' THEN DEPT_NM ELSE DEPT_NM_ENG END AS DEPT_NM
				        ,COMP_CD
				        ,LAS_GET_COMP_NM(COMP_CD, :vo.session_user_locale) AS COMP_NM
		                ,DEPT_CD
		                ,SUBSTRING (MAX (SYS_CONNECT_BY_PATH (MNG_COMP_CD, ',')), 2) MNG_COMP_CD
	   			FROM   (
		                SELECT	A.USER_ID
		                        ,A.USER_NM
		                        ,A.USER_NM_ENG
	                            ,A.USER_REAL_NM
	                            ,A.USER_REAL_NM_ENG
	                            ,A.JIKGUP_NM
	                            ,A.JIKGUP_NM_ENG
	                            ,A.COMP_CD
	                            ,A.DEPT_CD
	                            ,A.DEPT_NM
	                            ,A.DEPT_NM_ENG
	                            ,C.MNG_COMP_CD
	                            ,ROW_NUMBER() OVER (PARTITION BY A.USER_ID ORDER BY C.MNG_COMP_CD ) RNUM            
	                    FROM    TB_COM_USER A
	                    INNER JOIN TB_COM_ROLE_USER B
	                    ON A.USER_ID     	= B.USER_ID 
	                    LEFT OUTER JOIN TN_COM_SEC_MNG_COMP C
	                    ON A.USER_ID     	= C.USER_ID
	                    WHERE   1=1 
	                    AND     B.SYS_CD 	= 'LAS' 
	                    AND     B.ROLE_CD   = :vo.role_cd
	                    #if (!$vo.srch_user_nm.equals(""))
						AND		( UPPER(A.USER_REAL_NM) LIKE '%' + UPPER( :vo.srch_user_nm ) + '%'
								OR UPPER(A.USER_REAL_NM_ENG) LIKE '%' + UPPER( :vo.srch_user_nm ) + '%' )	
						#end
		        	)
		    	START WITH RNUM = 1
		     	CONNECT BY PRIOR RNUM = RNUM - 1 AND PRIOR USER_ID =  USER_ID
		     	GROUP BY USER_ID,USER_NM,USER_NM_ENG,USER_REAL_NM,USER_REAL_NM_ENG,JIKGUP_NM,JIKGUP_NM_ENG,COMP_CD,DEPT_CD,DEPT_NM,DEPT_NM_ENG
		     	ORDER BY USER_REAL_NM               
		    ]]>
		  </statement>
		</query>    
		<!-- primary key 값 생성 -->
		<query id="las.elecreviewer.createPrimaryKey" isCamelCase="false">
			<statement>
    		<![CDATA[
     		SELECT  TO_CHAR(SYSDATE, 'yymmdd') + LPAD(ISNULL(MAX(SUBSTRING(TMP_ID,7))+1,1),3,'0') AS PK
    		  FROM TN_LAS_TMPRESP
    		 WHERE TMP_ID LIKE TO_CHAR(SYSDATE, 'YYMMDD') + '%'
		    ]]>
			</statement>
		</query>
		
		<!-- 임시담당자 지정 - 메인정보 -->
		<query id="las.elecreviewer.insert" isCamelCase="false">
			<statement>
    		<![CDATA[
    		INSERT INTO TN_LAS_TMPRESP (
				 TMP_ID
				,COMP_CD
				,COMP_NM
				,ORG_RESP_ID
				,ORG_RESP_NM
				,ORG_RESP_DEPT
				,ORG_RESP_DEPT_NM
				,ORG_RESP_JIKGUP_NM
				,TMP_RESP_ID
				,TMP_RESP_NM
				,TMP_RESP_DEPT_NM
				,TMP_RESP_JIKGUP_NM
				,TMP_CAUSE
				,REG_DT
				,REG_ID
				,REG_NM
				,DEL_YN
       		 ) VALUES (
			 	 :vo.tmp_id
				,:vo.comp_cd
				,:vo.comp_nm
				,:vo.org_resp_id
				,:vo.org_resp_nm
				,:vo.org_resp_dept
				,:vo.org_resp_dept_nm
				,:vo.org_resp_jikgup_nm
				,:vo.tmp_resp_id
				,:vo.tmp_resp_nm
				,:vo.tmp_resp_dept_nm
				,:vo.tmp_resp_jikgup_nm
				,:vo.tmp_cause
				,SYSDATE
				,:vo.session_user_id
				,:vo.session_user_nm
				,'N'
	        )
   			 ]]>
			</statement>
		</query>
		
		<!-- 임시담당자 지정 - 키값정보 INSERT  -->
		<query id="las.elecreviewer.insertCont" isCamelCase="false">
			<statement>
    		<![CDATA[
    		INSERT INTO TN_LAS_TMPRESP_CONT 
			SELECT TMP_ID, COMP_CD, ROWNUM, CONT_TYPE, CONT_ID 
			 FROM(
			      SELECT :vo.tmp_id TMP_ID
					    ,:vo.comp_cd COMP_CD
					    ,'L' CONT_TYPE
					    , TLC.CNSLT_NO CONT_ID
			        FROM TN_LAS_CONSULT TLC, TN_LAS_CONSULT_RESPMAN TLCR
			       WHERE TLC.CNSLT_NO = TLCR.CNSLT_NO
			         AND TLC.COMP_CD = :vo.comp_cd
			         AND TLC.HSTRY_NO = 0
			         AND TLC.DEL_YN = 'N'
			         AND TLCR.RESPMAN_ID = :vo.org_resp_id
			         AND EXISTS (SELECT 1
			                       FROM TN_LAS_CONSULT_TYPE TLCT
			                      WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
			                        AND TLC.HSTRY_NO = TLCT.HSTRY_NO
			                        AND TLCT.CNSLT_TYPE NOT IN ('A20'))
			       
			       UNION ALL
			       
			       SELECT :vo.tmp_id TMP_ID
					    , :vo.comp_cd COMP_CD
					    ,'S' CONT_TYPE
					    , TLC.CNSLT_NO CONT_ID
			        FROM TN_LAS_CONSULT TLC, TN_LAS_CONSULT_RESPMAN TLCR
			       WHERE TLC.CNSLT_NO = TLCR.CNSLT_NO
			         AND TLC.COMP_CD = :vo.comp_cd
			         AND TLC.HSTRY_NO = 0
			         AND TLC.DEL_YN = 'N'
			         AND TLCR.RESPMAN_ID = :vo.org_resp_id
			         AND EXISTS (SELECT 1
			                       FROM TN_LAS_CONSULT_TYPE TLCT
			                      WHERE TLC.CNSLT_NO = TLCT.CNSLT_NO
			                        AND TLC.HSTRY_NO = TLCT.HSTRY_NO
			                        AND TLCT.CNSLT_TYPE IN ('A20'))
			       
			       /* 계약 들어갈 부분 */
			       UNION ALL
			       
			       SELECT :vo.tmp_id TMP_ID
					    , :vo.comp_cd COMP_CD
					    ,'C' CONT_TYPE 
					    , T1.CNTRT_ID
				   FROM    (
				            SELECT  A.CNTRT_ID, MAX(B.CNSDREQ_ID) CNSDREQ_ID
				            FROM    TN_CLM_CONTRACT_MASTER A
				                    ,TN_CLM_CONTRACT_CNSD B
				                    ,TN_CLM_CONT_CNSDREQ C
				            WHERE A.CNTRT_ID	= B.CNTRT_ID
				            AND   B.CNSDREQ_ID	= C.CNSDREQ_ID
				            AND   C.COMP_CD		= :vo.comp_cd
				            AND   A.DEL_YN		= 'N'
				            AND   C.DEL_YN		= 'N'
				            GROUP BY A.CNTRT_ID
				            ) T1
				            ,TN_CLM_CONT_CNSDREQ_RESPMAN T2
				  WHERE	T1.CNSDREQ_ID = T2.CNSDREQ_ID
				  AND   T2.RESPMAN_ID = :vo.org_resp_id
				  /*AND   NOT EXISTS ( SELECT 1 
                                	FROM TN_CLM_CONTRACT_DEPTCNSD T3
                                	WHERE T1.CNSDREQ_ID = T3.CNSDREQ_ID
                                	AND T3.CNSD_STATUS <> 'C04302')*/
		        )
   			 ]]>
			</statement>
		</query>
		
		<!-- 자문/표준계약서 담당자정보  임시담당자 정보로 업데이트 
		  	 TN_LAS_CONSULT 각 건의 HSTRY_NO 마지막 데이터의 EXTNL_PRGRS_STATUS값이 S02,04인 경우
		-->
		<query id="las.elecreviewer.updateLawConsultRespman" isCamelCase="false">
			<statement>
    		<![CDATA[
    		UPDATE TN_LAS_CONSULT_RESPMAN
    		  SET RESPMAN_ID = :vo.tmp_resp_id
    		    , RESPMAN_NM = (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = :vo.tmp_resp_id)
    		WHERE (CNSLT_NO, RESPMAN_ID) IN
    		                (SELECT TLC.CNSLT_NO, TLCR.RESPMAN_ID
    		                FROM (SELECT CNSLT_NO, HSTRY_NO
    		                        FROM TN_LAS_CONSULT
    		                       WHERE DEL_YN = 'N'
    		                         AND EXTNL_PRGRS_STATUS IN ('S02','S04')
    		                         AND COMP_CD = :vo.comp_cd) TLC
    		                   , (SELECT CNSLT_NO, MAX(HSTRY_NO) HSTRY_NO
    		                        FROM TN_LAS_CONSULT
    		                       WHERE DEL_YN = 'N' 
    		                      GROUP BY CNSLT_NO) MAX_TLC
    		                   , (SELECT CNSLT_NO, RESPMAN_ID
    		                        FROM TN_LAS_CONSULT_RESPMAN
    		                       WHERE RESPMAN_ID = :vo.org_resp_id
    		                         AND DEL_YN = 'N')TLCR
    		               WHERE TLC.CNSLT_NO = MAX_TLC.CNSLT_NO
    		                 AND TLC.HSTRY_NO = MAX_TLC.HSTRY_NO
    		                 AND TLC.CNSLT_NO = TLCR.CNSLT_NO)
   			 ]]>
			</statement>
		</query>
		<!-- 계약 검토 담당자정보  임시담당자 정보로 업데이트  -->
		<query id="las.elecreviewer.updateContCnsdreqRespman" isCamelCase="false">
			<statement>
    		<![CDATA[
    		BEGIN
    		UPDATE TN_CLM_CONT_CNSDREQ_RESPMAN
    		  SET RESPMAN_ID = :vo.tmp_resp_id
    		    , RESPMAN_NM = (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = :vo.tmp_resp_id)
    		WHERE (CNSDREQ_ID, RESPMAN_ID) IN
    		                (SELECT T1.CNSDREQ_ID,T2.RESPMAN_ID
							 FROM    (
							            SELECT  A.CNTRT_ID, MAX(B.CNSDREQ_ID) CNSDREQ_ID
							            FROM    TN_CLM_CONTRACT_MASTER A
							                    ,TN_CLM_CONTRACT_CNSD B
							                    ,TN_CLM_CONT_CNSDREQ C
							            WHERE	A.CNTRT_ID		= B.CNTRT_ID
							            AND   	B.CNSDREQ_ID	= C.CNSDREQ_ID
							            AND     C.COMP_CD 		= :vo.comp_cd
							            AND     A.DEL_YN 		= 'N'
							            AND     C.DEL_YN 		= 'N'
							            GROUP BY A.CNTRT_ID
							            ) T1
							            ,TN_CLM_CONT_CNSDREQ_RESPMAN T2
							WHERE T1.CNSDREQ_ID = T2.CNSDREQ_ID
							AND   T2.RESPMAN_ID = :vo.org_resp_id
							/*AND   NOT EXISTS ( SELECT 1 
							                   FROM TN_CLM_CONTRACT_DEPTCNSD T3
							                   WHERE T1.CNSDREQ_ID = T3.CNSDREQ_ID
							                   AND T3.CNSD_STATUS <> 'C04302')*/
                           );
                           
             UPDATE TN_CLM_CONTRACT_CNSD
             SET	CNSDMAN_ID = :vo.tmp_resp_id
    		    	,CNSDMAN_NM = (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = :vo.tmp_resp_id)
    		 WHERE	(CNSDREQ_ID, CNSDMAN_ID) IN
    		 				(SELECT T1.CNSDREQ_ID,T2.RESPMAN_ID
							 FROM    (
							            SELECT  A.CNTRT_ID, MAX(B.CNSDREQ_ID) CNSDREQ_ID
							            FROM    TN_CLM_CONTRACT_MASTER A
							                    ,TN_CLM_CONTRACT_CNSD B
							                    ,TN_CLM_CONT_CNSDREQ C
							            WHERE	A.CNTRT_ID		= B.CNTRT_ID
							            AND   	B.CNSDREQ_ID	= C.CNSDREQ_ID
							            AND     C.COMP_CD 		= :vo.comp_cd
							            AND     A.DEL_YN 		= 'N'
							            AND     C.DEL_YN 		= 'N'
							            GROUP BY A.CNTRT_ID
							            ) T1
							            ,TN_CLM_CONT_CNSDREQ_RESPMAN T2
							WHERE T1.CNSDREQ_ID = T2.CNSDREQ_ID
							AND   T2.RESPMAN_ID = :vo.org_resp_id
							/*AND   NOT EXISTS ( SELECT 1 
							                   FROM TN_CLM_CONTRACT_DEPTCNSD T3
							                   WHERE T1.CNSDREQ_ID = T3.CNSDREQ_ID
							                   AND T3.CNSD_STATUS <> 'C04302')*/
                           );
			
             UPDATE TN_CLM_CONTRACT_DEPTCNSD
             SET	CNSDMAN_ID = :vo.tmp_resp_id
    		    	,CNSDMAN_NM = (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = :vo.tmp_resp_id)
    		 WHERE	(CNSDREQ_ID, CNSDMAN_ID) IN
    		 				(SELECT T1.CNSDREQ_ID,T2.RESPMAN_ID
							 FROM    (
							            SELECT  A.CNTRT_ID, MAX(B.CNSDREQ_ID) CNSDREQ_ID
							            FROM    TN_CLM_CONTRACT_MASTER A
							                    ,TN_CLM_CONTRACT_CNSD B
							                    ,TN_CLM_CONT_CNSDREQ C
							            WHERE	A.CNTRT_ID		= B.CNTRT_ID
							            AND   	B.CNSDREQ_ID	= C.CNSDREQ_ID
							            AND     C.COMP_CD 		= :vo.comp_cd
							            AND     A.DEL_YN 		= 'N'
							            AND     C.DEL_YN 		= 'N'
							            GROUP BY A.CNTRT_ID
							            ) T1
							            ,TN_CLM_CONT_CNSDREQ_RESPMAN T2
							WHERE T1.CNSDREQ_ID = T2.CNSDREQ_ID
							AND   T2.RESPMAN_ID = :vo.org_resp_id)
			/*AND		CNSD_STATUS = 'C04302'*/
			;
			
    		END;
   			 ]]>
			</statement>
		</query>
		<!-- 자문/표준계약서 담당자 원복 >
		<query id="las.elecreviewer.returnLawConsultRespman" isCamelCase="false">
			<statement>
    		<![CDATA[
    		 UPDATE TN_LAS_CONSULT_RESPMAN
    		  SET RESPMAN_ID = :vo.org_resp_id
    		    , RESPMAN_NM = (SELECT CASE WHEN :vo.session_user_locale= 'ko' THEN USER_NM ELSE USER_NM_ENG END FROM TB_COM_USER WHERE USER_ID = :vo.org_resp_id)
    		WHERE (CNSLT_NO, RESPMAN_ID) IN 
    			   (SELECT CONT_ID, TMP_RESP_ID
    			     FROM TN_LAS_TMPRESP TLT, TN_LAS_TMPRESP_CONT TLTC
    			    WHERE TLT.TMP_ID = TLTC.TMP_ID
                      AND TLT.COMP_CD = TLTC.COMP_CD
                      AND TLT.TMP_ID = :vo.tmp_id
    			      AND TLT.COMP_CD = :vo.comp_cd
    			      AND TLTC.CONT_TYPE IN ('L','S')
    			  )    			          
   			 ]]>
			</statement>
		</query-->
		<!-- 자문/표준계약서 담당자 원복 -->
		<query id="las.elecreviewer.returnLawConsultRespman" isCamelCase="false">
			<statement>
    		<![CDATA[
    		 UPDATE TN_LAS_CONSULT_RESPMAN
    		  SET RESPMAN_ID = :vo.org_resp_id
    		    , RESPMAN_NM = (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = :vo.org_resp_id)
    		WHERE (CNSLT_NO, RESPMAN_ID) IN 
    			   (SELECT	TLC.CNSLT_NO, TLT.TMP_RESP_ID
					FROM    TN_LAS_TMPRESP TLT
							,TN_LAS_CONSULT TLC
					WHERE   TLT.TMP_ID 		= :vo.tmp_id
					AND 	TLT.COMP_CD 	= :vo.comp_cd
					AND 	TLT.COMP_CD 	= TLC.COMP_CD
					AND 	TLC.DEL_YN 		= 'N'
					GROUP BY TLC.CNSLT_NO, TLT.TMP_RESP_ID
    			  )    			          
   			 ]]>
			</statement>
		</query>
		<!-- 계약 검토 담당자 원복 -->
		<query id="las.elecreviewer.returnContCnsdreqRespman" isCamelCase="false">
			<statement>
    		<![CDATA[
    		BEGIN
    		 UPDATE TN_CLM_CONT_CNSDREQ_RESPMAN
    		  SET RESPMAN_ID = :vo.org_resp_id
    		    , RESPMAN_NM = (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = :vo.org_resp_id)
    		WHERE (CNSDREQ_ID, RESPMAN_ID) IN 
    			   (SELECT	TCCR.CNSDREQ_ID, TLT.TMP_RESP_ID
                    FROM	TN_LAS_TMPRESP TLT
                          , TN_CLM_CONTRACT_MASTER TCCM
                          , TN_CLM_CONTRACT_CNSD TCCC
                          , TN_CLM_CONT_CNSDREQ TCCR
                    WHERE TLT.TMP_ID      = :vo.tmp_id
                      AND TLT.COMP_CD     = :vo.comp_cd
                      AND TLT.COMP_CD     = TCCM.COMP_CD
                      AND TCCM.CNTRT_ID   = TCCC.CNTRT_ID
                      AND TCCC.CNSDREQ_ID = TCCR.CNSDREQ_ID
    			  ) ;
    		
    		UPDATE TN_CLM_CONTRACT_CNSD
    		  SET CNSDMAN_ID = :vo.org_resp_id
    		    , CNSDMAN_NM = (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = :vo.org_resp_id)
    		WHERE (CNSDREQ_ID, CNSDMAN_ID) IN 
    			   (SELECT	TCCR.CNSDREQ_ID, TLT.TMP_RESP_ID
                    FROM	TN_LAS_TMPRESP TLT
                          , TN_CLM_CONTRACT_MASTER TCCM
                          , TN_CLM_CONTRACT_CNSD TCCC
                          , TN_CLM_CONT_CNSDREQ TCCR
                    WHERE TLT.TMP_ID      = :vo.tmp_id
                      AND TLT.COMP_CD     = :vo.comp_cd
                      AND TLT.COMP_CD     = TCCM.COMP_CD
                      AND TCCM.CNTRT_ID   = TCCC.CNTRT_ID
                      AND TCCC.CNSDREQ_ID = TCCR.CNSDREQ_ID
    			  ) ;
    			  
    		UPDATE TN_CLM_CONTRACT_DEPTCNSD
    		  SET CNSDMAN_ID = :vo.org_resp_id
    		    , CNSDMAN_NM = (SELECT USER_NM FROM TB_COM_USER WHERE USER_ID = :vo.org_resp_id)
    		WHERE (CNSDREQ_ID, CNSDMAN_ID) IN 
    			   (SELECT	TCCR.CNSDREQ_ID, TLT.TMP_RESP_ID
                    FROM	TN_LAS_TMPRESP TLT
                          , TN_CLM_CONTRACT_MASTER TCCM
                          , TN_CLM_CONTRACT_CNSD TCCC
                          , TN_CLM_CONT_CNSDREQ TCCR
                    WHERE TLT.TMP_ID      = :vo.tmp_id
                      AND TLT.COMP_CD     = :vo.comp_cd
                      AND TLT.COMP_CD     = TCCM.COMP_CD
                      AND TCCM.CNTRT_ID   = TCCC.CNTRT_ID
                      AND TCCC.CNSDREQ_ID = TCCR.CNSDREQ_ID
    			  ) ; 
    			  
    		END;			          
   			 ]]>
			</statement>
		</query>
		<!-- 임시담당자의 현 담당회사코드 백업 -->
		<query id="las.elecreviewer.insertMngComp" isCamelCase="false">
			<statement>
    		<![CDATA[
    		 INSERT INTO TN_LAS_TMPRESP_MNG_COMP
    		 SELECT :vo.tmp_id
    		       ,MNG_COMP_CD
    		   FROM TN_COM_SEC_MNG_COMP
    		  WHERE USER_ID = :vo.tmp_resp_id
   			 ]]>
			</statement>
		</query>
		
		<!-- 원 담당자의 이관하는 회사코드 delete -->
		<query id="las.elecreviewer.deleteOrgMngCompCd" isCamelCase="false">
			<statement>
    		<![CDATA[
    			DELETE 
    			  FROM TN_COM_SEC_MNG_COMP
    			 WHERE USER_ID = :vo.org_resp_id
    			   AND MNG_COMP_CD = :vo.comp_cd
   			 ]]>
			</statement>
		</query>
		
		<!-- 임시담당자의 이관하는 회사코드 delete -->
		<query id="las.elecreviewer.deleteTmpMngCompCd" isCamelCase="false">
			<statement>
    		<![CDATA[
    			DELETE 
    			  FROM TN_COM_SEC_MNG_COMP
    			 WHERE USER_ID = :vo.tmp_resp_id
    			   AND MNG_COMP_CD = :vo.comp_cd
   			 ]]>
			</statement>
		</query>
		
		<!-- 임시 담당자의 관리 회사 코드 존재 여부 -->
		<query id="las.elecreviewer.existTmpMngCompCd" isCamelCase="false">
			<statement>
    		<![CDATA[
    			SELECT COUNT(1) CNT
    			  FROM TN_LAS_TMPRESP_MNG_COMP
    			 WHERE TMP_ID = :vo.tmp_id
    			   and MNG_COMP_CD = :vo.comp_cd
   			 ]]>
			</statement>
		</query>
		
		<!-- 원 담당자의 관리 회사 코드 존재 여부 -->
		<query id="las.elecreviewer.existOrgMngCompCd" isCamelCase="false">
			<statement>
    		<![CDATA[
    			SELECT COUNT(1) CNT
    			  FROM TN_COM_SEC_MNG_COMP
    			 WHERE USER_ID = :vo.org_resp_id
    			   and MNG_COMP_CD = :vo.comp_cd
   			 ]]>
			</statement>
		</query>
		
		<!-- 임시 담당자의 이관받는 회사 코드 INSERT -->
		<query id="las.elecreviewer.insertTmpMngCompCd" isCamelCase="false">
			<statement>
    		<![CDATA[
    			INSERT INTO TN_COM_SEC_MNG_COMP (USER_ID, MNG_COMP_CD, USER_NM, COMP_CD, REG_ID, REG_DT)
                  VALUES (:vo.tmp_resp_id
                         ,:vo.comp_cd
                         ,:vo.tmp_resp_nm
                         ,:vo.session_comp_cd
                         ,:vo.session_user_id
                         ,SYSDATE)
   			 ]]>
			</statement>
		</query>
		
		<!-- 원 담당자의 회사 코드 원복 -->
		<query id="las.elecreviewer.insertOrgMngCompCd" isCamelCase="false">
			<statement>
    		<![CDATA[
    			INSERT INTO TN_COM_SEC_MNG_COMP (USER_ID, MNG_COMP_CD, USER_NM, COMP_CD, REG_ID, REG_DT)
                  VALUES (:vo.org_resp_id
                         ,:vo.comp_cd
                         ,:vo.org_resp_nm
                         ,:vo.session_comp_cd
                         ,:vo.session_user_id
                         ,SYSDATE)
   			 ]]>
			</statement>
		</query>
		
		<!-- 전자검토자 권한이 있는지 없는지 조회 -->
		<query id="las.elecreviewer.isElecreviewer" isCamelCase="false">
			<statement>
    		<![CDATA[
    		SELECT COUNT(1) CNT
    		  FROM TB_COM_ROLE_USER
    		 WHERE SYS_CD = :vo.sys_cd
    		   AND ROLE_CD = 'RB01'
    		   AND USER_ID = :vo.tmp_resp_id
   			 ]]>
			</statement>
		</query>
		
		<!-- 전자검토자 권한 insert -->
		<query id="las.elecreviewer.insertElecreviewerRole" isCamelCase="false">
			<statement>
    		<![CDATA[
    		INSERT INTO TB_COM_ROLE_USER (SYS_CD, ROLE_CD, USER_ID, REG_ID, REG_DT)
                  VALUES (:vo.sys_cd, 'RB01', :vo.tmp_resp_id, :vo.session_user_id, SYSDATE)
   			 ]]>
			</statement>
		</query>
		
		<!-- TN_LAS_TMPRESP_MNG_COMP 해당데이터 삭제 -->
		<query id="las.elecreviewer.deleteTmpMngComp" isCamelCase="false">
			<statement>
    		<![CDATA[
    		 DELETE
    		   FROM TN_LAS_TMPRESP_MNG_COMP
    		  WHERE TMP_ID = :vo.tmp_id
   			 ]]>
			</statement>
		</query>
		
		<!-- TN_LAS_TMPRESP_CONT 해당데이터 삭제 -->
		<query id="las.elecreviewer.deleteTmpCont" isCamelCase="false">
			<statement>
    		<![CDATA[
    		 DELETE
    		   FROM TN_LAS_TMPRESP_CONT
    		  WHERE TMP_ID = :vo.tmp_id
    		    AND COMP_CD = :vo.comp_cd
   			 ]]>
			</statement>
		</query>
		
		
		<!--  TN_LAS_TMPRESP 해당데이터 삭제 -->
		<query id="las.elecreviewer.deleteTmpResp" isCamelCase="false">
			<statement>
    		<![CDATA[
    		 UPDATE TN_LAS_TMPRESP
    		    SET DEL_YN = 'Y'
    		    	,DEL_DT = SYSDATE
    		    	,DEL_ID = :vo.session_user_id
    		    	,DEL_NM = :vo.session_user_nm
    		  WHERE TMP_ID = :vo.tmp_id
    		    AND COMP_CD = :vo.comp_cd
   			 ]]>
			</statement>
		</query>
		
		
    </queries>
</queryservice>